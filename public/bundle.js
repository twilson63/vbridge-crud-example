!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require){function render(state){var components={search:searchComponent.render,newProfile:newProfileComponent.render,showProfile:showProfileComponent.render,editProfile:editProfileComponent.render};return h("div.container",[h("header.container",[h("h1.title",[state.get("title")])]),h(".container",[components[state.get("ref")](state)])])}require("./css");var app=require("vbridge"),h=app.h,page=require("page"),pageBodyParser=require("page-body-parser"),state=app.state({title:"DevBase",ref:"search",profiles:[]});require("services/profiles")();var searchComponent=require("components/search"),newProfileComponent=require("components/new-profile"),showProfileComponent=require("components/show-profile"),editProfileComponent=require("components/edit-profile");[searchComponent,newProfileComponent,showProfileComponent,editProfileComponent].map(function(init){init(state)}),page(),pageBodyParser(),app(document.body,state,render)},{"./css":2,"components/edit-profile":3,"components/new-profile":4,"components/search":5,"components/show-profile":6,page:10,"page-body-parser":9,"services/profiles":7,vbridge:85}],2:[function(require){(function(Buffer){var insertCss=require("insert-css"),normalize=Buffer("LyohIG5vcm1hbGl6ZS5jc3MgdjMuMC4yIHwgTUlUIExpY2Vuc2UgfCBnaXQuaW8vbm9ybWFsaXplICovCgovKioKICogMS4gU2V0IGRlZmF1bHQgZm9udCBmYW1pbHkgdG8gc2Fucy1zZXJpZi4KICogMi4gUHJldmVudCBpT1MgdGV4dCBzaXplIGFkanVzdCBhZnRlciBvcmllbnRhdGlvbiBjaGFuZ2UsIHdpdGhvdXQgZGlzYWJsaW5nCiAqICAgIHVzZXIgem9vbS4KICovCgpodG1sIHsKICBmb250LWZhbWlseTogc2Fucy1zZXJpZjsgLyogMSAqLwogIC1tcy10ZXh0LXNpemUtYWRqdXN0OiAxMDAlOyAvKiAyICovCiAgLXdlYmtpdC10ZXh0LXNpemUtYWRqdXN0OiAxMDAlOyAvKiAyICovCn0KCi8qKgogKiBSZW1vdmUgZGVmYXVsdCBtYXJnaW4uCiAqLwoKYm9keSB7CiAgbWFyZ2luOiAwOwp9CgovKiBIVE1MNSBkaXNwbGF5IGRlZmluaXRpb25zCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgovKioKICogQ29ycmVjdCBgYmxvY2tgIGRpc3BsYXkgbm90IGRlZmluZWQgZm9yIGFueSBIVE1MNSBlbGVtZW50IGluIElFIDgvOS4KICogQ29ycmVjdCBgYmxvY2tgIGRpc3BsYXkgbm90IGRlZmluZWQgZm9yIGBkZXRhaWxzYCBvciBgc3VtbWFyeWAgaW4gSUUgMTAvMTEKICogYW5kIEZpcmVmb3guCiAqIENvcnJlY3QgYGJsb2NrYCBkaXNwbGF5IG5vdCBkZWZpbmVkIGZvciBgbWFpbmAgaW4gSUUgMTEuCiAqLwoKYXJ0aWNsZSwKYXNpZGUsCmRldGFpbHMsCmZpZ2NhcHRpb24sCmZpZ3VyZSwKZm9vdGVyLApoZWFkZXIsCmhncm91cCwKbWFpbiwKbWVudSwKbmF2LApzZWN0aW9uLApzdW1tYXJ5IHsKICBkaXNwbGF5OiBibG9jazsKfQoKLyoqCiAqIDEuIENvcnJlY3QgYGlubGluZS1ibG9ja2AgZGlzcGxheSBub3QgZGVmaW5lZCBpbiBJRSA4LzkuCiAqIDIuIE5vcm1hbGl6ZSB2ZXJ0aWNhbCBhbGlnbm1lbnQgb2YgYHByb2dyZXNzYCBpbiBDaHJvbWUsIEZpcmVmb3gsIGFuZCBPcGVyYS4KICovCgphdWRpbywKY2FudmFzLApwcm9ncmVzcywKdmlkZW8gewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsgLyogMSAqLwogIHZlcnRpY2FsLWFsaWduOiBiYXNlbGluZTsgLyogMiAqLwp9CgovKioKICogUHJldmVudCBtb2Rlcm4gYnJvd3NlcnMgZnJvbSBkaXNwbGF5aW5nIGBhdWRpb2Agd2l0aG91dCBjb250cm9scy4KICogUmVtb3ZlIGV4Y2VzcyBoZWlnaHQgaW4gaU9TIDUgZGV2aWNlcy4KICovCgphdWRpbzpub3QoW2NvbnRyb2xzXSkgewogIGRpc3BsYXk6IG5vbmU7CiAgaGVpZ2h0OiAwOwp9CgovKioKICogQWRkcmVzcyBgW2hpZGRlbl1gIHN0eWxpbmcgbm90IHByZXNlbnQgaW4gSUUgOC85LzEwLgogKiBIaWRlIHRoZSBgdGVtcGxhdGVgIGVsZW1lbnQgaW4gSUUgOC85LzExLCBTYWZhcmksIGFuZCBGaXJlZm94IDwgMjIuCiAqLwoKW2hpZGRlbl0sCnRlbXBsYXRlIHsKICBkaXNwbGF5OiBub25lOwp9CgovKiBMaW5rcwogICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKLyoqCiAqIFJlbW92ZSB0aGUgZ3JheSBiYWNrZ3JvdW5kIGNvbG9yIGZyb20gYWN0aXZlIGxpbmtzIGluIElFIDEwLgogKi8KCmEgewogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Owp9CgovKioKICogSW1wcm92ZSByZWFkYWJpbGl0eSB3aGVuIGZvY3VzZWQgYW5kIGFsc28gbW91c2UgaG92ZXJlZCBpbiBhbGwgYnJvd3NlcnMuCiAqLwoKYTphY3RpdmUsCmE6aG92ZXIgewogIG91dGxpbmU6IDA7Cn0KCi8qIFRleHQtbGV2ZWwgc2VtYW50aWNzCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgovKioKICogQWRkcmVzcyBzdHlsaW5nIG5vdCBwcmVzZW50IGluIElFIDgvOS8xMC8xMSwgU2FmYXJpLCBhbmQgQ2hyb21lLgogKi8KCmFiYnJbdGl0bGVdIHsKICBib3JkZXItYm90dG9tOiAxcHggZG90dGVkOwp9CgovKioKICogQWRkcmVzcyBzdHlsZSBzZXQgdG8gYGJvbGRlcmAgaW4gRmlyZWZveCA0KywgU2FmYXJpLCBhbmQgQ2hyb21lLgogKi8KCmIsCnN0cm9uZyB7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCi8qKgogKiBBZGRyZXNzIHN0eWxpbmcgbm90IHByZXNlbnQgaW4gU2FmYXJpIGFuZCBDaHJvbWUuCiAqLwoKZGZuIHsKICBmb250LXN0eWxlOiBpdGFsaWM7Cn0KCi8qKgogKiBBZGRyZXNzIHZhcmlhYmxlIGBoMWAgZm9udC1zaXplIGFuZCBtYXJnaW4gd2l0aGluIGBzZWN0aW9uYCBhbmQgYGFydGljbGVgCiAqIGNvbnRleHRzIGluIEZpcmVmb3ggNCssIFNhZmFyaSwgYW5kIENocm9tZS4KICovCgpoMSB7CiAgZm9udC1zaXplOiAyZW07CiAgbWFyZ2luOiAwLjY3ZW0gMDsKfQoKLyoqCiAqIEFkZHJlc3Mgc3R5bGluZyBub3QgcHJlc2VudCBpbiBJRSA4LzkuCiAqLwoKbWFyayB7CiAgYmFja2dyb3VuZDogI2ZmMDsKICBjb2xvcjogIzAwMDsKfQoKLyoqCiAqIEFkZHJlc3MgaW5jb25zaXN0ZW50IGFuZCB2YXJpYWJsZSBmb250IHNpemUgaW4gYWxsIGJyb3dzZXJzLgogKi8KCnNtYWxsIHsKICBmb250LXNpemU6IDgwJTsKfQoKLyoqCiAqIFByZXZlbnQgYHN1YmAgYW5kIGBzdXBgIGFmZmVjdGluZyBgbGluZS1oZWlnaHRgIGluIGFsbCBicm93c2Vycy4KICovCgpzdWIsCnN1cCB7CiAgZm9udC1zaXplOiA3NSU7CiAgbGluZS1oZWlnaHQ6IDA7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHZlcnRpY2FsLWFsaWduOiBiYXNlbGluZTsKfQoKc3VwIHsKICB0b3A6IC0wLjVlbTsKfQoKc3ViIHsKICBib3R0b206IC0wLjI1ZW07Cn0KCi8qIEVtYmVkZGVkIGNvbnRlbnQKICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCi8qKgogKiBSZW1vdmUgYm9yZGVyIHdoZW4gaW5zaWRlIGBhYCBlbGVtZW50IGluIElFIDgvOS8xMC4KICovCgppbWcgewogIGJvcmRlcjogMDsKfQoKLyoqCiAqIENvcnJlY3Qgb3ZlcmZsb3cgbm90IGhpZGRlbiBpbiBJRSA5LzEwLzExLgogKi8KCnN2Zzpub3QoOnJvb3QpIHsKICBvdmVyZmxvdzogaGlkZGVuOwp9CgovKiBHcm91cGluZyBjb250ZW50CiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgovKioKICogQWRkcmVzcyBtYXJnaW4gbm90IHByZXNlbnQgaW4gSUUgOC85IGFuZCBTYWZhcmkuCiAqLwoKZmlndXJlIHsKICBtYXJnaW46IDFlbSA0MHB4Owp9CgovKioKICogQWRkcmVzcyBkaWZmZXJlbmNlcyBiZXR3ZWVuIEZpcmVmb3ggYW5kIG90aGVyIGJyb3dzZXJzLgogKi8KCmhyIHsKICAtbW96LWJveC1zaXppbmc6IGNvbnRlbnQtYm94OwogIGJveC1zaXppbmc6IGNvbnRlbnQtYm94OwogIGhlaWdodDogMDsKfQoKLyoqCiAqIENvbnRhaW4gb3ZlcmZsb3cgaW4gYWxsIGJyb3dzZXJzLgogKi8KCnByZSB7CiAgb3ZlcmZsb3c6IGF1dG87Cn0KCi8qKgogKiBBZGRyZXNzIG9kZCBgZW1gLXVuaXQgZm9udCBzaXplIHJlbmRlcmluZyBpbiBhbGwgYnJvd3NlcnMuCiAqLwoKY29kZSwKa2JkLApwcmUsCnNhbXAgewogIGZvbnQtZmFtaWx5OiBtb25vc3BhY2UsIG1vbm9zcGFjZTsKICBmb250LXNpemU6IDFlbTsKfQoKLyogRm9ybXMKICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCi8qKgogKiBLbm93biBsaW1pdGF0aW9uOiBieSBkZWZhdWx0LCBDaHJvbWUgYW5kIFNhZmFyaSBvbiBPUyBYIGFsbG93IHZlcnkgbGltaXRlZAogKiBzdHlsaW5nIG9mIGBzZWxlY3RgLCB1bmxlc3MgYSBgYm9yZGVyYCBwcm9wZXJ0eSBpcyBzZXQuCiAqLwoKLyoqCiAqIDEuIENvcnJlY3QgY29sb3Igbm90IGJlaW5nIGluaGVyaXRlZC4KICogICAgS25vd24gaXNzdWU6IGFmZmVjdHMgY29sb3Igb2YgZGlzYWJsZWQgZWxlbWVudHMuCiAqIDIuIENvcnJlY3QgZm9udCBwcm9wZXJ0aWVzIG5vdCBiZWluZyBpbmhlcml0ZWQuCiAqIDMuIEFkZHJlc3MgbWFyZ2lucyBzZXQgZGlmZmVyZW50bHkgaW4gRmlyZWZveCA0KywgU2FmYXJpLCBhbmQgQ2hyb21lLgogKi8KCmJ1dHRvbiwKaW5wdXQsCm9wdGdyb3VwLApzZWxlY3QsCnRleHRhcmVhIHsKICBjb2xvcjogaW5oZXJpdDsgLyogMSAqLwogIGZvbnQ6IGluaGVyaXQ7IC8qIDIgKi8KICBtYXJnaW46IDA7IC8qIDMgKi8KfQoKLyoqCiAqIEFkZHJlc3MgYG92ZXJmbG93YCBzZXQgdG8gYGhpZGRlbmAgaW4gSUUgOC85LzEwLzExLgogKi8KCmJ1dHRvbiB7CiAgb3ZlcmZsb3c6IHZpc2libGU7Cn0KCi8qKgogKiBBZGRyZXNzIGluY29uc2lzdGVudCBgdGV4dC10cmFuc2Zvcm1gIGluaGVyaXRhbmNlIGZvciBgYnV0dG9uYCBhbmQgYHNlbGVjdGAuCiAqIEFsbCBvdGhlciBmb3JtIGNvbnRyb2wgZWxlbWVudHMgZG8gbm90IGluaGVyaXQgYHRleHQtdHJhbnNmb3JtYCB2YWx1ZXMuCiAqIENvcnJlY3QgYGJ1dHRvbmAgc3R5bGUgaW5oZXJpdGFuY2UgaW4gRmlyZWZveCwgSUUgOC85LzEwLzExLCBhbmQgT3BlcmEuCiAqIENvcnJlY3QgYHNlbGVjdGAgc3R5bGUgaW5oZXJpdGFuY2UgaW4gRmlyZWZveC4KICovCgpidXR0b24sCnNlbGVjdCB7CiAgdGV4dC10cmFuc2Zvcm06IG5vbmU7Cn0KCi8qKgogKiAxLiBBdm9pZCB0aGUgV2ViS2l0IGJ1ZyBpbiBBbmRyb2lkIDQuMC4qIHdoZXJlICgyKSBkZXN0cm95cyBuYXRpdmUgYGF1ZGlvYAogKiAgICBhbmQgYHZpZGVvYCBjb250cm9scy4KICogMi4gQ29ycmVjdCBpbmFiaWxpdHkgdG8gc3R5bGUgY2xpY2thYmxlIGBpbnB1dGAgdHlwZXMgaW4gaU9TLgogKiAzLiBJbXByb3ZlIHVzYWJpbGl0eSBhbmQgY29uc2lzdGVuY3kgb2YgY3Vyc29yIHN0eWxlIGJldHdlZW4gaW1hZ2UtdHlwZQogKiAgICBgaW5wdXRgIGFuZCBvdGhlcnMuCiAqLwoKYnV0dG9uLApodG1sIGlucHV0W3R5cGU9ImJ1dHRvbiJdLCAvKiAxICovCmlucHV0W3R5cGU9InJlc2V0Il0sCmlucHV0W3R5cGU9InN1Ym1pdCJdIHsKICAtd2Via2l0LWFwcGVhcmFuY2U6IGJ1dHRvbjsgLyogMiAqLwogIGN1cnNvcjogcG9pbnRlcjsgLyogMyAqLwp9CgovKioKICogUmUtc2V0IGRlZmF1bHQgY3Vyc29yIGZvciBkaXNhYmxlZCBlbGVtZW50cy4KICovCgpidXR0b25bZGlzYWJsZWRdLApodG1sIGlucHV0W2Rpc2FibGVkXSB7CiAgY3Vyc29yOiBkZWZhdWx0Owp9CgovKioKICogUmVtb3ZlIGlubmVyIHBhZGRpbmcgYW5kIGJvcmRlciBpbiBGaXJlZm94IDQrLgogKi8KCmJ1dHRvbjo6LW1vei1mb2N1cy1pbm5lciwKaW5wdXQ6Oi1tb3otZm9jdXMtaW5uZXIgewogIGJvcmRlcjogMDsKICBwYWRkaW5nOiAwOwp9CgovKioKICogQWRkcmVzcyBGaXJlZm94IDQrIHNldHRpbmcgYGxpbmUtaGVpZ2h0YCBvbiBgaW5wdXRgIHVzaW5nIGAhaW1wb3J0YW50YCBpbgogKiB0aGUgVUEgc3R5bGVzaGVldC4KICovCgppbnB1dCB7CiAgbGluZS1oZWlnaHQ6IG5vcm1hbDsKfQoKLyoqCiAqIEl0J3MgcmVjb21tZW5kZWQgdGhhdCB5b3UgZG9uJ3QgYXR0ZW1wdCB0byBzdHlsZSB0aGVzZSBlbGVtZW50cy4KICogRmlyZWZveCdzIGltcGxlbWVudGF0aW9uIGRvZXNuJ3QgcmVzcGVjdCBib3gtc2l6aW5nLCBwYWRkaW5nLCBvciB3aWR0aC4KICoKICogMS4gQWRkcmVzcyBib3ggc2l6aW5nIHNldCB0byBgY29udGVudC1ib3hgIGluIElFIDgvOS8xMC4KICogMi4gUmVtb3ZlIGV4Y2VzcyBwYWRkaW5nIGluIElFIDgvOS8xMC4KICovCgppbnB1dFt0eXBlPSJjaGVja2JveCJdLAppbnB1dFt0eXBlPSJyYWRpbyJdIHsKICBib3gtc2l6aW5nOiBib3JkZXItYm94OyAvKiAxICovCiAgcGFkZGluZzogMDsgLyogMiAqLwp9CgovKioKICogRml4IHRoZSBjdXJzb3Igc3R5bGUgZm9yIENocm9tZSdzIGluY3JlbWVudC9kZWNyZW1lbnQgYnV0dG9ucy4gRm9yIGNlcnRhaW4KICogYGZvbnQtc2l6ZWAgdmFsdWVzIG9mIHRoZSBgaW5wdXRgLCBpdCBjYXVzZXMgdGhlIGN1cnNvciBzdHlsZSBvZiB0aGUKICogZGVjcmVtZW50IGJ1dHRvbiB0byBjaGFuZ2UgZnJvbSBgZGVmYXVsdGAgdG8gYHRleHRgLgogKi8KCmlucHV0W3R5cGU9Im51bWJlciJdOjotd2Via2l0LWlubmVyLXNwaW4tYnV0dG9uLAppbnB1dFt0eXBlPSJudW1iZXIiXTo6LXdlYmtpdC1vdXRlci1zcGluLWJ1dHRvbiB7CiAgaGVpZ2h0OiBhdXRvOwp9CgovKioKICogMS4gQWRkcmVzcyBgYXBwZWFyYW5jZWAgc2V0IHRvIGBzZWFyY2hmaWVsZGAgaW4gU2FmYXJpIGFuZCBDaHJvbWUuCiAqIDIuIEFkZHJlc3MgYGJveC1zaXppbmdgIHNldCB0byBgYm9yZGVyLWJveGAgaW4gU2FmYXJpIGFuZCBDaHJvbWUKICogICAgKGluY2x1ZGUgYC1tb3pgIHRvIGZ1dHVyZS1wcm9vZikuCiAqLwoKaW5wdXRbdHlwZT0ic2VhcmNoIl0gewogIC13ZWJraXQtYXBwZWFyYW5jZTogdGV4dGZpZWxkOyAvKiAxICovCiAgLW1vei1ib3gtc2l6aW5nOiBjb250ZW50LWJveDsKICAtd2Via2l0LWJveC1zaXppbmc6IGNvbnRlbnQtYm94OyAvKiAyICovCiAgYm94LXNpemluZzogY29udGVudC1ib3g7Cn0KCi8qKgogKiBSZW1vdmUgaW5uZXIgcGFkZGluZyBhbmQgc2VhcmNoIGNhbmNlbCBidXR0b24gaW4gU2FmYXJpIGFuZCBDaHJvbWUgb24gT1MgWC4KICogU2FmYXJpIChidXQgbm90IENocm9tZSkgY2xpcHMgdGhlIGNhbmNlbCBidXR0b24gd2hlbiB0aGUgc2VhcmNoIGlucHV0IGhhcwogKiBwYWRkaW5nIChhbmQgYHRleHRmaWVsZGAgYXBwZWFyYW5jZSkuCiAqLwoKaW5wdXRbdHlwZT0ic2VhcmNoIl06Oi13ZWJraXQtc2VhcmNoLWNhbmNlbC1idXR0b24sCmlucHV0W3R5cGU9InNlYXJjaCJdOjotd2Via2l0LXNlYXJjaC1kZWNvcmF0aW9uIHsKICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7Cn0KCi8qKgogKiBEZWZpbmUgY29uc2lzdGVudCBib3JkZXIsIG1hcmdpbiwgYW5kIHBhZGRpbmcuCiAqLwoKZmllbGRzZXQgewogIGJvcmRlcjogMXB4IHNvbGlkICNjMGMwYzA7CiAgbWFyZ2luOiAwIDJweDsKICBwYWRkaW5nOiAwLjM1ZW0gMC42MjVlbSAwLjc1ZW07Cn0KCi8qKgogKiAxLiBDb3JyZWN0IGBjb2xvcmAgbm90IGJlaW5nIGluaGVyaXRlZCBpbiBJRSA4LzkvMTAvMTEuCiAqIDIuIFJlbW92ZSBwYWRkaW5nIHNvIHBlb3BsZSBhcmVuJ3QgY2F1Z2h0IG91dCBpZiB0aGV5IHplcm8gb3V0IGZpZWxkc2V0cy4KICovCgpsZWdlbmQgewogIGJvcmRlcjogMDsgLyogMSAqLwogIHBhZGRpbmc6IDA7IC8qIDIgKi8KfQoKLyoqCiAqIFJlbW92ZSBkZWZhdWx0IHZlcnRpY2FsIHNjcm9sbGJhciBpbiBJRSA4LzkvMTAvMTEuCiAqLwoKdGV4dGFyZWEgewogIG92ZXJmbG93OiBhdXRvOwp9CgovKioKICogRG9uJ3QgaW5oZXJpdCB0aGUgYGZvbnQtd2VpZ2h0YCAoYXBwbGllZCBieSBhIHJ1bGUgYWJvdmUpLgogKiBOT1RFOiB0aGUgZGVmYXVsdCBjYW5ub3Qgc2FmZWx5IGJlIGNoYW5nZWQgaW4gQ2hyb21lIGFuZCBTYWZhcmkgb24gT1MgWC4KICovCgpvcHRncm91cCB7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCi8qIFRhYmxlcwogICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKLyoqCiAqIFJlbW92ZSBtb3N0IHNwYWNpbmcgYmV0d2VlbiB0YWJsZSBjZWxscy4KICovCgp0YWJsZSB7CiAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKICBib3JkZXItc3BhY2luZzogMDsKfQoKdGQsCnRoIHsKICBwYWRkaW5nOiAwOwp9","base64"),skeleton=Buffer("LyoKKiBTa2VsZXRvbiBWMi4wLjQKKiBDb3B5cmlnaHQgMjAxNCwgRGF2ZSBHYW1hY2hlCiogd3d3LmdldHNrZWxldG9uLmNvbQoqIEZyZWUgdG8gdXNlIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KKiBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocAoqIDEyLzI5LzIwMTQKKi8KCgovKiBUYWJsZSBvZiBjb250ZW50cwrigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJMKLSBHcmlkCi0gQmFzZSBTdHlsZXMKLSBUeXBvZ3JhcGh5Ci0gTGlua3MKLSBCdXR0b25zCi0gRm9ybXMKLSBMaXN0cwotIENvZGUKLSBUYWJsZXMKLSBTcGFjaW5nCi0gVXRpbGl0aWVzCi0gQ2xlYXJpbmcKLSBNZWRpYSBRdWVyaWVzCiovCgoKLyogR3JpZArigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJMgKi8KLmNvbnRhaW5lciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiAxMDAlOwogIG1heC13aWR0aDogOTYwcHg7CiAgbWFyZ2luOiAwIGF1dG87CiAgcGFkZGluZzogMCAyMHB4OwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KLmNvbHVtbiwKLmNvbHVtbnMgewogIHdpZHRoOiAxMDAlOwogIGZsb2F0OiBsZWZ0OwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KCi8qIEZvciBkZXZpY2VzIGxhcmdlciB0aGFuIDQwMHB4ICovCkBtZWRpYSAobWluLXdpZHRoOiA0MDBweCkgewogIC5jb250YWluZXIgewogICAgd2lkdGg6IDg1JTsKICAgIHBhZGRpbmc6IDA7IH0KfQoKLyogRm9yIGRldmljZXMgbGFyZ2VyIHRoYW4gNTUwcHggKi8KQG1lZGlhIChtaW4td2lkdGg6IDU1MHB4KSB7CiAgLmNvbnRhaW5lciB7CiAgICB3aWR0aDogODAlOyB9CiAgLmNvbHVtbiwKICAuY29sdW1ucyB7CiAgICBtYXJnaW4tbGVmdDogNCU7IH0KICAuY29sdW1uOmZpcnN0LWNoaWxkLAogIC5jb2x1bW5zOmZpcnN0LWNoaWxkIHsKICAgIG1hcmdpbi1sZWZ0OiAwOyB9CgogIC5vbmUuY29sdW1uLAogIC5vbmUuY29sdW1ucyAgICAgICAgICAgICAgICAgICAgeyB3aWR0aDogNC42NjY2NjY2NjY2NyU7IH0KICAudHdvLmNvbHVtbnMgICAgICAgICAgICAgICAgICAgIHsgd2lkdGg6IDEzLjMzMzMzMzMzMzMlOyB9CiAgLnRocmVlLmNvbHVtbnMgICAgICAgICAgICAgICAgICB7IHdpZHRoOiAyMiU7ICAgICAgICAgICAgfQogIC5mb3VyLmNvbHVtbnMgICAgICAgICAgICAgICAgICAgeyB3aWR0aDogMzAuNjY2NjY2NjY2NyU7IH0KICAuZml2ZS5jb2x1bW5zICAgICAgICAgICAgICAgICAgIHsgd2lkdGg6IDM5LjMzMzMzMzMzMzMlOyB9CiAgLnNpeC5jb2x1bW5zICAgICAgICAgICAgICAgICAgICB7IHdpZHRoOiA0OCU7ICAgICAgICAgICAgfQogIC5zZXZlbi5jb2x1bW5zICAgICAgICAgICAgICAgICAgeyB3aWR0aDogNTYuNjY2NjY2NjY2NyU7IH0KICAuZWlnaHQuY29sdW1ucyAgICAgICAgICAgICAgICAgIHsgd2lkdGg6IDY1LjMzMzMzMzMzMzMlOyB9CiAgLm5pbmUuY29sdW1ucyAgICAgICAgICAgICAgICAgICB7IHdpZHRoOiA3NC4wJTsgICAgICAgICAgfQogIC50ZW4uY29sdW1ucyAgICAgICAgICAgICAgICAgICAgeyB3aWR0aDogODIuNjY2NjY2NjY2NyU7IH0KICAuZWxldmVuLmNvbHVtbnMgICAgICAgICAgICAgICAgIHsgd2lkdGg6IDkxLjMzMzMzMzMzMzMlOyB9CiAgLnR3ZWx2ZS5jb2x1bW5zICAgICAgICAgICAgICAgICB7IHdpZHRoOiAxMDAlOyBtYXJnaW4tbGVmdDogMDsgfQoKICAub25lLXRoaXJkLmNvbHVtbiAgICAgICAgICAgICAgIHsgd2lkdGg6IDMwLjY2NjY2NjY2NjclOyB9CiAgLnR3by10aGlyZHMuY29sdW1uICAgICAgICAgICAgICB7IHdpZHRoOiA2NS4zMzMzMzMzMzMzJTsgfQoKICAub25lLWhhbGYuY29sdW1uICAgICAgICAgICAgICAgIHsgd2lkdGg6IDQ4JTsgfQoKICAvKiBPZmZzZXRzICovCiAgLm9mZnNldC1ieS1vbmUuY29sdW1uLAogIC5vZmZzZXQtYnktb25lLmNvbHVtbnMgICAgICAgICAgeyBtYXJnaW4tbGVmdDogOC42NjY2NjY2NjY2NyU7IH0KICAub2Zmc2V0LWJ5LXR3by5jb2x1bW4sCiAgLm9mZnNldC1ieS10d28uY29sdW1ucyAgICAgICAgICB7IG1hcmdpbi1sZWZ0OiAxNy4zMzMzMzMzMzMzJTsgfQogIC5vZmZzZXQtYnktdGhyZWUuY29sdW1uLAogIC5vZmZzZXQtYnktdGhyZWUuY29sdW1ucyAgICAgICAgeyBtYXJnaW4tbGVmdDogMjYlOyAgICAgICAgICAgIH0KICAub2Zmc2V0LWJ5LWZvdXIuY29sdW1uLAogIC5vZmZzZXQtYnktZm91ci5jb2x1bW5zICAgICAgICAgeyBtYXJnaW4tbGVmdDogMzQuNjY2NjY2NjY2NyU7IH0KICAub2Zmc2V0LWJ5LWZpdmUuY29sdW1uLAogIC5vZmZzZXQtYnktZml2ZS5jb2x1bW5zICAgICAgICAgeyBtYXJnaW4tbGVmdDogNDMuMzMzMzMzMzMzMyU7IH0KICAub2Zmc2V0LWJ5LXNpeC5jb2x1bW4sCiAgLm9mZnNldC1ieS1zaXguY29sdW1ucyAgICAgICAgICB7IG1hcmdpbi1sZWZ0OiA1MiU7ICAgICAgICAgICAgfQogIC5vZmZzZXQtYnktc2V2ZW4uY29sdW1uLAogIC5vZmZzZXQtYnktc2V2ZW4uY29sdW1ucyAgICAgICAgeyBtYXJnaW4tbGVmdDogNjAuNjY2NjY2NjY2NyU7IH0KICAub2Zmc2V0LWJ5LWVpZ2h0LmNvbHVtbiwKICAub2Zmc2V0LWJ5LWVpZ2h0LmNvbHVtbnMgICAgICAgIHsgbWFyZ2luLWxlZnQ6IDY5LjMzMzMzMzMzMzMlOyB9CiAgLm9mZnNldC1ieS1uaW5lLmNvbHVtbiwKICAub2Zmc2V0LWJ5LW5pbmUuY29sdW1ucyAgICAgICAgIHsgbWFyZ2luLWxlZnQ6IDc4LjAlOyAgICAgICAgICB9CiAgLm9mZnNldC1ieS10ZW4uY29sdW1uLAogIC5vZmZzZXQtYnktdGVuLmNvbHVtbnMgICAgICAgICAgeyBtYXJnaW4tbGVmdDogODYuNjY2NjY2NjY2NyU7IH0KICAub2Zmc2V0LWJ5LWVsZXZlbi5jb2x1bW4sCiAgLm9mZnNldC1ieS1lbGV2ZW4uY29sdW1ucyAgICAgICB7IG1hcmdpbi1sZWZ0OiA5NS4zMzMzMzMzMzMzJTsgfQoKICAub2Zmc2V0LWJ5LW9uZS10aGlyZC5jb2x1bW4sCiAgLm9mZnNldC1ieS1vbmUtdGhpcmQuY29sdW1ucyAgICB7IG1hcmdpbi1sZWZ0OiAzNC42NjY2NjY2NjY3JTsgfQogIC5vZmZzZXQtYnktdHdvLXRoaXJkcy5jb2x1bW4sCiAgLm9mZnNldC1ieS10d28tdGhpcmRzLmNvbHVtbnMgICB7IG1hcmdpbi1sZWZ0OiA2OS4zMzMzMzMzMzMzJTsgfQoKICAub2Zmc2V0LWJ5LW9uZS1oYWxmLmNvbHVtbiwKICAub2Zmc2V0LWJ5LW9uZS1oYWxmLmNvbHVtbnMgICAgIHsgbWFyZ2luLWxlZnQ6IDUyJTsgfQoKfQoKCi8qIEJhc2UgU3R5bGVzCuKAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAkyAqLwovKiBOT1RFCmh0bWwgaXMgc2V0IHRvIDYyLjUlIHNvIHRoYXQgYWxsIHRoZSBSRU0gbWVhc3VyZW1lbnRzIHRocm91Z2hvdXQgU2tlbGV0b24KYXJlIGJhc2VkIG9uIDEwcHggc2l6aW5nLiBTbyBiYXNpY2FsbHkgMS41cmVtID0gMTVweCA6KSAqLwpodG1sIHsKICBmb250LXNpemU6IDYyLjUlOyB9CmJvZHkgewogIGZvbnQtc2l6ZTogMS41ZW07IC8qIGN1cnJlbnRseSBlbXMgY2F1c2UgY2hyb21lIGJ1ZyBtaXNpbnRlcnByZXRpbmcgcmVtcyBvbiBib2R5IGVsZW1lbnQgKi8KICBsaW5lLWhlaWdodDogMS42OwogIGZvbnQtd2VpZ2h0OiA0MDA7CiAgZm9udC1mYW1pbHk6ICJSYWxld2F5IiwgIkhlbHZldGljYU5ldWUiLCAiSGVsdmV0aWNhIE5ldWUiLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogIGNvbG9yOiAjMjIyOyB9CgoKLyogVHlwb2dyYXBoeQrigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJMgKi8KaDEsIGgyLCBoMywgaDQsIGg1LCBoNiB7CiAgbWFyZ2luLXRvcDogMDsKICBtYXJnaW4tYm90dG9tOiAycmVtOwogIGZvbnQtd2VpZ2h0OiAzMDA7IH0KaDEgeyBmb250LXNpemU6IDQuMHJlbTsgbGluZS1oZWlnaHQ6IDEuMjsgIGxldHRlci1zcGFjaW5nOiAtLjFyZW07fQpoMiB7IGZvbnQtc2l6ZTogMy42cmVtOyBsaW5lLWhlaWdodDogMS4yNTsgbGV0dGVyLXNwYWNpbmc6IC0uMXJlbTsgfQpoMyB7IGZvbnQtc2l6ZTogMy4wcmVtOyBsaW5lLWhlaWdodDogMS4zOyAgbGV0dGVyLXNwYWNpbmc6IC0uMXJlbTsgfQpoNCB7IGZvbnQtc2l6ZTogMi40cmVtOyBsaW5lLWhlaWdodDogMS4zNTsgbGV0dGVyLXNwYWNpbmc6IC0uMDhyZW07IH0KaDUgeyBmb250LXNpemU6IDEuOHJlbTsgbGluZS1oZWlnaHQ6IDEuNTsgIGxldHRlci1zcGFjaW5nOiAtLjA1cmVtOyB9Cmg2IHsgZm9udC1zaXplOiAxLjVyZW07IGxpbmUtaGVpZ2h0OiAxLjY7ICBsZXR0ZXItc3BhY2luZzogMDsgfQoKLyogTGFyZ2VyIHRoYW4gcGhhYmxldCAqLwpAbWVkaWEgKG1pbi13aWR0aDogNTUwcHgpIHsKICBoMSB7IGZvbnQtc2l6ZTogNS4wcmVtOyB9CiAgaDIgeyBmb250LXNpemU6IDQuMnJlbTsgfQogIGgzIHsgZm9udC1zaXplOiAzLjZyZW07IH0KICBoNCB7IGZvbnQtc2l6ZTogMy4wcmVtOyB9CiAgaDUgeyBmb250LXNpemU6IDIuNHJlbTsgfQogIGg2IHsgZm9udC1zaXplOiAxLjVyZW07IH0KfQoKcCB7CiAgbWFyZ2luLXRvcDogMDsgfQoKCi8qIExpbmtzCuKAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAkyAqLwphIHsKICBjb2xvcjogIzFFQUVEQjsgfQphOmhvdmVyIHsKICBjb2xvcjogIzBGQTBDRTsgfQoKCi8qIEJ1dHRvbnMK4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCTICovCi5idXR0b24sCmJ1dHRvbiwKaW5wdXRbdHlwZT0ic3VibWl0Il0sCmlucHV0W3R5cGU9InJlc2V0Il0sCmlucHV0W3R5cGU9ImJ1dHRvbiJdIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgaGVpZ2h0OiAzOHB4OwogIHBhZGRpbmc6IDAgMzBweDsKICBjb2xvcjogIzU1NTsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgZm9udC1zaXplOiAxMXB4OwogIGZvbnQtd2VpZ2h0OiA2MDA7CiAgbGluZS1oZWlnaHQ6IDM4cHg7CiAgbGV0dGVyLXNwYWNpbmc6IC4xcmVtOwogIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwogIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGJvcmRlcjogMXB4IHNvbGlkICNiYmI7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KLmJ1dHRvbjpob3ZlciwKYnV0dG9uOmhvdmVyLAppbnB1dFt0eXBlPSJzdWJtaXQiXTpob3ZlciwKaW5wdXRbdHlwZT0icmVzZXQiXTpob3ZlciwKaW5wdXRbdHlwZT0iYnV0dG9uIl06aG92ZXIsCi5idXR0b246Zm9jdXMsCmJ1dHRvbjpmb2N1cywKaW5wdXRbdHlwZT0ic3VibWl0Il06Zm9jdXMsCmlucHV0W3R5cGU9InJlc2V0Il06Zm9jdXMsCmlucHV0W3R5cGU9ImJ1dHRvbiJdOmZvY3VzIHsKICBjb2xvcjogIzMzMzsKICBib3JkZXItY29sb3I6ICM4ODg7CiAgb3V0bGluZTogMDsgfQouYnV0dG9uLmJ1dHRvbi1wcmltYXJ5LApidXR0b24uYnV0dG9uLXByaW1hcnksCmlucHV0W3R5cGU9InN1Ym1pdCJdLmJ1dHRvbi1wcmltYXJ5LAppbnB1dFt0eXBlPSJyZXNldCJdLmJ1dHRvbi1wcmltYXJ5LAppbnB1dFt0eXBlPSJidXR0b24iXS5idXR0b24tcHJpbWFyeSB7CiAgY29sb3I6ICNGRkY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzQzNGMDsKICBib3JkZXItY29sb3I6ICMzM0MzRjA7IH0KLmJ1dHRvbi5idXR0b24tcHJpbWFyeTpob3ZlciwKYnV0dG9uLmJ1dHRvbi1wcmltYXJ5OmhvdmVyLAppbnB1dFt0eXBlPSJzdWJtaXQiXS5idXR0b24tcHJpbWFyeTpob3ZlciwKaW5wdXRbdHlwZT0icmVzZXQiXS5idXR0b24tcHJpbWFyeTpob3ZlciwKaW5wdXRbdHlwZT0iYnV0dG9uIl0uYnV0dG9uLXByaW1hcnk6aG92ZXIsCi5idXR0b24uYnV0dG9uLXByaW1hcnk6Zm9jdXMsCmJ1dHRvbi5idXR0b24tcHJpbWFyeTpmb2N1cywKaW5wdXRbdHlwZT0ic3VibWl0Il0uYnV0dG9uLXByaW1hcnk6Zm9jdXMsCmlucHV0W3R5cGU9InJlc2V0Il0uYnV0dG9uLXByaW1hcnk6Zm9jdXMsCmlucHV0W3R5cGU9ImJ1dHRvbiJdLmJ1dHRvbi1wcmltYXJ5OmZvY3VzIHsKICBjb2xvcjogI0ZGRjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMUVBRURCOwogIGJvcmRlci1jb2xvcjogIzFFQUVEQjsgfQoKCi8qIEZvcm1zCuKAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAkyAqLwppbnB1dFt0eXBlPSJlbWFpbCJdLAppbnB1dFt0eXBlPSJudW1iZXIiXSwKaW5wdXRbdHlwZT0ic2VhcmNoIl0sCmlucHV0W3R5cGU9InRleHQiXSwKaW5wdXRbdHlwZT0idGVsIl0sCmlucHV0W3R5cGU9InVybCJdLAppbnB1dFt0eXBlPSJwYXNzd29yZCJdLAp0ZXh0YXJlYSwKc2VsZWN0IHsKICBoZWlnaHQ6IDM4cHg7CiAgcGFkZGluZzogNnB4IDEwcHg7IC8qIFRoZSA2cHggdmVydGljYWxseSBjZW50ZXJzIHRleHQgb24gRkYsIGlnbm9yZWQgYnkgV2Via2l0ICovCiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBib3JkZXI6IDFweCBzb2xpZCAjRDFEMUQxOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBib3gtc2hhZG93OiBub25lOwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KLyogUmVtb3ZlcyBhd2t3YXJkIGRlZmF1bHQgc3R5bGVzIG9uIHNvbWUgaW5wdXRzIGZvciBpT1MgKi8KaW5wdXRbdHlwZT0iZW1haWwiXSwKaW5wdXRbdHlwZT0ibnVtYmVyIl0sCmlucHV0W3R5cGU9InNlYXJjaCJdLAppbnB1dFt0eXBlPSJ0ZXh0Il0sCmlucHV0W3R5cGU9InRlbCJdLAppbnB1dFt0eXBlPSJ1cmwiXSwKaW5wdXRbdHlwZT0icGFzc3dvcmQiXSwKdGV4dGFyZWEgewogIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgICAtbW96LWFwcGVhcmFuY2U6IG5vbmU7CiAgICAgICAgICBhcHBlYXJhbmNlOiBub25lOyB9CnRleHRhcmVhIHsKICBtaW4taGVpZ2h0OiA2NXB4OwogIHBhZGRpbmctdG9wOiA2cHg7CiAgcGFkZGluZy1ib3R0b206IDZweDsgfQppbnB1dFt0eXBlPSJlbWFpbCJdOmZvY3VzLAppbnB1dFt0eXBlPSJudW1iZXIiXTpmb2N1cywKaW5wdXRbdHlwZT0ic2VhcmNoIl06Zm9jdXMsCmlucHV0W3R5cGU9InRleHQiXTpmb2N1cywKaW5wdXRbdHlwZT0idGVsIl06Zm9jdXMsCmlucHV0W3R5cGU9InVybCJdOmZvY3VzLAppbnB1dFt0eXBlPSJwYXNzd29yZCJdOmZvY3VzLAp0ZXh0YXJlYTpmb2N1cywKc2VsZWN0OmZvY3VzIHsKICBib3JkZXI6IDFweCBzb2xpZCAjMzNDM0YwOwogIG91dGxpbmU6IDA7IH0KbGFiZWwsCmxlZ2VuZCB7CiAgZGlzcGxheTogYmxvY2s7CiAgbWFyZ2luLWJvdHRvbTogLjVyZW07CiAgZm9udC13ZWlnaHQ6IDYwMDsgfQpmaWVsZHNldCB7CiAgcGFkZGluZzogMDsKICBib3JkZXItd2lkdGg6IDA7IH0KaW5wdXRbdHlwZT0iY2hlY2tib3giXSwKaW5wdXRbdHlwZT0icmFkaW8iXSB7CiAgZGlzcGxheTogaW5saW5lOyB9CmxhYmVsID4gLmxhYmVsLWJvZHkgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBtYXJnaW4tbGVmdDogLjVyZW07CiAgZm9udC13ZWlnaHQ6IG5vcm1hbDsgfQoKCi8qIExpc3RzCuKAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAkyAqLwp1bCB7CiAgbGlzdC1zdHlsZTogY2lyY2xlIGluc2lkZTsgfQpvbCB7CiAgbGlzdC1zdHlsZTogZGVjaW1hbCBpbnNpZGU7IH0Kb2wsIHVsIHsKICBwYWRkaW5nLWxlZnQ6IDA7CiAgbWFyZ2luLXRvcDogMDsgfQp1bCB1bCwKdWwgb2wsCm9sIG9sLApvbCB1bCB7CiAgbWFyZ2luOiAxLjVyZW0gMCAxLjVyZW0gM3JlbTsKICBmb250LXNpemU6IDkwJTsgfQpsaSB7CiAgbWFyZ2luLWJvdHRvbTogMXJlbTsgfQoKCi8qIENvZGUK4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCTICovCmNvZGUgewogIHBhZGRpbmc6IC4ycmVtIC41cmVtOwogIG1hcmdpbjogMCAuMnJlbTsKICBmb250LXNpemU6IDkwJTsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwogIGJhY2tncm91bmQ6ICNGMUYxRjE7CiAgYm9yZGVyOiAxcHggc29saWQgI0UxRTFFMTsKICBib3JkZXItcmFkaXVzOiA0cHg7IH0KcHJlID4gY29kZSB7CiAgZGlzcGxheTogYmxvY2s7CiAgcGFkZGluZzogMXJlbSAxLjVyZW07CiAgd2hpdGUtc3BhY2U6IHByZTsgfQoKCi8qIFRhYmxlcwrigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJMgKi8KdGgsCnRkIHsKICBwYWRkaW5nOiAxMnB4IDE1cHg7CiAgdGV4dC1hbGlnbjogbGVmdDsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0UxRTFFMTsgfQp0aDpmaXJzdC1jaGlsZCwKdGQ6Zmlyc3QtY2hpbGQgewogIHBhZGRpbmctbGVmdDogMDsgfQp0aDpsYXN0LWNoaWxkLAp0ZDpsYXN0LWNoaWxkIHsKICBwYWRkaW5nLXJpZ2h0OiAwOyB9CgoKLyogU3BhY2luZwrigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJMgKi8KYnV0dG9uLAouYnV0dG9uIHsKICBtYXJnaW4tYm90dG9tOiAxcmVtOyB9CmlucHV0LAp0ZXh0YXJlYSwKc2VsZWN0LApmaWVsZHNldCB7CiAgbWFyZ2luLWJvdHRvbTogMS41cmVtOyB9CnByZSwKYmxvY2txdW90ZSwKZGwsCmZpZ3VyZSwKdGFibGUsCnAsCnVsLApvbCwKZm9ybSB7CiAgbWFyZ2luLWJvdHRvbTogMi41cmVtOyB9CgoKLyogVXRpbGl0aWVzCuKAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAk+KAkyAqLwoudS1mdWxsLXdpZHRoIHsKICB3aWR0aDogMTAwJTsKICBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9Ci51LW1heC1mdWxsLXdpZHRoIHsKICBtYXgtd2lkdGg6IDEwMCU7CiAgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQoudS1wdWxsLXJpZ2h0IHsKICBmbG9hdDogcmlnaHQ7IH0KLnUtcHVsbC1sZWZ0IHsKICBmbG9hdDogbGVmdDsgfQoKCi8qIE1pc2MK4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCT4oCTICovCmhyIHsKICBtYXJnaW4tdG9wOiAzcmVtOwogIG1hcmdpbi1ib3R0b206IDMuNXJlbTsKICBib3JkZXItd2lkdGg6IDA7CiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNFMUUxRTE7IH0KCgovKiBDbGVhcmluZwrigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJMgKi8KCi8qIFNlbGYgQ2xlYXJpbmcgR29vZG5lc3MgKi8KLmNvbnRhaW5lcjphZnRlciwKLnJvdzphZnRlciwKLnUtY2YgewogIGNvbnRlbnQ6ICIiOwogIGRpc3BsYXk6IHRhYmxlOwogIGNsZWFyOiBib3RoOyB9CgoKLyogTWVkaWEgUXVlcmllcwrigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJPigJMgKi8KLyoKTm90ZTogVGhlIGJlc3Qgd2F5IHRvIHN0cnVjdHVyZSB0aGUgdXNlIG9mIG1lZGlhIHF1ZXJpZXMgaXMgdG8gY3JlYXRlIHRoZSBxdWVyaWVzCm5lYXIgdGhlIHJlbGV2YW50IGNvZGUuIEZvciBleGFtcGxlLCBpZiB5b3Ugd2FudGVkIHRvIGNoYW5nZSB0aGUgc3R5bGVzIGZvciBidXR0b25zCm9uIHNtYWxsIGRldmljZXMsIHBhc3RlIHRoZSBtb2JpbGUgcXVlcnkgY29kZSB1cCBpbiB0aGUgYnV0dG9ucyBzZWN0aW9uIGFuZCBzdHlsZSBpdAp0aGVyZS4KKi8KCgovKiBMYXJnZXIgdGhhbiBtb2JpbGUgKi8KQG1lZGlhIChtaW4td2lkdGg6IDQwMHB4KSB7fQoKLyogTGFyZ2VyIHRoYW4gcGhhYmxldCAoYWxzbyBwb2ludCB3aGVuIGdyaWQgYmVjb21lcyBhY3RpdmUpICovCkBtZWRpYSAobWluLXdpZHRoOiA1NTBweCkge30KCi8qIExhcmdlciB0aGFuIHRhYmxldCAqLwpAbWVkaWEgKG1pbi13aWR0aDogNzUwcHgpIHt9CgovKiBMYXJnZXIgdGhhbiBkZXNrdG9wICovCkBtZWRpYSAobWluLXdpZHRoOiAxMDAwcHgpIHt9CgovKiBMYXJnZXIgdGhhbiBEZXNrdG9wIEhEICovCkBtZWRpYSAobWluLXdpZHRoOiAxMjAwcHgpIHt9Cg==","base64");insertCss(normalize),insertCss(skeleton),insertCss(".button-bar .button { margin-right: 3px; }"),insertCss("textarea { height: 160px; }")}).call(this,require("buffer").Buffer)},{buffer:127,"insert-css":8}],3:[function(require,module){function profile(state){ee.on("profile:get-edit-response",function(doc){console.log("edit response"),state.set("profile",doc.object),state.set("ref","editProfile")}),ee.on("profile:updated",function(doc){page.redirect("/profiles/"+doc.object._id+"/show")}),page("/profiles/:id/edit",function(ctx){ee.emit("post",{object:{type:"profile",_id:ctx.params.id},verb:"get-edit"})}),page("/profiles/:id/update",function(ctx){ee.emit("post",{verb:"update",object:ctx.body,actor:null})})}function render(state){var profile=state.get("profile");return h("div",[h(".row",[h(".twelve.columns",[h("form",{action:"/profiles/"+profile._id+"/update",method:"POST"},[h("input",{type:"hidden",name:"_id",value:profile._id}),h("input",{type:"hidden",name:"_rev",value:profile._rev}),h("input",{type:"hidden",name:"type",value:"profile"}),h("fieldset",[h("label","Name"),h("input.u-full-width",{type:"text",name:"name",value:profile.name})]),h("fieldset",[h("label","Email"),h("input.u-full-width",{type:"text",name:"email",value:profile.email})]),h("fieldset",[h("label","Summary"),h("textarea.u-full-width",{name:"summary"},[profile.summary])]),h("fieldset",[h("label","twitter"),h("input.u-full-width",{type:"text",name:"twitter",value:profile.twitter})]),h("fieldset",[h("label","github"),h("input.u-full-width",{type:"text",name:"github",value:profile.github})]),h("fieldset",[h("label","skills"),h("input.u-full-width",{type:"text",name:"skills",value:profile.skills.join(", ")})]),h("input.button.button-primary",{type:"submit",value:"Update Profile"})])])])])}var ee=require("vflow-pouchdb"),h=require("vbridge").h,page=require("page");profile.render=render,module.exports=profile},{page:10,vbridge:85,"vflow-pouchdb":125}],4:[function(require,module){function profile(state){ee.on("profile:created",function(){page.redirect("/")}),page("/profiles/new",function(){state.set("ref","newProfile")}),page("/profiles/create",function(ctx){ee.emit("post",{verb:"create",object:ctx.body,actor:null})})}function render(){return h("div",[h(".row",[h(".twelve.columns",[h("form",{action:"/profiles/create",method:"POST"},[h("input",{type:"hidden",name:"type",value:"profile"}),h("fieldset",[h("label","Name"),h("input.u-full-width",{type:"text",name:"name"})]),h("fieldset",[h("label","Email"),h("input.u-full-width",{type:"text",name:"email"})]),h("fieldset",[h("label","Summary"),h("textarea.u-full-width",{name:"summary"})]),h("fieldset",[h("label","twitter"),h("input.u-full-width",{type:"text",name:"twitter"})]),h("fieldset",[h("label","github"),h("input.u-full-width",{type:"text",name:"github"})]),h("fieldset",[h("label","skills"),h("input.u-full-width",{type:"text",name:"skills"})]),h("input.button.button-primary",{type:"submit",value:"Create Profile"}),h("a.button",{href:"/"},["Cancel"])])])])])}var ee=require("vflow-pouchdb"),h=require("vbridge").h,page=require("page");profile.render=render,module.exports=profile},{page:10,vbridge:85,"vflow-pouchdb":125}],5:[function(require,module){function search(state){var e={verb:"query",object:{type:"profile",criteria:"*"},actor:state.get("user")};ee.on("profile:query-response",function(o){state.set("profiles",o.object.docs||[{name:"beep"}])}),page("/",function(){setTimeout(function(){ee.emit("post",e)},10),state.set("ref","search")}),page("/search",function(ctx){e.criteria=ctx.body.criteria,ee.emit("post",e)})}function render(state){function li(profile){return h("li",[h(".u-pull-right",[h("a",{href:"http://twitter.com/"+profile.twitter},["@"+profile.twitter]),h("span"," | "),h("a",{href:"http://github.com/"+profile.github},"github: "+profile.github)]),h("a",{href:"/profiles/"+profile._id+"/show"},profile.name)])}var profiles=state.get("profiles");return h("div",[h(".row",[h("form",{action:"/search",method:"POST"},[h(".five.columns",[h("input.u-full-width",{type:"text",name:"q",value:""})]),h(".two.columns",[h("input.button.button-primary",{type:"submit",value:"Search"})]),h(".four.columns",[h("a.button.button-primary",{href:"/profiles/new"},["New Profile"])])])]),h(".row",[h(".twelve.columns",[h("ul",profiles.map(li))])])])}var ee=require("vflow-pouchdb"),h=require("vbridge").h,page=require("page");search.render=render,module.exports=search},{page:10,vbridge:85,"vflow-pouchdb":125}],6:[function(require,module){function profile(state){ee.on("profile:get-show-response",function(doc){state.set("profile",doc.object),state.set("ref","showProfile")
}),ee.on("profile:removed",function(){page.redirect("/")}),page("/profiles/:id/show",function(ctx){ee.emit("post",{object:{type:"profile",_id:ctx.params.id},verb:"get-show"})}),page("/profiles/:id/remove/:rev",function(ctx){ee.emit("post",{object:{type:"profile",_id:ctx.params.id,_rev:ctx.params.rev},verb:"remove"})})}function render(state){function listSkills(){return profile.skills?profile.skills.map(function(s){return h("li",s)}):[]}var profile=state.get("profile");return h("div",[h(".row",[h(".twelve.columns",[h(".u-pull-right",[h("a",{href:"http://twitter.com/"+profile.twitter},"@"+profile.twitter),h("span"," | "),h("a",{href:"http://github.com/"+profile.github},"gh:"+profile.github)]),h("h1",profile.name)])]),h(".row",[h(".twelve.columns",[h("p",profile.email)])]),h(".row",[h(".twelve.columns",[h("p",profile.summary)])]),h(".row",[h(".twelve.columns",[h("h2","Skills"),h("ul",listSkills())])]),h(".row",[h(".twelve.columns",[h("ul",[h("li",[h("a",{href:"/profiles/"+profile._id+"/edit"},["Edit"])]),h("li",[h("a",{href:"/profiles/"+profile._id+"/remove/"+profile._rev},["Remove"])]),h("li",[h("a",{href:"/"},["Return"])])])])])])}var ee=require("vflow-pouchdb"),h=require("vbridge").h,page=require("page");profile.render=render,module.exports=profile},{page:10,vbridge:85,"vflow-pouchdb":125}],7:[function(require,module){var ee=require("vflow-pouchdb"),pouchdb=require("pouchdb"),profiles=pouchdb("ifile_profiles");module.exports=function(){function get(req){return function(doc){profiles.get(doc.object._id).then(function(result){var e={object:result,verb:"get-"+req+"-response"};ee.emit("post",e)})}}ee.on("profile:get-show",get("show")),ee.on("profile:get-edit",get("edit")),ee.on("profile:query",function(doc){"*"===doc.object.criteria&&profiles.allDocs({include_docs:!0}).then(function(results){var docs=results.rows.map(function(row){return row.doc.skills=row.doc.skills?row.doc.skills:[],row.doc});ee.emit("post",{object:{type:"profile",docs:docs},verb:"query-response"})},function(err){console.log(err)})}),ee.on("profile:create",function(doc){doc.object.skills=doc.object.skills?[]:doc.object.skills.split(","),profiles.post(doc.object).then(function(res){doc.object._id=res.id;var e={verb:"created",object:doc.object};ee.emit("profile:created",e)})}),ee.on("profile:update",function(doc){doc.object.skills=doc.object.skills.split(","),profiles.put(doc.object).then(function(){ee.emit("profile:updated",{verb:"updated",object:doc.object})},function(err){console.log(err)})}),ee.on("profile:remove",function(doc){profiles.remove(doc.object._id,doc.object._rev).then(function(res){ee.emit("profile:removed",{verb:"removed",object:res})})})}},{pouchdb:41,"vflow-pouchdb":125}],8:[function(require,module){var inserted={};module.exports=function(css,options){if(!inserted[css]){inserted[css]=!0;var elem=document.createElement("style");elem.setAttribute("type","text/css"),"textContent"in elem?elem.textContent=css:elem.styleSheet.cssText=css;var head=document.getElementsByTagName("head")[0];options&&options.prepend?head.insertBefore(elem,head.childNodes[0]):head.appendChild(elem)}}},{}],9:[function(require,module){function pageBodyParser(){window.removeEventListener("click",bodyParser,!1),window.removeEventListener("keypress",bodyParser,!1),window.addEventListener("click",bodyParser,!1),window.addEventListener("keypress",bodyParser,!1)}function bodyParser(e){function addToBody(el,val){el.name?body[el.name]=val:el.id&&(body[el.id]=val)}var link,proto,path,orig,submitAdded,i,l,control,el=e.target,form=el,nodeName=el.nodeName,keycode=e.keyCode?e.keyCode:e.which,body={};if("keypress"===e.type){if(13!==keycode)return;if("INPUT"!==nodeName)return}else{if("INPUT"!==nodeName&&"BUTTON"!==nodeName)return;if("INPUT"===nodeName&&"submit"!==el.type)return}for(;form&&"FORM"!==form.nodeName;)form=form.parentNode;if(form&&(link=form.action,proto=link.split("://"),proto&&proto[1]&&(link=proto[1],form.pathname=link=proto[1].replace(location.host,"")),form.hash||(form.hash=""),form.search||(form.search=""),(form.pathname!==location.pathname||!form.hash&&"#"!==link)&&page.sameOrigin(form.action))){for(path=form.pathname+form.search+(form.hash||""),orig=path+form.hash,l=form.elements.length,addToBody(el,el.value),(el.name||el.id)&&"submit"===el.type&&(submitAdded=!0),i=0;l>i;i++)control=form.elements[i],"checkbox"===control.type?addToBody(control,control.checked):"submit"===control.type?submitAdded||(addToBody(control,control.value),submitAdded=!0):"BUTTON"!==control.nodeName&&("radio"!==control.type||control.checked)&&addToBody(control,control.value);e.preventDefault(),page.show(orig,{body:body})}}var page=require("page"),Context=page.Context;page.show=function(path,state,dispatch){var ctx=new Context(path,state);return page.current=ctx.path,state&&state.body&&(ctx.body=state.body),!1!==dispatch&&page.dispatch(ctx),!1!==ctx.handled&&ctx.pushState(),ctx},module.exports=pageBodyParser},{page:10}],10:[function(require,module){"use strict";function page(path,fn){if("function"==typeof path)return page("*",path);if("function"==typeof fn)for(var route=new Route(path),i=1;i<arguments.length;++i)page.callbacks.push(route.middleware(arguments[i]));else"string"==typeof path?page["string"==typeof fn?"redirect":"show"](path,fn):page.start(path)}function unhandled(ctx){if(!ctx.handled){var current;current=hashbang?base+location.hash.replace("#!",""):location.pathname+location.search,current!==ctx.canonicalPath&&(page.stop(),ctx.handled=!1,location.href=ctx.canonicalPath)}}function decodeURLEncodedURIComponent(val){return"string"!=typeof val?val:decodeURLComponents?decodeURIComponent(val.replace(/\+/g," ")):val}function Context(path,state){"/"===path[0]&&0!==path.indexOf(base)&&(path=base+(hashbang?"#!":"")+path);var i=path.indexOf("?");if(this.canonicalPath=path,this.path=path.replace(base,"")||"/",hashbang&&(this.path=this.path.replace("#!","")||"/"),this.title=document.title,this.state=state||{},this.state.path=path,this.querystring=~i?decodeURLEncodedURIComponent(path.slice(i+1)):"",this.pathname=decodeURLEncodedURIComponent(~i?path.slice(0,i):path),this.params={},this.hash="",!hashbang){if(!~this.path.indexOf("#"))return;var parts=this.path.split("#");this.path=parts[0],this.hash=decodeURLEncodedURIComponent(parts[1])||"",this.querystring=this.querystring.split("#")[0]}}function Route(path,options){options=options||{},this.path="*"===path?"(.*)":path,this.method="GET",this.regexp=pathtoRegexp(this.path,this.keys=[],options.sensitive,options.strict)}function onpopstate(e){if(e.state){var path=e.state.path;page.replace(path,e.state)}else page.show(location.pathname+location.hash)}function onclick(e){if(1===which(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var el=e.target;el&&"A"!==el.nodeName;)el=el.parentNode;if(el&&"A"===el.nodeName&&!el.getAttribute("download")&&"external"!==el.getAttribute("rel")){var link=el.getAttribute("href");if((hashbang||el.pathname!==location.pathname||!el.hash&&"#"!==link)&&!(link&&link.indexOf("mailto:")>-1)&&!el.target&&sameOrigin(el.href)){var path=el.pathname+el.search+(el.hash||""),orig=path;path=path.replace(base,""),hashbang&&(path=path.replace("#!","")),base&&orig===path||(e.preventDefault(),page.show(orig))}}}}function which(e){return e=e||window.event,null===e.which?e.button:e.which}function sameOrigin(href){var origin=location.protocol+"//"+location.hostname;return location.port&&(origin+=":"+location.port),href&&0===href.indexOf(origin)}var pathtoRegexp=require("path-to-regexp");module.exports=page;var running,prevContext,location="undefined"!=typeof window&&(window.history.location||window.location),dispatch=!0,decodeURLComponents=!0,base="",hashbang=!1;page.callbacks=[],page.exits=[],page.current="",page.len=0,page.base=function(path){return 0===arguments.length?base:void(base=path)},page.start=function(options){if(options=options||{},!running&&(running=!0,!1===options.dispatch&&(dispatch=!1),!1===options.decodeURLComponents&&(decodeURLComponents=!1),!1!==options.popstate&&window.addEventListener("popstate",onpopstate,!1),!1!==options.click&&window.addEventListener("click",onclick,!1),!0===options.hashbang&&(hashbang=!0),dispatch)){var url=hashbang&&~location.hash.indexOf("#!")?location.hash.substr(2)+location.search:location.pathname+location.search+location.hash;page.replace(url,null,!0,dispatch)}},page.stop=function(){running&&(page.current="",page.len=0,running=!1,window.removeEventListener("click",onclick,!1),window.removeEventListener("popstate",onpopstate,!1))},page.show=function(path,state,dispatch){var ctx=new Context(path,state);return page.current=ctx.path,!1!==dispatch&&page.dispatch(ctx),!1!==ctx.handled&&ctx.pushState(),ctx},page.back=function(path,state){page.len>0?(history.back(),page.len--):setTimeout(path?function(){page.show(path,state)}:function(){page.show(base,state)})},page.redirect=function(from,to){"string"==typeof from&&"string"==typeof to&&page(from,function(){setTimeout(function(){page.replace(to)},0)}),"string"==typeof from&&"undefined"==typeof to&&setTimeout(function(){page.replace(from)},0)},page.replace=function(path,state,init,dispatch){var ctx=new Context(path,state);return page.current=ctx.path,ctx.init=init,ctx.save(),!1!==dispatch&&page.dispatch(ctx),ctx},page.dispatch=function(ctx){function nextExit(){var fn=page.exits[j++];return fn?void fn(prev,nextExit):nextEnter()}function nextEnter(){var fn=page.callbacks[i++];return ctx.path!==page.current?void(ctx.handled=!1):fn?void fn(ctx,nextEnter):unhandled(ctx)}var prev=prevContext,i=0,j=0;prevContext=ctx,prev?nextExit():nextEnter()},page.exit=function(path){if("function"==typeof path)return page.exit("*",path);for(var route=new Route(path),i=1;i<arguments.length;++i)page.exits.push(route.middleware(arguments[i]))},page.Context=Context,Context.prototype.pushState=function(){page.len++,history.pushState(this.state,this.title,hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},Context.prototype.save=function(){history.replaceState(this.state,this.title,hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},page.Route=Route,Route.prototype.middleware=function(fn){var self=this;return function(ctx,next){return self.match(ctx.path,ctx.params)?fn(ctx,next):void next()}},Route.prototype.match=function(path,params){var keys=this.keys,qsIndex=path.indexOf("?"),pathname=~qsIndex?path.slice(0,qsIndex):path,m=this.regexp.exec(decodeURIComponent(pathname));if(!m)return!1;for(var i=1,len=m.length;len>i;++i){var key=keys[i-1],val=decodeURLEncodedURIComponent(m[i]);void 0===val&&hasOwnProperty.call(params,key.name)||(params[key.name]=val)}return!0},page.sameOrigin=sameOrigin},{"path-to-regexp":11}],11:[function(require,module){function escapeGroup(group){return group.replace(/([=!:$\/()])/g,"\\$1")}function attachKeys(re,keys){return re.keys=keys,re}function flags(options){return options.sensitive?"":"i"}function regexpToRegexp(path,keys){var groups=path.source.match(/\((?!\?)/g);if(groups)for(var i=0;i<groups.length;i++)keys.push({name:i,delimiter:null,optional:!1,repeat:!1});return attachKeys(path,keys)}function arrayToRegexp(path,keys,options){for(var parts=[],i=0;i<path.length;i++)parts.push(pathToRegexp(path[i],keys,options).source);var regexp=new RegExp("(?:"+parts.join("|")+")",flags(options));return attachKeys(regexp,keys)}function replacePath(path,keys){function replace(_,escaped,prefix,key,capture,group,suffix,escape){if(escaped)return escaped;if(escape)return"\\"+escape;var repeat="+"===suffix||"*"===suffix,optional="?"===suffix||"*"===suffix;return keys.push({name:key||index++,delimiter:prefix||"/",optional:optional,repeat:repeat}),prefix=prefix?"\\"+prefix:"",capture=escapeGroup(capture||group||"[^"+(prefix||"\\/")+"]+?"),repeat&&(capture=capture+"(?:"+prefix+capture+")*"),optional?"(?:"+prefix+"("+capture+"))?":prefix+"("+capture+")"}var index=0;return path.replace(PATH_REGEXP,replace)}function pathToRegexp(path,keys,options){if(keys=keys||[],isArray(keys)?options||(options={}):(options=keys,keys=[]),path instanceof RegExp)return regexpToRegexp(path,keys,options);if(isArray(path))return arrayToRegexp(path,keys,options);var strict=options.strict,end=options.end!==!1,route=replacePath(path,keys),endsWithSlash="/"===path.charAt(path.length-1);return strict||(route=(endsWithSlash?route.slice(0,-2):route)+"(?:\\/(?=$))?"),route+=end?"$":strict&&endsWithSlash?"":"(?=\\/|$)",attachKeys(new RegExp("^"+route,flags(options)),keys)}var isArray=require("isarray");module.exports=pathToRegexp;var PATH_REGEXP=new RegExp(["(\\\\.)","([\\/.])?(?:\\:(\\w+)(?:\\(((?:\\\\.|[^)])*)\\))?|\\(((?:\\\\.|[^)])*)\\))([+*?])?","([.+*?=^!:${}()[\\]|\\/])"].join("|"),"g")},{isarray:12}],12:[function(require,module){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],13:[function(require,module){"use strict";function arrayFirst(arr,callback){for(var i=0;i<arr.length;i++)if(callback(arr[i],i)===!0)return arr[i];return!1}function yankError(callback){return function(err,results){err||results[0]&&results[0].error?callback(err||results[0]):callback(null,results.length?results[0]:results)}}function computeHeight(revs){var height={},edges=[];return merge.traverseRevTree(revs,function(isLeaf,pos,id,prnt){var rev=pos+"-"+id;return isLeaf&&(height[rev]=0),void 0!==prnt&&edges.push({from:prnt,to:rev}),rev}),edges.reverse(),edges.forEach(function(edge){height[edge.from]=void 0===height[edge.from]?1+height[edge.to]:Math.min(height[edge.from],1+height[edge.to])}),height}function allDocsKeysQuery(api,opts,callback){var keys="limit"in opts?opts.keys.slice(opts.skip,opts.limit+opts.skip):opts.skip>0?opts.keys.slice(opts.skip):opts.keys;if(opts.descending&&keys.reverse(),!keys.length)return api._allDocs({limit:0},callback);var finalResults={offset:opts.skip};return Promise.all(keys.map(function(key){var subOpts=utils.extend(!0,{key:key,deleted:"ok"},opts);return["limit","skip","keys"].forEach(function(optKey){delete subOpts[optKey]}),new Promise(function(resolve,reject){api._allDocs(subOpts,function(err,res){return err?reject(err):(finalResults.total_rows=res.total_rows,void resolve(res.rows[0]||{key:key,error:"not_found"}))})})})).then(function(results){return finalResults.rows=results,finalResults})}function AbstractPouchDB(){var self=this;EventEmitter.call(this);var changes,listeners=0,eventNames=["change","delete","create","update"];this.on("newListener",function(eventName){if(~eventNames.indexOf(eventName)){if(listeners)return void listeners++;listeners++;var lastChange=0;changes=this.changes({conflicts:!0,include_docs:!0,continuous:!0,since:"now",onChange:function(change){change.seq<=lastChange||(lastChange=change.seq,self.emit("change",change),change.doc._deleted?self.emit("delete",change):"1"===change.doc._rev.split("-")[0]?self.emit("create",change):self.emit("update",change))}})}}),this.on("removeListener",function(eventName){~eventNames.indexOf(eventName)&&(listeners--,listeners||changes.cancel())})}var utils=require("./utils"),merge=require("./merge"),errors=require("./deps/errors"),EventEmitter=require("events").EventEmitter,upsert=require("./deps/upsert"),Changes=require("./changes"),Promise=utils.Promise;utils.inherits(AbstractPouchDB,EventEmitter),module.exports=AbstractPouchDB,AbstractPouchDB.prototype.post=utils.adapterFun("post",function(doc,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),"object"!=typeof doc||Array.isArray(doc)?callback(errors.error(errors.NOT_AN_OBJECT)):void this.bulkDocs({docs:[doc]},opts,yankError(callback))}),AbstractPouchDB.prototype.put=utils.adapterFun("put",utils.getArguments(function(args){var temp,temptype,opts,callback,doc=args.shift(),id="_id"in doc;if("object"!=typeof doc||Array.isArray(doc))return(callback=args.pop())(errors.error(errors.NOT_AN_OBJECT));for(doc=utils.clone(doc);;)if(temp=args.shift(),temptype=typeof temp,"string"!==temptype||id?"string"!==temptype||!id||"_rev"in doc?"object"===temptype?opts=temp:"function"===temptype&&(callback=temp):doc._rev=temp:(doc._id=temp,id=!0),!args.length)break;opts=opts||{};var error=utils.invalidIdError(doc._id);return error?callback(error):utils.isLocalId(doc._id)&&"function"==typeof this._putLocal?doc._deleted?this._removeLocal(doc,callback):this._putLocal(doc,callback):void this.bulkDocs({docs:[doc]},opts,yankError(callback))})),AbstractPouchDB.prototype.putAttachment=utils.adapterFun("putAttachment",function(docId,attachmentId,rev,blob,type,callback){function createAttachment(doc){return doc._attachments=doc._attachments||{},doc._attachments[attachmentId]={content_type:type,data:blob},api.put(doc)}var api=this;return"function"==typeof type&&(callback=type,type=blob,blob=rev,rev=null),"undefined"==typeof type&&(type=blob,blob=rev,rev=null),api.get(docId).then(function(doc){if(doc._rev!==rev)throw errors.error(errors.REV_CONFLICT);return createAttachment(doc)},function(err){if(err.reason===errors.MISSING_DOC.message)return createAttachment({_id:docId});throw err})}),AbstractPouchDB.prototype.removeAttachment=utils.adapterFun("removeAttachment",function(docId,attachmentId,rev,callback){var self=this;self.get(docId,function(err,obj){return err?void callback(err):obj._rev!==rev?void callback(errors.error(errors.REV_CONFLICT)):obj._attachments?(delete obj._attachments[attachmentId],0===Object.keys(obj._attachments).length&&delete obj._attachments,void self.put(obj,callback)):callback()})}),AbstractPouchDB.prototype.remove=utils.adapterFun("remove",function(docOrId,optsOrRev,opts,callback){var doc;"string"==typeof optsOrRev?(doc={_id:docOrId,_rev:optsOrRev},"function"==typeof opts&&(callback=opts,opts={})):(doc=docOrId,"function"==typeof optsOrRev?(callback=optsOrRev,opts={}):(callback=opts,opts=optsOrRev)),opts=utils.clone(opts||{}),opts.was_delete=!0;var newDoc={_id:doc._id,_rev:doc._rev||opts.rev};return newDoc._deleted=!0,utils.isLocalId(newDoc._id)&&"function"==typeof this._removeLocal?this._removeLocal(doc,callback):void this.bulkDocs({docs:[newDoc]},opts,yankError(callback))}),AbstractPouchDB.prototype.revsDiff=utils.adapterFun("revsDiff",function(req,opts,callback){function addToMissing(id,revId){missing.has(id)||missing.set(id,{missing:[]}),missing.get(id).missing.push(revId)}function processDoc(id,rev_tree){var missingForId=req[id].slice(0);merge.traverseRevTree(rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash,idx=missingForId.indexOf(rev);-1!==idx&&(missingForId.splice(idx,1),"available"!==opts.status&&addToMissing(id,rev))}),missingForId.forEach(function(rev){addToMissing(id,rev)})}"function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts);var ids=Object.keys(req);if(!ids.length)return callback(null,{});var count=0,missing=new utils.Map;ids.map(function(id){this._getRevisionTree(id,function(err,rev_tree){if(err&&404===err.status&&"missing"===err.message)missing.set(id,{missing:req[id]});else{if(err)return callback(err);processDoc(id,rev_tree)}if(++count===ids.length){var missingObj={};return missing.forEach(function(value,key){missingObj[key]=value}),callback(null,missingObj)}})},this)}),AbstractPouchDB.prototype.compactDocument=utils.adapterFun("compactDocument",function(docId,maxHeight,callback){var self=this;this._getRevisionTree(docId,function(err,revTree){if(err)return callback(err);var height=computeHeight(revTree),candidates=[],revs=[];Object.keys(height).forEach(function(rev){height[rev]>maxHeight&&candidates.push(rev)}),merge.traverseRevTree(revTree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash;"available"===opts.status&&-1!==candidates.indexOf(rev)&&revs.push(rev)}),self._doCompaction(docId,revs,callback)})}),AbstractPouchDB.prototype.compact=utils.adapterFun("compact",function(opts,callback){"function"==typeof opts&&(callback=opts,opts={});var self=this;opts=utils.clone(opts||{}),self.get("_local/compaction")["catch"](function(){return!1}).then(function(doc){return"function"==typeof self._compact?(doc&&doc.last_seq&&(opts.last_seq=doc.last_seq),self._compact(opts,callback)):void 0})}),AbstractPouchDB.prototype._compact=function(opts,callback){function onChange(row){promises.push(self.compactDocument(row.id,0))}function onComplete(resp){var lastSeq=resp.last_seq;Promise.all(promises).then(function(){return upsert(self,"_local/compaction",function(doc){return!doc.last_seq||doc.last_seq<lastSeq?(doc.last_seq=lastSeq,doc):!1})}).then(function(){callback(null,{ok:!0})})["catch"](callback)}var self=this,changesOpts={returnDocs:!1,last_seq:opts.last_seq||0},promises=[];self.changes(changesOpts).on("change",onChange).on("complete",onComplete).on("error",callback)},AbstractPouchDB.prototype.get=utils.adapterFun("get",function(id,opts,callback){function finishOpenRevs(){var result=[],count=leaves.length;return count?void leaves.forEach(function(leaf){self.get(id,{rev:leaf,revs:opts.revs,attachments:opts.attachments},function(err,doc){result.push(err?{missing:leaf}:{ok:doc}),count--,count||callback(null,result)})}):callback(null,result)}if("function"==typeof opts&&(callback=opts,opts={}),"string"!=typeof id)return callback(errors.error(errors.INVALID_ID));if(utils.isLocalId(id)&&"function"==typeof this._getLocal)return this._getLocal(id,callback);var leaves=[],self=this;if(!opts.open_revs)return this._get(id,opts,function(err,result){if(opts=utils.clone(opts),err)return callback(err);var doc=result.doc,metadata=result.metadata,ctx=result.ctx;if(opts.conflicts){var conflicts=merge.collectConflicts(metadata);conflicts.length&&(doc._conflicts=conflicts)}if(utils.isDeleted(metadata,doc._rev)&&(doc._deleted=!0),opts.revs||opts.revs_info){var paths=merge.rootToLeaf(metadata.rev_tree),path=arrayFirst(paths,function(arr){return-1!==arr.ids.map(function(x){return x.id}).indexOf(doc._rev.split("-")[1])}),indexOfRev=path.ids.map(function(x){return x.id}).indexOf(doc._rev.split("-")[1])+1,howMany=path.ids.length-indexOfRev;if(path.ids.splice(indexOfRev,howMany),path.ids.reverse(),opts.revs&&(doc._revisions={start:path.pos+path.ids.length-1,ids:path.ids.map(function(rev){return rev.id})}),opts.revs_info){var pos=path.pos+path.ids.length;doc._revs_info=path.ids.map(function(rev){return pos--,{rev:pos+"-"+rev.id,status:rev.opts.status}})}}if(opts.local_seq&&(utils.info('The "local_seq" option is deprecated and will be removed'),doc._local_seq=result.metadata.seq),opts.attachments&&doc._attachments){var attachments=doc._attachments,count=Object.keys(attachments).length;if(0===count)return callback(null,doc);Object.keys(attachments).forEach(function(key){this._getAttachment(attachments[key],{encode:!0,ctx:ctx},function(err,data){var att=doc._attachments[key];att.data=data,delete att.stub,delete att.length,--count||callback(null,doc)})},self)}else{if(doc._attachments)for(var key in doc._attachments)doc._attachments.hasOwnProperty(key)&&(doc._attachments[key].stub=!0);callback(null,doc)}});if("all"===opts.open_revs)this._getRevisionTree(id,function(err,rev_tree){return err?callback(err):(leaves=merge.collectLeaves(rev_tree).map(function(leaf){return leaf.rev}),void finishOpenRevs())});else{if(!Array.isArray(opts.open_revs))return callback(errors.error(errors.UNKNOWN_ERROR,"function_clause"));leaves=opts.open_revs;for(var i=0;i<leaves.length;i++){var l=leaves[i];if("string"!=typeof l||!/^\d+-/.test(l))return callback(errors.error(errors.INVALID_REV))}finishOpenRevs()}}),AbstractPouchDB.prototype.getAttachment=utils.adapterFun("getAttachment",function(docId,attachmentId,opts,callback){var self=this;opts instanceof Function&&(callback=opts,opts={}),opts=utils.clone(opts),this._get(docId,opts,function(err,res){return err?callback(err):res.doc._attachments&&res.doc._attachments[attachmentId]?(opts.ctx=res.ctx,void self._getAttachment(res.doc._attachments[attachmentId],opts,callback)):callback(errors.error(errors.MISSING_DOC))})}),AbstractPouchDB.prototype.allDocs=utils.adapterFun("allDocs",function(opts,callback){if("function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts),opts.skip="undefined"!=typeof opts.skip?opts.skip:0,"keys"in opts){if(!Array.isArray(opts.keys))return callback(new TypeError("options.keys must be an array"));var incompatibleOpt=["startkey","endkey","key"].filter(function(incompatibleOpt){return incompatibleOpt in opts})[0];if(incompatibleOpt)return void callback(errors.error(errors.QUERY_PARSE_ERROR,"Query parameter `"+incompatibleOpt+"` is not compatible with multi-get"));if("http"!==this.type())return allDocsKeysQuery(this,opts,callback)}return this._allDocs(opts,callback)}),AbstractPouchDB.prototype.changes=function(opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),new Changes(this,opts,callback)},AbstractPouchDB.prototype.close=utils.adapterFun("close",function(callback){return this._closed=!0,this._close(callback)}),AbstractPouchDB.prototype.info=utils.adapterFun("info",function(callback){var self=this;this._info(function(err,info){return err?callback(err):(info.db_name=info.db_name||self._db_name,info.auto_compaction=!(!self.auto_compaction||"http"===self.type()),void callback(null,info))})}),AbstractPouchDB.prototype.id=utils.adapterFun("id",function(callback){return this._id(callback)}),AbstractPouchDB.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},AbstractPouchDB.prototype.bulkDocs=utils.adapterFun("bulkDocs",function(req,opts,callback){if("function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts),Array.isArray(req)&&(req={docs:req}),!req||!req.docs||!Array.isArray(req.docs))return callback(errors.error(errors.MISSING_BULK_DOCS));for(var i=0;i<req.docs.length;++i)if("object"!=typeof req.docs[i]||Array.isArray(req.docs[i]))return callback(errors.error(errors.NOT_AN_OBJECT));return req=utils.clone(req),"new_edits"in opts||(opts.new_edits="new_edits"in req?req.new_edits:!0),opts.new_edits||"http"===this.type()||req.docs.sort(function(a,b){var idCompare=utils.compare(a._id,b._id);if(0!==idCompare)return idCompare;var aStart=a._revisions?a._revisions.start:0,bStart=b._revisions?b._revisions.start:0;return utils.compare(aStart,bStart)}),req.docs.forEach(function(doc){doc._deleted&&delete doc._attachments}),this._bulkDocs(req,opts,function(err,res){return err?callback(err):(opts.new_edits||(res=res.filter(function(x){return x.error})),void callback(null,res))})}),AbstractPouchDB.prototype.registerDependentDatabase=utils.adapterFun("registerDependentDatabase",function(dependentDb,callback){function diffFun(doc){return doc.dependentDbs=doc.dependentDbs||{},doc.dependentDbs[dependentDb]?!1:(doc.dependentDbs[dependentDb]=!0,doc)}var depDB=new this.constructor(dependentDb,this.__opts||{});upsert(this,"_local/_pouch_dependentDbs",diffFun,function(err){return err?callback(err):callback(null,{db:depDB})})})},{"./changes":25,"./deps/errors":31,"./deps/upsert":37,"./merge":42,"./utils":47,events:131}],14:[function(require,module){(function(process){"use strict";function encodeDocId(id){return/^_(design|local)/.test(id)?id:encodeURIComponent(id)}function preprocessAttachments(doc){return doc._attachments&&Object.keys(doc._attachments)?utils.Promise.all(Object.keys(doc._attachments).map(function(key){var attachment=doc._attachments[key];if(attachment.data&&"string"!=typeof attachment.data){if(isBrowser)return new utils.Promise(function(resolve){utils.readAsBinaryString(attachment.data,function(binary){attachment.data=utils.btoa(binary),resolve()})});attachment.data=attachment.data.toString("base64")}})):utils.Promise.resolve()}function getHost(name,opts){if(/http(s?):/.test(name)){var uri=utils.parseUri(name);uri.remote=!0,(uri.user||uri.password)&&(uri.auth={username:uri.user,password:uri.password});var parts=uri.path.replace(/(^\/|\/$)/g,"").split("/");if(uri.db=parts.pop(),uri.path=parts.join("/"),opts=opts||{},opts=utils.clone(opts),uri.headers=opts.headers||opts.ajax&&opts.ajax.headers||{},opts.auth||uri.auth){var nAuth=opts.auth||uri.auth,token=utils.btoa(nAuth.username+":"+nAuth.password);uri.headers.Authorization="Basic "+token}return opts.headers&&(uri.headers=opts.headers),uri}return{host:"",path:"/",db:name,auth:!1}}function genDBUrl(opts,path){return genUrl(opts,opts.db+"/"+path)}function genUrl(opts,path){if(opts.remote){var pathDel=opts.path?"/":"";return opts.protocol+"://"+opts.host+":"+opts.port+"/"+opts.path+pathDel+path}return"/"+path}function HttpPouch(opts,callback){function ajax(options,callback){var reqOpts=utils.extend({},ajaxOpts,options);return log(reqOpts.method+" "+reqOpts.url),utils.ajax(reqOpts,callback)}function encodeAttachmentId(attachmentId){return attachmentId.split("/").map(encodeURIComponent).join("/")}var api=this;api.getHost=opts.getHost?opts.getHost:getHost;var host=api.getHost(opts.name,opts),dbUrl=genDBUrl(host,"");api.getUrl=function(){return dbUrl},api.getHeaders=function(){return utils.clone(host.headers)};var ajaxOpts=opts.ajax||{};opts=utils.clone(opts);var createDB=function(){ajax({headers:host.headers,method:"PUT",url:dbUrl},function(err){err&&401===err.status?ajax({headers:host.headers,method:"HEAD",url:dbUrl},function(err){err?callback(err):callback(null,api)}):err&&412!==err.status?callback(err):callback(null,api)})};opts.skipSetup||ajax({headers:host.headers,method:"GET",url:dbUrl},function(err){err?404===err.status?(utils.explain404("PouchDB is just detecting if the remote DB exists."),createDB()):callback(err):callback(null,api)}),api.type=function(){return"http"},api.id=utils.adapterFun("id",function(callback){ajax({headers:host.headers,method:"GET",url:genUrl(host,"")},function(err,result){var uuid=result&&result.uuid?result.uuid+host.db:genDBUrl(host,"");callback(null,uuid)})}),api.request=utils.adapterFun("request",function(options,callback){options.headers=host.headers,options.url=genDBUrl(host,options.url),ajax(options,callback)}),api.compact=utils.adapterFun("compact",function(opts,callback){"function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts),ajax({headers:host.headers,url:genDBUrl(host,"_compact"),method:"POST"},function(){function ping(){api.info(function(err,res){res.compact_running?setTimeout(ping,opts.interval||200):callback(null,{ok:!0})})}"function"==typeof callback&&ping()})}),api._info=function(callback){ajax({headers:host.headers,method:"GET",url:genDBUrl(host,"")},function(err,res){err?callback(err):(res.host=genDBUrl(host,""),callback(null,res))})},api.get=utils.adapterFun("get",function(id,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts),void 0===opts.auto_encode&&(opts.auto_encode=!0);var params=[];opts.revs&&params.push("revs=true"),opts.revs_info&&params.push("revs_info=true"),opts.local_seq&&params.push("local_seq=true"),opts.open_revs&&("all"!==opts.open_revs&&(opts.open_revs=JSON.stringify(opts.open_revs)),params.push("open_revs="+opts.open_revs)),opts.attachments&&params.push("attachments=true"),opts.rev&&params.push("rev="+opts.rev),opts.conflicts&&params.push("conflicts="+opts.conflicts),params=params.join("&"),params=""===params?"":"?"+params,opts.auto_encode&&(id=encodeDocId(id));var options={headers:host.headers,method:"GET",url:genDBUrl(host,id+params)},parts=id.split("/");(parts.length>1&&"_design"!==parts[0]&&"_local"!==parts[0]||parts.length>2&&"_design"===parts[0]&&"_local"!==parts[0])&&(options.binary=!0),ajax(options,function(err,doc,xhr){return err?callback(err):void callback(null,doc,xhr)})}),api.remove=utils.adapterFun("remove",function(docOrId,optsOrRev,opts,callback){var doc;"string"==typeof optsOrRev?(doc={_id:docOrId,_rev:optsOrRev},"function"==typeof opts&&(callback=opts,opts={})):(doc=docOrId,"function"==typeof optsOrRev?(callback=optsOrRev,opts={}):(callback=opts,opts=optsOrRev));var rev=doc._rev||opts.rev;ajax({headers:host.headers,method:"DELETE",url:genDBUrl(host,encodeDocId(doc._id))+"?rev="+rev},callback)}),api.getAttachment=utils.adapterFun("getAttachment",function(docId,attachmentId,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts),void 0===opts.auto_encode&&(opts.auto_encode=!0),opts.auto_encode&&(docId=encodeDocId(docId)),opts.auto_encode=!1,api.get(docId+"/"+encodeAttachmentId(attachmentId),opts,callback)
}),api.removeAttachment=utils.adapterFun("removeAttachment",function(docId,attachmentId,rev,callback){var url=genDBUrl(host,encodeDocId(docId)+"/"+encodeAttachmentId(attachmentId))+"?rev="+rev;ajax({headers:host.headers,method:"DELETE",url:url},callback)}),api.putAttachment=utils.adapterFun("putAttachment",function(docId,attachmentId,rev,blob,type,callback){"function"==typeof type&&(callback=type,type=blob,blob=rev,rev=null),"undefined"==typeof type&&(type=blob,blob=rev,rev=null);var id=encodeDocId(docId)+"/"+encodeAttachmentId(attachmentId),url=genDBUrl(host,id);if(rev&&(url+="?rev="+rev),"string"==typeof blob){var binary;try{binary=utils.atob(blob)}catch(err){return callback(errors.error(errors.BAD_ARG,"Attachments need to be base64 encoded"))}blob=isBrowser?utils.createBlob([utils.fixBinary(binary)],{type:type}):binary?new buffer(binary,"binary"):""}var opts={headers:utils.clone(host.headers),method:"PUT",url:url,processData:!1,body:blob,timeout:6e4};opts.headers["Content-Type"]=type,ajax(opts,callback)}),api.put=utils.adapterFun("put",utils.getArguments(function(args){var temp,temptype,opts,doc=args.shift(),id="_id"in doc,callback=args.pop();return"object"!=typeof doc||Array.isArray(doc)?callback(errors.error(errors.NOT_AN_OBJECT)):(doc=utils.clone(doc),void preprocessAttachments(doc).then(function(){for(;;)if(temp=args.shift(),temptype=typeof temp,"string"!==temptype||id?"string"!==temptype||!id||"_rev"in doc?"object"===temptype&&(opts=utils.clone(temp)):doc._rev=temp:(doc._id=temp,id=!0),!args.length)break;opts=opts||{};var error=utils.invalidIdError(doc._id);if(error)throw error;var params=[];opts&&"undefined"!=typeof opts.new_edits&&params.push("new_edits="+opts.new_edits),params=params.join("&"),""!==params&&(params="?"+params),ajax({headers:host.headers,method:"PUT",url:genDBUrl(host,encodeDocId(doc._id))+params,body:doc},function(err,res){return err?callback(err):(res.ok=!0,void callback(null,res))})})["catch"](callback))})),api.post=utils.adapterFun("post",function(doc,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts),"object"!=typeof doc?callback(errors.error(errors.NOT_AN_OBJECT)):("_id"in doc||(doc._id=utils.uuid()),void api.put(doc,opts,function(err,res){return err?callback(err):(res.ok=!0,void callback(null,res))}))}),api._bulkDocs=function(req,opts,callback){"undefined"!=typeof opts.new_edits&&(req.new_edits=opts.new_edits),utils.Promise.all(req.docs.map(preprocessAttachments)).then(function(){ajax({headers:host.headers,method:"POST",url:genDBUrl(host,"_bulk_docs"),body:req},function(err,results){return err?callback(err):(results.forEach(function(result){result.ok=!0}),void callback(null,results))})})["catch"](callback)},api.allDocs=utils.adapterFun("allDocs",function(opts,callback){"function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts);var body,params=[],method="GET";if(opts.conflicts&&params.push("conflicts=true"),opts.descending&&params.push("descending=true"),opts.include_docs&&params.push("include_docs=true"),opts.attachments&&params.push("attachments=true"),opts.key&&params.push("key="+encodeURIComponent(JSON.stringify(opts.key))),opts.startkey&&params.push("startkey="+encodeURIComponent(JSON.stringify(opts.startkey))),opts.endkey&&params.push("endkey="+encodeURIComponent(JSON.stringify(opts.endkey))),"undefined"!=typeof opts.inclusive_end&&params.push("inclusive_end="+!!opts.inclusive_end),"undefined"!=typeof opts.limit&&params.push("limit="+opts.limit),"undefined"!=typeof opts.skip&&params.push("skip="+opts.skip),params=params.join("&"),""!==params&&(params="?"+params),"undefined"!=typeof opts.keys){var keysAsString="keys="+encodeURIComponent(JSON.stringify(opts.keys));keysAsString.length+params.length+1<=MAX_URL_LENGTH?params+=(-1!==params.indexOf("?")?"&":"?")+keysAsString:(method="POST",body=JSON.stringify({keys:opts.keys}))}ajax({headers:host.headers,method:method,url:genDBUrl(host,"_all_docs"+params),body:body},callback)}),api._changes=function(opts){var batchSize="batch_size"in opts?opts.batch_size:CHANGES_BATCH_SIZE;opts=utils.clone(opts),opts.timeout=opts.timeout||3e4;var params={timeout:opts.timeout-5e3},limit="undefined"!=typeof opts.limit?opts.limit:!1;0===limit&&(limit=1);var returnDocs;returnDocs="returnDocs"in opts?opts.returnDocs:!0;var leftToFetch=limit;if(opts.style&&(params.style=opts.style),(opts.include_docs||opts.filter&&"function"==typeof opts.filter)&&(params.include_docs=!0),opts.attachments&&(params.attachments=!0),opts.continuous&&(params.feed="longpoll"),opts.conflicts&&(params.conflicts=!0),opts.descending&&(params.descending=!0),opts.filter&&"string"==typeof opts.filter&&(params.filter=opts.filter,"_view"===opts.filter&&opts.view&&"string"==typeof opts.view&&(params.view=opts.view)),opts.query_params&&"object"==typeof opts.query_params)for(var param_name in opts.query_params)opts.query_params.hasOwnProperty(param_name)&&(params[param_name]=opts.query_params[param_name]);var body,method="GET";if(opts.doc_ids){params.filter="_doc_ids";var docIdsJson=JSON.stringify(opts.doc_ids);docIdsJson.length<MAX_URL_LENGTH?params.doc_ids=docIdsJson:(method="POST",body={doc_ids:opts.doc_ids})}if(opts.continuous&&api._useSSE)return api.sse(opts,params,returnDocs);var xhr,lastFetchedSeq,fetch=function(since,callback){if(!opts.aborted){params.since=since,"object"==typeof params.since&&(params.since=JSON.stringify(params.since)),opts.descending?limit&&(params.limit=leftToFetch):params.limit=!limit||leftToFetch>batchSize?batchSize:leftToFetch;var paramStr="?"+Object.keys(params).map(function(k){return k+"="+params[k]}).join("&"),xhrOpts={headers:host.headers,method:method,url:genDBUrl(host,"_changes"+paramStr),timeout:opts.timeout,body:body};lastFetchedSeq=since,opts.aborted||(xhr=ajax(xhrOpts,callback))}},fetchTimeout=10,fetchRetryCount=0,results={results:[]},fetched=function(err,res){if(!opts.aborted){var raw_results_length=0;if(res&&res.results){raw_results_length=res.results.length,results.last_seq=res.last_seq;var req={};req.query=opts.query_params,res.results=res.results.filter(function(c){leftToFetch--;var ret=utils.filterChange(opts)(c);return ret&&(returnDocs&&results.results.push(c),utils.call(opts.onChange,c)),ret})}else if(err)return opts.aborted=!0,void utils.call(opts.complete,err);res&&res.last_seq&&(lastFetchedSeq=res.last_seq);var finished=limit&&0>=leftToFetch||res&&batchSize>raw_results_length||opts.descending;if((!opts.continuous||limit&&0>=leftToFetch)&&finished)utils.call(opts.complete,null,results);else{err?fetchRetryCount+=1:fetchRetryCount=0;var timeoutMultiplier=1<<fetchRetryCount,retryWait=fetchTimeout*timeoutMultiplier,maximumWait=opts.maximumWait||3e4;if(retryWait>maximumWait)return void utils.call(opts.complete,err||errors.error(errors.UNKNOWN_ERROR));setTimeout(function(){fetch(lastFetchedSeq,fetched)},retryWait)}}};return fetch(opts.since||0,fetched),{cancel:function(){opts.aborted=!0,xhr&&xhr.abort()}}},api.sse=function(opts,params,returnDocs){function msgHandler(e){var data=JSON.parse(e.data);returnDocs&&results.results.push(data),results.last_seq=data.seq,utils.call(opts.onChange,data)}function errHandler(err){return source.removeEventListener("message",msgHandler,!1),open===!1?(api._useSSE=!1,void(dispatched=api._changes(opts))):(source.close(),void utils.call(opts.complete,err))}params.feed="eventsource",params.since=opts.since||0,params.limit=opts.limit,delete params.timeout;var paramStr="?"+Object.keys(params).map(function(k){return k+"="+params[k]}).join("&"),url=genDBUrl(host,"_changes"+paramStr),source=new EventSource(url),results={results:[],last_seq:!1},dispatched=!1,open=!1;return source.addEventListener("message",msgHandler,!1),source.onopen=function(){open=!0},source.onerror=errHandler,{cancel:function(){return dispatched?dispatched.cancel():(source.removeEventListener("message",msgHandler,!1),void source.close())}}},api._useSSE=!1,api.revsDiff=utils.adapterFun("revsDiff",function(req,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),ajax({headers:host.headers,method:"POST",url:genDBUrl(host,"_revs_diff"),body:JSON.stringify(req)},callback)}),api._close=function(callback){callback()},api.destroy=utils.adapterFun("destroy",function(callback){ajax({url:genDBUrl(host,""),method:"DELETE",headers:host.headers},function(err,resp){err?(api.emit("error",err),callback(err)):(api.emit("destroyed"),callback(null,resp))})})}var CHANGES_BATCH_SIZE=25,MAX_URL_LENGTH=1800,utils=require("../../utils"),errors=require("../../deps/errors"),log=require("debug")("pouchdb:http"),isBrowser="undefined"==typeof process||process.browser,buffer=require("../../deps/buffer");HttpPouch.destroy=utils.toPromise(function(name,opts,callback){var host=getHost(name,opts);opts=opts||{},"function"==typeof opts&&(callback=opts,opts={}),opts=utils.clone(opts),opts.headers=host.headers,opts.method="DELETE",opts.url=genDBUrl(host,"");var ajaxOpts=opts.ajax||{};opts=utils.extend({},opts,ajaxOpts),utils.ajax(opts,callback)}),HttpPouch.valid=function(){return!0},module.exports=HttpPouch}).call(this,require("_process"))},{"../../deps/buffer":30,"../../deps/errors":31,"../../utils":47,_process:132,debug:50}],15:[function(require,module){"use strict";function checkBlobSupport(txn,idb){return new utils.Promise(function(resolve,reject){var blob=utils.createBlob([""],{type:"image/png"});txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob,"key"),txn.oncomplete=function(){var blobTxn=idb.transaction([DETECT_BLOB_SUPPORT_STORE],"readwrite"),getBlobReq=blobTxn.objectStore(DETECT_BLOB_SUPPORT_STORE).get("key");getBlobReq.onerror=reject,getBlobReq.onsuccess=function(e){var storedBlob=e.target.result,url=URL.createObjectURL(storedBlob);utils.ajax({url:url,cache:!0,binary:!0},function(err,res){err&&405===err.status?resolve(!0):(resolve(!(!res||"image/png"!==res.type)),err&&404===err.status&&utils.explain404("PouchDB is just detecting blob URL support.")),URL.revokeObjectURL(url)})}}})["catch"](function(){return!1})}var utils=require("../../utils"),idbConstants=require("./idb-constants"),DETECT_BLOB_SUPPORT_STORE=idbConstants.DETECT_BLOB_SUPPORT_STORE;module.exports=checkBlobSupport},{"../../utils":47,"./idb-constants":17}],16:[function(require,module){"use strict";function idbBulkDocs(req,opts,api,idb,Changes,callback){function startTransaction(){var stores=[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE,LOCAL_STORE,ATTACH_AND_SEQ_STORE],txnResult=openTransactionSafely(idb,stores,"readwrite");return txnResult.error?callback(txnResult.error):(txn=txnResult.txn,txn.onerror=idbError(callback),txn.ontimeout=idbError(callback),txn.oncomplete=complete,docStore=txn.objectStore(DOC_STORE),bySeqStore=txn.objectStore(BY_SEQ_STORE),attachStore=txn.objectStore(ATTACH_STORE),attachAndSeqStore=txn.objectStore(ATTACH_AND_SEQ_STORE),void verifyAttachments(function(err){return err?(preconditionErrored=!0,callback(err)):void fetchExistingDocs()}))}function processDocs(){utils.processDocs(docInfos,api,fetchedDocs,txn,results,writeDoc,opts)}function fetchExistingDocs(){function checkDone(){++numFetched===docInfos.length&&processDocs()}function readMetadata(event){var metadata=decodeMetadata(event.target.result);metadata&&fetchedDocs.set(metadata.id,metadata),checkDone()}if(docInfos.length)for(var numFetched=0,i=0,len=docInfos.length;len>i;i++){var docInfo=docInfos[i];if(docInfo._id&&utils.isLocalId(docInfo._id))checkDone();else{var req=docStore.get(docInfo.metadata.id);req.onsuccess=readMetadata}}}function complete(){preconditionErrored||(Changes.notify(api._name),api._docCount=-1,callback(null,results))}function verifyAttachment(digest,callback){var req=attachStore.get(digest);req.onsuccess=function(e){if(e.target.result)callback();else{var err=errors.error(errors.MISSING_STUB,"unknown stub attachment with digest "+digest);err.status=412,callback(err)}}}function verifyAttachments(finish){function checkDone(){++numDone===digests.length&&finish(err)}var digests=[];if(docInfos.forEach(function(docInfo){docInfo.data&&docInfo.data._attachments&&Object.keys(docInfo.data._attachments).forEach(function(filename){var att=docInfo.data._attachments[filename];att.stub&&digests.push(att.digest)})}),!digests.length)return finish();var err,numDone=0;digests.forEach(function(digest){verifyAttachment(digest,function(attErr){attErr&&!err&&(err=attErr),checkDone()})})}function writeDoc(docInfo,winningRev,deleted,callback,isUpdate,delta,resultsIdx){var doc=docInfo.data;doc._id=docInfo.metadata.id,doc._rev=docInfo.metadata.rev,deleted&&(doc._deleted=!0);var hasAttachments=doc._attachments&&Object.keys(doc._attachments).length;return hasAttachments?writeAttachments(docInfo,winningRev,deleted,callback,isUpdate,resultsIdx):void finishDoc(docInfo,winningRev,deleted,callback,isUpdate,resultsIdx)}function autoCompact(docInfo){var revsToDelete=utils.compactTree(docInfo.metadata);compactRevs(revsToDelete,docInfo.metadata.id,txn)}function finishDoc(docInfo,winningRev,deleted,callback,isUpdate,resultsIdx){function afterPutDoc(e){isUpdate&&api.auto_compaction&&autoCompact(docInfo),metadata.seq=e.target.result,delete metadata.rev;var metadataToStore=encodeMetadata(metadata,winningRev,deleted),metaDataReq=docStore.put(metadataToStore);metaDataReq.onsuccess=afterPutMetadata}function afterPutDocError(e){e.preventDefault(),e.stopPropagation();var index=bySeqStore.index("_doc_id_rev"),getKeyReq=index.getKey(doc._doc_id_rev);getKeyReq.onsuccess=function(e){var putReq=bySeqStore.put(doc,e.target.result);putReq.onsuccess=afterPutDoc}}function afterPutMetadata(){results[resultsIdx]={ok:!0,id:metadata.id,rev:winningRev},fetchedDocs.set(docInfo.metadata.id,docInfo.metadata),insertAttachmentMappings(docInfo,metadata.seq,callback)}var doc=docInfo.data,metadata=docInfo.metadata;doc._doc_id_rev=metadata.id+"::"+metadata.rev,delete doc._id,delete doc._rev;var putReq=bySeqStore.put(doc);putReq.onsuccess=afterPutDoc,putReq.onerror=afterPutDocError}function writeAttachments(docInfo,winningRev,deleted,callback,isUpdate,resultsIdx){function collectResults(){numDone===attachments.length&&finishDoc(docInfo,winningRev,deleted,callback,isUpdate,resultsIdx)}function attachmentSaved(){numDone++,collectResults()}var doc=docInfo.data,numDone=0,attachments=Object.keys(doc._attachments);attachments.forEach(function(key){var att=docInfo.data._attachments[key];if(att.stub)numDone++,collectResults();else{var data=att.data;delete att.data;var digest=att.digest;saveAttachment(digest,data,attachmentSaved)}})}function insertAttachmentMappings(docInfo,seq,callback){function checkDone(){++attsAdded===attsToAdd.length&&callback()}function add(att){var digest=docInfo.data._attachments[att].digest,req=attachAndSeqStore.put({seq:seq,digestSeq:digest+"::"+seq});req.onsuccess=checkDone,req.onerror=function(e){e.preventDefault(),e.stopPropagation(),checkDone()}}var attsAdded=0,attsToAdd=Object.keys(docInfo.data._attachments||{});if(!attsToAdd.length)return callback();for(var i=0;i<attsToAdd.length;i++)add(attsToAdd[i])}function saveAttachment(digest,data,callback){var getKeyReq=attachStore.count(digest);getKeyReq.onsuccess=function(e){var count=e.target.result;if(count)return callback();var newAtt={digest:digest,body:data},putReq=attachStore.put(newAtt);putReq.onsuccess=callback}}for(var txn,docStore,bySeqStore,attachStore,attachAndSeqStore,docInfoError,docInfos=req.docs,i=0,len=docInfos.length;len>i;i++){var doc=docInfos[i];doc._id&&utils.isLocalId(doc._id)||(doc=docInfos[i]=utils.parseDoc(doc,opts.new_edits),doc.error&&!docInfoError&&(docInfoError=doc))}if(docInfoError)return callback(docInfoError);var results=new Array(docInfos.length),fetchedDocs=new utils.Map,preconditionErrored=!1,blobType=api._blobSupport?"blob":"base64";utils.preprocessAttachments(docInfos,blobType,function(err){return err?callback(err):void startTransaction()})}var utils=require("../../utils"),errors=require("../../deps/errors"),idbUtils=require("./idb-utils"),idbConstants=require("./idb-constants"),ATTACH_AND_SEQ_STORE=idbConstants.ATTACH_AND_SEQ_STORE,ATTACH_STORE=idbConstants.ATTACH_STORE,BY_SEQ_STORE=idbConstants.BY_SEQ_STORE,DOC_STORE=idbConstants.DOC_STORE,LOCAL_STORE=idbConstants.LOCAL_STORE,META_STORE=idbConstants.META_STORE,compactRevs=idbUtils.compactRevs,decodeMetadata=idbUtils.decodeMetadata,encodeMetadata=idbUtils.encodeMetadata,idbError=idbUtils.idbError,openTransactionSafely=idbUtils.openTransactionSafely;module.exports=idbBulkDocs},{"../../deps/errors":31,"../../utils":47,"./idb-constants":17,"./idb-utils":18}],17:[function(require,module,exports){"use strict";exports.ADAPTER_VERSION=5,exports.DOC_STORE="document-store",exports.BY_SEQ_STORE="by-sequence",exports.ATTACH_STORE="attach-store",exports.ATTACH_AND_SEQ_STORE="attach-seq-store",exports.META_STORE="meta-store",exports.LOCAL_STORE="local-store",exports.DETECT_BLOB_SUPPORT_STORE="detect-blob-support"},{}],18:[function(require,module,exports){(function(process){"use strict";function tryCode(fun,that,args){try{fun.apply(that,args)}catch(err){"undefined"!=typeof PouchDB&&PouchDB.emit("error",err)}}var errors=require("../../deps/errors"),utils=require("../../utils"),constants=require("./idb-constants");exports.taskQueue={running:!1,queue:[]},exports.applyNext=function(){if(!exports.taskQueue.running&&exports.taskQueue.queue.length){exports.taskQueue.running=!0;var item=exports.taskQueue.queue.shift();item.action(function(err,res){tryCode(item.callback,this,[err,res]),exports.taskQueue.running=!1,process.nextTick(exports.applyNext)})}},exports.idbError=function(callback){return function(event){var message=event.target&&event.target.error&&event.target.error.name||event.target;callback(errors.error(errors.IDB_ERROR,message,event.type))}},exports.encodeMetadata=function(metadata,winningRev,deleted){return{data:utils.safeJsonStringify(metadata),winningRev:winningRev,deletedOrLocal:deleted?"1":"0",seq:metadata.seq,id:metadata.id}},exports.decodeMetadata=function(storedObject){if(!storedObject)return null;var metadata=utils.safeJsonParse(storedObject.data);return metadata.winningRev=storedObject.winningRev,metadata.deletedOrLocal="1"===storedObject.deletedOrLocal,metadata.seq=storedObject.seq,metadata},exports.decodeDoc=function(doc){if(!doc)return doc;var idx=utils.lastIndexOf(doc._doc_id_rev,":");return doc._id=doc._doc_id_rev.substring(0,idx-1),doc._rev=doc._doc_id_rev.substring(idx+1),delete doc._doc_id_rev,doc},exports.readBlobData=function(body,type,encode,callback){encode?body?"string"!=typeof body?utils.readAsBinaryString(body,function(binary){callback(utils.btoa(binary))}):callback(body):callback(""):body?"string"!=typeof body?callback(body):(body=utils.fixBinary(atob(body)),callback(utils.createBlob([body],{type:type}))):callback(utils.createBlob([""],{type:type}))},exports.fetchAttachmentsIfNecessary=function(doc,opts,txn,cb){function checkDone(){++numDone===attachments.length&&cb&&cb()}function fetchAttachment(doc,att){var attObj=doc._attachments[att],digest=attObj.digest,req=txn.objectStore(constants.ATTACH_STORE).get(digest);req.onsuccess=function(e){attObj.body=e.target.result.body,checkDone()}}var attachments=Object.keys(doc._attachments||{});if(!attachments.length)return cb&&cb();var numDone=0;attachments.forEach(function(att){opts.attachments&&opts.include_docs?fetchAttachment(doc,att):(doc._attachments[att].stub=!0,checkDone())})},exports.postProcessAttachments=function(results){return utils.Promise.all(results.map(function(row){if(row.doc&&row.doc._attachments){var attNames=Object.keys(row.doc._attachments);return utils.Promise.all(attNames.map(function(att){var attObj=row.doc._attachments[att];if("body"in attObj){var body=attObj.body,type=attObj.content_type;return new utils.Promise(function(resolve){exports.readBlobData(body,type,!0,function(base64){row.doc._attachments[att]=utils.extend(utils.pick(attObj,["digest","content_type"]),{data:base64}),resolve()})})}}))}}))},exports.compactRevs=function(revs,docId,txn){function checkDone(){count--,count||deleteOrphanedAttachments()}function deleteOrphanedAttachments(){possiblyOrphanedDigests.length&&possiblyOrphanedDigests.forEach(function(digest){var countReq=attAndSeqStore.index("digestSeq").count(IDBKeyRange.bound(digest+"::",digest+"::",!1,!1));countReq.onsuccess=function(e){var count=e.target.result;count||attStore["delete"](digest)}})}var possiblyOrphanedDigests=[],seqStore=txn.objectStore(constants.BY_SEQ_STORE),attStore=txn.objectStore(constants.ATTACH_STORE),attAndSeqStore=txn.objectStore(constants.ATTACH_AND_SEQ_STORE),count=revs.length;revs.forEach(function(rev){var index=seqStore.index("_doc_id_rev"),key=docId+"::"+rev;index.getKey(key).onsuccess=function(e){var seq=e.target.result;if("number"!=typeof seq)return checkDone();seqStore["delete"](seq);var cursor=attAndSeqStore.index("seq").openCursor(IDBKeyRange.only(seq));cursor.onsuccess=function(event){var cursor=event.target.result;if(cursor){var digest=cursor.value.digestSeq.split("::")[0];possiblyOrphanedDigests.push(digest),attAndSeqStore["delete"](cursor.primaryKey),cursor["continue"]()}else checkDone()}}})},exports.openTransactionSafely=function(idb,stores,mode){try{return{txn:idb.transaction(stores,mode)}}catch(err){return{error:err}}}}).call(this,require("_process"))},{"../../deps/errors":31,"../../utils":47,"./idb-constants":17,_process:132}],19:[function(require,module){(function(process){"use strict";function IdbPouch(opts,callback){var api=this;taskQueue.queue.push({action:function(thisCallback){init(api,opts,thisCallback)},callback:callback}),applyNext()}function init(api,opts,callback){function createSchema(db){var docStore=db.createObjectStore(DOC_STORE,{keyPath:"id"});db.createObjectStore(BY_SEQ_STORE,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),db.createObjectStore(ATTACH_STORE,{keyPath:"digest"}),db.createObjectStore(META_STORE,{keyPath:"id",autoIncrement:!1}),db.createObjectStore(DETECT_BLOB_SUPPORT_STORE),docStore.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),db.createObjectStore(LOCAL_STORE,{keyPath:"_id"});var attAndSeqStore=db.createObjectStore(ATTACH_AND_SEQ_STORE,{autoIncrement:!0});attAndSeqStore.createIndex("seq","seq"),attAndSeqStore.createIndex("digestSeq","digestSeq",{unique:!0})}function addDeletedOrLocalIndex(txn,callback){var docStore=txn.objectStore(DOC_STORE);docStore.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),docStore.openCursor().onsuccess=function(event){var cursor=event.target.result;if(cursor){var metadata=cursor.value,deleted=utils.isDeleted(metadata);metadata.deletedOrLocal=deleted?"1":"0",docStore.put(metadata),cursor["continue"]()}else callback()}}function createLocalStoreSchema(db){db.createObjectStore(LOCAL_STORE,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function migrateLocalStore(txn,cb){var localStore=txn.objectStore(LOCAL_STORE),docStore=txn.objectStore(DOC_STORE),seqStore=txn.objectStore(BY_SEQ_STORE),cursor=docStore.openCursor();cursor.onsuccess=function(event){var cursor=event.target.result;if(cursor){var metadata=cursor.value,docId=metadata.id,local=utils.isLocalId(docId),rev=merge.winningRev(metadata);if(local){var docIdRev=docId+"::"+rev,start=docId+"::",end=docId+"::~",index=seqStore.index("_doc_id_rev"),range=IDBKeyRange.bound(start,end,!1,!1),seqCursor=index.openCursor(range);seqCursor.onsuccess=function(e){if(seqCursor=e.target.result){var data=seqCursor.value;data._doc_id_rev===docIdRev&&localStore.put(data),seqStore["delete"](seqCursor.primaryKey),seqCursor["continue"]()}else docStore["delete"](cursor.primaryKey),cursor["continue"]()}}else cursor["continue"]()}else cb&&cb()}}function addAttachAndSeqStore(db){var attAndSeqStore=db.createObjectStore(ATTACH_AND_SEQ_STORE,{autoIncrement:!0});attAndSeqStore.createIndex("seq","seq"),attAndSeqStore.createIndex("digestSeq","digestSeq",{unique:!0})}function migrateAttsAndSeqs(txn,callback){var seqStore=txn.objectStore(BY_SEQ_STORE),attStore=txn.objectStore(ATTACH_STORE),attAndSeqStore=txn.objectStore(ATTACH_AND_SEQ_STORE),req=attStore.count();req.onsuccess=function(e){var count=e.target.result;return count?void(seqStore.openCursor().onsuccess=function(e){var cursor=e.target.result;if(!cursor)return callback();for(var doc=cursor.value,seq=cursor.primaryKey,atts=Object.keys(doc._attachments||{}),digestMap={},j=0;j<atts.length;j++){var att=doc._attachments[atts[j]];digestMap[att.digest]=!0}var digests=Object.keys(digestMap);for(j=0;j<digests.length;j++){var digest=digests[j];attAndSeqStore.put({seq:seq,digestSeq:digest+"::"+seq})}cursor["continue"]()}):callback()}}function migrateMetadata(txn){function decodeMetadataCompat(storedObject){return storedObject.data?decodeMetadata(storedObject):(storedObject.deletedOrLocal="1"===storedObject.deletedOrLocal,storedObject)}var bySeqStore=txn.objectStore(BY_SEQ_STORE),docStore=txn.objectStore(DOC_STORE),cursor=docStore.openCursor();cursor.onsuccess=function(e){function fetchMetadataSeq(){var start=metadata.id+"::",end=metadata.id+"::",req=bySeqStore.index("_doc_id_rev").openCursor(IDBKeyRange.bound(start,end)),metadataSeq=0;req.onsuccess=function(e){var cursor=e.target.result;if(!cursor)return metadata.seq=metadataSeq,onGetMetadataSeq();var seq=cursor.primaryKey;seq>metadataSeq&&(metadataSeq=seq),cursor["continue"]()}}function onGetMetadataSeq(){var metadataToStore=encodeMetadata(metadata,metadata.winningRev,metadata.deletedOrLocal),req=docStore.put(metadataToStore);req.onsuccess=function(){cursor["continue"]()}}var cursor=e.target.result;if(cursor){var metadata=decodeMetadataCompat(cursor.value);return metadata.winningRev=metadata.winningRev||merge.winningRev(metadata),metadata.seq?onGetMetadataSeq():void fetchMetadataSeq()}}}function allDocsQuery(totalRows,opts,callback){function onResultsReady(){callback(null,{total_rows:totalRows,offset:opts.skip,rows:results})}var start="startkey"in opts?opts.startkey:!1,end="endkey"in opts?opts.endkey:!1,key="key"in opts?opts.key:!1,skip=opts.skip||0,limit="number"==typeof opts.limit?opts.limit:-1,inclusiveEnd=opts.inclusive_end!==!1,descending="descending"in opts&&opts.descending?"prev":null,manualDescEnd=!1;descending&&start&&end&&(manualDescEnd=end,end=!1);var keyRange=null;try{start&&end?keyRange=IDBKeyRange.bound(start,end,!1,!inclusiveEnd):start?keyRange=descending?IDBKeyRange.upperBound(start):IDBKeyRange.lowerBound(start):end?keyRange=descending?IDBKeyRange.lowerBound(end,!inclusiveEnd):IDBKeyRange.upperBound(end,!inclusiveEnd):key&&(keyRange=IDBKeyRange.only(key))}catch(e){return"DataError"===e.name&&0===e.code?callback(null,{total_rows:totalRows,offset:opts.skip,rows:[]}):callback(errors.error(errors.IDB_ERROR,e.name,e.message))}var stores=[DOC_STORE,BY_SEQ_STORE];opts.attachments&&stores.push(ATTACH_STORE);var txnResult=openTransactionSafely(idb,stores,"readonly");if(txnResult.error)return callback(txnResult.error);var transaction=txnResult.txn;transaction.oncomplete=function(){opts.attachments?postProcessAttachments(results).then(onResultsReady):onResultsReady()};var oStore=transaction.objectStore(DOC_STORE),oCursor=descending?oStore.openCursor(keyRange,descending):oStore.openCursor(keyRange),results=[];oCursor.onsuccess=function(e){function allDocsInner(metadata,data){var doc={id:metadata.id,key:metadata.id,value:{rev:winningRev}};opts.include_docs&&(doc.doc=data,opts.conflicts&&(doc.doc._conflicts=merge.collectConflicts(metadata)),fetchAttachmentsIfNecessary(doc.doc,opts,transaction));var deleted=utils.isDeleted(metadata,winningRev);if("ok"===opts.deleted)deleted&&(doc.value.deleted=!0,doc.doc=null),results.push(doc);else if(!deleted&&skip--<=0){if(manualDescEnd){if(inclusiveEnd&&doc.key<manualDescEnd)return;if(!inclusiveEnd&&doc.key<=manualDescEnd)return}if(results.push(doc),0===--limit)return}cursor["continue"]()}if(e.target.result){var cursor=e.target.result,metadata=decodeMetadata(cursor.value),winningRev=metadata.winningRev;if(opts.include_docs){var index=transaction.objectStore(BY_SEQ_STORE).index("_doc_id_rev"),key=metadata.id+"::"+winningRev;index.get(key).onsuccess=function(event){allDocsInner(decodeMetadata(cursor.value),decodeDoc(event.target.result))}}else allDocsInner(metadata)}}}function countDocs(callback){if(-1!==api._docCount)return callback(null,api._docCount);var count,txnResult=openTransactionSafely(idb,[DOC_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);var txn=txnResult.txn,index=txn.objectStore(DOC_STORE).index("deletedOrLocal");index.count(IDBKeyRange.only("0")).onsuccess=function(e){count=e.target.result},txn.onerror=idbError(callback),txn.oncomplete=function(){api._docCount=count,callback(null,api._docCount)}}var name=opts.name,instanceId=null,idStored=!1,idb=null;api._docCount=-1,api._blobSupport=null,api._name=name,api.type=function(){return"idb"},api._id=utils.toPromise(function(callback){callback(null,instanceId)}),api._bulkDocs=function(req,opts,callback){idbBulkDocs(req,opts,api,idb,IdbPouch.Changes,callback)},api._get=function(id,opts,callback){function finish(){callback(err,{doc:doc,metadata:metadata,ctx:txn})}var doc,metadata,err,txn;if(opts=utils.clone(opts),opts.ctx)txn=opts.ctx;else{var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);txn=txnResult.txn}txn.objectStore(DOC_STORE).get(id).onsuccess=function(e){if(metadata=decodeMetadata(e.target.result),!metadata)return err=errors.error(errors.MISSING_DOC,"missing"),finish();if(utils.isDeleted(metadata)&&!opts.rev)return err=errors.error(errors.MISSING_DOC,"deleted"),finish();var objectStore=txn.objectStore(BY_SEQ_STORE),rev=opts.rev||metadata.winningRev,key=metadata.id+"::"+rev;objectStore.index("_doc_id_rev").get(key).onsuccess=function(e){return doc=e.target.result,doc&&(doc=decodeDoc(doc)),doc?void finish():(err=errors.error(errors.MISSING_DOC,"missing"),finish())}}},api._getAttachment=function(attachment,opts,callback){var txn;if(opts=utils.clone(opts),opts.ctx)txn=opts.ctx;else{var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);txn=txnResult.txn}var digest=attachment.digest,type=attachment.content_type;txn.objectStore(ATTACH_STORE).get(digest).onsuccess=function(e){var body=e.target.result.body;readBlobData(body,type,opts.encode,function(blobData){callback(null,blobData)})}},api._allDocs=function(opts,callback){countDocs(function(err,totalRows){return err?callback(err):0===opts.limit?callback(null,{total_rows:totalRows,offset:opts.skip,rows:[]}):void allDocsQuery(totalRows,opts,callback)})},api._info=function(callback){countDocs(function(err,count){if(err)return callback(err);if(null===idb||!cachedDBs[api._name]){var error=new Error("db isn't open");return error.id="idbNull",callback(error)}var updateSeq=0,txnResult=openTransactionSafely(idb,[BY_SEQ_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);var txn=txnResult.txn;txn.objectStore(BY_SEQ_STORE).openCursor(null,"prev").onsuccess=function(event){var cursor=event.target.result;updateSeq=cursor?cursor.key:0},txn.oncomplete=function(){callback(null,{doc_count:count,update_seq:updateSeq})}})},api._changes=function(opts){function onGetCursor(cursor){function onGetMetadata(){return metadata.seq!==seq?cursor["continue"]():(lastSeq=seq,metadata.winningRev===doc._rev?onGetWinningDoc(doc):void fetchWinningDoc())}function fetchWinningDoc(){var docIdRev=doc._id+"::"+metadata.winningRev,req=bySeqStore.index("_doc_id_rev").openCursor(IDBKeyRange.bound(docIdRev,docIdRev+""));req.onsuccess=function(e){onGetWinningDoc(decodeDoc(e.target.result.value))}}function onGetWinningDoc(winningDoc){var change=opts.processChange(winningDoc,metadata,opts);change.seq=metadata.seq,filter(change)&&(numResults++,returnDocs&&results.push(change),opts.attachments&&opts.include_docs?fetchAttachmentsIfNecessary(winningDoc,opts,txn,function(){postProcessAttachments([change]).then(function(){opts.onChange(change)
})}):opts.onChange(change)),numResults!==limit&&cursor["continue"]()}var doc=decodeDoc(cursor.value),seq=cursor.key;if(docIds&&!docIds.has(doc._id))return cursor["continue"]();var metadata;return(metadata=docIdsToMetadata.get(doc._id))?onGetMetadata():void(docStore.get(doc._id).onsuccess=function(event){metadata=decodeMetadata(event.target.result),docIdsToMetadata.set(doc._id,metadata),onGetMetadata()})}function onsuccess(event){var cursor=event.target.result;cursor&&onGetCursor(cursor)}function fetchChanges(){var objectStores=[DOC_STORE,BY_SEQ_STORE];opts.attachments&&objectStores.push(ATTACH_STORE);var txnResult=openTransactionSafely(idb,objectStores,"readonly");if(txnResult.error)return opts.complete(txnResult.error);txn=txnResult.txn,txn.onerror=idbError(opts.complete),txn.oncomplete=onTxnComplete,bySeqStore=txn.objectStore(BY_SEQ_STORE),docStore=txn.objectStore(DOC_STORE);var req;req=descending?bySeqStore.openCursor(null,descending):bySeqStore.openCursor(IDBKeyRange.lowerBound(opts.since,!0)),req.onsuccess=onsuccess}function onTxnComplete(){function finish(){opts.complete(null,{results:results,last_seq:lastSeq})}!opts.continuous&&opts.attachments?postProcessAttachments(results).then(finish):finish()}if(opts=utils.clone(opts),opts.continuous){var id=name+":"+utils.uuid();return IdbPouch.Changes.addListener(name,id,api,opts),IdbPouch.Changes.notify(name),{cancel:function(){IdbPouch.Changes.removeListener(name,id)}}}var docIds=opts.doc_ids&&new utils.Set(opts.doc_ids),descending=opts.descending?"prev":null;opts.since=opts.since||0;var lastSeq=opts.since,limit="limit"in opts?opts.limit:-1;0===limit&&(limit=1);var returnDocs;returnDocs="returnDocs"in opts?opts.returnDocs:!0;var txn,bySeqStore,docStore,results=[],numResults=0,filter=utils.filterChange(opts),docIdsToMetadata=new utils.Map;fetchChanges()},api._close=function(callback){return null===idb?callback(errors.error(errors.NOT_OPEN)):(idb.close(),delete cachedDBs[name],idb=null,void callback())},api._getRevisionTree=function(docId,callback){var txnResult=openTransactionSafely(idb,[DOC_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);var txn=txnResult.txn,req=txn.objectStore(DOC_STORE).get(docId);req.onsuccess=function(event){var doc=decodeMetadata(event.target.result);doc?callback(null,doc.rev_tree):callback(errors.error(errors.MISSING_DOC))}},api._doCompaction=function(docId,revs,callback){var stores=[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,ATTACH_AND_SEQ_STORE],txnResult=openTransactionSafely(idb,stores,"readwrite");if(txnResult.error)return callback(txnResult.error);var txn=txnResult.txn,docStore=txn.objectStore(DOC_STORE);docStore.get(docId).onsuccess=function(event){var metadata=decodeMetadata(event.target.result);merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash;-1!==revs.indexOf(rev)&&(opts.status="missing")}),compactRevs(revs,docId,txn);var winningRev=metadata.winningRev,deleted=metadata.deletedOrLocal;txn.objectStore(DOC_STORE).put(encodeMetadata(metadata,winningRev,deleted))},txn.onerror=idbError(callback),txn.oncomplete=function(){utils.call(callback)}},api._getLocal=function(id,callback){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);var tx=txnResult.txn,req=tx.objectStore(LOCAL_STORE).get(id);req.onerror=idbError(callback),req.onsuccess=function(e){var doc=e.target.result;doc?(delete doc._doc_id_rev,callback(null,doc)):callback(errors.error(errors.MISSING_DOC))}},api._putLocal=function(doc,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),delete doc._revisions;var oldRev=doc._rev,id=doc._id;doc._rev=oldRev?"0-"+(parseInt(oldRev.split("-")[1],10)+1):"0-1";var ret,tx=opts.ctx;if(!tx){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readwrite");if(txnResult.error)return callback(txnResult.error);tx=txnResult.txn,tx.onerror=idbError(callback),tx.oncomplete=function(){ret&&callback(null,ret)}}var req,oStore=tx.objectStore(LOCAL_STORE);oldRev?(req=oStore.get(id),req.onsuccess=function(e){var oldDoc=e.target.result;if(oldDoc&&oldDoc._rev===oldRev){var req=oStore.put(doc);req.onsuccess=function(){ret={ok:!0,id:doc._id,rev:doc._rev},opts.ctx&&callback(null,ret)}}else callback(errors.error(errors.REV_CONFLICT))}):(req=oStore.add(doc),req.onerror=function(e){callback(errors.error(errors.REV_CONFLICT)),e.preventDefault(),e.stopPropagation()},req.onsuccess=function(){ret={ok:!0,id:doc._id,rev:doc._rev},opts.ctx&&callback(null,ret)})},api._removeLocal=function(doc,callback){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readwrite");if(txnResult.error)return callback(txnResult.error);var ret,tx=txnResult.txn;tx.oncomplete=function(){ret&&callback(null,ret)};var id=doc._id,oStore=tx.objectStore(LOCAL_STORE),req=oStore.get(id);req.onerror=idbError(callback),req.onsuccess=function(e){var oldDoc=e.target.result;oldDoc&&oldDoc._rev===doc._rev?(oStore["delete"](id),ret={ok:!0,id:id,rev:"0-0"}):callback(errors.error(errors.MISSING_DOC))}};var cached=cachedDBs[name];if(cached)return idb=cached.idb,instanceId=cached.instanceId,api._blobSupport=cached.blobSupport,void process.nextTick(function(){callback(null,api)});var req=indexedDB.open(name,ADAPTER_VERSION);"openReqList"in IdbPouch||(IdbPouch.openReqList={}),IdbPouch.openReqList[name]=req,req.onupgradeneeded=function(e){function next(){var migration=migrations[i-1];i++,migration&&migration(txn,next)}var db=e.target.result;if(e.oldVersion<1)return createSchema(db);var txn=e.currentTarget.transaction;e.oldVersion<3&&createLocalStoreSchema(db),e.oldVersion<4&&addAttachAndSeqStore(db);var migrations=[addDeletedOrLocalIndex,migrateLocalStore,migrateAttsAndSeqs,migrateMetadata],i=e.oldVersion;next()},req.onsuccess=function(e){idb=e.target.result,idb.onversionchange=function(){idb.close(),delete cachedDBs[name]},idb.onabort=function(){idb.close(),delete cachedDBs[name]};var txn=idb.transaction([META_STORE,DETECT_BLOB_SUPPORT_STORE],"readwrite"),req=txn.objectStore(META_STORE).get(META_STORE);req.onsuccess=function(e){var checkSetupComplete=function(){null!==api._blobSupport&&idStored&&(cachedDBs[name]={idb:idb,instanceId:instanceId,blobSupport:api._blobSupport,loaded:!0},callback(null,api))},meta=e.target.result||{id:META_STORE};name+"_id"in meta?(instanceId=meta[name+"_id"],idStored=!0,checkSetupComplete()):(instanceId=utils.uuid(),meta[name+"_id"]=instanceId,txn.objectStore(META_STORE).put(meta).onsuccess=function(){idStored=!0,checkSetupComplete()}),blobSupportPromise||(blobSupportPromise=checkBlobSupport(txn,idb)),blobSupportPromise.then(function(val){api._blobSupport=val,checkSetupComplete()})}},req.onerror=idbError(callback)}function destroy(name,opts,callback){"openReqList"in IdbPouch||(IdbPouch.openReqList={}),IdbPouch.Changes.removeAllListeners(name),IdbPouch.openReqList[name]&&IdbPouch.openReqList[name].result&&(IdbPouch.openReqList[name].result.close(),delete cachedDBs[name]);var req=indexedDB.deleteDatabase(name);req.onsuccess=function(){IdbPouch.openReqList[name]&&(IdbPouch.openReqList[name]=null),utils.hasLocalStorage()&&name in localStorage&&delete localStorage[name],callback(null,{ok:!0})},req.onerror=idbError(callback)}var blobSupportPromise,utils=require("../../utils"),merge=require("../../merge"),errors=require("../../deps/errors"),idbUtils=require("./idb-utils"),idbConstants=require("./idb-constants"),idbBulkDocs=require("./idb-bulk-docs"),checkBlobSupport=require("./idb-blob-support"),ADAPTER_VERSION=idbConstants.ADAPTER_VERSION,ATTACH_AND_SEQ_STORE=idbConstants.ATTACH_AND_SEQ_STORE,ATTACH_STORE=idbConstants.ATTACH_STORE,BY_SEQ_STORE=idbConstants.BY_SEQ_STORE,DETECT_BLOB_SUPPORT_STORE=idbConstants.DETECT_BLOB_SUPPORT_STORE,DOC_STORE=idbConstants.DOC_STORE,LOCAL_STORE=idbConstants.LOCAL_STORE,META_STORE=idbConstants.META_STORE,applyNext=idbUtils.applyNext,compactRevs=idbUtils.compactRevs,decodeDoc=idbUtils.decodeDoc,decodeMetadata=idbUtils.decodeMetadata,encodeMetadata=idbUtils.encodeMetadata,fetchAttachmentsIfNecessary=idbUtils.fetchAttachmentsIfNecessary,idbError=idbUtils.idbError,postProcessAttachments=idbUtils.postProcessAttachments,readBlobData=idbUtils.readBlobData,taskQueue=idbUtils.taskQueue,openTransactionSafely=idbUtils.openTransactionSafely,cachedDBs={};IdbPouch.valid=function(){var isSafari="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);return!isSafari&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange},IdbPouch.destroy=utils.toPromise(function(name,opts,callback){taskQueue.queue.push({action:function(thisCallback){destroy(name,opts,thisCallback)},callback:callback}),applyNext()}),IdbPouch.Changes=new utils.Changes,module.exports=IdbPouch}).call(this,require("_process"))},{"../../deps/errors":31,"../../merge":42,"../../utils":47,"./idb-blob-support":15,"./idb-bulk-docs":16,"./idb-constants":17,"./idb-utils":18,_process:132}],20:[function(require,module){module.exports=["idb","websql"]},{}],21:[function(require,module){"use strict";function websqlBulkDocs(req,opts,api,db,Changes,callback){function complete(){return preconditionErrored?callback(preconditionErrored):(Changes.notify(api._name),api._docCount=-1,void callback(null,results))}function verifyAttachment(digest,callback){var sql="SELECT count(*) as cnt FROM "+ATTACH_STORE+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){if(0===result.rows.item(0).cnt){var err=errors.error(errors.MISSING_STUB,"unknown stub attachment with digest "+digest);callback(err)}else callback()})}function verifyAttachments(finish){function checkDone(){++numDone===digests.length&&finish(err)}var digests=[];if(docInfos.forEach(function(docInfo){docInfo.data&&docInfo.data._attachments&&Object.keys(docInfo.data._attachments).forEach(function(filename){var att=docInfo.data._attachments[filename];att.stub&&digests.push(att.digest)})}),!digests.length)return finish();var err,numDone=0;digests.forEach(function(digest){verifyAttachment(digest,function(attErr){attErr&&!err&&(err=attErr),checkDone()})})}function writeDoc(docInfo,winningRev,deleted,callback,isUpdate,docCount,resultsIdx){function finish(){function insertAttachmentMappings(seq,callback){function checkDone(){return++attsAdded===attsToAdd.length&&callback(),!1}function add(att){var sql="INSERT INTO "+ATTACH_AND_SEQ_STORE+" (digest, seq) VALUES (?,?)",sqlArgs=[data._attachments[att].digest,seq];tx.executeSql(sql,sqlArgs,checkDone,checkDone)}var attsAdded=0,attsToAdd=Object.keys(data._attachments||{});if(!attsToAdd.length)return callback();for(var i=0;i<attsToAdd.length;i++)add(attsToAdd[i])}var data=docInfo.data,deletedInt=deleted?1:0,id=data._id,rev=data._rev,json=stringifyDoc(data),sql="INSERT INTO "+BY_SEQ_STORE+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",sqlArgs=[id,rev,json,deletedInt];tx.executeSql(sql,sqlArgs,function(tx,result){var seq=result.insertId;insertAttachmentMappings(seq,function(){dataWritten(tx,seq)})},function(){var fetchSql=select("seq",BY_SEQ_STORE,null,"doc_id=? AND rev=?");return tx.executeSql(fetchSql,[id,rev],function(tx,res){var seq=res.rows.item(0).seq,sql="UPDATE "+BY_SEQ_STORE+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",sqlArgs=[json,deletedInt,id,rev];tx.executeSql(sql,sqlArgs,function(tx){insertAttachmentMappings(seq,function(){dataWritten(tx,seq)})})}),!1})}function collectResults(attachmentErr){err||(attachmentErr?(err=attachmentErr,callback(err)):recv===attachments.length&&finish())}function attachmentSaved(err){recv++,collectResults(err)}function autoCompact(){if(isUpdate&&api.auto_compaction){var id=docInfo.metadata.id,revsToDelete=utils.compactTree(docInfo.metadata);compactRevs(revsToDelete,id,tx)}}function dataWritten(tx,seq){autoCompact(),docInfo.metadata.seq=seq,delete docInfo.metadata.rev;var sql=isUpdate?"UPDATE "+DOC_STORE+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id="+DOC_STORE+".id AND rev=?) WHERE id=?":"INSERT INTO "+DOC_STORE+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",metadataStr=utils.safeJsonStringify(docInfo.metadata),id=docInfo.metadata.id,params=isUpdate?[metadataStr,seq,winningRev,id]:[id,seq,seq,metadataStr];tx.executeSql(sql,params,function(){results[resultsIdx]={ok:!0,id:docInfo.metadata.id,rev:winningRev},fetchedDocs.set(id,docInfo.metadata),callback()})}var err=null,recv=0;docInfo.data._id=docInfo.metadata.id,docInfo.data._rev=docInfo.metadata.rev;var attachments=Object.keys(docInfo.data._attachments||{});deleted&&(docInfo.data._deleted=!0),attachments.forEach(function(key){var att=docInfo.data._attachments[key];if(att.stub)recv++,collectResults();else{var data=att.data;delete att.data;var digest=att.digest;saveAttachment(digest,data,attachmentSaved)}}),attachments.length||finish()}function processDocs(){utils.processDocs(docInfos,api,fetchedDocs,tx,results,writeDoc,opts)}function fetchExistingDocs(callback){function checkDone(){++numFetched===docInfos.length&&callback()}if(!docInfos.length)return callback();var numFetched=0;docInfos.forEach(function(docInfo){if(docInfo._id&&utils.isLocalId(docInfo._id))return checkDone();var id=docInfo.metadata.id;tx.executeSql("SELECT json FROM "+DOC_STORE+" WHERE id = ?",[id],function(tx,result){if(result.rows.length){var metadata=utils.safeJsonParse(result.rows.item(0).json);fetchedDocs.set(id,metadata)}checkDone()})})}function saveAttachment(digest,data,callback){var sql="SELECT digest FROM "+ATTACH_STORE+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){return result.rows.length?callback():(sql="INSERT INTO "+ATTACH_STORE+" (digest, body, escaped) VALUES (?,?,1)",void tx.executeSql(sql,[digest,websqlUtils.escapeBlob(data)],function(){callback()},function(){return callback(),!1}))})}var newEdits=opts.new_edits,userDocs=req.docs,docInfos=userDocs.map(function(doc){if(doc._id&&utils.isLocalId(doc._id))return doc;var newDoc=utils.parseDoc(doc,newEdits);return newDoc}),docInfoErrors=docInfos.filter(function(docInfo){return docInfo.error});if(docInfoErrors.length)return callback(docInfoErrors[0]);var tx,preconditionErrored,results=new Array(docInfos.length),fetchedDocs=new utils.Map;utils.preprocessAttachments(docInfos,"binary",function(err){return err?callback(err):void db.transaction(function(txn){tx=txn,verifyAttachments(function(err){err?preconditionErrored=err:fetchExistingDocs(processDocs)})},unknownError(callback),complete)})}var utils=require("../../utils"),errors=require("../../deps/errors"),websqlUtils=require("./websql-utils"),websqlConstants=require("./websql-constants"),DOC_STORE=websqlConstants.DOC_STORE,BY_SEQ_STORE=websqlConstants.BY_SEQ_STORE,ATTACH_STORE=websqlConstants.ATTACH_STORE,ATTACH_AND_SEQ_STORE=websqlConstants.ATTACH_AND_SEQ_STORE,select=websqlUtils.select,stringifyDoc=websqlUtils.stringifyDoc,compactRevs=websqlUtils.compactRevs,unknownError=websqlUtils.unknownError;module.exports=websqlBulkDocs},{"../../deps/errors":31,"../../utils":47,"./websql-constants":22,"./websql-utils":23}],22:[function(require,module,exports){"use strict";function quote(str){return"'"+str+"'"}exports.ADAPTER_VERSION=7,exports.DOC_STORE=quote("document-store"),exports.BY_SEQ_STORE=quote("by-sequence"),exports.ATTACH_STORE=quote("attach-store"),exports.LOCAL_STORE=quote("local-store"),exports.META_STORE=quote("metadata-store"),exports.ATTACH_AND_SEQ_STORE=quote("attach-seq-store")},{}],23:[function(require,module){"use strict";function escapeBlob(str){return str.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function unescapeBlob(str){return str.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function stringifyDoc(doc){return delete doc._id,delete doc._rev,JSON.stringify(doc)}function unstringifyDoc(doc,id,rev){return doc=JSON.parse(doc),doc._id=id,doc._rev=rev,doc}function qMarks(num){for(var s="(";num--;)s+="?",num&&(s+=",");return s+")"}function select(selector,table,joiner,where,orderBy){return"SELECT "+selector+" FROM "+("string"==typeof table?table:table.join(" JOIN "))+(joiner?" ON "+joiner:"")+(where?" WHERE "+("string"==typeof where?where:where.join(" AND ")):"")+(orderBy?" ORDER BY "+orderBy:"")}function compactRevs(revs,docId,tx){function checkDone(){++numDone===revs.length&&deleteOrphans()}function deleteOrphans(){if(seqs.length){var sql="SELECT DISTINCT digest AS digest FROM "+ATTACH_AND_SEQ_STORE+" WHERE seq IN "+qMarks(seqs.length);tx.executeSql(sql,seqs,function(tx,res){for(var digestsToCheck=[],i=0;i<res.rows.length;i++)digestsToCheck.push(res.rows.item(i).digest);if(digestsToCheck.length){var sql="DELETE FROM "+ATTACH_AND_SEQ_STORE+" WHERE seq IN ("+seqs.map(function(){return"?"}).join(",")+")";tx.executeSql(sql,seqs,function(tx){var sql="SELECT digest FROM "+ATTACH_AND_SEQ_STORE+" WHERE digest IN ("+digestsToCheck.map(function(){return"?"}).join(",")+")";tx.executeSql(sql,digestsToCheck,function(tx,res){for(var nonOrphanedDigests=new utils.Set,i=0;i<res.rows.length;i++)nonOrphanedDigests.add(res.rows.item(i).digest);digestsToCheck.forEach(function(digest){nonOrphanedDigests.has(digest)||(tx.executeSql("DELETE FROM "+ATTACH_AND_SEQ_STORE+" WHERE digest=?",[digest]),tx.executeSql("DELETE FROM "+ATTACH_STORE+" WHERE digest=?",[digest]))})})})}})}}if(revs.length){var numDone=0,seqs=[];revs.forEach(function(rev){var sql="SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id=? AND rev=?";tx.executeSql(sql,[docId,rev],function(tx,res){if(!res.rows.length)return checkDone();var seq=res.rows.item(0).seq;seqs.push(seq),tx.executeSql("DELETE FROM "+BY_SEQ_STORE+" WHERE seq=?",[seq],checkDone)})})}}function unknownError(callback){return function(event){var errorNameMatch=event&&event.constructor.toString().match(/function ([^\(]+)/),errorName=errorNameMatch&&errorNameMatch[1]||event.type,errorReason=event.target||event.message;callback(errors.error(errors.WSQ_ERROR,errorReason,errorName))}}function getSize(opts){if("size"in opts)return 1e6*opts.size;var isAndroid=/Android/.test(window.navigator.userAgent);return isAndroid?5e6:1}var utils=require("../../utils"),errors=require("../../deps/errors"),websqlConstants=require("./websql-constants"),BY_SEQ_STORE=websqlConstants.BY_SEQ_STORE,ATTACH_STORE=websqlConstants.ATTACH_STORE,ATTACH_AND_SEQ_STORE=websqlConstants.ATTACH_AND_SEQ_STORE;module.exports={escapeBlob:escapeBlob,unescapeBlob:unescapeBlob,stringifyDoc:stringifyDoc,unstringifyDoc:unstringifyDoc,qMarks:qMarks,select:select,compactRevs:compactRevs,unknownError:unknownError,getSize:getSize}},{"../../deps/errors":31,"../../utils":47,"./websql-constants":22}],24:[function(require,module){"use strict";function fetchAttachmentsIfNecessary(doc,opts,api,txn,cb){function checkDone(){++numDone===attachments.length&&cb&&cb()}function fetchAttachment(doc,att){var attObj=doc._attachments[att],attOpts={encode:!0,ctx:txn};api._getAttachment(attObj,attOpts,function(_,base64){doc._attachments[att]=utils.extend(utils.pick(attObj,["digest","content_type"]),{data:base64}),checkDone()})}var attachments=Object.keys(doc._attachments||{});if(!attachments.length)return cb&&cb();var numDone=0;attachments.forEach(function(att){opts.attachments&&opts.include_docs?fetchAttachment(doc,att):(doc._attachments[att].stub=!0,checkDone())})}function openDB(name,version,desc,size){var db=cachedDatabases[name];return db||(db=cachedDatabases[name]=openDBFunction(name,version,desc,size)),db}function WebSqlPouch(opts,callback){function dbCreated(){utils.hasLocalStorage()&&(window.localStorage["_pouch__websqldb_"+api._name]=!0),callback(null,api)}function runMigration2(tx,callback){tx.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL),tx.executeSql("ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){tx.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL),tx.executeSql("ALTER TABLE "+DOC_STORE+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){tx.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+DOC_STORE+" (local, id)");var sql="SELECT "+DOC_STORE+".winningseq AS seq, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq";tx.executeSql(sql,[],function(tx,result){for(var deleted=[],local=[],i=0;i<result.rows.length;i++){var item=result.rows.item(i),seq=item.seq,metadata=JSON.parse(item.metadata);utils.isDeleted(metadata)&&deleted.push(seq),utils.isLocalId(metadata.id)&&local.push(metadata.id)}tx.executeSql("UPDATE "+DOC_STORE+"SET local = 1 WHERE id IN "+qMarks(local.length),local,function(){tx.executeSql("UPDATE "+BY_SEQ_STORE+" SET deleted = 1 WHERE seq IN "+qMarks(deleted.length),deleted,callback)})})})})}function runMigration3(tx,callback){var local="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE+" (id UNIQUE, rev, json)";tx.executeSql(local,[],function(){var sql="SELECT "+DOC_STORE+".id AS id, "+BY_SEQ_STORE+".json AS data FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq WHERE local = 1";tx.executeSql(sql,[],function(tx,res){function doNext(){if(!rows.length)return callback(tx);var row=rows.shift(),rev=JSON.parse(row.data)._rev;tx.executeSql("INSERT INTO "+LOCAL_STORE+" (id, rev, json) VALUES (?,?,?)",[row.id,rev,row.data],function(tx){tx.executeSql("DELETE FROM "+DOC_STORE+" WHERE id=?",[row.id],function(tx){tx.executeSql("DELETE FROM "+BY_SEQ_STORE+" WHERE seq=?",[row.seq],function(){doNext()})})})}for(var rows=[],i=0;i<res.rows.length;i++)rows.push(res.rows.item(i));doNext()})})}function runMigration4(tx,callback){function updateRows(rows){function doNext(){if(!rows.length)return callback(tx);var row=rows.shift(),doc_id_rev=parseHexString(row.hex,encoding),idx=doc_id_rev.lastIndexOf("::"),doc_id=doc_id_rev.substring(0,idx),rev=doc_id_rev.substring(idx+2),sql="UPDATE "+BY_SEQ_STORE+" SET doc_id=?, rev=? WHERE doc_id_rev=?";tx.executeSql(sql,[doc_id,rev,doc_id_rev],function(){doNext()})}doNext()}var sql="ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN doc_id";tx.executeSql(sql,[],function(tx){var sql="ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN rev";tx.executeSql(sql,[],function(tx){tx.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL,[],function(tx){var sql="SELECT hex(doc_id_rev) as hex FROM "+BY_SEQ_STORE;tx.executeSql(sql,[],function(tx,res){for(var rows=[],i=0;i<res.rows.length;i++)rows.push(res.rows.item(i));updateRows(rows)})})})})}function runMigration5(tx,callback){function migrateAttsAndSeqs(tx){var sql="SELECT COUNT(*) AS cnt FROM "+ATTACH_STORE;tx.executeSql(sql,[],function(tx,res){function nextPage(){var sql=select(SELECT_DOCS+", "+DOC_STORE+".id AS id",[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,null,DOC_STORE+".id ");sql+=" LIMIT "+pageSize+" OFFSET "+offset,offset+=pageSize,tx.executeSql(sql,[],function(tx,res){function addDigestSeq(digest,seq){var seqs=digestSeqs[digest]=digestSeqs[digest]||[];-1===seqs.indexOf(seq)&&seqs.push(seq)}if(!res.rows.length)return callback(tx);for(var digestSeqs={},i=0;i<res.rows.length;i++)for(var row=res.rows.item(i),doc=unstringifyDoc(row.data,row.id,row.rev),atts=Object.keys(doc._attachments||{}),j=0;j<atts.length;j++){var att=doc._attachments[atts[j]];addDigestSeq(att.digest,row.seq)}var digestSeqPairs=[];if(Object.keys(digestSeqs).forEach(function(digest){var seqs=digestSeqs[digest];seqs.forEach(function(seq){digestSeqPairs.push([digest,seq])})}),!digestSeqPairs.length)return nextPage();var numDone=0;digestSeqPairs.forEach(function(pair){var sql="INSERT INTO "+ATTACH_AND_SEQ_STORE+" (digest, seq) VALUES (?,?)";tx.executeSql(sql,pair,function(){++numDone===digestSeqPairs.length&&nextPage()})})})}var count=res.rows.item(0).cnt;if(!count)return callback(tx);var offset=0,pageSize=10;nextPage()})}var attachAndRev="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE+" (digest, seq INTEGER)";tx.executeSql(attachAndRev,[],function(tx){tx.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL,[],function(tx){tx.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL,[],migrateAttsAndSeqs)})})}function runMigration6(tx,callback){var sql="ALTER TABLE "+ATTACH_STORE+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";tx.executeSql(sql,[],callback)}function runMigration7(tx,callback){var sql="ALTER TABLE "+DOC_STORE+" ADD COLUMN max_seq INTEGER";tx.executeSql(sql,[],function(tx){var sql="UPDATE "+DOC_STORE+" SET max_seq=(SELECT MAX(seq) FROM "+BY_SEQ_STORE+" WHERE doc_id=id)";tx.executeSql(sql,[],function(tx){var sql="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+DOC_STORE+" (max_seq)";tx.executeSql(sql,[],callback)})})}function checkEncoding(tx,cb){tx.executeSql('SELECT HEX("a") AS hex',[],function(tx,res){var hex=res.rows.item(0).hex;encoding=2===hex.length?"UTF-8":"UTF-16",cb()})}function onGetInstanceId(){for(;idRequests.length>0;){var idCallback=idRequests.pop();idCallback(null,instanceId)}}function onGetVersion(tx,dbVersion){if(0===dbVersion){var meta="CREATE TABLE IF NOT EXISTS "+META_STORE+" (dbid, db_version INTEGER)",attach="CREATE TABLE IF NOT EXISTS "+ATTACH_STORE+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",attachAndRev="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE+" (digest, seq INTEGER)",doc="CREATE TABLE IF NOT EXISTS "+DOC_STORE+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",seq="CREATE TABLE IF NOT EXISTS "+BY_SEQ_STORE+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",local="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE+" (id UNIQUE, rev, json)";tx.executeSql(attach),tx.executeSql(local),tx.executeSql(attachAndRev,[],function(){tx.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL),tx.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL)}),tx.executeSql(doc,[],function(){tx.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL),tx.executeSql(seq,[],function(){tx.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL),tx.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL),tx.executeSql(meta,[],function(){var initSeq="INSERT INTO "+META_STORE+" (db_version, dbid) VALUES (?,?)";instanceId=utils.uuid();var initSeqArgs=[ADAPTER_VERSION,instanceId];tx.executeSql(initSeq,initSeqArgs,function(){onGetInstanceId()})})})})}else{var setupDone=function(){var migrated=ADAPTER_VERSION>dbVersion;migrated&&tx.executeSql("UPDATE "+META_STORE+" SET db_version = "+ADAPTER_VERSION);var sql="SELECT dbid FROM "+META_STORE;tx.executeSql(sql,[],function(tx,result){instanceId=result.rows.item(0).dbid,onGetInstanceId()})},tasks=[runMigration2,runMigration3,runMigration4,runMigration5,runMigration6,runMigration7,setupDone],i=dbVersion,nextMigration=function(tx){tasks[i-1](tx,nextMigration),i++};nextMigration(tx)}}function setup(){db.transaction(function(tx){checkEncoding(tx,function(){fetchVersion(tx)})},unknownError(callback),dbCreated)}function fetchVersion(tx){var sql="SELECT sql FROM sqlite_master WHERE tbl_name = "+META_STORE;tx.executeSql(sql,[],function(tx,result){result.rows.length?/db_version/.test(result.rows.item(0).sql)?tx.executeSql("SELECT db_version FROM "+META_STORE,[],function(tx,result){var dbVersion=result.rows.item(0).db_version;onGetVersion(tx,dbVersion)}):tx.executeSql("ALTER TABLE "+META_STORE+" ADD COLUMN db_version INTEGER",[],function(){onGetVersion(tx,1)}):onGetVersion(tx,0)})}function countDocs(tx,callback){if(-1!==api._docCount)return callback(api._docCount);var sql=select("COUNT("+DOC_STORE+".id) AS 'num'",[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,BY_SEQ_STORE+".deleted=0");tx.executeSql(sql,[],function(tx,result){api._docCount=result.rows.item(0).num,callback(api._docCount)})}var encoding,api=this,instanceId=null,size=getSize(opts),idRequests=[];api._docCount=-1,api._name=opts.name;var db=openDB(api._name,POUCH_VERSION,api._name,size);return db?("function"!=typeof db.readTransaction&&(db.readTransaction=db.transaction),utils.isCordova()?window.addEventListener(api._name+"_pouch",function cordova_init(){window.removeEventListener(api._name+"_pouch",cordova_init,!1),setup()},!1):setup(),api.type=function(){return"websql"},api._id=utils.toPromise(function(callback){callback(null,instanceId)}),api._info=function(callback){db.readTransaction(function(tx){countDocs(tx,function(docCount){var sql="SELECT MAX(seq) AS seq FROM "+BY_SEQ_STORE;tx.executeSql(sql,[],function(tx,res){var updateSeq=res.rows.item(0).seq||0;callback(null,{doc_count:docCount,update_seq:updateSeq})})})},unknownError(callback))},api._bulkDocs=function(req,opts,callback){websqlBulkDocs(req,opts,api,db,WebSqlPouch.Changes,callback)},api._get=function(id,opts,callback){function finish(){callback(err,{doc:doc,metadata:metadata,ctx:tx})}opts=utils.clone(opts);var doc,metadata,err;if(!opts.ctx)return void db.readTransaction(function(txn){opts.ctx=txn,api._get(id,opts,callback)});var sql,sqlArgs,tx=opts.ctx;opts.rev?(sql=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE+".id="+BY_SEQ_STORE+".doc_id",[BY_SEQ_STORE+".doc_id=?",BY_SEQ_STORE+".rev=?"]),sqlArgs=[id,opts.rev]):(sql=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,DOC_STORE+".id=?"),sqlArgs=[id]),tx.executeSql(sql,sqlArgs,function(a,results){if(!results.rows.length)return err=errors.error(errors.MISSING_DOC,"missing"),finish();var item=results.rows.item(0);return metadata=utils.safeJsonParse(item.metadata),item.deleted&&!opts.rev?(err=errors.error(errors.MISSING_DOC,"deleted"),finish()):(doc=unstringifyDoc(item.data,metadata.id,item.rev),void finish())})},api._allDocs=function(opts,callback){var totalRows,results=[],start="startkey"in opts?opts.startkey:!1,end="endkey"in opts?opts.endkey:!1,key="key"in opts?opts.key:!1,descending="descending"in opts?opts.descending:!1,limit="limit"in opts?opts.limit:-1,offset="skip"in opts?opts.skip:0,inclusiveEnd=opts.inclusive_end!==!1,sqlArgs=[],criteria=[];if(key!==!1)criteria.push(DOC_STORE+".id = ?"),sqlArgs.push(key);else if(start!==!1||end!==!1){if(start!==!1&&(criteria.push(DOC_STORE+".id "+(descending?"<=":">=")+" ?"),sqlArgs.push(start)),end!==!1){var comparator=descending?">":"<";inclusiveEnd&&(comparator+="="),criteria.push(DOC_STORE+".id "+comparator+" ?"),sqlArgs.push(end)}key!==!1&&(criteria.push(DOC_STORE+".id = ?"),sqlArgs.push(key))}"ok"!==opts.deleted&&criteria.push(BY_SEQ_STORE+".deleted = 0"),db.readTransaction(function(tx){countDocs(tx,function(count){if(totalRows=count,0!==limit){var sql=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,criteria,DOC_STORE+".id "+(descending?"DESC":"ASC"));sql+=" LIMIT "+limit+" OFFSET "+offset,tx.executeSql(sql,sqlArgs,function(tx,result){for(var i=0,l=result.rows.length;l>i;i++){var item=result.rows.item(i),metadata=utils.safeJsonParse(item.metadata),id=metadata.id,data=unstringifyDoc(item.data,id,item.rev),winningRev=data._rev,doc={id:id,key:id,value:{rev:winningRev}};if(opts.include_docs&&(doc.doc=data,doc.doc._rev=winningRev,opts.conflicts&&(doc.doc._conflicts=merge.collectConflicts(metadata)),fetchAttachmentsIfNecessary(doc.doc,opts,api,tx)),item.deleted){if("ok"!==opts.deleted)continue;doc.value.deleted=!0,doc.doc=null}results.push(doc)}})}})},unknownError(callback),function(){callback(null,{total_rows:totalRows,offset:opts.skip,rows:results})})},api._changes=function(opts){function fetchChanges(){var selectStmt=DOC_STORE+".json AS metadata, "+DOC_STORE+".max_seq AS maxSeq, "+BY_SEQ_STORE+".json AS winningDoc, "+BY_SEQ_STORE+".rev AS winningRev ",from=DOC_STORE+" JOIN "+BY_SEQ_STORE,joiner=DOC_STORE+".id="+BY_SEQ_STORE+".doc_id AND "+DOC_STORE+".winningseq="+BY_SEQ_STORE+".seq",criteria=["maxSeq > ?"],sqlArgs=[opts.since];opts.doc_ids&&(criteria.push(DOC_STORE+".id IN "+qMarks(opts.doc_ids.length)),sqlArgs=sqlArgs.concat(opts.doc_ids));var orderBy="maxSeq "+(descending?"DESC":"ASC"),sql=select(selectStmt,from,joiner,criteria,orderBy),filter=utils.filterChange(opts);opts.view||opts.filter||(sql+=" LIMIT "+limit);var lastSeq=opts.since||0;db.readTransaction(function(tx){tx.executeSql(sql,sqlArgs,function(tx,result){function reportChange(change){return function(){opts.onChange(change)}}for(var i=0,l=result.rows.length;l>i;i++){var item=result.rows.item(i),metadata=utils.safeJsonParse(item.metadata);
lastSeq=item.maxSeq;var doc=unstringifyDoc(item.winningDoc,metadata.id,item.winningRev),change=opts.processChange(doc,metadata,opts);if(change.seq=item.maxSeq,filter(change)&&(numResults++,returnDocs&&results.push(change),opts.attachments&&opts.include_docs?fetchAttachmentsIfNecessary(doc,opts,api,tx,reportChange(change)):reportChange(change)()),numResults===limit)break}})},unknownError(opts.complete),function(){opts.continuous||opts.complete(null,{results:results,last_seq:lastSeq})})}if(opts=utils.clone(opts),opts.continuous){var id=api._name+":"+utils.uuid();return WebSqlPouch.Changes.addListener(api._name,id,api,opts),WebSqlPouch.Changes.notify(api._name),{cancel:function(){WebSqlPouch.Changes.removeListener(api._name,id)}}}var descending=opts.descending;opts.since=opts.since&&!descending?opts.since:0;var limit="limit"in opts?opts.limit:-1;0===limit&&(limit=1);var returnDocs;returnDocs="returnDocs"in opts?opts.returnDocs:!0;var results=[],numResults=0;fetchChanges()},api._close=function(callback){callback()},api._getAttachment=function(attachment,opts,callback){var res,tx=opts.ctx,digest=attachment.digest,type=attachment.content_type,sql="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+ATTACH_STORE+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){var item=result.rows.item(0),data=item.escaped?websqlUtils.unescapeBlob(item.body):parseHexString(item.body,encoding);opts.encode?res=btoa(data):(data=utils.fixBinary(data),res=utils.createBlob([data],{type:type})),callback(null,res)})},api._getRevisionTree=function(docId,callback){db.readTransaction(function(tx){var sql="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";tx.executeSql(sql,[docId],function(tx,result){if(result.rows.length){var data=utils.safeJsonParse(result.rows.item(0).metadata);callback(null,data.rev_tree)}else callback(errors.error(errors.MISSING_DOC))})})},api._doCompaction=function(docId,revs,callback){return revs.length?void db.transaction(function(tx){var sql="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";tx.executeSql(sql,[docId],function(tx,result){var metadata=utils.safeJsonParse(result.rows.item(0).metadata);merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash;-1!==revs.indexOf(rev)&&(opts.status="missing")});var sql="UPDATE "+DOC_STORE+" SET json = ? WHERE id = ?";tx.executeSql(sql,[utils.safeJsonStringify(metadata),docId])}),compactRevs(revs,docId,tx)},unknownError(callback),function(){callback()}):callback()},api._getLocal=function(id,callback){db.readTransaction(function(tx){var sql="SELECT json, rev FROM "+LOCAL_STORE+" WHERE id=?";tx.executeSql(sql,[id],function(tx,res){if(res.rows.length){var item=res.rows.item(0),doc=unstringifyDoc(item.json,id,item.rev);callback(null,doc)}else callback(errors.error(errors.MISSING_DOC))})})},api._putLocal=function(doc,opts,callback){function putLocal(tx){var sql,values;oldRev?(sql="UPDATE "+LOCAL_STORE+" SET rev=?, json=? WHERE id=? AND rev=?",values=[newRev,json,id,oldRev]):(sql="INSERT INTO "+LOCAL_STORE+" (id, rev, json) VALUES (?,?,?)",values=[id,newRev,json]),tx.executeSql(sql,values,function(tx,res){res.rowsAffected?(ret={ok:!0,id:id,rev:newRev},opts.ctx&&callback(null,ret)):callback(errors.error(errors.REV_CONFLICT))},function(){return callback(errors.error(errors.REV_CONFLICT)),!1})}"function"==typeof opts&&(callback=opts,opts={}),delete doc._revisions;var newRev,oldRev=doc._rev,id=doc._id;newRev=doc._rev=oldRev?"0-"+(parseInt(oldRev.split("-")[1],10)+1):"0-1";var ret,json=stringifyDoc(doc);opts.ctx?putLocal(opts.ctx):db.transaction(function(tx){putLocal(tx)},unknownError(callback),function(){ret&&callback(null,ret)})},void(api._removeLocal=function(doc,callback){var ret;db.transaction(function(tx){var sql="DELETE FROM "+LOCAL_STORE+" WHERE id=? AND rev=?",params=[doc._id,doc._rev];tx.executeSql(sql,params,function(tx,res){return res.rowsAffected?void(ret={ok:!0,id:doc._id,rev:"0-0"}):callback(errors.error(errors.MISSING_DOC))})},unknownError(callback),function(){ret&&callback(null,ret)})})):callback(errors.error(errors.UNKNOWN_ERROR))}var utils=require("../../utils"),merge=require("../../merge"),errors=require("../../deps/errors"),parseHexString=require("../../deps/parse-hex"),websqlConstants=require("./websql-constants"),websqlUtils=require("./websql-utils"),websqlBulkDocs=require("./websql-bulk-docs"),ADAPTER_VERSION=websqlConstants.ADAPTER_VERSION,DOC_STORE=websqlConstants.DOC_STORE,BY_SEQ_STORE=websqlConstants.BY_SEQ_STORE,ATTACH_STORE=websqlConstants.ATTACH_STORE,LOCAL_STORE=websqlConstants.LOCAL_STORE,META_STORE=websqlConstants.META_STORE,ATTACH_AND_SEQ_STORE=websqlConstants.ATTACH_AND_SEQ_STORE,qMarks=websqlUtils.qMarks,stringifyDoc=websqlUtils.stringifyDoc,unstringifyDoc=websqlUtils.unstringifyDoc,select=websqlUtils.select,compactRevs=websqlUtils.compactRevs,unknownError=websqlUtils.unknownError,getSize=websqlUtils.getSize,cachedDatabases={},openDBFunction="undefined"!=typeof navigator&&navigator.sqlitePlugin&&navigator.sqlitePlugin.openDatabase?navigator.sqlitePlugin.openDatabase.bind(navigator.sqlitePlugin):"undefined"!=typeof sqlitePlugin&&sqlitePlugin.openDatabase?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?openDatabase:null,POUCH_VERSION=1,BY_SEQ_STORE_DELETED_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+BY_SEQ_STORE+" (seq, deleted)",BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+BY_SEQ_STORE+" (doc_id, rev)",DOC_STORE_WINNINGSEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+DOC_STORE+" (winningseq)",ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+ATTACH_AND_SEQ_STORE+" (seq)",ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+ATTACH_AND_SEQ_STORE+" (digest, seq)",DOC_STORE_AND_BY_SEQ_JOINER=BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq",SELECT_DOCS=BY_SEQ_STORE+".seq AS seq, "+BY_SEQ_STORE+".deleted AS deleted, "+BY_SEQ_STORE+".json AS data, "+BY_SEQ_STORE+".rev AS rev, "+DOC_STORE+".json AS metadata";WebSqlPouch.valid=function(){return!!openDBFunction},WebSqlPouch.destroy=utils.toPromise(function(name,opts,callback){WebSqlPouch.Changes.removeAllListeners(name);var size=getSize(opts),db=openDB(name,POUCH_VERSION,name,size);db.transaction(function(tx){var stores=[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE,LOCAL_STORE,ATTACH_AND_SEQ_STORE];stores.forEach(function(store){tx.executeSql("DROP TABLE IF EXISTS "+store,[])})},unknownError(callback),function(){utils.hasLocalStorage()&&(delete window.localStorage["_pouch__websqldb_"+name],delete window.localStorage[name]),callback(null,{ok:!0})})}),WebSqlPouch.Changes=new utils.Changes,module.exports=WebSqlPouch},{"../../deps/errors":31,"../../deps/parse-hex":34,"../../merge":42,"../../utils":47,"./websql-bulk-docs":21,"./websql-constants":22,"./websql-utils":23}],25:[function(require,module){"use strict";function Changes(db,opts,callback){function onDestroy(){self.cancel()}EE.call(this);var self=this;this.db=db,opts=opts?utils.clone(opts):{};var oldComplete=callback||opts.complete||function(){},complete=opts.complete=utils.once(function(err,resp){err?self.emit("error",err):self.emit("complete",resp),self.removeAllListeners(),db.removeListener("destroyed",onDestroy)});oldComplete&&(self.on("complete",function(resp){oldComplete(null,resp)}),self.on("error",function(err){oldComplete(err)}));var oldOnChange=opts.onChange;oldOnChange&&self.on("change",oldOnChange),db.once("destroyed",onDestroy),opts.onChange=function(change){opts.isCancelled||(self.emit("change",change),self.startSeq&&self.startSeq<=change.seq&&(self.emit("uptodate"),self.startSeq=!1),change.deleted?self.emit("delete",change):1===change.changes.length&&"1-"===change.changes[0].rev.slice(0,2)?self.emit("create",change):self.emit("update",change))};var promise=new utils.Promise(function(fulfill,reject){opts.complete=function(err,res){err?reject(err):fulfill(res)}});self.once("cancel",function(){oldOnChange&&self.removeListener("change",oldOnChange),opts.complete(null,{status:"cancelled"})}),this.then=promise.then.bind(promise),this["catch"]=promise["catch"].bind(promise),this.then(function(result){complete(null,result)},complete),db.taskqueue.isReady?self.doChanges(opts):db.taskqueue.addTask(function(){self.isCancelled?self.emit("cancel"):self.doChanges(opts)})}function processChange(doc,metadata,opts){var changeList=[{rev:doc._rev}];"all_docs"===opts.style&&(changeList=merge.collectLeaves(metadata.rev_tree).map(function(x){return{rev:x.rev}}));var change={id:metadata.id,changes:changeList,doc:doc};return utils.isDeleted(metadata,doc._rev)&&(change.deleted=!0),opts.conflicts&&(change.doc._conflicts=merge.collectConflicts(metadata),change.doc._conflicts.length||delete change.doc._conflicts),change}var utils=require("./utils"),merge=require("./merge"),errors=require("./deps/errors"),EE=require("events").EventEmitter,evalFilter=require("./evalFilter"),evalView=require("./evalView");module.exports=Changes,utils.inherits(Changes,EE),Changes.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Changes.prototype.doChanges=function(opts){var self=this,callback=opts.complete;if(opts=utils.clone(opts),"live"in opts&&!("continuous"in opts)&&(opts.continuous=opts.live),opts.processChange=processChange,"latest"===opts.since&&(opts.since="now"),opts.since||(opts.since=0),"now"===opts.since)return void this.db.info().then(function(info){return self.isCancelled?void callback(null,{status:"cancelled"}):(opts.since=info.update_seq,void self.doChanges(opts))},callback);if(opts.continuous&&"now"!==opts.since&&this.db.info().then(function(info){self.startSeq=info.update_seq},function(err){if("idbNull"!==err.id)throw err}),"http"!==this.db.type()&&opts.filter&&"string"==typeof opts.filter&&!opts.doc_ids)return this.filterChanges(opts);"descending"in opts||(opts.descending=!1),opts.limit=0===opts.limit?1:opts.limit,opts.complete=callback;var newPromise=this.db._changes(opts);if(newPromise&&"function"==typeof newPromise.cancel){var cancel=self.cancel;self.cancel=utils.getArguments(function(args){newPromise.cancel(),cancel.apply(this,args)})}},Changes.prototype.filterChanges=function(opts){var self=this,callback=opts.complete;if("_view"===opts.filter){if(!opts.view||"string"!=typeof opts.view){var err=errors.error(errors.BAD_REQUEST,"`view` filter parameter is not provided.");return void callback(err)}var viewName=opts.view.split("/");this.db.get("_design/"+viewName[0],function(err,ddoc){if(self.isCancelled)return void callback(null,{status:"cancelled"});if(err)return void callback(errors.generateErrorFromResponse(err));if(ddoc&&ddoc.views&&ddoc.views[viewName[1]]){var filter=evalView(ddoc.views[viewName[1]].map);return opts.filter=filter,void self.doChanges(opts)}var msg=ddoc.views?"missing json key: "+viewName[1]:"missing json key: views";err||(err=errors.error(errors.MISSING_DOC,msg)),callback(err)})}else{var filterName=opts.filter.split("/");this.db.get("_design/"+filterName[0],function(err,ddoc){if(self.isCancelled)return void callback(null,{status:"cancelled"});if(err)return void callback(errors.generateErrorFromResponse(err));if(ddoc&&ddoc.filters&&ddoc.filters[filterName[1]]){var filter=evalFilter(ddoc.filters[filterName[1]]);return opts.filter=filter,void self.doChanges(opts)}var msg=ddoc&&ddoc.filters?"missing json key: "+filterName[1]:"missing json key: filters";return err||(err=errors.error(errors.MISSING_DOC,msg)),void callback(err)})}}},{"./deps/errors":31,"./evalFilter":39,"./evalView":40,"./merge":42,"./utils":47,events:131}],26:[function(require,module){"use strict";function updateCheckpoint(db,id,checkpoint,returnValue){return db.get(id)["catch"](function(err){if(404===err.status)return"http"===db.type()&&utils.explain404("PouchDB is just checking if a remote checkpoint exists."),{_id:id};throw err}).then(function(doc){return returnValue.cancelled?void 0:(doc.last_seq=checkpoint,db.put(doc))})}function Checkpointer(src,target,id,returnValue){this.src=src,this.target=target,this.id=id,this.returnValue=returnValue}var utils=require("./utils"),pouchCollate=require("pouchdb-collate"),collate=pouchCollate.collate;Checkpointer.prototype.writeCheckpoint=function(checkpoint){var self=this;return this.updateTarget(checkpoint).then(function(){return self.updateSource(checkpoint)})},Checkpointer.prototype.updateTarget=function(checkpoint){return updateCheckpoint(this.target,this.id,checkpoint,this.returnValue)},Checkpointer.prototype.updateSource=function(checkpoint){var self=this;return this.readOnlySource?utils.Promise.resolve(!0):updateCheckpoint(this.src,this.id,checkpoint,this.returnValue)["catch"](function(err){var isForbidden="number"==typeof err.status&&4===Math.floor(err.status/100);if(isForbidden)return self.readOnlySource=!0,!0;throw err})},Checkpointer.prototype.getCheckpoint=function(){var self=this;return self.target.get(self.id).then(function(targetDoc){return self.src.get(self.id).then(function(sourceDoc){return 0===collate(targetDoc.last_seq,sourceDoc.last_seq)?sourceDoc.last_seq:0},function(err){if(404===err.status&&targetDoc.last_seq)return self.src.put({_id:self.id,last_seq:0}).then(function(){return 0},function(err){return 401===err.status?(self.readOnlySource=!0,targetDoc.last_seq):0});throw err})})["catch"](function(err){if(404!==err.status)throw err;return 0})},module.exports=Checkpointer},{"./utils":47,"pouchdb-collate":72}],27:[function(require,module){(function(process,global){"use strict";function defaultCallback(err){err&&global.debug&&console.error(err)}function PouchDB(name,opts,callback){if(!(this instanceof PouchDB))return new PouchDB(name,opts,callback);var self=this;("function"==typeof opts||"undefined"==typeof opts)&&(callback=opts,opts={}),name&&"object"==typeof name&&(opts=name,name=void 0),"undefined"==typeof callback&&(callback=defaultCallback),opts=opts||{},this.__opts=opts;var oldCB=callback;self.auto_compaction=opts.auto_compaction,self.prefix=PouchDB.prefix,Adapter.call(self),self.taskqueue=new TaskQueue;var promise=new Promise(function(fulfill,reject){callback=function(err,resp){return err?reject(err):(delete resp.then,void fulfill(resp))},opts=utils.clone(opts);var backend,error,originalName=opts.name||name;return function(){try{if("string"!=typeof originalName)throw error=new Error("Missing/invalid DB name"),error.code=400,error;if(backend=PouchDB.parseAdapter(originalName,opts),opts.originalName=originalName,opts.name=backend.name,opts.prefix&&"http"!==backend.adapter&&"https"!==backend.adapter&&(opts.name=opts.prefix+opts.name),opts.adapter=opts.adapter||backend.adapter,self._adapter=opts.adapter,self._db_name=originalName,!PouchDB.adapters[opts.adapter])throw error=new Error("Adapter is missing"),error.code=404,error;if(!PouchDB.adapters[opts.adapter].valid())throw error=new Error("Invalid Adapter"),error.code=404,error}catch(err){self.taskqueue.fail(err),self.changes=utils.toPromise(function(opts){opts.complete&&opts.complete(err)})}}(),error?reject(error):(self.adapter=opts.adapter,self.replicate={},self.replicate.from=function(url,opts,callback){return self.constructor.replicate(url,self,opts,callback)},self.replicate.to=function(url,opts,callback){return self.constructor.replicate(self,url,opts,callback)},self.sync=function(dbName,opts,callback){return self.constructor.sync(self,dbName,opts,callback)},self.replicate.sync=self.sync,self.destroy=utils.adapterFun("destroy",function(callback){var self=this,opts=this.__opts||{};self.info(function(err,info){return err?callback(err):(opts.internal=!0,void self.constructor.destroy(info.db_name,opts,callback))})}),PouchDB.adapters[opts.adapter].call(self,opts,function(err){function destructionListener(event){"destroyed"===event&&(self.emit("destroyed"),PouchDB.removeListener(originalName,destructionListener))}return err?void(callback&&(self.taskqueue.fail(err),callback(err))):(PouchDB.on(originalName,destructionListener),self.emit("created",self),PouchDB.emit("created",opts.originalName),self.taskqueue.ready(self),void callback(null,self))}),opts.skipSetup&&(self.taskqueue.ready(self),process.nextTick(function(){callback(null,self)})),void(utils.isCordova()&&cordova.fireWindowEvent(opts.name+"_pouch",{})))});promise.then(function(resp){oldCB(null,resp)},oldCB),self.then=promise.then.bind(promise),self["catch"]=promise["catch"].bind(promise)}var Adapter=require("./adapter"),utils=require("./utils"),TaskQueue=require("./taskqueue"),Promise=utils.Promise;utils.inherits(PouchDB,Adapter),PouchDB.debug=require("debug"),module.exports=PouchDB}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter":13,"./taskqueue":46,"./utils":47,_process:132,debug:50}],28:[function(require,module){(function(process){"use strict";function ajax(options,adapterCallback){function onSuccess(obj,resp,cb){if(options.binary||options.json||!options.processData||"string"==typeof obj){if(!options.binary&&options.json&&"string"==typeof obj)try{obj=JSON.parse(obj)}catch(e){return cb(e)}}else obj=JSON.stringify(obj);Array.isArray(obj)&&(obj=obj.map(function(v){return v.error||v.missing?errors.generateErrorFromResponse(v):v})),cb(null,obj,resp)}function onError(err,cb){var errParsed,errObj;if(err.code&&err.status){var err2=new Error(err.message||err.code);return err2.status=err.status,cb(err2)}try{errParsed=JSON.parse(err.responseText),errObj=errors.generateErrorFromResponse(errParsed)}catch(e){errObj=errors.generateErrorFromResponse(err)}cb(errObj)}function defaultBody(){return process.browser?"":new buffer("","binary")}var requestCompleted=!1,callback=utils.getArguments(function(args){requestCompleted||(adapterCallback.apply(this,args),requestCompleted=!0)});"function"==typeof options&&(callback=options,options={}),options=utils.clone(options);var defaultOptions={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return options=utils.extend(!0,defaultOptions,options),options.json&&(options.binary||(options.headers.Accept="application/json"),options.headers["Content-Type"]=options.headers["Content-Type"]||"application/json"),options.binary&&(options.encoding=null,options.json=!1),options.processData||(options.json=!1),request(options,function(err,response,body){if(err)return err.status=response?response.statusCode:400,onError(err,callback);var error,content_type=response.headers&&response.headers["content-type"],data=body||defaultBody();options.binary||!options.json&&options.processData||"object"==typeof data||!(/json/.test(content_type)||/^[\s]*\{/.test(data)&&/\}[\s]*$/.test(data))||(data=JSON.parse(data)),response.statusCode>=200&&response.statusCode<300?onSuccess(data,response,callback):(options.binary&&(data=JSON.parse(data.toString())),error=errors.generateErrorFromResponse(data),error.status=response.statusCode,callback(error))})}var request=require("request"),buffer=require("./buffer"),errors=require("./errors"),utils=require("../utils");module.exports=ajax}).call(this,require("_process"))},{"../utils":47,"./buffer":30,"./errors":31,_process:132,request:36}],29:[function(require,module){(function(global){"use strict";function createBlob(parts,properties){parts=parts||[],properties=properties||{};try{return new Blob(parts,properties)}catch(e){if("TypeError"!==e.name)throw e;for(var BlobBuilder=global.BlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder||global.WebKitBlobBuilder,builder=new BlobBuilder,i=0;i<parts.length;i+=1)builder.append(parts[i]);return builder.getBlob(properties.type)}}module.exports=createBlob}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],30:[function(require,module){module.exports={}},{}],31:[function(require,module,exports){"use strict";function PouchError(opts){Error.call(opts.reason),this.status=opts.status,this.name=opts.error,this.message=opts.reason,this.error=!0}var inherits=require("inherits");inherits(PouchError,Error),PouchError.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},exports.UNAUTHORIZED=new PouchError({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),exports.MISSING_BULK_DOCS=new PouchError({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),exports.MISSING_DOC=new PouchError({status:404,error:"not_found",reason:"missing"}),exports.REV_CONFLICT=new PouchError({status:409,error:"conflict",reason:"Document update conflict"}),exports.INVALID_ID=new PouchError({status:400,error:"invalid_id",reason:"_id field must contain a string"}),exports.MISSING_ID=new PouchError({status:412,error:"missing_id",reason:"_id is required for puts"}),exports.RESERVED_ID=new PouchError({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),exports.NOT_OPEN=new PouchError({status:412,error:"precondition_failed",reason:"Database not open"}),exports.UNKNOWN_ERROR=new PouchError({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),exports.BAD_ARG=new PouchError({status:500,error:"badarg",reason:"Some query argument is invalid"}),exports.INVALID_REQUEST=new PouchError({status:400,error:"invalid_request",reason:"Request was invalid"}),exports.QUERY_PARSE_ERROR=new PouchError({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),exports.DOC_VALIDATION=new PouchError({status:500,error:"doc_validation",reason:"Bad special document member"}),exports.BAD_REQUEST=new PouchError({status:400,error:"bad_request",reason:"Something wrong with the request"}),exports.NOT_AN_OBJECT=new PouchError({status:400,error:"bad_request",reason:"Document must be a JSON object"}),exports.DB_MISSING=new PouchError({status:404,error:"not_found",reason:"Database not found"}),exports.IDB_ERROR=new PouchError({status:500,error:"indexed_db_went_bad",reason:"unknown"}),exports.WSQ_ERROR=new PouchError({status:500,error:"web_sql_went_bad",reason:"unknown"}),exports.LDB_ERROR=new PouchError({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),exports.FORBIDDEN=new PouchError({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),exports.INVALID_REV=new PouchError({status:400,error:"bad_request",reason:"Invalid rev format"}),exports.FILE_EXISTS=new PouchError({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),exports.MISSING_STUB=new PouchError({status:412,error:"missing_stub"}),exports.error=function(error,reason,name){function CustomPouchError(reason){for(var p in error)"function"!=typeof error[p]&&(this[p]=error[p]);void 0!==name&&(this.name=name),void 0!==reason&&(this.reason=reason)}return CustomPouchError.prototype=PouchError.prototype,new CustomPouchError(reason)},exports.getErrorTypeByProp=function(prop,value,reason){var errors=exports,keys=Object.keys(errors).filter(function(key){var error=errors[key];return"function"!=typeof error&&error[prop]===value}),key=reason&&keys.filter(function(key){var error=errors[key];return error.message===reason})[0]||keys[0];return key?errors[key]:null},exports.generateErrorFromResponse=function(res){var error,errName,errType,errMsg,errReason,errors=exports;return errName=res.error===!0&&"string"==typeof res.name?res.name:res.error,errReason=res.reason,errType=errors.getErrorTypeByProp("name",errName,errReason),res.missing||"missing"===errReason||"deleted"===errReason||"not_found"===errName?errType=errors.MISSING_DOC:"doc_validation"===errName?(errType=errors.DOC_VALIDATION,errMsg=errReason):"bad_request"===errName&&errType.message!==errReason&&(0===errReason.indexOf("unknown stub attachment")?(errType=errors.MISSING_STUB,errMsg=errReason):errType=errors.BAD_REQUEST),errType||(errType=errors.getErrorTypeByProp("status",res.status,errReason)||errors.UNKNOWN_ERROR),error=errors.error(errType,errReason,errName),errMsg&&(error.message=errMsg),res.id&&(error.id=res.id),res.status&&(error.status=res.status),res.statusText&&(error.name=res.statusText),res.missing&&(error.missing=res.missing),error}},{inherits:53}],32:[function(require,module){(function(process,global){"use strict";function sliceShim(arrayBuffer,begin,end){if("function"==typeof arrayBuffer.slice)return begin||end?end?arrayBuffer.slice(begin,end):arrayBuffer.slice(begin):arrayBuffer.slice();begin=Math.floor(begin||0),end=Math.floor(end||0);var len=arrayBuffer.byteLength;if(begin=0>begin?Math.max(begin+len,0):Math.min(len,begin),end=0>end?Math.max(end+len,0):Math.min(len,end),0>=end-begin)return new ArrayBuffer(0);var result=new ArrayBuffer(end-begin),resultBytes=new Uint8Array(result),sourceBytes=new Uint8Array(arrayBuffer,begin,end-begin);return resultBytes.set(sourceBytes),result}function intToString(int){var bytes=[255&int,int>>>8&255,int>>>16&255,int>>>24&255];return bytes.map(function(byte){return String.fromCharCode(byte)}).join("")}function rawToBase64(raw){for(var res="",i=0;i<raw.length;i++)res+=intToString(raw[i]);return btoa(res)}var crypto=require("crypto"),Md5=require("spark-md5"),setImmediateShim=global.setImmediate||global.setTimeout,MD5_CHUNK_SIZE=32768;module.exports=function(data,callback){function append(buffer,data,start,end){inputIsString?buffer.appendBinary(data.substring(start,end)):buffer.append(sliceShim(data,start,end))}function loadNextChunk(){var start=currentChunk*chunkSize,end=start+chunkSize;if(currentChunk++,chunks>currentChunk)append(buffer,data,start,end),setImmediateShim(loadNextChunk);else{append(buffer,data,start,end);var raw=buffer.end(!0),base64=rawToBase64(raw);callback(null,base64),buffer.destroy()}}if(!process.browser){var base64=crypto.createHash("md5").update(data).digest("base64");return void callback(null,base64)}var inputIsString="string"==typeof data,len=inputIsString?data.length:data.byteLength,chunkSize=Math.min(MD5_CHUNK_SIZE,len),chunks=Math.ceil(len/chunkSize),currentChunk=0,buffer=inputIsString?new Md5:new Md5.ArrayBuffer;loadNextChunk()}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:132,crypto:126,"spark-md5":83}],33:[function(require,module,exports){"use strict";function toObject(array){return array.reduce(function(obj,item){return obj[item]=!0,obj},{})}function parseRevisionInfo(rev){if(!/^\d+\-./.test(rev))return errors.error(errors.INVALID_REV);var idx=rev.indexOf("-"),left=rev.substring(0,idx),right=rev.substring(idx+1);return{prefix:parseInt(left,10),id:right}}function makeRevTreeFromRevisions(revisions,opts){for(var pos=revisions.start-revisions.ids.length+1,revisionIds=revisions.ids,ids=[revisionIds[0],opts,[]],i=1,len=revisionIds.length;len>i;i++)ids=[revisionIds[i],{status:"missing"},[ids]];return[{pos:pos,ids:ids}]}var errors=require("./errors"),uuid=require("./uuid"),reservedWords=toObject(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),dataWords=toObject(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);exports.invalidIdError=function(id){var err;if(id?"string"!=typeof id?err=errors.error(errors.INVALID_ID):/^_/.test(id)&&!/^_(design|local)/.test(id)&&(err=errors.error(errors.RESERVED_ID)):err=errors.error(errors.MISSING_ID),err)throw err},exports.parseDoc=function(doc,newEdits){var nRevNum,newRevId,revInfo,opts={status:"available"};if(doc._deleted&&(opts.deleted=!0),newEdits)if(doc._id||(doc._id=uuid()),newRevId=uuid(32,16).toLowerCase(),doc._rev){if(revInfo=parseRevisionInfo(doc._rev),revInfo.error)return revInfo;doc._rev_tree=[{pos:revInfo.prefix,ids:[revInfo.id,{status:"missing"},[[newRevId,opts,[]]]]}],nRevNum=revInfo.prefix+1}else doc._rev_tree=[{pos:1,ids:[newRevId,opts,[]]}],nRevNum=1;else if(doc._revisions&&(doc._rev_tree=makeRevTreeFromRevisions(doc._revisions,opts),nRevNum=doc._revisions.start,newRevId=doc._revisions.ids[0]),!doc._rev_tree){if(revInfo=parseRevisionInfo(doc._rev),revInfo.error)return revInfo;nRevNum=revInfo.prefix,newRevId=revInfo.id,doc._rev_tree=[{pos:nRevNum,ids:[newRevId,opts,[]]}]}exports.invalidIdError(doc._id),doc._rev=nRevNum+"-"+newRevId;var result={metadata:{},data:{}};for(var key in doc)if(doc.hasOwnProperty(key)){var specialKey="_"===key[0];if(specialKey&&!reservedWords[key]){var error=errors.error(errors.DOC_VALIDATION,key);throw error.message=errors.DOC_VALIDATION.message+": "+key,error}specialKey&&!dataWords[key]?result.metadata[key.slice(1)]=doc[key]:result.data[key]=doc[key]}return result}},{"./errors":31,"./uuid":38}],34:[function(require,module){"use strict";function decodeUtf8(str){return decodeURIComponent(window.escape(str))}function hexToInt(charCode){return 65>charCode?charCode-48:charCode-55}function parseHexUtf8(str,start,end){for(var result="";end>start;)result+=String.fromCharCode(hexToInt(str.charCodeAt(start++))<<4|hexToInt(str.charCodeAt(start++)));return result}function parseHexUtf16(str,start,end){for(var result="";end>start;)result+=String.fromCharCode(hexToInt(str.charCodeAt(start+2))<<12|hexToInt(str.charCodeAt(start+3))<<8|hexToInt(str.charCodeAt(start))<<4|hexToInt(str.charCodeAt(start+1))),start+=4;return result}function parseHexString(str,encoding){return"UTF-8"===encoding?decodeUtf8(parseHexUtf8(str,0,str.length)):parseHexUtf16(str,0,str.length)}module.exports=parseHexString},{}],35:[function(require,module){"use strict";function parseUri(str){for(var o=options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;){var key=o.key[i],value=m[i]||"",encoded=-1!==["user","password"].indexOf(key);uri[key]=encoded?decodeURIComponent(value):value}return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}var options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};module.exports=parseUri},{}],36:[function(require,module){"use strict";var createBlob=require("./blob.js"),utils=require("../utils");module.exports=function(options,callback){var xhr,timer,hasUpload,abortReq=function(){xhr.abort()};if(xhr=options.xhr?new options.xhr:new XMLHttpRequest,"GET"===options.method&&!options.cache){var hasArgs=-1!==options.url.indexOf("?");options.url+=(hasArgs?"&":"?")+"_nonce="+Date.now()}xhr.open(options.method,options.url),xhr.withCredentials=!0,options.json&&(options.headers.Accept="application/json",options.headers["Content-Type"]=options.headers["Content-Type"]||"application/json",options.body&&options.processData&&"string"!=typeof options.body&&(options.body=JSON.stringify(options.body))),options.binary&&(xhr.responseType="arraybuffer"),"body"in options||(options.body=null);for(var key in options.headers)options.headers.hasOwnProperty(key)&&xhr.setRequestHeader(key,options.headers[key]);return options.timeout>0&&(timer=setTimeout(abortReq,options.timeout),xhr.onprogress=function(){clearTimeout(timer),timer=setTimeout(abortReq,options.timeout)},"undefined"==typeof hasUpload&&(hasUpload=-1!==Object.keys(xhr).indexOf("upload")),hasUpload&&(xhr.upload.onprogress=xhr.onprogress)),xhr.onreadystatechange=function(){if(4===xhr.readyState){var response={statusCode:xhr.status};
if(xhr.status>=200&&xhr.status<300){var data;data=options.binary?createBlob([xhr.response||""],{type:xhr.getResponseHeader("Content-Type")}):xhr.responseText,callback(null,response,data)}else{var err={};try{err=JSON.parse(xhr.response)}catch(e){}callback(err,response)}}},options.body&&options.body instanceof Blob?utils.readAsBinaryString(options.body,function(binary){xhr.send(utils.fixBinary(binary))}):xhr.send(options.body),{abort:abortReq}}},{"../utils":47,"./blob.js":29}],37:[function(require,module){"use strict";var upsert=require("pouchdb-upsert").upsert;module.exports=function(db,doc,diffFun,cb){return upsert.call(db,doc,diffFun,cb)}},{"pouchdb-upsert":82}],38:[function(require,module){"use strict";function getValue(radix){return 0|Math.random()*radix}function uuid(len,radix){radix=radix||chars.length;var out="",i=-1;if(len){for(;++i<len;)out+=chars[getValue(radix)];return out}for(;++i<36;)switch(i){case 8:case 13:case 18:case 23:out+="-";break;case 19:out+=chars[3&getValue(16)|8];break;default:out+=chars[getValue(16)]}return out}var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");module.exports=uuid},{}],39:[function(require,module,exports){"use strict";function evalFilter(input){return eval(["(function () { return ",input," })()"].join(""))}module.exports=evalFilter},{}],40:[function(require,module,exports){"use strict";function evalView(input){return eval(["(function () {","  return function (doc) {","    var emitted = false;","    var emit = function (a, b) {","      emitted = true;","    };","    var view = "+input+";","    view(doc);","    if (emitted) {","      return true;","    }","  }","})()"].join("\n"))}module.exports=evalView},{}],41:[function(require,module){(function(process){"use strict";var PouchDB=require("./setup");module.exports=PouchDB,PouchDB.ajax=require("./deps/ajax"),PouchDB.utils=require("./utils"),PouchDB.Errors=require("./deps/errors"),PouchDB.replicate=require("./replicate").replicate,PouchDB.sync=require("./sync"),PouchDB.version=require("./version");var httpAdapter=require("./adapters/http/http");if(PouchDB.adapter("http",httpAdapter),PouchDB.adapter("https",httpAdapter),PouchDB.adapter("idb",require("./adapters/idb/idb")),PouchDB.adapter("websql",require("./adapters/websql/websql")),PouchDB.plugin(require("pouchdb-mapreduce")),!process.browser){var ldbAdapter=require("./adapters/leveldb/leveldb");PouchDB.adapter("ldb",ldbAdapter),PouchDB.adapter("leveldb",ldbAdapter)}}).call(this,require("_process"))},{"./adapters/http/http":14,"./adapters/idb/idb":19,"./adapters/leveldb/leveldb":126,"./adapters/websql/websql":24,"./deps/ajax":28,"./deps/errors":31,"./replicate":43,"./setup":44,"./sync":45,"./utils":47,"./version":48,_process:132,"pouchdb-mapreduce":78}],42:[function(require,module){"use strict";function binarySearch(arr,item,comparator){for(var mid,low=0,high=arr.length;high>low;)mid=low+high>>>1,comparator(arr[mid],item)<0?low=mid+1:high=mid;return low}function insertSorted(arr,item,comparator){var idx=binarySearch(arr,item,comparator);arr.splice(idx,0,item)}function pathToTree(path){for(var nleaf,doc=path.shift(),root=[doc.id,doc.opts,[]],leaf=root;path.length;)doc=path.shift(),nleaf=[doc.id,doc.opts,[]],leaf[2].push(nleaf),leaf=nleaf;return root}function compareTree(a,b){return a[0]<b[0]?-1:1}function mergeTree(in_tree1,in_tree2){for(var queue=[{tree1:in_tree1,tree2:in_tree2}],conflicts=!1;queue.length>0;){var item=queue.pop(),tree1=item.tree1,tree2=item.tree2;(tree1[1].status||tree2[1].status)&&(tree1[1].status="available"===tree1[1].status||"available"===tree2[1].status?"available":"missing");for(var i=0;i<tree2[2].length;i++)if(tree1[2][0]){for(var merged=!1,j=0;j<tree1[2].length;j++)tree1[2][j][0]===tree2[2][i][0]&&(queue.push({tree1:tree1[2][j],tree2:tree2[2][i]}),merged=!0);merged||(conflicts="new_branch",insertSorted(tree1[2],tree2[2][i],compareTree))}else conflicts="new_leaf",tree1[2][0]=tree2[2][i]}return{conflicts:conflicts,tree:in_tree1}}function doMerge(tree,path,dontExpand){var res,restree=[],conflicts=!1,merged=!1;return tree.length?(tree.forEach(function(branch){if(branch.pos===path.pos&&branch.ids[0]===path.ids[0])res=mergeTree(branch.ids,path.ids),restree.push({pos:branch.pos,ids:res.tree}),conflicts=conflicts||res.conflicts,merged=!0;else if(dontExpand!==!0){var t1=branch.pos<path.pos?branch:path,t2=branch.pos<path.pos?path:branch,diff=t2.pos-t1.pos,candidateParents=[],trees=[];for(trees.push({ids:t1.ids,diff:diff,parent:null,parentIdx:null});trees.length>0;){var item=trees.pop();0!==item.diff?item.ids&&item.ids[2].forEach(function(el,idx){trees.push({ids:el,diff:item.diff-1,parent:item.ids,parentIdx:idx})}):item.ids[0]===t2.ids[0]&&candidateParents.push(item)}var el=candidateParents[0];el?(res=mergeTree(el.ids,t2.ids),el.parent[2][el.parentIdx]=res.tree,restree.push({pos:t1.pos,ids:t1.ids}),conflicts=conflicts||res.conflicts,merged=!0):restree.push(branch)}else restree.push(branch)}),merged||restree.push(path),restree.sort(function(a,b){return a.pos-b.pos}),{tree:restree,conflicts:conflicts||"internal_node"}):{tree:[path],conflicts:"new_leaf"}}function stem(tree,depth){var stemmedPaths=PouchMerge.rootToLeaf(tree).map(function(path){var stemmed=path.ids.slice(-depth);return{pos:path.pos+(path.ids.length-stemmed.length),ids:pathToTree(stemmed)}});return stemmedPaths.reduce(function(prev,current){return doMerge(prev,current,!0).tree},[stemmedPaths.shift()])}var extend=require("pouchdb-extend"),PouchMerge={};PouchMerge.merge=function(tree,path,depth){tree=extend(!0,[],tree),path=extend(!0,{},path);var newTree=doMerge(tree,path);return{tree:stem(newTree.tree,depth),conflicts:newTree.conflicts}},PouchMerge.winningRev=function(metadata){var leafs=[];return PouchMerge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,id,something,opts){isLeaf&&leafs.push({pos:pos,id:id,deleted:!!opts.deleted})}),leafs.sort(function(a,b){return a.deleted!==b.deleted?a.deleted>b.deleted?1:-1:a.pos!==b.pos?b.pos-a.pos:a.id<b.id?1:-1}),leafs[0].pos+"-"+leafs[0].id},PouchMerge.traverseRevTree=function(revs,callback){for(var node,toVisit=revs.slice();node=toVisit.pop();)for(var pos=node.pos,tree=node.ids,branches=tree[2],newCtx=callback(0===branches.length,pos,tree[0],node.ctx,tree[1]),i=0,len=branches.length;len>i;i++)toVisit.push({pos:pos+1,ids:branches[i],ctx:newCtx})},PouchMerge.collectLeaves=function(revs){var leaves=[];return PouchMerge.traverseRevTree(revs,function(isLeaf,pos,id,acc,opts){isLeaf&&leaves.push({rev:pos+"-"+id,pos:pos,opts:opts})}),leaves.sort(function(a,b){return b.pos-a.pos}),leaves.forEach(function(leaf){delete leaf.pos}),leaves},PouchMerge.collectConflicts=function(metadata){var win=PouchMerge.winningRev(metadata),leaves=PouchMerge.collectLeaves(metadata.rev_tree),conflicts=[];return leaves.forEach(function(leaf){leaf.rev===win||leaf.opts.deleted||conflicts.push(leaf.rev)}),conflicts},PouchMerge.rootToLeaf=function(tree){var paths=[];return PouchMerge.traverseRevTree(tree,function(isLeaf,pos,id,history,opts){if(history=history?history.slice(0):[],history.push({id:id,opts:opts}),isLeaf){var rootPos=pos+1-history.length;paths.unshift({pos:rootPos,ids:history})}return history}),paths},module.exports=PouchMerge},{"pouchdb-extend":75}],43:[function(require,module,exports){"use strict";function randomNumber(min,max){min=parseInt(min,10),max=parseInt(max,10),min!==min&&(min=0),max!==max||min>=max?max=(min||1)<<1:max+=1;var ratio=Math.random(),range=max-min;return~~(range*ratio+min)}function defaultBackOff(min){var max=0;return min||(max=2e3),randomNumber(min,max)}function backOff(repId,src,target,opts,returnValue,result,error){return opts.retry===!1?(returnValue.emit("error",error),void returnValue.removeAllListeners()):(opts.default_back_off=opts.default_back_off||0,opts.retries=opts.retries||0,"function"!=typeof opts.back_off_function&&(opts.back_off_function=defaultBackOff),opts.retries++,opts.max_retries&&opts.retries>opts.max_retries?(returnValue.emit("error",new Error("tried "+opts.retries+" times but replication failed")),void returnValue.removeAllListeners()):(returnValue.emit("requestError",error),"active"===returnValue.state&&(returnValue.emit("paused",error),returnValue.state="stopped",returnValue.once("active",function(){opts.current_back_off=opts.default_back_off})),opts.current_back_off=opts.current_back_off||opts.default_back_off,opts.current_back_off=opts.back_off_function(opts.current_back_off),void setTimeout(function(){replicate(repId,src,target,opts,returnValue)},opts.current_back_off)))}function Replication(){EE.call(this),this.cancelled=!1,this.state="pending";var self=this,promise=new utils.Promise(function(fulfill,reject){self.once("complete",fulfill),self.once("error",reject)});self.then=function(resolve,reject){return promise.then(resolve,reject)},self["catch"]=function(reject){return promise["catch"](reject)},self["catch"](function(){})}function genReplicationId(src,target,opts){var filterFun=opts.filter?opts.filter.toString():"";return src.id().then(function(src_id){return target.id().then(function(target_id){var queryData=src_id+target_id+filterFun+JSON.stringify(opts.query_params)+opts.doc_ids;return utils.MD5(queryData).then(function(md5){return md5=md5.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+md5})})})}function replicate(repId,src,target,opts,returnValue,result){function writeDocs(){if(0!==currentBatch.docs.length){var docs=currentBatch.docs;return target.bulkDocs({docs:docs,new_edits:!1}).then(function(res){if(state.cancelled)throw completeReplication(),new Error("cancelled");var errors=[],errorsById={};res.forEach(function(res){res.error&&(result.doc_write_failures++,errors.push(res),errorsById[res.id]=res)}),result.errors=errors,allErrors=allErrors.concat(errors),result.docs_written+=currentBatch.docs.length-errors.length;var non403s=errors.filter(function(error){return"unauthorized"!==error.name&&"forbidden"!==error.name});if(changedDocs=[],docs.forEach(function(doc){var error=errorsById[doc._id];error?returnValue.emit("denied",utils.clone(error)):changedDocs.push(doc)}),non403s.length>0){var error=new Error("bulkDocs error");throw error.other_errors=errors,abortReplication("target.bulkDocs failed to write docs",error),new Error("bulkWrite partial failure")}},function(err){throw result.doc_write_failures+=docs.length,err})}}function processDiffDoc(id){for(var diffs=currentBatch.diffs,allMissing=diffs[id].missing,missingBatches=[],i=0;i<allMissing.length;i+=MAX_SIMULTANEOUS_REVS)missingBatches.push(allMissing.slice(i,Math.min(allMissing.length,i+MAX_SIMULTANEOUS_REVS)));return utils.Promise.all(missingBatches.map(function(missing){var opts={revs:!0,open_revs:missing,attachments:!0};return src.get(id,opts).then(function(docs){docs.forEach(function(doc){return state.cancelled?completeReplication():void(doc.ok&&(result.docs_read++,currentBatch.pendingRevs++,currentBatch.docs.push(doc.ok)))}),delete diffs[id]})}))}function getAllDocs(){var diffKeys=Object.keys(currentBatch.diffs);return utils.Promise.all(diffKeys.map(processDiffDoc))}function getRevisionOneDocs(){var ids=Object.keys(currentBatch.diffs).filter(function(id){var missing=currentBatch.diffs[id].missing;return 1===missing.length&&"1-"===missing[0].slice(0,2)});return ids.length?src.allDocs({keys:ids,include_docs:!0}).then(function(res){if(state.cancelled)throw completeReplication(),new Error("cancelled");res.rows.forEach(function(row){!row.doc||row.deleted||"1-"!==row.value.rev.slice(0,2)||row.doc._attachments&&0!==Object.keys(row.doc._attachments).length||(result.docs_read++,currentBatch.pendingRevs++,currentBatch.docs.push(row.doc),delete currentBatch.diffs[row.id])})}):utils.Promise.resolve()}function getDocs(){return getRevisionOneDocs().then(getAllDocs)}function finishBatch(){return writingCheckpoint=!0,checkpointer.writeCheckpoint(currentBatch.seq).then(function(){if(writingCheckpoint=!1,state.cancelled)throw completeReplication(),new Error("cancelled");result.last_seq=last_seq=currentBatch.seq;var outResult=utils.clone(result);outResult.docs=changedDocs,returnValue.emit("change",outResult),currentBatch=void 0,getChanges()})["catch"](function(err){throw writingCheckpoint=!1,abortReplication("writeCheckpoint completed with error",err),err})}function getDiffs(){var diff={};return currentBatch.changes.forEach(function(change){diff[change.id]=change.changes.map(function(x){return x.rev})}),target.revsDiff(diff).then(function(diffs){if(state.cancelled)throw completeReplication(),new Error("cancelled");currentBatch.diffs=diffs,currentBatch.pendingRevs=0})}function startNextBatch(){if(!state.cancelled&&!currentBatch){if(0===batches.length)return void processPendingBatch(!0);currentBatch=batches.shift(),getDiffs().then(getDocs).then(writeDocs).then(finishBatch).then(startNextBatch)["catch"](function(err){abortReplication("batch processing terminated with error",err)})}}function processPendingBatch(immediate){return 0===pendingBatch.changes.length?void(0!==batches.length||currentBatch||((continuous&&changesOpts.live||changesCompleted)&&(returnValue.emit("paused"),returnValue.emit("uptodate",result)),changesCompleted&&completeReplication())):void((immediate||changesCompleted||pendingBatch.changes.length>=batch_size)&&(batches.push(pendingBatch),pendingBatch={seq:0,changes:[],docs:[]},startNextBatch()))}function abortReplication(reason,err){replicationCompleted||(err.message||(err.message=reason),result.ok=!1,result.status="aborting",result.errors.push(err),allErrors=allErrors.concat(err),batches=[],pendingBatch={seq:0,changes:[],docs:[]},completeReplication())}function completeReplication(){if(!(replicationCompleted||state.cancelled&&(result.status="cancelled",writingCheckpoint))){result.status=result.status||"complete",result.end_time=new Date,result.last_seq=last_seq,replicationCompleted=state.cancelled=!0;var non403s=allErrors.filter(function(error){return"unauthorized"!==error.name&&"forbidden"!==error.name});if(non403s.length>0){var error=allErrors.pop();allErrors.length>0&&(error.other_errors=allErrors),error.result=result,backOff(repId,src,target,opts,returnValue,result,error)}else result.errors=allErrors,returnValue.emit("complete",result),returnValue.removeAllListeners()}}function onChange(change){if(state.cancelled)return completeReplication();var filter=utils.filterChange(opts)(change);filter&&(0!==pendingBatch.changes.length||0!==batches.length||currentBatch||returnValue.emit("outofdate",result),pendingBatch.seq=change.seq,pendingBatch.changes.push(change),processPendingBatch(0===batches.length))}function onChangesComplete(changes){return changesPending=!1,state.cancelled?completeReplication():(changes.results.length>0?(changesOpts.since=changes.last_seq,getChanges()):continuous?(changesOpts.live=!0,getChanges()):changesCompleted=!0,void processPendingBatch(!0))}function onChangesError(err){return changesPending=!1,state.cancelled?completeReplication():void abortReplication("changes rejected",err)}function getChanges(){function abortChanges(){changes.cancel()}function removeListener(){returnValue.removeListener("cancel",abortChanges)}if(!changesPending&&!changesCompleted&&batches.length<batches_limit){changesPending=!0,returnValue.once("cancel",abortChanges);var changes=src.changes(changesOpts).on("change",onChange);changes.then(removeListener,removeListener),changes.then(onChangesComplete)["catch"](onChangesError)}}function startChanges(){checkpointer.getCheckpoint().then(function(checkpoint){last_seq=checkpoint,changesOpts={since:last_seq,limit:batch_size,batch_size:batch_size,style:"all_docs",doc_ids:doc_ids,returnDocs:!0},opts.filter&&(changesOpts.include_docs=!0),opts.query_params&&(changesOpts.query_params=opts.query_params),getChanges()})["catch"](function(err){abortReplication("getCheckpoint rejected with ",err)})}var currentBatch,batches=[],pendingBatch={seq:0,changes:[],docs:[]},writingCheckpoint=!1,changesCompleted=!1,replicationCompleted=!1,last_seq=0,continuous=opts.continuous||opts.live||!1,batch_size=opts.batch_size||100,batches_limit=opts.batches_limit||10,changesPending=!1,doc_ids=opts.doc_ids,state={cancelled:!1},checkpointer=new Checkpointer(src,target,repId,state),allErrors=[],changedDocs=[];result=result||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var changesOpts={};returnValue.ready(src,target),returnValue.once("cancel",completeReplication),"function"==typeof opts.onChange&&returnValue.on("change",opts.onChange),"function"==typeof opts.complete&&(returnValue.once("error",opts.complete),returnValue.once("complete",function(result){opts.complete(null,result)})),"undefined"==typeof opts.since?startChanges():(writingCheckpoint=!0,checkpointer.writeCheckpoint(opts.since).then(function(){return writingCheckpoint=!1,state.cancelled?void completeReplication():(last_seq=opts.since,void startChanges())})["catch"](function(err){throw writingCheckpoint=!1,abortReplication("writeCheckpoint completed with error",err),err}))}function toPouch(db,opts){var PouchConstructor=opts.PouchConstructor;return"string"==typeof db?new PouchConstructor(db):db.then?db:utils.Promise.resolve(db)}function replicateWrapper(src,target,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),"undefined"==typeof opts&&(opts={}),opts.complete||(opts.complete=callback||function(){}),opts=utils.clone(opts),opts.continuous=opts.continuous||opts.live,opts.retry="retry"in opts?opts.retry:RETRY_DEFAULT,opts.PouchConstructor=opts.PouchConstructor||this;var replicateRet=new Replication(opts);return toPouch(src,opts).then(function(src){return toPouch(target,opts).then(function(target){return genReplicationId(src,target,opts).then(function(repId){replicate(repId,src,target,opts,replicateRet)})})})["catch"](function(err){replicateRet.emit("error",err),opts.complete(err)}),replicateRet}var utils=require("./utils"),EE=require("events").EventEmitter,Checkpointer=require("./checkpointer"),MAX_SIMULTANEOUS_REVS=50,RETRY_DEFAULT=!1;utils.inherits(Replication,EE),Replication.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Replication.prototype.ready=function(src,target){function onDestroy(){self.cancel()}function cleanup(){src.removeListener("destroyed",onDestroy),target.removeListener("destroyed",onDestroy)}var self=this;this.once("change",function(){("pending"===this.state||"stopped"===this.state)&&(self.state="active",self.emit("active"))}),src.once("destroyed",onDestroy),target.once("destroyed",onDestroy),this.then(cleanup,cleanup)},exports.toPouch=toPouch,exports.replicate=replicateWrapper},{"./checkpointer":26,"./utils":47,events:131}],44:[function(require,module){"use strict";var PouchDB=require("./constructor"),utils=require("./utils"),Promise=utils.Promise,EventEmitter=require("events").EventEmitter;PouchDB.adapters={},PouchDB.preferredAdapters=require("./adapters/preferredAdapters.js"),PouchDB.prefix="_pouch_";var eventEmitter=new EventEmitter,eventEmitterMethods=["on","addListener","emit","listeners","once","removeAllListeners","removeListener","setMaxListeners"];eventEmitterMethods.forEach(function(method){PouchDB[method]=eventEmitter[method].bind(eventEmitter)}),PouchDB.setMaxListeners(0),PouchDB.parseAdapter=function(name,opts){var adapter,adapterName,match=name.match(/([a-z\-]*):\/\/(.*)/);if(match){if(name=/http(s?)/.test(match[1])?match[1]+"://"+match[2]:match[2],adapter=match[1],!PouchDB.adapters[adapter].valid())throw"Invalid adapter";return{name:name,adapter:match[1]}}var skipIdb="idb"in PouchDB.adapters&&"websql"in PouchDB.adapters&&utils.hasLocalStorage()&&localStorage["_pouch__websqldb_"+PouchDB.prefix+name];if("undefined"!=typeof opts&&opts.db)adapterName="leveldb";else for(var i=0;i<PouchDB.preferredAdapters.length;++i)if(adapterName=PouchDB.preferredAdapters[i],adapterName in PouchDB.adapters){if(skipIdb&&"idb"===adapterName)continue;break}if(adapter=PouchDB.adapters[adapterName],adapterName&&adapter){var use_prefix="use_prefix"in adapter?adapter.use_prefix:!0;return{name:use_prefix?PouchDB.prefix+name:name,adapter:adapterName}}throw"No valid adapter found"},PouchDB.destroy=utils.toPromise(function(name,opts,callback){function destroyDb(){adapter.destroy(fullName,opts,function(err,resp){err?callback(err):(PouchDB.emit("destroyed",name),PouchDB.emit(name,"destroyed"),callback(null,resp||{ok:!0}))})}("function"==typeof opts||"undefined"==typeof opts)&&(callback=opts,opts={}),name&&"object"==typeof name&&(opts=name,name=void 0),opts.internal||console.log("PouchDB.destroy() is deprecated and will be removed. Please use db.destroy() instead.");var backend=PouchDB.parseAdapter(opts.name||name,opts),dbName=backend.name,adapter=PouchDB.adapters[backend.adapter],usePrefix="use_prefix"in adapter?adapter.use_prefix:!0,baseName=usePrefix?dbName.replace(new RegExp("^"+PouchDB.prefix),""):dbName,fullName=("http"===backend.adapter||"https"===backend.adapter?"":opts.prefix||"")+dbName,createOpts=utils.extend(!0,{},opts,{adapter:backend.adapter});new PouchDB(baseName,createOpts,function(err,db){return err?callback(err):void db.get("_local/_pouch_dependentDbs",function(err,localDoc){if(err)return 404!==err.status?callback(err):destroyDb();var dependentDbs=localDoc.dependentDbs,deletedMap=Object.keys(dependentDbs).map(function(name){var trueName=usePrefix?name.replace(new RegExp("^"+PouchDB.prefix),""):name,subOpts=utils.extend(!0,opts,db.__opts||{});return db.constructor.destroy(trueName,subOpts)});Promise.all(deletedMap).then(destroyDb,function(error){callback(error)})})})}),PouchDB.adapter=function(id,obj){obj.valid()&&(PouchDB.adapters[id]=obj)},PouchDB.plugin=function(obj){Object.keys(obj).forEach(function(id){PouchDB.prototype[id]=obj[id]})},PouchDB.defaults=function(defaultOpts){function PouchAlt(name,opts,callback){("function"==typeof opts||"undefined"==typeof opts)&&(callback=opts,opts={}),name&&"object"==typeof name&&(opts=name,name=void 0),opts=utils.extend(!0,{},defaultOpts,opts),PouchDB.call(this,name,opts,callback)}return utils.inherits(PouchAlt,PouchDB),PouchAlt.destroy=utils.toPromise(function(name,opts,callback){return("function"==typeof opts||"undefined"==typeof opts)&&(callback=opts,opts={}),name&&"object"==typeof name&&(opts=name,name=void 0),opts=utils.extend(!0,{},defaultOpts,opts),PouchDB.destroy(name,opts,callback)}),eventEmitterMethods.forEach(function(method){PouchAlt[method]=eventEmitter[method].bind(eventEmitter)}),PouchAlt.setMaxListeners(0),PouchAlt.preferredAdapters=PouchDB.preferredAdapters.slice(),Object.keys(PouchDB).forEach(function(key){key in PouchAlt||(PouchAlt[key]=PouchDB[key])}),PouchAlt},module.exports=PouchDB},{"./adapters/preferredAdapters.js":20,"./constructor":27,"./utils":47,events:131}],45:[function(require,module){"use strict";function sync(src,target,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),"undefined"==typeof opts&&(opts={}),opts=utils.clone(opts),opts.PouchConstructor=opts.PouchConstructor||this,src=replication.toPouch(src,opts),target=replication.toPouch(target,opts),new Sync(src,target,opts,callback)}function Sync(src,target,opts,callback){function onCancel(data){emittedCancel||(emittedCancel=!0,self.emit("cancel",data))}function pullChange(change){self.emit("change",{direction:"pull",change:change})}function pushChange(change){self.emit("change",{direction:"push",change:change})}function pushDenied(doc){self.emit("denied",{direction:"push",doc:doc})}function pullDenied(doc){self.emit("denied",{direction:"pull",doc:doc})}function removeAll(type){return function(event,func){var isChange="change"===event&&(func===pullChange||func===pushChange),isCancel="cancel"===event&&func===onCancel,isOtherEvent=event in listeners&&func===listeners[event];(isChange||isCancel||isOtherEvent)&&(event in removed||(removed[event]={}),removed[event][type]=!0,2===Object.keys(removed[event]).length&&self.removeAllListeners(event))}}var self=this;this.canceled=!1;var onChange,complete;"onChange"in opts&&(onChange=opts.onChange,delete opts.onChange),"function"!=typeof callback||opts.complete?"complete"in opts&&(complete=opts.complete,delete opts.complete):complete=callback,this.push=replicate(src,target,opts),this.pull=replicate(target,src,opts);var emittedCancel=!1,listeners={},removed={};opts.live&&(this.push.on("complete",self.pull.cancel.bind(self.pull)),this.pull.on("complete",self.push.cancel.bind(self.push))),this.on("newListener",function(event){"change"===event?(self.pull.on("change",pullChange),self.push.on("change",pushChange)):"denied"===event?(self.pull.on("denied",pullDenied),self.push.on("denied",pushDenied)):"cancel"===event?(self.pull.on("cancel",onCancel),self.push.on("cancel",onCancel)):"error"===event||"removeListener"===event||"complete"===event||event in listeners||(listeners[event]=function(e){self.emit(event,e)},self.pull.on(event,listeners[event]),self.push.on(event,listeners[event]))}),this.on("removeListener",function(event){"change"===event?(self.pull.removeListener("change",pullChange),self.push.removeListener("change",pushChange)):"cancel"===event?(self.pull.removeListener("cancel",onCancel),self.push.removeListener("cancel",onCancel)):event in listeners&&"function"==typeof listeners[event]&&(self.pull.removeListener(event,listeners[event]),self.push.removeListener(event,listeners[event]),delete listeners[event])}),this.pull.on("removeListener",removeAll("pull")),this.push.on("removeListener",removeAll("push"));var promise=utils.Promise.all([this.push,this.pull]).then(function(resp){var out={push:resp[0],pull:resp[1]};return self.emit("complete",out),complete&&complete(null,out),self.removeAllListeners(),out},function(err){throw self.cancel(),self.emit("error",err),complete&&complete(err),self.removeAllListeners(),err});this.then=function(success,err){return promise.then(success,err)},this["catch"]=function(err){return promise["catch"](err)}}var utils=require("./utils"),replication=require("./replicate"),replicate=replication.replicate,EE=require("events").EventEmitter;utils.inherits(Sync,EE),module.exports=sync,Sync.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}},{"./replicate":43,"./utils":47,events:131}],46:[function(require,module){"use strict";function TaskQueue(){this.isReady=!1,this.failed=!1,this.queue=[]}module.exports=TaskQueue,TaskQueue.prototype.execute=function(){var d,func;if(this.failed)for(;d=this.queue.shift();)"function"!=typeof d?(func=d.parameters[d.parameters.length-1],"function"==typeof func?func(this.failed):"changes"===d.name&&"function"==typeof func.complete&&func.complete(this.failed)):d(this.failed);else if(this.isReady)for(;d=this.queue.shift();)"function"==typeof d?d():d.task=this.db[d.name].apply(this.db,d.parameters)},TaskQueue.prototype.fail=function(err){this.failed=err,this.execute()},TaskQueue.prototype.ready=function(db){return this.failed?!1:0===arguments.length?this.isReady:(this.isReady=db?!0:!1,this.db=db,void this.execute())},TaskQueue.prototype.addTask=function(name,parameters){if("function"!=typeof name){var task={name:name,parameters:parameters};return this.queue.push(task),this.failed&&this.execute(),task}this.queue.push(name),this.failed&&this.execute()}},{}],47:[function(require,module,exports){(function(process,global){function isChromeApp(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function Changes(){if(!(this instanceof Changes))return new Changes;var self=this;EventEmitter.call(this),this.isChrome=isChromeApp(),this.listeners={},this.hasLocal=!1,this.isChrome||(this.hasLocal=exports.hasLocalStorage()),this.isChrome?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&self.emit(e.dbName.newValue)}):this.hasLocal&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){self.emit(e.key)}):window.attachEvent("storage",function(e){self.emit(e.key)}))}var merge=require("./merge");exports.extend=require("pouchdb-extend"),exports.ajax=require("./deps/ajax"),exports.createBlob=require("./deps/blob"),exports.uuid=require("./deps/uuid"),exports.getArguments=require("argsarray");var buffer=require("./deps/buffer"),errors=require("./deps/errors"),EventEmitter=require("events").EventEmitter,collections=require("pouchdb-collections");exports.Map=collections.Map,exports.Set=collections.Set;var parseDoc=require("./deps/parse-doc");exports.Promise="function"==typeof global.Promise?global.Promise:require("bluebird");var Promise=exports.Promise;exports.lastIndexOf=function(str,char){for(var i=str.length-1;i>=0;i--)if(str.charAt(i)===char)return i;return-1},exports.clone=function(obj){return exports.extend(!0,{},obj)},exports.pick=function(obj,arr){for(var res={},i=0,len=arr.length;len>i;i++){var prop=arr[i];res[prop]=obj[prop]}return res},exports.inherits=require("inherits"),exports.call=exports.getArguments(function(args){if(args.length){var fun=args.shift();"function"==typeof fun&&fun.apply(this,args)}}),exports.isLocalId=function(id){return/^_local/.test(id)},exports.isDeleted=function(metadata,rev){rev||(rev=merge.winningRev(metadata));var dashIndex=rev.indexOf("-");-1!==dashIndex&&(rev=rev.substring(dashIndex+1));var deleted=!1;return merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,id,acc,opts){id===rev&&(deleted=!!opts.deleted)}),deleted},exports.revExists=function(metadata,rev){var found=!1;return merge.traverseRevTree(metadata.rev_tree,function(leaf,pos,id){pos+"-"+id===rev&&(found=!0)}),found},exports.filterChange=function(opts){var req={},hasFilter=opts.filter&&"function"==typeof opts.filter;return req.query=opts.query_params,function(change){if(opts.filter&&hasFilter&&!opts.filter.call(this,change.doc,req))return!1;if(opts.include_docs){if(!opts.attachments)for(var att in change.doc._attachments)change.doc._attachments.hasOwnProperty(att)&&(change.doc._attachments[att].stub=!0)}else delete change.doc;return!0}},exports.parseDoc=parseDoc.parseDoc,exports.invalidIdError=parseDoc.invalidIdError,exports.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},exports.hasLocalStorage=function(){if(isChromeApp())return!1;try{return localStorage}catch(e){return!1}},exports.Changes=Changes,exports.inherits(Changes,EventEmitter),Changes.prototype.addListener=function(dbName,id,db,opts){function eventFunction(){if(self.listeners[id]){if(inprogress)return void(inprogress="waiting");inprogress=!0,db.changes({include_docs:opts.include_docs,attachments:opts.attachments,conflicts:opts.conflicts,continuous:!1,descending:!1,filter:opts.filter,doc_ids:opts.doc_ids,view:opts.view,since:opts.since,query_params:opts.query_params}).on("change",function(c){c.seq>opts.since&&!opts.cancelled&&(opts.since=c.seq,exports.call(opts.onChange,c))}).on("complete",function(){"waiting"===inprogress&&process.nextTick(function(){self.notify(dbName)}),inprogress=!1}).on("error",function(){inprogress=!1})}}if(!this.listeners[id]){var self=this,inprogress=!1;this.listeners[id]=eventFunction,this.on(dbName,eventFunction)}},Changes.prototype.removeListener=function(dbName,id){id in this.listeners&&EventEmitter.prototype.removeListener.call(this,dbName,this.listeners[id])},Changes.prototype.notifyLocalWindows=function(dbName){this.isChrome?chrome.storage.local.set({dbName:dbName}):this.hasLocal&&(localStorage[dbName]="a"===localStorage[dbName]?"b":"a")},Changes.prototype.notify=function(dbName){this.emit(dbName),this.notifyLocalWindows(dbName)},exports.atob="undefined"==typeof window||"function"!=typeof window.atob?function(str){var base64=new buffer(str,"base64");if(base64.toString("base64")!==str)throw"Cannot base64 encode full string";return base64.toString("binary")}:function(str){return atob(str)},exports.btoa="undefined"==typeof window||"function"!=typeof window.btoa?function(str){return new buffer(str,"binary").toString("base64")}:function(str){return btoa(str)},exports.fixBinary=function(bin){if(!process.browser)return bin;
for(var length=bin.length,buf=new ArrayBuffer(length),arr=new Uint8Array(buf),i=0;length>i;i++)arr[i]=bin.charCodeAt(i);return buf},exports.readAsBinaryString=function(blob,callback){var reader=new FileReader,hasBinaryString="function"==typeof reader.readAsBinaryString;reader.onloadend=function(e){var result=e.target.result||"";return hasBinaryString?callback(result):void callback(exports.arrayBufferToBinaryString(result))},hasBinaryString?reader.readAsBinaryString(blob):reader.readAsArrayBuffer(blob)},exports.readAsArrayBuffer=function(blob,callback){var reader=new FileReader;reader.onloadend=function(e){var result=e.target.result||new ArrayBuffer(0);callback(result)},reader.readAsArrayBuffer(blob)},exports.once=function(fun){var called=!1;return exports.getArguments(function(args){if(called)throw new Error("once called  more than once");called=!0,fun.apply(this,args)})},exports.toPromise=function(func){return exports.getArguments(function(args){var usedCB,self=this,tempCB="function"==typeof args[args.length-1]?args.pop():!1;tempCB&&(usedCB=function(err,resp){process.nextTick(function(){tempCB(err,resp)})});var promise=new Promise(function(fulfill,reject){var resp;try{var callback=exports.once(function(err,mesg){err?reject(err):fulfill(mesg)});args.push(callback),resp=func.apply(self,args),resp&&"function"==typeof resp.then&&fulfill(resp)}catch(e){reject(e)}});return usedCB&&promise.then(function(result){usedCB(null,result)},usedCB),promise.cancel=function(){return this},promise})},exports.adapterFun=function(name,callback){function logApiCall(self,name,args){if(log.enabled){for(var logArgs=[self._db_name,name],i=0;i<args.length-1;i++)logArgs.push(args[i]);log.apply(null,logArgs);var origCallback=args[args.length-1];args[args.length-1]=function(err,res){var responseArgs=[self._db_name,name];responseArgs=responseArgs.concat(err?["error",err]:["success",res]),log.apply(null,responseArgs),origCallback(err,res)}}}var log=require("debug")("pouchdb:api");return exports.toPromise(exports.getArguments(function(args){if(this._closed)return Promise.reject(new Error("database is closed"));var self=this;return logApiCall(self,name,args),this.taskqueue.isReady?callback.apply(this,args):new exports.Promise(function(fulfill,reject){self.taskqueue.addTask(function(failed){failed?reject(failed):fulfill(self[name].apply(self,args))})})}))},exports.arrayBufferToBinaryString=function(buffer){for(var binary="",bytes=new Uint8Array(buffer),length=bytes.byteLength,i=0;length>i;i++)binary+=String.fromCharCode(bytes[i]);return binary},exports.cancellableFun=function(fun,self,opts){opts=opts?exports.clone(!0,{},opts):{};var emitter=new EventEmitter,oldComplete=opts.complete||function(){},complete=opts.complete=exports.once(function(err,resp){err?oldComplete(err):(emitter.emit("end",resp),oldComplete(null,resp)),emitter.removeAllListeners()}),oldOnChange=opts.onChange||function(){},lastChange=0;self.on("destroyed",function(){emitter.removeAllListeners()}),opts.onChange=function(change){oldOnChange(change),change.seq<=lastChange||(lastChange=change.seq,emitter.emit("change",change),change.deleted?emitter.emit("delete",change):1===change.changes.length&&"1-"===change.changes[0].rev.slice(0,1)?emitter.emit("create",change):emitter.emit("update",change))};var promise=new Promise(function(fulfill,reject){opts.complete=function(err,res){err?reject(err):fulfill(res)}});return promise.then(function(result){complete(null,result)},complete),promise.cancel=function(){promise.isCancelled=!0,self.taskqueue.isReady&&opts.complete(null,{status:"cancelled"})},self.taskqueue.isReady?fun(self,opts,promise):self.taskqueue.addTask(function(){promise.isCancelled?opts.complete(null,{status:"cancelled"}):fun(self,opts,promise)}),promise.on=emitter.on.bind(emitter),promise.once=emitter.once.bind(emitter),promise.addListener=emitter.addListener.bind(emitter),promise.removeListener=emitter.removeListener.bind(emitter),promise.removeAllListeners=emitter.removeAllListeners.bind(emitter),promise.setMaxListeners=emitter.setMaxListeners.bind(emitter),promise.listeners=emitter.listeners.bind(emitter),promise.emit=emitter.emit.bind(emitter),promise},exports.MD5=exports.toPromise(require("./deps/md5")),exports.explain404=function(str){process.browser&&"console"in global&&"info"in console&&console.info("The above 404 is totally normal. "+str)},exports.info=function(str){"undefined"!=typeof console&&"info"in console&&console.info(str)},exports.parseUri=require("./deps/parse-uri"),exports.compare=function(left,right){return right>left?-1:left>right?1:0},exports.updateDoc=function(prev,docInfo,results,i,cb,writeDoc,newEdits){if(exports.revExists(prev,docInfo.metadata.rev))return results[i]=docInfo,cb();var previouslyDeleted=exports.isDeleted(prev),deleted=exports.isDeleted(docInfo.metadata),isRoot=/^1-/.test(docInfo.metadata.rev);if(previouslyDeleted&&!deleted&&newEdits&&isRoot){var newDoc=docInfo.data;newDoc._rev=merge.winningRev(prev),newDoc._id=docInfo.metadata.id,docInfo=exports.parseDoc(newDoc,newEdits)}var merged=merge.merge(prev.rev_tree,docInfo.metadata.rev_tree[0],1e3),inConflict=newEdits&&(previouslyDeleted&&deleted||!previouslyDeleted&&"new_leaf"!==merged.conflicts||previouslyDeleted&&!deleted&&"new_branch"===merged.conflicts);if(inConflict){var err=errors.error(errors.REV_CONFLICT);return results[i]=err,cb()}var newRev=docInfo.metadata.rev;docInfo.metadata.rev_tree=merged.tree,prev.rev_map&&(docInfo.metadata.rev_map=prev.rev_map);var winningRev=merge.winningRev(docInfo.metadata);deleted=exports.isDeleted(docInfo.metadata,winningRev);var delta=0;(newEdits||winningRev===newRev)&&(delta=previouslyDeleted===deleted?0:deleted>previouslyDeleted?-1:1),writeDoc(docInfo,winningRev,deleted,cb,!0,delta,i)},exports.processDocs=function(docInfos,api,fetchedDocs,tx,results,writeDoc,opts,overallCallback){function insertDoc(docInfo,resultsIdx,callback){var winningRev=merge.winningRev(docInfo.metadata),deleted=exports.isDeleted(docInfo.metadata,winningRev);if("was_delete"in opts&&deleted)return results[resultsIdx]=errors.error(errors.MISSING_DOC,"deleted"),callback();var delta=deleted?0:1;writeDoc(docInfo,winningRev,deleted,callback,!1,delta,resultsIdx)}function checkAllDocsDone(){++docsDone===docsToDo&&overallCallback&&overallCallback()}if(docInfos.length){var newEdits=opts.new_edits,idsToDocs=new exports.Map,docsDone=0,docsToDo=docInfos.length;docInfos.forEach(function(currentDoc,resultsIdx){if(currentDoc._id&&exports.isLocalId(currentDoc._id))return void api[currentDoc._deleted?"_removeLocal":"_putLocal"](currentDoc,{ctx:tx},function(err){results[resultsIdx]=err?err:{ok:!0},checkAllDocsDone()});var id=currentDoc.metadata.id;idsToDocs.has(id)?(docsToDo--,idsToDocs.get(id).push([currentDoc,resultsIdx])):idsToDocs.set(id,[[currentDoc,resultsIdx]])}),idsToDocs.forEach(function(docs,id){function docWritten(){++numDone<docs.length?nextDoc():checkAllDocsDone()}function nextDoc(){var value=docs[numDone],currentDoc=value[0],resultsIdx=value[1];fetchedDocs.has(id)?exports.updateDoc(fetchedDocs.get(id),currentDoc,results,resultsIdx,docWritten,writeDoc,newEdits):insertDoc(currentDoc,resultsIdx,docWritten)}var numDone=0;nextDoc()})}},exports.preprocessAttachments=function(docInfos,blobType,callback){function parseBase64(data){try{return exports.atob(data)}catch(e){var err=errors.error(errors.BAD_ARG,"Attachments need to be base64 encoded");return{error:err}}}function preprocessAttachment(att,callback){if(att.stub)return callback();if("string"==typeof att.data){var asBinary=parseBase64(att.data);if(asBinary.error)return callback(asBinary.error);att.length=asBinary.length,att.data="blob"===blobType?exports.createBlob([exports.fixBinary(asBinary)],{type:att.content_type}):"base64"===blobType?exports.btoa(asBinary):asBinary,exports.MD5(asBinary).then(function(result){att.digest="md5-"+result,callback()})}else exports.readAsArrayBuffer(att.data,function(buff){"binary"===blobType?att.data=exports.arrayBufferToBinaryString(buff):"base64"===blobType&&(att.data=exports.btoa(exports.arrayBufferToBinaryString(buff))),exports.MD5(buff).then(function(result){att.digest="md5-"+result,att.length=buff.byteLength,callback()})})}function done(){docv++,docInfos.length===docv&&(overallErr?callback(overallErr):callback())}if(!docInfos.length)return callback();var overallErr,docv=0;docInfos.forEach(function(docInfo){function processedAttachment(err){overallErr=err,recv++,recv===attachments.length&&done()}var attachments=docInfo.data&&docInfo.data._attachments?Object.keys(docInfo.data._attachments):[],recv=0;if(!attachments.length)return done();for(var key in docInfo.data._attachments)docInfo.data._attachments.hasOwnProperty(key)&&preprocessAttachment(docInfo.data._attachments[key],processedAttachment)})},exports.compactTree=function(metadata){var revs=[];return merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){"available"!==opts.status||isLeaf||(revs.push(pos+"-"+revHash),opts.status="missing")}),revs};var vuvuzela=require("vuvuzela");exports.safeJsonParse=function(str){try{return JSON.parse(str)}catch(e){return vuvuzela.parse(str)}},exports.safeJsonStringify=function(json){try{return JSON.stringify(json)}catch(e){return vuvuzela.stringify(json)}}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./deps/ajax":28,"./deps/blob":29,"./deps/buffer":30,"./deps/errors":31,"./deps/md5":32,"./deps/parse-doc":33,"./deps/parse-uri":35,"./deps/uuid":38,"./merge":42,_process:132,argsarray:49,bluebird:57,debug:50,events:131,inherits:53,"pouchdb-collections":74,"pouchdb-extend":75,vuvuzela:84}],48:[function(require,module){module.exports="3.3.0"},{}],49:[function(require,module){"use strict";function argsArray(fun){return function(){var len=arguments.length;if(len){for(var args=[],i=-1;++i<len;)args[i]=arguments[i];return fun.call(this,args)}return fun.call(this,[])}}module.exports=argsArray},{}],50:[function(require,module,exports){function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function formatArgs(){var args=arguments,useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0,lastC=0;return args[0].replace(/%[a-z%]/g,function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c),args}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{null==namespaces?storage.removeItem("debug"):storage.debug=namespaces}catch(e){}}function load(){var r;try{r=storage.debug}catch(e){}return r}exports=module.exports=require("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors;var storage;storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:window.localStorage,exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){return JSON.stringify(v)},exports.enable(load())},{"./debug":51}],51:[function(require,module,exports){function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}function enabled(){var self=enabled,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,null==self.useColors&&(self.useColors=exports.useColors()),null==self.color&&self.useColors&&(self.color=selectColor());var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&(args=["%o"].concat(args));var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),"function"==typeof exports.formatArgs&&(args=exports.formatArgs.apply(self,args));var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}disabled.enabled=!1,enabled.enabled=!0;var fn=exports.enabled(namespace)?enabled:disabled;return fn.namespace=namespace,fn}function enable(namespaces){exports.save(namespaces);for(var split=(namespaces||"").split(/[\s,]+/),len=split.length,i=0;len>i;i++)split[i]&&(namespaces=split[i].replace(/\*/g,".*?"),"-"===namespaces[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;len>i;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;len>i;i++)if(exports.names[i].test(name))return!0;return!1}function coerce(val){return val instanceof Error?val.stack||val.message:val}exports=module.exports=debug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevTime,prevColor=0},{ms:52}],52:[function(require,module){function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]),type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}}function short(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){return n>ms?void 0:1.5*n>ms?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(val,options){return options=options||{},"string"==typeof val?parse(val):options["long"]?long(val):short(val)}},{}],53:[function(require,module){module.exports="function"==typeof Object.create?function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],54:[function(require,module){"use strict";function INTERNAL(){}module.exports=INTERNAL},{}],55:[function(require,module){"use strict";function all(iterable){function allResolver(value,i){function resolveFromAll(outValue){values[i]=outValue,++resolved===len&!called&&(called=!0,handlers.resolve(promise,values))}resolve(value).then(resolveFromAll,function(error){called||(called=!0,handlers.reject(promise,error))})}if("[object Array]"!==Object.prototype.toString.call(iterable))return reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return resolve([]);for(var values=new Array(len),resolved=0,i=-1,promise=new Promise(INTERNAL);++i<len;)allResolver(iterable[i],i);return promise}var Promise=require("./promise"),reject=require("./reject"),resolve=require("./resolve"),INTERNAL=require("./INTERNAL"),handlers=require("./handlers");module.exports=all},{"./INTERNAL":54,"./handlers":56,"./promise":58,"./reject":61,"./resolve":62}],56:[function(require,module,exports){"use strict";function getThen(obj){var then=obj&&obj.then;return obj&&"object"==typeof obj&&"function"==typeof then?function(){then.apply(obj,arguments)}:void 0}var tryCatch=require("./tryCatch"),resolveThenable=require("./resolveThenable"),states=require("./states");exports.resolve=function(self,value){var result=tryCatch(getThen,value);if("error"===result.status)return exports.reject(self,result.value);var thenable=result.value;if(thenable)resolveThenable.safely(self,thenable);else{self.state=states.FULFILLED,self.outcome=value;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callFulfilled(value)}return self},exports.reject=function(self,error){self.state=states.REJECTED,self.outcome=error;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callRejected(error);return self}},{"./resolveThenable":63,"./states":64,"./tryCatch":65}],57:[function(require,module,exports){module.exports=exports=require("./promise"),exports.resolve=require("./resolve"),exports.reject=require("./reject"),exports.all=require("./all"),exports.race=require("./race")},{"./all":55,"./promise":58,"./race":60,"./reject":61,"./resolve":62}],58:[function(require,module){"use strict";function Promise(resolver){if(!(this instanceof Promise))return new Promise(resolver);if("function"!=typeof resolver)throw new TypeError("resolver must be a function");this.state=states.PENDING,this.queue=[],this.outcome=void 0,resolver!==INTERNAL&&resolveThenable.safely(this,resolver)}var unwrap=require("./unwrap"),INTERNAL=require("./INTERNAL"),resolveThenable=require("./resolveThenable"),states=require("./states"),QueueItem=require("./queueItem");module.exports=Promise,Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){if("function"!=typeof onFulfilled&&this.state===states.FULFILLED||"function"!=typeof onRejected&&this.state===states.REJECTED)return this;var promise=new Promise(INTERNAL);if(this.state!==states.PENDING){var resolver=this.state===states.FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome)}else this.queue.push(new QueueItem(promise,onFulfilled,onRejected));return promise}},{"./INTERNAL":54,"./queueItem":59,"./resolveThenable":63,"./states":64,"./unwrap":66}],59:[function(require,module){"use strict";function QueueItem(promise,onFulfilled,onRejected){this.promise=promise,"function"==typeof onFulfilled&&(this.onFulfilled=onFulfilled,this.callFulfilled=this.otherCallFulfilled),"function"==typeof onRejected&&(this.onRejected=onRejected,this.callRejected=this.otherCallRejected)}var handlers=require("./handlers"),unwrap=require("./unwrap");module.exports=QueueItem,QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)},QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)},QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)},QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)}},{"./handlers":56,"./unwrap":66}],60:[function(require,module){"use strict";function race(iterable){function resolver(value){resolve(value).then(function(response){called||(called=!0,handlers.resolve(promise,response))},function(error){called||(called=!0,handlers.reject(promise,error))})}if("[object Array]"!==Object.prototype.toString.call(iterable))return reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return resolve([]);for(var i=-1,promise=new Promise(INTERNAL);++i<len;)resolver(iterable[i]);return promise}var Promise=require("./promise"),reject=require("./reject"),resolve=require("./resolve"),INTERNAL=require("./INTERNAL"),handlers=require("./handlers");module.exports=race},{"./INTERNAL":54,"./handlers":56,"./promise":58,"./reject":61,"./resolve":62}],61:[function(require,module){"use strict";function reject(reason){var promise=new Promise(INTERNAL);return handlers.reject(promise,reason)}var Promise=require("./promise"),INTERNAL=require("./INTERNAL"),handlers=require("./handlers");module.exports=reject},{"./INTERNAL":54,"./handlers":56,"./promise":58}],62:[function(require,module){"use strict";function resolve(value){if(value)return value instanceof Promise?value:handlers.resolve(new Promise(INTERNAL),value);var valueType=typeof value;switch(valueType){case"boolean":return FALSE;case"undefined":return UNDEFINED;case"object":return NULL;case"number":return ZERO;case"string":return EMPTYSTRING}}var Promise=require("./promise"),INTERNAL=require("./INTERNAL"),handlers=require("./handlers");module.exports=resolve;var FALSE=handlers.resolve(new Promise(INTERNAL),!1),NULL=handlers.resolve(new Promise(INTERNAL),null),UNDEFINED=handlers.resolve(new Promise(INTERNAL),void 0),ZERO=handlers.resolve(new Promise(INTERNAL),0),EMPTYSTRING=handlers.resolve(new Promise(INTERNAL),"")},{"./INTERNAL":54,"./handlers":56,"./promise":58}],63:[function(require,module,exports){"use strict";function safelyResolveThenable(self,thenable){function onError(value){called||(called=!0,handlers.reject(self,value))}function onSuccess(value){called||(called=!0,handlers.resolve(self,value))}function tryToUnwrap(){thenable(onSuccess,onError)}var called=!1,result=tryCatch(tryToUnwrap);"error"===result.status&&onError(result.value)}var handlers=require("./handlers"),tryCatch=require("./tryCatch");exports.safely=safelyResolveThenable},{"./handlers":56,"./tryCatch":65}],64:[function(require,module,exports){exports.REJECTED=["REJECTED"],exports.FULFILLED=["FULFILLED"],exports.PENDING=["PENDING"]},{}],65:[function(require,module){"use strict";function tryCatch(func,value){var out={};try{out.value=func(value),out.status="success"}catch(e){out.status="error",out.value=e}return out}module.exports=tryCatch},{}],66:[function(require,module){"use strict";function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}returnValue===promise?handlers.reject(promise,new TypeError("Cannot resolve promise with itself")):handlers.resolve(promise,returnValue)})}var immediate=require("immediate"),handlers=require("./handlers");module.exports=unwrap},{"./handlers":56,immediate:67}],67:[function(require,module){"use strict";function nextTick(){draining=!0;for(var i,oldQueue,len=queue.length;len;){for(oldQueue=queue,queue=[],i=-1;++i<len;)oldQueue[i]();len=queue.length}draining=!1}function immediate(task){1!==queue.push(task)||draining||scheduleDrain()}for(var draining,scheduleDrain,types=[require("./nextTick"),require("./mutation.js"),require("./messageChannel"),require("./stateChange"),require("./timeout")],queue=[],i=-1,len=types.length;++i<len;)if(types[i]&&types[i].test&&types[i].test()){scheduleDrain=types[i].install(nextTick);break}module.exports=immediate},{"./messageChannel":68,"./mutation.js":69,"./nextTick":126,"./stateChange":70,"./timeout":71}],68:[function(require,module,exports){(function(global){"use strict";exports.test=function(){return global.setImmediate?!1:"undefined"!=typeof global.MessageChannel},exports.install=function(func){var channel=new global.MessageChannel;return channel.port1.onmessage=func,function(){channel.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],69:[function(require,module,exports){(function(global){"use strict";var Mutation=global.MutationObserver||global.WebKitMutationObserver;exports.test=function(){return Mutation},exports.install=function(handle){var called=0,observer=new Mutation(handle),element=global.document.createTextNode("");return observer.observe(element,{characterData:!0}),function(){element.data=called=++called%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],70:[function(require,module,exports){(function(global){"use strict";exports.test=function(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")},exports.install=function(handle){return function(){var scriptEl=global.document.createElement("script");return scriptEl.onreadystatechange=function(){handle(),scriptEl.onreadystatechange=null,scriptEl.parentNode.removeChild(scriptEl),scriptEl=null},global.document.documentElement.appendChild(scriptEl),handle}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],71:[function(require,module,exports){"use strict";exports.test=function(){return!0},exports.install=function(t){return function(){setTimeout(t,0)}}},{}],72:[function(require,module,exports){"use strict";function indexify(key){if(null!==key)switch(typeof key){case"boolean":return key?1:0;case"number":return numToIndexableString(key);case"string":return key.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var isArray=Array.isArray(key),arr=isArray?key:Object.keys(key),i=-1,len=arr.length,result="";if(isArray)for(;++i<len;)result+=exports.toIndexableString(arr[i]);else for(;++i<len;){var objKey=arr[i];result+=exports.toIndexableString(objKey)+exports.toIndexableString(key[objKey])}return result}return""}function parseNumber(str,i){var num,originalIdx=i,zero="1"===str[i];if(zero)num=0,i++;else{var neg="0"===str[i];i++;var numAsString="",magAsString=str.substring(i,i+MAGNITUDE_DIGITS),magnitude=parseInt(magAsString,10)+MIN_MAGNITUDE;for(neg&&(magnitude=-magnitude),i+=MAGNITUDE_DIGITS;;){var ch=str[i];if("\x00"===ch)break;numAsString+=ch,i++}numAsString=numAsString.split("."),num=1===numAsString.length?parseInt(numAsString,10):parseFloat(numAsString[0]+"."+numAsString[1]),neg&&(num-=10),0!==magnitude&&(num=parseFloat(num+"e"+magnitude))}return{num:num,length:i-originalIdx}}function pop(stack,metaStack){var obj=stack.pop();if(metaStack.length){var lastMetaElement=metaStack[metaStack.length-1];obj===lastMetaElement.element&&(metaStack.pop(),lastMetaElement=metaStack[metaStack.length-1]);var element=lastMetaElement.element,lastElementIndex=lastMetaElement.index;if(Array.isArray(element))element.push(obj);else if(lastElementIndex===stack.length-2){var key=stack.pop();element[key]=obj}else stack.push(obj)}}function arrayCollate(a,b){for(var len=Math.min(a.length,b.length),i=0;len>i;i++){var sort=exports.collate(a[i],b[i]);if(0!==sort)return sort}return a.length===b.length?0:a.length>b.length?1:-1}function stringCollate(a,b){return a===b?0:a>b?1:-1}function objectCollate(a,b){for(var ak=Object.keys(a),bk=Object.keys(b),len=Math.min(ak.length,bk.length),i=0;len>i;i++){var sort=exports.collate(ak[i],bk[i]);if(0!==sort)return sort;if(sort=exports.collate(a[ak[i]],b[bk[i]]),0!==sort)return sort}return ak.length===bk.length?0:ak.length>bk.length?1:-1}function collationIndex(x){var id=["boolean","number","string","object"],idx=id.indexOf(typeof x);return~idx?null===x?1:Array.isArray(x)?5:3>idx?idx+2:idx+3:Array.isArray(x)?5:void 0}function numToIndexableString(num){if(0===num)return"1";var expFormat=num.toExponential().split(/e\+?/),magnitude=parseInt(expFormat[1],10),neg=0>num,result=neg?"0":"2",magForComparison=(neg?-magnitude:magnitude)-MIN_MAGNITUDE,magString=utils.padLeft(magForComparison.toString(),"0",MAGNITUDE_DIGITS);result+=SEP+magString;var factor=Math.abs(parseFloat(expFormat[0]));neg&&(factor=10-factor);var factorStr=factor.toFixed(20);return factorStr=factorStr.replace(/\.?0+$/,""),result+=SEP+factorStr}var MIN_MAGNITUDE=-324,MAGNITUDE_DIGITS=3,SEP="",utils=require("./utils");exports.collate=function(a,b){if(a===b)return 0;a=exports.normalizeKey(a),b=exports.normalizeKey(b);var ai=collationIndex(a),bi=collationIndex(b);if(ai-bi!==0)return ai-bi;if(null===a)return 0;switch(typeof a){case"number":return a-b;case"boolean":return a===b?0:b>a?-1:1;case"string":return stringCollate(a,b)}return Array.isArray(a)?arrayCollate(a,b):objectCollate(a,b)},exports.normalizeKey=function(key){switch(typeof key){case"undefined":return null;case"number":return 1/0===key||key===-1/0||isNaN(key)?null:key;case"object":var origKey=key;if(Array.isArray(key)){var len=key.length;key=new Array(len);for(var i=0;len>i;i++)key[i]=exports.normalizeKey(origKey[i])}else{if(key instanceof Date)return key.toJSON();if(null!==key){key={};for(var k in origKey)if(origKey.hasOwnProperty(k)){var val=origKey[k];"undefined"!=typeof val&&(key[k]=exports.normalizeKey(val))}}}}return key},exports.toIndexableString=function(key){var zero="\x00";return key=exports.normalizeKey(key),collationIndex(key)+SEP+indexify(key)+zero},exports.parseIndexableString=function(str){for(var stack=[],metaStack=[],i=0;;){var collationIndex=str[i++];if("\x00"!==collationIndex)switch(collationIndex){case"1":stack.push(null);break;case"2":stack.push("1"===str[i]),i++;break;case"3":var parsedNum=parseNumber(str,i);stack.push(parsedNum.num),i+=parsedNum.length;break;case"4":for(var parsedStr="";;){var ch=str[i];if("\x00"===ch)break;parsedStr+=ch,i++}parsedStr=parsedStr.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),stack.push(parsedStr);break;case"5":var arrayElement={element:[],index:stack.length};stack.push(arrayElement.element),metaStack.push(arrayElement);break;case"6":var objElement={element:{},index:stack.length};stack.push(objElement.element),metaStack.push(objElement);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+collationIndex)}else{if(1===stack.length)return stack.pop();pop(stack,metaStack)}}}},{"./utils":73}],73:[function(require,module,exports){"use strict";function pad(str,padWith,upToLength){for(var padding="",targetLength=upToLength-str.length;padding.length<targetLength;)padding+=padWith;return padding}exports.padLeft=function(str,padWith,upToLength){var padding=pad(str,padWith,upToLength);return padding+str},exports.padRight=function(str,padWith,upToLength){var padding=pad(str,padWith,upToLength);return str+padding},exports.stringLexCompare=function(a,b){var i,aLen=a.length,bLen=b.length;for(i=0;aLen>i;i++){if(i===bLen)return 1;var aChar=a.charAt(i),bChar=b.charAt(i);if(aChar!==bChar)return bChar>aChar?-1:1}return bLen>aLen?-1:0},exports.intToDecimalForm=function(int){var isNeg=0>int,result="";do{var remainder=isNeg?-Math.ceil(int%10):Math.floor(int%10);result=remainder+result,int=isNeg?Math.ceil(int/10):Math.floor(int/10)}while(int);return isNeg&&"0"!==result&&(result="-"+result),result}},{}],74:[function(require,module,exports){"use strict";function LazyMap(){this.store={}}function LazySet(array){if(this.store=new LazyMap,array&&Array.isArray(array))for(var i=0,len=array.length;len>i;i++)this.add(array[i])}exports.Map=LazyMap,exports.Set=LazySet,LazyMap.prototype.mangle=function(key){if("string"!=typeof key)throw new TypeError("key must be a string but Got "+key);return"$"+key},LazyMap.prototype.unmangle=function(key){return key.substring(1)},LazyMap.prototype.get=function(key){var mangled=this.mangle(key);return mangled in this.store?this.store[mangled]:void 0},LazyMap.prototype.set=function(key,value){var mangled=this.mangle(key);return this.store[mangled]=value,!0},LazyMap.prototype.has=function(key){var mangled=this.mangle(key);return mangled in this.store},LazyMap.prototype["delete"]=function(key){var mangled=this.mangle(key);return mangled in this.store?(delete this.store[mangled],!0):!1},LazyMap.prototype.forEach=function(cb){var self=this,keys=Object.keys(self.store);keys.forEach(function(key){var value=self.store[key];key=self.unmangle(key),cb(value,key)})},LazySet.prototype.add=function(key){return this.store.set(key,!0)},LazySet.prototype.has=function(key){return this.store.has(key)},LazySet.prototype["delete"]=function(key){return this.store["delete"](key)}},{}],75:[function(require,module){"use strict";function type(obj){return null===obj?String(obj):"object"==typeof obj||"function"==typeof obj?class2type[core_toString.call(obj)]||"object":typeof obj}function isWindow(obj){return null!==obj&&obj===obj.window}function isPlainObject(obj){if(!obj||"object"!==type(obj)||obj.nodeType||isWindow(obj))return!1;
try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var key;for(key in obj);return void 0===key||core_hasOwn.call(obj,key)}function isFunction(obj){return"function"===type(obj)}function extend(){for(var stack=[],i=-1,len=arguments.length,args=new Array(len);++i<len;)args[i]=arguments[i];var container={};stack.push({args:args,result:{container:container,key:"key"}});for(var next;next=stack.pop();)extendInner(stack,next.args,next.result);return container.key}function extendInner(stack,args,result){var options,name,src,copy,copyIsArray,clone,optionsIsArray,target=args[0]||{},i=1,length=args.length,deep=!1,numericStringRegex=/\d+/;for("boolean"==typeof target&&(deep=target,target=args[1]||{},i=2),"object"==typeof target||isFunction(target)||(target={}),length===i&&(target=this,--i);length>i;i++)if(null!=(options=args[i])){optionsIsArray=isArray(options);for(name in options)if(!(name in Object.prototype)){if(optionsIsArray&&!numericStringRegex.test(name))continue;if(src=target[name],copy=options[name],target===copy)continue;deep&&copy&&(isPlainObject(copy)||(copyIsArray=isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&isArray(src)?src:[]):clone=src&&isPlainObject(src)?src:{},stack.push({args:[deep,clone,copy],result:{container:target,key:name}})):void 0!==copy&&(isArray(options)&&isFunction(copy)||(target[name]=copy))}}result.container[result.key]=target}for(var class2type={},types=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],i=0;i<types.length;i++){var typename=types[i];class2type["[object "+typename+"]"]=typename.toLowerCase()}var core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,isArray=Array.isArray||function(obj){return"array"===type(obj)};module.exports=extend},{}],76:[function(require,module){"use strict";var upsert=require("./upsert"),utils=require("./utils"),Promise=utils.Promise;module.exports=function(opts){var sourceDB=opts.db,viewName=opts.viewName,mapFun=opts.map,reduceFun=opts.reduce,temporary=opts.temporary,viewSignature=mapFun.toString()+(reduceFun&&reduceFun.toString())+"undefined";if(!temporary&&sourceDB._cachedViews){var cachedView=sourceDB._cachedViews[viewSignature];if(cachedView)return Promise.resolve(cachedView)}return sourceDB.info().then(function(info){function diffFunction(doc){doc.views=doc.views||{};var fullViewName=viewName;-1===fullViewName.indexOf("/")&&(fullViewName=viewName+"/"+viewName);var depDbs=doc.views[fullViewName]=doc.views[fullViewName]||{};if(!depDbs[depDbName])return depDbs[depDbName]=!0,doc}var depDbName=info.db_name+"-mrview-"+(temporary?"temp":utils.MD5(viewSignature));return upsert(sourceDB,"_local/mrviews",diffFunction).then(function(){return sourceDB.registerDependentDatabase(depDbName).then(function(res){var db=res.db;db.auto_compaction=!0;var view={name:depDbName,db:db,sourceDB:sourceDB,adapter:sourceDB.adapter,mapFun:mapFun,reduceFun:reduceFun};return view.db.get("_local/lastSeq")["catch"](function(err){if(404!==err.status)throw err}).then(function(lastSeqDoc){return view.seq=lastSeqDoc?lastSeqDoc.seq:0,temporary||(sourceDB._cachedViews=sourceDB._cachedViews||{},sourceDB._cachedViews[viewSignature]=view,view.db.on("destroyed",function(){delete sourceDB._cachedViews[viewSignature]})),view})})})})}},{"./upsert":80,"./utils":81}],77:[function(require,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func.replace(/;\s*$/,"")+");")}},{}],78:[function(require,module,exports){(function(process){"use strict";function parseViewName(name){return-1===name.indexOf("/")?[name,name]:name.split("/")}function isGenOne(changes){return 1===changes.length&&/^1-/.test(changes[0].rev)}function tryCode(db,fun,args){try{return{output:fun.apply(null,args)}}catch(e){return db.emit("error",e),{error:e}}}function sortByKeyThenValue(x,y){var keyCompare=collate(x.key,y.key);return 0!==keyCompare?keyCompare:collate(x.value,y.value)}function sliceResults(results,limit,skip){return skip=skip||0,"number"==typeof limit?results.slice(skip,limit+skip):skip>0?results.slice(skip):results}function rowToDocId(row){var val=row.value,docId=val&&"object"==typeof val&&val._id||row.id;return docId}function createBuiltInError(name){var error=new Error("builtin "+name+" function requires map values to be numbers or number arrays");return error.name="invalid_value",error.status=500,error}function sum(values){for(var result=0,i=0,len=values.length;len>i;i++){var num=values[i];if("number"!=typeof num){if(!Array.isArray(num))throw createBuiltInError("_sum");result="number"==typeof result?[result]:result;for(var j=0,jLen=num.length;jLen>j;j++){var jNum=num[j];if("number"!=typeof jNum)throw createBuiltInError("_sum");"undefined"==typeof result[j]?result.push(jNum):result[j]+=jNum}}else"number"==typeof result?result+=num:result[0]+=num}return result}function addHttpParam(paramName,opts,params,asJson){var val=opts[paramName];"undefined"!=typeof val&&(asJson&&(val=encodeURIComponent(JSON.stringify(val))),params.push(paramName+"="+val))}function checkQueryParseError(options,fun){var startkeyName=options.descending?"endkey":"startkey",endkeyName=options.descending?"startkey":"endkey";if("undefined"!=typeof options[startkeyName]&&"undefined"!=typeof options[endkeyName]&&collate(options[startkeyName],options[endkeyName])>0)throw new QueryParseError("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(fun.reduce&&options.reduce!==!1){if(options.include_docs)throw new QueryParseError("{include_docs:true} is invalid for reduce");if(options.keys&&options.keys.length>1&&!options.group&&!options.group_level)throw new QueryParseError("Multi-key fetches for reduce views must use {group: true}")}if(options.group_level){if("number"!=typeof options.group_level)throw new QueryParseError('Invalid value for integer: "'+options.group_level+'"');if(options.group_level<0)throw new QueryParseError('Invalid value for positive integer: "'+options.group_level+'"')}}function httpQuery(db,fun,opts){var body,params=[],method="GET";if(addHttpParam("reduce",opts,params),addHttpParam("include_docs",opts,params),addHttpParam("attachments",opts,params),addHttpParam("limit",opts,params),addHttpParam("descending",opts,params),addHttpParam("group",opts,params),addHttpParam("group_level",opts,params),addHttpParam("skip",opts,params),addHttpParam("stale",opts,params),addHttpParam("conflicts",opts,params),addHttpParam("startkey",opts,params,!0),addHttpParam("endkey",opts,params,!0),addHttpParam("inclusive_end",opts,params),addHttpParam("key",opts,params,!0),params=params.join("&"),params=""===params?"":"?"+params,"undefined"!=typeof opts.keys){var MAX_URL_LENGTH=2e3,keysAsString="keys="+encodeURIComponent(JSON.stringify(opts.keys));keysAsString.length+params.length+1<=MAX_URL_LENGTH?params+=("?"===params[0]?"&":"?")+keysAsString:(method="POST","string"==typeof fun?body=JSON.stringify({keys:opts.keys}):fun.keys=opts.keys)}if("string"==typeof fun){var parts=parseViewName(fun);return db.request({method:method,url:"_design/"+parts[0]+"/_view/"+parts[1]+params,body:body})}return body=body||{},Object.keys(fun).forEach(function(key){body[key]=Array.isArray(fun[key])?fun[key]:fun[key].toString()}),db.request({method:"POST",url:"_temp_view"+params,body:body})}function defaultsTo(value){return function(reason){if(404===reason.status)return value;throw reason}}function getDocsToPersist(docId,view,docIdsToChangesAndEmits){function getMetaDoc(){return isGenOne(changes)?Promise.resolve(defaultMetaDoc):view.db.get(metaDocId)["catch"](defaultsTo(defaultMetaDoc))}function getKeyValueDocs(metaDoc){return metaDoc.keys.length?view.db.allDocs({keys:metaDoc.keys,include_docs:!0}):Promise.resolve({rows:[]})}function processKvDocs(metaDoc,kvDocsRes){for(var kvDocs=[],oldKeysMap={},i=0,len=kvDocsRes.rows.length;len>i;i++){var row=kvDocsRes.rows[i],doc=row.doc;if(doc&&(kvDocs.push(doc),oldKeysMap[doc._id]=!0,doc._deleted=!indexableKeysToKeyValues[doc._id],!doc._deleted)){var keyValue=indexableKeysToKeyValues[doc._id];"value"in keyValue&&(doc.value=keyValue.value)}}var newKeys=Object.keys(indexableKeysToKeyValues);return newKeys.forEach(function(key){if(!oldKeysMap[key]){var kvDoc={_id:key},keyValue=indexableKeysToKeyValues[key];"value"in keyValue&&(kvDoc.value=keyValue.value),kvDocs.push(kvDoc)}}),metaDoc.keys=utils.uniq(newKeys.concat(metaDoc.keys)),kvDocs.push(metaDoc),kvDocs}var metaDocId="_local/doc_"+docId,defaultMetaDoc={_id:metaDocId,keys:[]},docData=docIdsToChangesAndEmits[docId],indexableKeysToKeyValues=docData.indexableKeysToKeyValues,changes=docData.changes;return getMetaDoc().then(function(metaDoc){return getKeyValueDocs(metaDoc).then(function(kvDocsRes){return processKvDocs(metaDoc,kvDocsRes)})})}function saveKeyValues(view,docIdsToChangesAndEmits,seq){var seqDocId="_local/lastSeq";return view.db.get(seqDocId)["catch"](defaultsTo({_id:seqDocId,seq:0})).then(function(lastSeqDoc){var docIds=Object.keys(docIdsToChangesAndEmits);return Promise.all(docIds.map(function(docId){return getDocsToPersist(docId,view,docIdsToChangesAndEmits)})).then(function(listOfDocsToPersist){var docsToPersist=utils.flatten(listOfDocsToPersist);return lastSeqDoc.seq=seq,docsToPersist.push(lastSeqDoc),view.db.bulkDocs({docs:docsToPersist})})})}function getQueue(view){var viewName="string"==typeof view?view:view.name,queue=persistentQueues[viewName];return queue||(queue=persistentQueues[viewName]=new TaskQueue),queue}function updateView(view){return utils.sequentialize(getQueue(view),function(){return updateViewInQueue(view)})()}function updateViewInQueue(view){function emit(key,value){var output={id:doc._id,key:normalizeKey(key)};"undefined"!=typeof value&&null!==value&&(output.value=normalizeKey(value)),mapResults.push(output)}function processChange(docIdsToChangesAndEmits,seq){return function(){return saveKeyValues(view,docIdsToChangesAndEmits,seq)}}var mapResults,doc,mapFun;if("function"==typeof view.mapFun&&2===view.mapFun.length){var origMap=view.mapFun;mapFun=function(doc){return origMap(doc,emit)}}else mapFun=evalFunc(view.mapFun.toString(),emit,sum,log,Array.isArray,JSON.parse);var currentSeq=view.seq||0,queue=new TaskQueue;return new Promise(function(resolve,reject){function complete(){queue.finish().then(function(){view.seq=currentSeq,resolve()})}function processNextBatch(){function onError(err){reject(err)}view.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:currentSeq,limit:CHANGES_BATCH_SIZE}).on("complete",function(response){var results=response.results;if(!results.length)return complete();for(var docIdsToChangesAndEmits={},i=0,l=results.length;l>i;i++){var change=results[i];if("_"!==change.doc._id[0]){mapResults=[],doc=change.doc,doc._deleted||tryCode(view.sourceDB,mapFun,[doc]),mapResults.sort(sortByKeyThenValue);for(var lastKey,indexableKeysToKeyValues={},j=0,jl=mapResults.length;jl>j;j++){var obj=mapResults[j],complexKey=[obj.key,obj.id];obj.key===lastKey&&complexKey.push(j);var indexableKey=toIndexableString(complexKey);indexableKeysToKeyValues[indexableKey]=obj,lastKey=obj.key}docIdsToChangesAndEmits[change.doc._id]={indexableKeysToKeyValues:indexableKeysToKeyValues,changes:change.changes}}currentSeq=change.seq}return queue.add(processChange(docIdsToChangesAndEmits,currentSeq)),results.length<CHANGES_BATCH_SIZE?complete():processNextBatch()}).on("error",onError)}processNextBatch()})}function reduceView(view,results,options){0===options.group_level&&delete options.group_level;var reduceFun,shouldGroup=options.group||options.group_level;reduceFun=builtInReduce[view.reduceFun]?builtInReduce[view.reduceFun]:evalFunc(view.reduceFun.toString(),null,sum,log,Array.isArray,JSON.parse);var groups=[],lvl=options.group_level;results.forEach(function(e){var last=groups[groups.length-1],key=shouldGroup?e.key:null;return shouldGroup&&Array.isArray(key)&&"number"==typeof lvl&&(key=key.length>lvl?key.slice(0,lvl):key),last&&0===collate(last.key[0][0],key)?(last.key.push([key,e.id]),void last.value.push(e.value)):void groups.push({key:[[key,e.id]],value:[e.value]})});for(var i=0,len=groups.length;len>i;i++){var e=groups[i],reduceTry=tryCode(view.sourceDB,reduceFun,[e.key,e.value,!1]);e.value=reduceTry.error?null:reduceTry.output,e.key=e.key[0][0]}return{rows:sliceResults(groups,options.limit,options.skip)}}function queryView(view,opts){return utils.sequentialize(getQueue(view),function(){return queryViewInQueue(view,opts)})()}function queryViewInQueue(view,opts){function fetchFromView(viewOpts){return viewOpts.include_docs=!0,view.db.allDocs(viewOpts).then(function(res){return totalRows=res.total_rows,res.rows.map(function(result){if("value"in result.doc&&"object"==typeof result.doc.value&&null!==result.doc.value){var keys=Object.keys(result.doc.value).sort(),expectedKeys=["id","key","value"];if(!(expectedKeys>keys||keys>expectedKeys))return result.doc.value}var parsedKeyAndDocId=pouchCollate.parseIndexableString(result.doc._id);return{key:parsedKeyAndDocId[0],id:parsedKeyAndDocId[1],value:"value"in result.doc?result.doc.value:null}})})}function onMapResultsReady(rows){var finalResults;if(finalResults=shouldReduce?reduceView(view,rows,opts):{total_rows:totalRows,offset:skip,rows:rows},opts.include_docs){var docIds=utils.uniq(rows.map(rowToDocId));return view.sourceDB.allDocs({keys:docIds,include_docs:!0,conflicts:opts.conflicts,attachments:opts.attachments}).then(function(allDocsRes){var docIdsToDocs={};return allDocsRes.rows.forEach(function(row){row.doc&&(docIdsToDocs["$"+row.id]=row.doc)}),rows.forEach(function(row){var docId=rowToDocId(row),doc=docIdsToDocs["$"+docId];doc&&(row.doc=doc)}),finalResults})}return finalResults}var totalRows,shouldReduce=view.reduceFun&&opts.reduce!==!1,skip=opts.skip||0;"undefined"==typeof opts.keys||opts.keys.length||(opts.limit=0,delete opts.keys);var flatten=function(array){return array.reduce(function(prev,cur){return prev.concat(cur)})};if("undefined"!=typeof opts.keys){var keys=opts.keys,fetchPromises=keys.map(function(key){var viewOpts={startkey:toIndexableString([key]),endkey:toIndexableString([key,{}])};return fetchFromView(viewOpts)});return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady)}var viewOpts={descending:opts.descending};if("undefined"!=typeof opts.startkey&&(viewOpts.startkey=toIndexableString(opts.descending?[opts.startkey,{}]:[opts.startkey])),"undefined"!=typeof opts.endkey){var inclusiveEnd=opts.inclusive_end!==!1;opts.descending&&(inclusiveEnd=!inclusiveEnd),viewOpts.endkey=toIndexableString(inclusiveEnd?[opts.endkey,{}]:[opts.endkey])}if("undefined"!=typeof opts.key){var keyStart=toIndexableString([opts.key]),keyEnd=toIndexableString([opts.key,{}]);viewOpts.descending?(viewOpts.endkey=keyStart,viewOpts.startkey=keyEnd):(viewOpts.startkey=keyStart,viewOpts.endkey=keyEnd)}return shouldReduce||("number"==typeof opts.limit&&(viewOpts.limit=opts.limit),viewOpts.skip=skip),fetchFromView(viewOpts).then(onMapResultsReady)}function httpViewCleanup(db){return db.request({method:"POST",url:"_view_cleanup"})}function localViewCleanup(db){return db.get("_local/mrviews").then(function(metaDoc){var docsToViews={};Object.keys(metaDoc.views).forEach(function(fullViewName){var parts=parseViewName(fullViewName),designDocName="_design/"+parts[0],viewName=parts[1];docsToViews[designDocName]=docsToViews[designDocName]||{},docsToViews[designDocName][viewName]=!0});var opts={keys:Object.keys(docsToViews),include_docs:!0};return db.allDocs(opts).then(function(res){var viewsToStatus={};res.rows.forEach(function(row){var ddocName=row.key.substring(8);Object.keys(docsToViews[row.key]).forEach(function(viewName){var fullViewName=ddocName+"/"+viewName;metaDoc.views[fullViewName]||(fullViewName=viewName);var viewDBNames=Object.keys(metaDoc.views[fullViewName]),statusIsGood=row.doc&&row.doc.views&&row.doc.views[viewName];viewDBNames.forEach(function(viewDBName){viewsToStatus[viewDBName]=viewsToStatus[viewDBName]||statusIsGood})})});var dbsToDelete=Object.keys(viewsToStatus).filter(function(viewDBName){return!viewsToStatus[viewDBName]}),destroyPromises=dbsToDelete.map(function(viewDBName){return utils.sequentialize(getQueue(viewDBName),function(){return db.constructor.destroy(viewDBName,db.__opts)})()});return Promise.all(destroyPromises).then(function(){return{ok:!0}})})},defaultsTo({ok:!0}))}function queryPromised(db,fun,opts){if("http"===db.type())return httpQuery(db,fun,opts);if("string"!=typeof fun){checkQueryParseError(opts,fun);var createViewOpts={db:db,viewName:"temp_view/temp_view",map:fun.map,reduce:fun.reduce,temporary:!0};return tempViewQueue.add(function(){return createView(createViewOpts).then(function(view){function cleanup(){return view.db.destroy()}return utils.fin(updateView(view).then(function(){return queryView(view,opts)}),cleanup)})}),tempViewQueue.finish()}var fullViewName=fun,parts=parseViewName(fullViewName),designDocName=parts[0],viewName=parts[1];return db.get("_design/"+designDocName).then(function(doc){var fun=doc.views&&doc.views[viewName];if(!fun||"string"!=typeof fun.map)throw new NotFoundError("ddoc "+designDocName+" has no view named "+viewName);checkQueryParseError(opts,fun);var createViewOpts={db:db,viewName:fullViewName,map:fun.map,reduce:fun.reduce};return createView(createViewOpts).then(function(view){return"ok"===opts.stale||"update_after"===opts.stale?("update_after"===opts.stale&&process.nextTick(function(){updateView(view)}),queryView(view,opts)):updateView(view).then(function(){return queryView(view,opts)})})})}function QueryParseError(message){this.status=400,this.name="query_parse_error",this.message=message,this.error=!0;try{Error.captureStackTrace(this,QueryParseError)}catch(e){}}function NotFoundError(message){this.status=404,this.name="not_found",this.message=message,this.error=!0;try{Error.captureStackTrace(this,NotFoundError)}catch(e){}}var log,pouchCollate=require("pouchdb-collate"),TaskQueue=require("./taskqueue"),collate=pouchCollate.collate,toIndexableString=pouchCollate.toIndexableString,normalizeKey=pouchCollate.normalizeKey,createView=require("./create-view"),evalFunc=require("./evalfunc");log="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var utils=require("./utils"),Promise=utils.Promise,persistentQueues={},tempViewQueue=new TaskQueue,CHANGES_BATCH_SIZE=50,builtInReduce={_sum:function(keys,values){return sum(values)},_count:function(keys,values){return values.length},_stats:function(keys,values){function sumsqr(values){for(var _sumsqr=0,i=0,len=values.length;len>i;i++){var num=values[i];_sumsqr+=num*num}return _sumsqr}return{sum:sum(values),min:Math.min.apply(null,values),max:Math.max.apply(null,values),count:values.length,sumsqr:sumsqr(values)}}};exports.viewCleanup=utils.callbackify(function(){var db=this;return"http"===db.type()?httpViewCleanup(db):localViewCleanup(db)}),exports.query=function(fun,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),opts=utils.extend(!0,{},opts),"function"==typeof fun&&(fun={map:fun});var db=this,promise=Promise.resolve().then(function(){return queryPromised(db,fun,opts)});return utils.promisedCallback(promise,callback),promise},utils.inherits(QueryParseError,Error),utils.inherits(NotFoundError,Error)}).call(this,require("_process"))},{"./create-view":76,"./evalfunc":77,"./taskqueue":79,"./utils":81,_process:132,"pouchdb-collate":72}],79:[function(require,module){"use strict";function TaskQueue(){this.promise=new Promise(function(fulfill){fulfill()})}var Promise=require("./utils").Promise;TaskQueue.prototype.add=function(promiseFactory){return this.promise=this.promise["catch"](function(){}).then(function(){return promiseFactory()}),this.promise},TaskQueue.prototype.finish=function(){return this.promise},module.exports=TaskQueue},{"./utils":81}],80:[function(require,module){"use strict";var upsert=require("pouchdb-upsert").upsert;module.exports=function(db,doc,diffFun){return upsert.apply(db,[doc,diffFun])}},{"pouchdb-upsert":82}],81:[function(require,module,exports){(function(process,global){"use strict";exports.Promise="function"==typeof global.Promise?global.Promise:require("lie"),exports.inherits=require("inherits"),exports.extend=require("pouchdb-extend");var argsarray=require("argsarray");exports.promisedCallback=function(promise,callback){return callback&&promise.then(function(res){process.nextTick(function(){callback(null,res)})},function(reason){process.nextTick(function(){callback(reason)})}),promise},exports.callbackify=function(fun){return argsarray(function(args){var cb=args.pop(),promise=fun.apply(this,args);return"function"==typeof cb&&exports.promisedCallback(promise,cb),promise})},exports.fin=function(promise,cb){return promise.then(function(res){var promise2=cb();return"function"==typeof promise2.then?promise2.then(function(){return res}):res},function(reason){var promise2=cb();if("function"==typeof promise2.then)return promise2.then(function(){throw reason});throw reason})},exports.sequentialize=function(queue,promiseFactory){return function(){var args=arguments,that=this;return queue.add(function(){return promiseFactory.apply(that,args)})}},exports.flatten=function(arrs){for(var res=[],i=0,len=arrs.length;len>i;i++)res=res.concat(arrs[i]);return res},exports.uniq=function(arr){for(var map={},i=0,len=arr.length;len>i;i++)map["$"+arr[i]]=!0;var keys=Object.keys(map),output=new Array(keys.length);for(i=0,len=keys.length;len>i;i++)output[i]=keys[i].substring(1);return output};var crypto=require("crypto"),Md5=require("spark-md5");exports.MD5=function(string){return process.browser?Md5.hash(string):crypto.createHash("md5").update(string).digest("hex")}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:132,argsarray:49,crypto:126,inherits:53,lie:57,"pouchdb-extend":75,"spark-md5":83}],82:[function(require,module,exports){(function(global){"use strict";function upsertInner(db,docId,diffFun){return new PouchPromise(function(fulfill,reject){return"string"!=typeof docId?reject(new Error("doc id is required")):void db.get(docId,function(err,doc){if(err){if(404!==err.status)return reject(err);doc={}}var newDoc=diffFun(doc);return newDoc?(newDoc._id=docId,newDoc._rev=doc._rev,void fulfill(tryAndPut(db,newDoc,diffFun))):fulfill({updated:!1,rev:doc._rev})})})}function tryAndPut(db,doc,diffFun){return db.put(doc).then(function(res){return{updated:!0,rev:res.rev}},function(err){if(409!==err.status)throw err;return upsertInner(db,doc._id,diffFun)})}var PouchPromise;PouchPromise="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof global.Promise?global.Promise:require("lie"),exports.upsert=function(docId,diffFun,cb){var db=this,promise=upsertInner(db,docId,diffFun);return"function"!=typeof cb?promise:void promise.then(function(resp){cb(null,resp)},cb)},exports.putIfNotExists=function(docId,doc,cb){var db=this;"string"!=typeof docId&&(cb=doc,doc=docId,docId=doc._id);var diffFun=function(existingDoc){return existingDoc._rev?!1:doc},promise=upsertInner(db,docId,diffFun);return"function"!=typeof cb?promise:void promise.then(function(resp){cb(null,resp)},cb)},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(exports)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{lie:57}],83:[function(require,module,exports){!function(factory){if("object"==typeof exports)module.exports=factory();else if("function"==typeof define&&define.amd)define(factory);else{var glob;try{glob=window}catch(e){glob=self}glob.SparkMD5=factory()}}(function(){"use strict";var add32=function(a,b){return a+b&4294967295},cmn=function(q,a,b,x,s,t){return a=add32(add32(a,q),add32(x,t)),add32(a<<s|a>>>32-s,b)},ff=function(a,b,c,d,x,s,t){return cmn(b&c|~b&d,a,b,x,s,t)},gg=function(a,b,c,d,x,s,t){return cmn(b&d|c&~d,a,b,x,s,t)},hh=function(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)},ii=function(a,b,c,d,x,s,t){return cmn(c^(b|~d),a,b,x,s,t)},md5cycle=function(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936),d=ff(d,a,b,c,k[1],12,-389564586),c=ff(c,d,a,b,k[2],17,606105819),b=ff(b,c,d,a,k[3],22,-1044525330),a=ff(a,b,c,d,k[4],7,-176418897),d=ff(d,a,b,c,k[5],12,1200080426),c=ff(c,d,a,b,k[6],17,-1473231341),b=ff(b,c,d,a,k[7],22,-45705983),a=ff(a,b,c,d,k[8],7,1770035416),d=ff(d,a,b,c,k[9],12,-1958414417),c=ff(c,d,a,b,k[10],17,-42063),b=ff(b,c,d,a,k[11],22,-1990404162),a=ff(a,b,c,d,k[12],7,1804603682),d=ff(d,a,b,c,k[13],12,-40341101),c=ff(c,d,a,b,k[14],17,-1502002290),b=ff(b,c,d,a,k[15],22,1236535329),a=gg(a,b,c,d,k[1],5,-165796510),d=gg(d,a,b,c,k[6],9,-1069501632),c=gg(c,d,a,b,k[11],14,643717713),b=gg(b,c,d,a,k[0],20,-373897302),a=gg(a,b,c,d,k[5],5,-701558691),d=gg(d,a,b,c,k[10],9,38016083),c=gg(c,d,a,b,k[15],14,-660478335),b=gg(b,c,d,a,k[4],20,-405537848),a=gg(a,b,c,d,k[9],5,568446438),d=gg(d,a,b,c,k[14],9,-1019803690),c=gg(c,d,a,b,k[3],14,-187363961),b=gg(b,c,d,a,k[8],20,1163531501),a=gg(a,b,c,d,k[13],5,-1444681467),d=gg(d,a,b,c,k[2],9,-51403784),c=gg(c,d,a,b,k[7],14,1735328473),b=gg(b,c,d,a,k[12],20,-1926607734),a=hh(a,b,c,d,k[5],4,-378558),d=hh(d,a,b,c,k[8],11,-2022574463),c=hh(c,d,a,b,k[11],16,1839030562),b=hh(b,c,d,a,k[14],23,-35309556),a=hh(a,b,c,d,k[1],4,-1530992060),d=hh(d,a,b,c,k[4],11,1272893353),c=hh(c,d,a,b,k[7],16,-155497632),b=hh(b,c,d,a,k[10],23,-1094730640),a=hh(a,b,c,d,k[13],4,681279174),d=hh(d,a,b,c,k[0],11,-358537222),c=hh(c,d,a,b,k[3],16,-722521979),b=hh(b,c,d,a,k[6],23,76029189),a=hh(a,b,c,d,k[9],4,-640364487),d=hh(d,a,b,c,k[12],11,-421815835),c=hh(c,d,a,b,k[15],16,530742520),b=hh(b,c,d,a,k[2],23,-995338651),a=ii(a,b,c,d,k[0],6,-198630844),d=ii(d,a,b,c,k[7],10,1126891415),c=ii(c,d,a,b,k[14],15,-1416354905),b=ii(b,c,d,a,k[5],21,-57434055),a=ii(a,b,c,d,k[12],6,1700485571),d=ii(d,a,b,c,k[3],10,-1894986606),c=ii(c,d,a,b,k[10],15,-1051523),b=ii(b,c,d,a,k[1],21,-2054922799),a=ii(a,b,c,d,k[8],6,1873313359),d=ii(d,a,b,c,k[15],10,-30611744),c=ii(c,d,a,b,k[6],15,-1560198380),b=ii(b,c,d,a,k[13],21,1309151649),a=ii(a,b,c,d,k[4],6,-145523070),d=ii(d,a,b,c,k[11],10,-1120210379),c=ii(c,d,a,b,k[2],15,718787259),b=ii(b,c,d,a,k[9],21,-343485551),x[0]=add32(a,x[0]),x[1]=add32(b,x[1]),x[2]=add32(c,x[2]),x[3]=add32(d,x[3])},md5blk=function(s){var i,md5blks=[];for(i=0;64>i;i+=4)md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24);return md5blks},md5blk_array=function(a){var i,md5blks=[];for(i=0;64>i;i+=4)md5blks[i>>2]=a[i]+(a[i+1]<<8)+(a[i+2]<<16)+(a[i+3]<<24);return md5blks},md51=function(s){var i,length,tail,tmp,lo,hi,n=s.length,state=[1732584193,-271733879,-1732584194,271733878];for(i=64;n>=i;i+=64)md5cycle(state,md5blk(s.substring(i-64,i)));for(s=s.substring(i-64),length=s.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;length>i;i+=1)tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3);if(tail[i>>2]|=128<<(i%4<<3),i>55)for(md5cycle(state,tail),i=0;16>i;i+=1)tail[i]=0;return tmp=8*n,tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(state,tail),state},md51_array=function(a){var i,length,tail,tmp,lo,hi,n=a.length,state=[1732584193,-271733879,-1732584194,271733878];for(i=64;n>=i;i+=64)md5cycle(state,md5blk_array(a.subarray(i-64,i)));for(a=n>i-64?a.subarray(i-64):new Uint8Array(0),length=a.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;length>i;i+=1)tail[i>>2]|=a[i]<<(i%4<<3);if(tail[i>>2]|=128<<(i%4<<3),i>55)for(md5cycle(state,tail),i=0;16>i;i+=1)tail[i]=0;return tmp=8*n,tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(state,tail),state},hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],rhex=function(n){var j,s="";for(j=0;4>j;j+=1)s+=hex_chr[n>>8*j+4&15]+hex_chr[n>>8*j&15];return s},hex=function(x){var i;for(i=0;i<x.length;i+=1)x[i]=rhex(x[i]);return x.join("")},md5=function(s){return hex(md51(s))},SparkMD5=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==md5("hello")&&(add32=function(x,y){var lsw=(65535&x)+(65535&y),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|65535&lsw}),SparkMD5.prototype.append=function(str){return/[\u0080-\uFFFF]/.test(str)&&(str=unescape(encodeURIComponent(str))),this.appendBinary(str),this},SparkMD5.prototype.appendBinary=function(contents){this._buff+=contents,this._length+=contents.length;var i,length=this._buff.length;for(i=64;length>=i;i+=64)md5cycle(this._state,md5blk(this._buff.substring(i-64,i)));return this._buff=this._buff.substr(i-64),this},SparkMD5.prototype.end=function(raw){var i,ret,buff=this._buff,length=buff.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;length>i;i+=1)tail[i>>2]|=buff.charCodeAt(i)<<(i%4<<3);return this._finish(tail,length),ret=raw?this._state:hex(this._state),this.reset(),ret},SparkMD5.prototype._finish=function(tail,length){var tmp,lo,hi,i=length;if(tail[i>>2]|=128<<(i%4<<3),i>55)for(md5cycle(this._state,tail),i=0;16>i;i+=1)tail[i]=0;tmp=8*this._length,tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(this._state,tail)},SparkMD5.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},SparkMD5.hash=function(str,raw){/[\u0080-\uFFFF]/.test(str)&&(str=unescape(encodeURIComponent(str)));var hash=md51(str);return raw?hash:hex(hash)},SparkMD5.hashBinary=function(content,raw){var hash=md51(content);return raw?hash:hex(hash)},SparkMD5.ArrayBuffer=function(){this.reset()},SparkMD5.ArrayBuffer.prototype.append=function(arr){var i,buff=this._concatArrayBuffer(this._buff,arr),length=buff.length;for(this._length+=arr.byteLength,i=64;length>=i;i+=64)md5cycle(this._state,md5blk_array(buff.subarray(i-64,i)));return this._buff=length>i-64?buff.subarray(i-64):new Uint8Array(0),this},SparkMD5.ArrayBuffer.prototype.end=function(raw){var i,ret,buff=this._buff,length=buff.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;length>i;i+=1)tail[i>>2]|=buff[i]<<(i%4<<3);return this._finish(tail,length),ret=raw?this._state:hex(this._state),this.reset(),ret},SparkMD5.ArrayBuffer.prototype._finish=SparkMD5.prototype._finish,SparkMD5.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.ArrayBuffer.prototype.destroy=SparkMD5.prototype.destroy,SparkMD5.ArrayBuffer.prototype._concatArrayBuffer=function(first,second){var firstLength=first.length,result=new Uint8Array(firstLength+second.byteLength);return result.set(first),result.set(new Uint8Array(second),firstLength),result},SparkMD5.ArrayBuffer.hash=function(arr,raw){var hash=md51_array(new Uint8Array(arr));return raw?hash:hex(hash)},SparkMD5})},{}],84:[function(require,module,exports){"use strict";function pop(obj,stack,metaStack){var lastMetaElement=metaStack[metaStack.length-1];obj===lastMetaElement.element&&(metaStack.pop(),lastMetaElement=metaStack[metaStack.length-1]);var element=lastMetaElement.element,lastElementIndex=lastMetaElement.index;if(Array.isArray(element))element.push(obj);else if(lastElementIndex===stack.length-2){var key=stack.pop();element[key]=obj}else stack.push(obj)}exports.stringify=function(input){var queue=[];queue.push({obj:input});for(var next,obj,prefix,val,i,arrayPrefix,keys,k,key,value,objPrefix,res="";next=queue.pop();)if(obj=next.obj,prefix=next.prefix||"",val=next.val||"",res+=prefix,val)res+=val;else if("object"!=typeof obj)res+="undefined"==typeof obj?null:JSON.stringify(obj);else if(null===obj)res+="null";else if(Array.isArray(obj)){for(queue.push({val:"]"}),i=obj.length-1;i>=0;i--)arrayPrefix=0===i?"":",",queue.push({obj:obj[i],prefix:arrayPrefix});
queue.push({val:"["})}else{keys=[];for(k in obj)obj.hasOwnProperty(k)&&keys.push(k);for(queue.push({val:"}"}),i=keys.length-1;i>=0;i--)key=keys[i],value=obj[key],objPrefix=i>0?",":"",objPrefix+=JSON.stringify(key)+":",queue.push({obj:value,prefix:objPrefix});queue.push({val:"{"})}return res},exports.parse=function(str){for(var collationIndex,parsedNum,numChar,parsedString,lastCh,numConsecutiveSlashes,ch,arrayElement,objElement,stack=[],metaStack=[],i=0;;)if(collationIndex=str[i++],"}"!==collationIndex&&"]"!==collationIndex&&"undefined"!=typeof collationIndex)switch(collationIndex){case" ":case"	":case"\n":case":":case",":break;case"n":i+=3,pop(null,stack,metaStack);break;case"t":i+=3,pop(!0,stack,metaStack);break;case"f":i+=4,pop(!1,stack,metaStack);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(parsedNum="",i--;;){if(numChar=str[i++],!/[\d\.\-e\+]/.test(numChar)){i--;break}parsedNum+=numChar}pop(parseFloat(parsedNum),stack,metaStack);break;case'"':for(parsedString="",lastCh=void 0,numConsecutiveSlashes=0;;){if(ch=str[i++],'"'===ch&&("\\"!==lastCh||numConsecutiveSlashes%2!==1))break;parsedString+=ch,lastCh=ch,"\\"===lastCh?numConsecutiveSlashes++:numConsecutiveSlashes=0}pop(JSON.parse('"'+parsedString+'"'),stack,metaStack);break;case"[":arrayElement={element:[],index:stack.length},stack.push(arrayElement.element),metaStack.push(arrayElement);break;case"{":objElement={element:{},index:stack.length},stack.push(objElement.element),metaStack.push(objElement);break;default:throw new Error("unexpectedly reached end of input: "+collationIndex)}else{if(1===stack.length)return stack.pop();pop(stack.pop(),stack,metaStack)}}},{}],85:[function(require,module){function state(data){return Cursor.from(Immutable.fromJS(data))}function app(elem,state,render){var observ=toObserv(state),loop=main(observ(),render,extend({diff:diff,create:create,patch:patch}));return elem&&elem.appendChild(loop.target),observ(loop.update)}function toObserv(cursor){return function(listener){return listener?void(cursor._onChange=function(data){cursor._rootData=data,listener(data)}):cursor.deref()}}var Immutable=require("immutable"),Cursor=require("immutable/contrib/cursor"),extend=require("extend"),main=require("main-loop"),diff=require("virtual-dom/vtree/diff"),patch=require("virtual-dom/vdom/patch"),create=require("virtual-dom/vdom/create-element"),h=require("virtual-dom/virtual-hyperscript");app.h=h,app.state=state,module.exports=app},{extend:86,immutable:88,"immutable/contrib/cursor":87,"main-loop":89,"virtual-dom/vdom/create-element":104,"virtual-dom/vdom/patch":107,"virtual-dom/virtual-hyperscript":111,"virtual-dom/vtree/diff":124}],86:[function(require,module){var undefined,hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,isPlainObject=function(obj){"use strict";if(!obj||"[object Object]"!==toString.call(obj))return!1;var has_own_constructor=hasOwn.call(obj,"constructor"),has_is_property_of_method=obj.constructor&&obj.constructor.prototype&&hasOwn.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!has_own_constructor&&!has_is_property_of_method)return!1;var key;for(key in obj);return key===undefined||hasOwn.call(obj,key)};module.exports=function extend(){"use strict";var options,name,src,copy,copyIsArray,clone,target=arguments[0],i=1,length=arguments.length,deep=!1;for("boolean"==typeof target?(deep=target,target=arguments[1]||{},i=2):("object"!=typeof target&&"function"!=typeof target||null==target)&&(target={});length>i;++i)if(options=arguments[i],null!=options)for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&Array.isArray(src)?src:[]):clone=src&&isPlainObject(src)?src:{},target[name]=extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy));return target}},{}],87:[function(require,module,exports){function cursorFrom(rootData,keyPath,onChange){return 1===arguments.length?keyPath=[]:"function"==typeof keyPath?(onChange=keyPath,keyPath=[]):keyPath=valToKeyPath(keyPath),makeCursor(rootData,keyPath,onChange)}function KeyedCursor(rootData,keyPath,onChange,size){this.size=size,this._rootData=rootData,this._keyPath=keyPath,this._onChange=onChange}function IndexedCursor(rootData,keyPath,onChange,size){this.size=size,this._rootData=rootData,this._keyPath=keyPath,this._onChange=onChange}function makeCursor(rootData,keyPath,onChange,value){arguments.length<4&&(value=rootData.getIn(keyPath));var size=value&&value.size,CursorClass=Iterable.isIndexed(value)?IndexedCursor:KeyedCursor;return new CursorClass(rootData,keyPath,onChange,size)}function wrappedValue(cursor,keyPath,value){return Iterable.isIterable(value)?subCursor(cursor,keyPath,value):value}function subCursor(cursor,keyPath,value){return makeCursor(cursor._rootData,newKeyPath(cursor._keyPath,keyPath),cursor._onChange,value)}function updateCursor(cursor,changeFn,changeKeyPath){var deepChange=arguments.length>2,newRootData=cursor._rootData.updateIn(cursor._keyPath,deepChange?Map():void 0,changeFn),keyPath=cursor._keyPath||[],result=cursor._onChange&&cursor._onChange.call(void 0,newRootData,cursor._rootData,deepChange?newKeyPath(keyPath,changeKeyPath):keyPath);return void 0!==result&&(newRootData=result),makeCursor(newRootData,cursor._keyPath,cursor._onChange)}function newKeyPath(head,tail){return head.concat(listToKeyPath(tail))}function listToKeyPath(list){return Array.isArray(list)?list:Immutable.Iterable(list).toArray()}function valToKeyPath(val){return Array.isArray(val)?val:Iterable.isIterable(val)?val.toArray():[val]}var Immutable=require("immutable"),Iterable=Immutable.Iterable,Iterator=Iterable.Iterator,Seq=Immutable.Seq,Map=Immutable.Map,KeyedCursorPrototype=Object.create(Seq.Keyed.prototype),IndexedCursorPrototype=Object.create(Seq.Indexed.prototype);KeyedCursorPrototype.constructor=KeyedCursor,IndexedCursorPrototype.constructor=IndexedCursor,KeyedCursorPrototype.toString=function(){return this.__toString("Cursor {","}")},IndexedCursorPrototype.toString=function(){return this.__toString("Cursor [","]")},KeyedCursorPrototype.deref=KeyedCursorPrototype.valueOf=IndexedCursorPrototype.deref=IndexedCursorPrototype.valueOf=function(notSetValue){return this._rootData.getIn(this._keyPath,notSetValue)},KeyedCursorPrototype.get=IndexedCursorPrototype.get=function(key,notSetValue){return this.getIn([key],notSetValue)},KeyedCursorPrototype.getIn=IndexedCursorPrototype.getIn=function(keyPath,notSetValue){if(keyPath=listToKeyPath(keyPath),0===keyPath.length)return this;var value=this._rootData.getIn(newKeyPath(this._keyPath,keyPath),NOT_SET);return value===NOT_SET?notSetValue:wrappedValue(this,keyPath,value)},IndexedCursorPrototype.set=KeyedCursorPrototype.set=function(key,value){return updateCursor(this,function(m){return m.set(key,value)},[key])},IndexedCursorPrototype.setIn=KeyedCursorPrototype.setIn=Map.prototype.setIn,KeyedCursorPrototype.remove=KeyedCursorPrototype["delete"]=IndexedCursorPrototype.remove=IndexedCursorPrototype["delete"]=function(key){return updateCursor(this,function(m){return m.remove(key)},[key])},IndexedCursorPrototype.removeIn=IndexedCursorPrototype.deleteIn=KeyedCursorPrototype.removeIn=KeyedCursorPrototype.deleteIn=Map.prototype.deleteIn,KeyedCursorPrototype.clear=IndexedCursorPrototype.clear=function(){return updateCursor(this,function(m){return m.clear()})},IndexedCursorPrototype.update=KeyedCursorPrototype.update=function(keyOrFn,notSetValue,updater){return 1===arguments.length?updateCursor(this,keyOrFn):this.updateIn([keyOrFn],notSetValue,updater)},IndexedCursorPrototype.updateIn=KeyedCursorPrototype.updateIn=function(keyPath,notSetValue,updater){return updateCursor(this,function(m){return m.updateIn(keyPath,notSetValue,updater)},keyPath)},IndexedCursorPrototype.merge=KeyedCursorPrototype.merge=function(){var args=arguments;return updateCursor(this,function(m){return m.merge.apply(m,args)})},IndexedCursorPrototype.mergeWith=KeyedCursorPrototype.mergeWith=function(){var args=arguments;return updateCursor(this,function(m){return m.mergeWith.apply(m,args)})},IndexedCursorPrototype.mergeIn=KeyedCursorPrototype.mergeIn=Map.prototype.mergeIn,IndexedCursorPrototype.mergeDeep=KeyedCursorPrototype.mergeDeep=function(){var args=arguments;return updateCursor(this,function(m){return m.mergeDeep.apply(m,args)})},IndexedCursorPrototype.mergeDeepWith=KeyedCursorPrototype.mergeDeepWith=function(){var args=arguments;return updateCursor(this,function(m){return m.mergeDeepWith.apply(m,args)})},IndexedCursorPrototype.mergeDeepIn=KeyedCursorPrototype.mergeDeepIn=Map.prototype.mergeDeepIn,KeyedCursorPrototype.withMutations=IndexedCursorPrototype.withMutations=function(fn){return updateCursor(this,function(m){return(m||Map()).withMutations(fn)})},KeyedCursorPrototype.cursor=IndexedCursorPrototype.cursor=function(subKeyPath){return subKeyPath=valToKeyPath(subKeyPath),0===subKeyPath.length?this:subCursor(this,subKeyPath)},KeyedCursorPrototype.__iterate=IndexedCursorPrototype.__iterate=function(fn,reverse){var cursor=this,deref=cursor.deref();return deref&&deref.__iterate?deref.__iterate(function(v,k){return fn(wrappedValue(cursor,[k],v),k,cursor)},reverse):0},KeyedCursorPrototype.__iterator=IndexedCursorPrototype.__iterator=function(type,reverse){var deref=this.deref(),cursor=this,iterator=deref&&deref.__iterator&&deref.__iterator(Iterator.ENTRIES,reverse);return new Iterator(function(){if(!iterator)return{value:void 0,done:!0};var step=iterator.next();if(step.done)return step;var entry=step.value,k=entry[0],v=wrappedValue(cursor,[k],entry[1]);return{value:type===Iterator.KEYS?k:type===Iterator.VALUES?v:[k,v],done:!1}})},KeyedCursor.prototype=KeyedCursorPrototype,IndexedCursor.prototype=IndexedCursorPrototype;var NOT_SET={};exports.from=cursorFrom},{immutable:88}],88:[function(require,module,exports){!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.Immutable=factory()}(this,function(){"use strict";function createClass(ctor,superClass){superClass&&(ctor.prototype=Object.create(superClass.prototype)),ctor.prototype.constructor=ctor}function MakeRef(ref){return ref.value=!1,ref}function SetRef(ref){ref&&(ref.value=!0)}function OwnerID(){}function arrCopy(arr,offset){offset=offset||0;for(var len=Math.max(0,arr.length-offset),newArr=new Array(len),ii=0;len>ii;ii++)newArr[ii]=arr[ii+offset];return newArr}function ensureSize(iter){return void 0===iter.size&&(iter.size=iter.__iterate(returnTrue)),iter.size}function wrapIndex(iter,index){return index>=0?+index:ensureSize(iter)+ +index}function returnTrue(){return!0}function wholeSlice(begin,end,size){return(0===begin||void 0!==size&&-size>=begin)&&(void 0===end||void 0!==size&&end>=size)}function resolveBegin(begin,size){return resolveIndex(begin,size,0)}function resolveEnd(end,size){return resolveIndex(end,size,size)}function resolveIndex(index,size,defaultIndex){return void 0===index?defaultIndex:0>index?Math.max(0,size+index):void 0===size?index:Math.min(size,index)}function Iterable(value){return isIterable(value)?value:Seq(value)}function KeyedIterable(value){return isKeyed(value)?value:KeyedSeq(value)}function IndexedIterable(value){return isIndexed(value)?value:IndexedSeq(value)}function SetIterable(value){return isIterable(value)&&!isAssociative(value)?value:SetSeq(value)}function isIterable(maybeIterable){return!(!maybeIterable||!maybeIterable[IS_ITERABLE_SENTINEL])}function isKeyed(maybeKeyed){return!(!maybeKeyed||!maybeKeyed[IS_KEYED_SENTINEL])}function isIndexed(maybeIndexed){return!(!maybeIndexed||!maybeIndexed[IS_INDEXED_SENTINEL])}function isAssociative(maybeAssociative){return isKeyed(maybeAssociative)||isIndexed(maybeAssociative)}function isOrdered(maybeOrdered){return!(!maybeOrdered||!maybeOrdered[IS_ORDERED_SENTINEL])}function Iterator(next){this.next=next}function iteratorValue(type,k,v,iteratorResult){var value=0===type?k:1===type?v:[k,v];return iteratorResult?iteratorResult.value=value:iteratorResult={value:value,done:!1},iteratorResult}function iteratorDone(){return{value:void 0,done:!0}}function hasIterator(maybeIterable){return!!getIteratorFn(maybeIterable)}function isIterator(maybeIterator){return maybeIterator&&"function"==typeof maybeIterator.next}function getIterator(iterable){var iteratorFn=getIteratorFn(iterable);return iteratorFn&&iteratorFn.call(iterable)}function getIteratorFn(iterable){var iteratorFn=iterable&&(REAL_ITERATOR_SYMBOL&&iterable[REAL_ITERATOR_SYMBOL]||iterable[FAUX_ITERATOR_SYMBOL]);return"function"==typeof iteratorFn?iteratorFn:void 0}function isArrayLike(value){return value&&"number"==typeof value.length}function Seq(value){return null===value||void 0===value?emptySequence():isIterable(value)?value.toSeq():seqFromValue(value)}function KeyedSeq(value){return null===value||void 0===value?emptySequence().toKeyedSeq():isIterable(value)?isKeyed(value)?value.toSeq():value.fromEntrySeq():keyedSeqFromValue(value)}function IndexedSeq(value){return null===value||void 0===value?emptySequence():isIterable(value)?isKeyed(value)?value.entrySeq():value.toIndexedSeq():indexedSeqFromValue(value)}function SetSeq(value){return(null===value||void 0===value?emptySequence():isIterable(value)?isKeyed(value)?value.entrySeq():value:indexedSeqFromValue(value)).toSetSeq()}function ArraySeq(array){this._array=array,this.size=array.length}function ObjectSeq(object){var keys=Object.keys(object);this._object=object,this._keys=keys,this.size=keys.length}function IterableSeq(iterable){this._iterable=iterable,this.size=iterable.length||iterable.size}function IteratorSeq(iterator){this._iterator=iterator,this._iteratorCache=[]}function isSeq(maybeSeq){return!(!maybeSeq||!maybeSeq[IS_SEQ_SENTINEL])}function emptySequence(){return EMPTY_SEQ||(EMPTY_SEQ=new ArraySeq([]))}function keyedSeqFromValue(value){var seq=Array.isArray(value)?new ArraySeq(value).fromEntrySeq():isIterator(value)?new IteratorSeq(value).fromEntrySeq():hasIterator(value)?new IterableSeq(value).fromEntrySeq():"object"==typeof value?new ObjectSeq(value):void 0;if(!seq)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+value);return seq}function indexedSeqFromValue(value){var seq=maybeIndexedSeqFromValue(value);if(!seq)throw new TypeError("Expected Array or iterable object of values: "+value);return seq}function seqFromValue(value){var seq=maybeIndexedSeqFromValue(value)||"object"==typeof value&&new ObjectSeq(value);if(!seq)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+value);return seq}function maybeIndexedSeqFromValue(value){return isArrayLike(value)?new ArraySeq(value):isIterator(value)?new IteratorSeq(value):hasIterator(value)?new IterableSeq(value):void 0}function seqIterate(seq,fn,reverse,useKeys){var cache=seq._cache;if(cache){for(var maxIndex=cache.length-1,ii=0;maxIndex>=ii;ii++){var entry=cache[reverse?maxIndex-ii:ii];if(fn(entry[1],useKeys?entry[0]:ii,seq)===!1)return ii+1}return ii}return seq.__iterateUncached(fn,reverse)}function seqIterator(seq,type,reverse,useKeys){var cache=seq._cache;if(cache){var maxIndex=cache.length-1,ii=0;return new Iterator(function(){var entry=cache[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,useKeys?entry[0]:ii-1,entry[1])})}return seq.__iteratorUncached(type,reverse)}function Collection(){throw TypeError("Abstract")}function KeyedCollection(){}function IndexedCollection(){}function SetCollection(){}function is(valueA,valueB){return valueA===valueB||valueA!==valueA&&valueB!==valueB?!0:valueA&&valueB?("function"==typeof valueA.valueOf&&"function"==typeof valueB.valueOf&&(valueA=valueA.valueOf(),valueB=valueB.valueOf()),"function"==typeof valueA.equals&&"function"==typeof valueB.equals?valueA.equals(valueB):valueA===valueB||valueA!==valueA&&valueB!==valueB):!1}function fromJS(json,converter){return converter?fromJSWith(converter,json,"",{"":json}):fromJSDefault(json)}function fromJSWith(converter,json,key,parentJSON){return Array.isArray(json)?converter.call(parentJSON,key,IndexedSeq(json).map(function(v,k){return fromJSWith(converter,v,k,json)})):isPlainObj(json)?converter.call(parentJSON,key,KeyedSeq(json).map(function(v,k){return fromJSWith(converter,v,k,json)})):json}function fromJSDefault(json){return Array.isArray(json)?IndexedSeq(json).map(fromJSDefault).toList():isPlainObj(json)?KeyedSeq(json).map(fromJSDefault).toMap():json}function isPlainObj(value){return value&&value.constructor===Object}function smi(i32){return i32>>>1&1073741824|3221225471&i32}function hash(o){if(o===!1||null===o||void 0===o)return 0;if("function"==typeof o.valueOf&&(o=o.valueOf(),o===!1||null===o||void 0===o))return 0;if(o===!0)return 1;var type=typeof o;if("number"===type){var h=0|o;for(h!==o&&(h^=4294967295*o);o>4294967295;)o/=4294967295,h^=o;return smi(h)}return"string"===type?o.length>STRING_HASH_CACHE_MIN_STRLEN?cachedHashString(o):hashString(o):"function"==typeof o.hashCode?o.hashCode():hashJSObj(o)}function cachedHashString(string){var hash=stringHashCache[string];return void 0===hash&&(hash=hashString(string),STRING_HASH_CACHE_SIZE===STRING_HASH_CACHE_MAX_SIZE&&(STRING_HASH_CACHE_SIZE=0,stringHashCache={}),STRING_HASH_CACHE_SIZE++,stringHashCache[string]=hash),hash}function hashString(string){for(var hash=0,ii=0;ii<string.length;ii++)hash=31*hash+string.charCodeAt(ii)|0;return smi(hash)}function hashJSObj(obj){var hash=weakMap&&weakMap.get(obj);if(hash)return hash;if(hash=obj[UID_HASH_KEY])return hash;if(!canDefineProperty){if(hash=obj.propertyIsEnumerable&&obj.propertyIsEnumerable[UID_HASH_KEY])return hash;if(hash=getIENodeHash(obj))return hash}if(Object.isExtensible&&!Object.isExtensible(obj))throw new Error("Non-extensible objects are not allowed as keys.");if(hash=++objHashUID,1073741824&objHashUID&&(objHashUID=0),weakMap)weakMap.set(obj,hash);else if(canDefineProperty)Object.defineProperty(obj,UID_HASH_KEY,{enumerable:!1,configurable:!1,writable:!1,value:hash});else if(obj.propertyIsEnumerable&&obj.propertyIsEnumerable===obj.constructor.prototype.propertyIsEnumerable)obj.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},obj.propertyIsEnumerable[UID_HASH_KEY]=hash;else{if(!obj.nodeType)throw new Error("Unable to set a non-enumerable property on object.");obj[UID_HASH_KEY]=hash}return hash}function getIENodeHash(node){if(node&&node.nodeType>0)switch(node.nodeType){case 1:return node.uniqueID;case 9:return node.documentElement&&node.documentElement.uniqueID}}function invariant(condition,error){if(!condition)throw new Error(error)}function assertNotInfinite(size){invariant(1/0!==size,"Cannot perform this action with an infinite size.")}function ToKeyedSequence(indexed,useKeys){this._iter=indexed,this._useKeys=useKeys,this.size=indexed.size}function ToIndexedSequence(iter){this._iter=iter,this.size=iter.size}function ToSetSequence(iter){this._iter=iter,this.size=iter.size}function FromEntriesSequence(entries){this._iter=entries,this.size=entries.size}function flipFactory(iterable){var flipSequence=makeSequence(iterable);return flipSequence._iter=iterable,flipSequence.size=iterable.size,flipSequence.flip=function(){return iterable},flipSequence.reverse=function(){var reversedSequence=iterable.reverse.apply(this);return reversedSequence.flip=function(){return iterable.reverse()},reversedSequence},flipSequence.has=function(key){return iterable.contains(key)},flipSequence.contains=function(key){return iterable.has(key)},flipSequence.cacheResult=cacheResultThrough,flipSequence.__iterateUncached=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k){return fn(k,v,this$0)!==!1},reverse)},flipSequence.__iteratorUncached=function(type,reverse){if(type===ITERATE_ENTRIES){var iterator=iterable.__iterator(type,reverse);return new Iterator(function(){var step=iterator.next();if(!step.done){var k=step.value[0];step.value[0]=step.value[1],step.value[1]=k}return step})}return iterable.__iterator(type===ITERATE_VALUES?ITERATE_KEYS:ITERATE_VALUES,reverse)},flipSequence}function mapFactory(iterable,mapper,context){var mappedSequence=makeSequence(iterable);return mappedSequence.size=iterable.size,mappedSequence.has=function(key){return iterable.has(key)},mappedSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v===NOT_SET?notSetValue:mapper.call(context,v,key,iterable)},mappedSequence.__iterateUncached=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k,c){return fn(mapper.call(context,v,k,c),k,this$0)!==!1},reverse)},mappedSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);return new Iterator(function(){var step=iterator.next();if(step.done)return step;var entry=step.value,key=entry[0];return iteratorValue(type,key,mapper.call(context,entry[1],key,iterable),step)})},mappedSequence}function reverseFactory(iterable,useKeys){var reversedSequence=makeSequence(iterable);return reversedSequence._iter=iterable,reversedSequence.size=iterable.size,reversedSequence.reverse=function(){return iterable},iterable.flip&&(reversedSequence.flip=function(){var flipSequence=flipFactory(iterable);return flipSequence.reverse=function(){return iterable.flip()},flipSequence}),reversedSequence.get=function(key,notSetValue){return iterable.get(useKeys?key:-1-key,notSetValue)},reversedSequence.has=function(key){return iterable.has(useKeys?key:-1-key)},reversedSequence.contains=function(value){return iterable.contains(value)},reversedSequence.cacheResult=cacheResultThrough,reversedSequence.__iterate=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k){return fn(v,k,this$0)},!reverse)},reversedSequence.__iterator=function(type,reverse){return iterable.__iterator(type,!reverse)},reversedSequence}function filterFactory(iterable,predicate,context,useKeys){var filterSequence=makeSequence(iterable);return useKeys&&(filterSequence.has=function(key){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&!!predicate.call(context,v,key,iterable)},filterSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&predicate.call(context,v,key,iterable)?v:notSetValue}),filterSequence.__iterateUncached=function(fn,reverse){var this$0=this,iterations=0;return iterable.__iterate(function(v,k,c){return predicate.call(context,v,k,c)?(iterations++,fn(v,useKeys?k:iterations-1,this$0)):void 0},reverse),iterations},filterSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse),iterations=0;return new Iterator(function(){for(;;){var step=iterator.next();if(step.done)return step;var entry=step.value,key=entry[0],value=entry[1];if(predicate.call(context,value,key,iterable))return iteratorValue(type,useKeys?key:iterations++,value,step)}})},filterSequence}function countByFactory(iterable,grouper,context){var groups=Map().asMutable();return iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),0,function(a){return a+1})}),groups.asImmutable()}function groupByFactory(iterable,grouper,context){var isKeyedIter=isKeyed(iterable),groups=(isOrdered(iterable)?OrderedMap():Map()).asMutable();iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),function(a){return a=a||[],a.push(isKeyedIter?[k,v]:v),a})});var coerce=iterableClass(iterable);return groups.map(function(arr){return reify(iterable,coerce(arr))})}function sliceFactory(iterable,begin,end,useKeys){var originalSize=iterable.size;if(wholeSlice(begin,end,originalSize))return iterable;var resolvedBegin=resolveBegin(begin,originalSize),resolvedEnd=resolveEnd(end,originalSize);if(resolvedBegin!==resolvedBegin||resolvedEnd!==resolvedEnd)return sliceFactory(iterable.toSeq().cacheResult(),begin,end,useKeys);var sliceSize=resolvedEnd-resolvedBegin;0>sliceSize&&(sliceSize=0);var sliceSeq=makeSequence(iterable);return sliceSeq.size=0===sliceSize?sliceSize:iterable.size&&sliceSize||void 0,!useKeys&&isSeq(iterable)&&sliceSize>=0&&(sliceSeq.get=function(index,notSetValue){return index=wrapIndex(this,index),index>=0&&sliceSize>index?iterable.get(index+resolvedBegin,notSetValue):notSetValue}),sliceSeq.__iterateUncached=function(fn,reverse){var this$0=this;if(0===sliceSize)return 0;if(reverse)return this.cacheResult().__iterate(fn,reverse);var skipped=0,isSkipping=!0,iterations=0;return iterable.__iterate(function(v,k){return isSkipping&&(isSkipping=skipped++<resolvedBegin)?void 0:(iterations++,fn(v,useKeys?k:iterations-1,this$0)!==!1&&iterations!==sliceSize)}),iterations},sliceSeq.__iteratorUncached=function(type,reverse){if(sliceSize&&reverse)return this.cacheResult().__iterator(type,reverse);var iterator=sliceSize&&iterable.__iterator(type,reverse),skipped=0,iterations=0;return new Iterator(function(){for(;skipped++!==resolvedBegin;)iterator.next();if(++iterations>sliceSize)return iteratorDone();var step=iterator.next();return useKeys||type===ITERATE_VALUES?step:type===ITERATE_KEYS?iteratorValue(type,iterations-1,void 0,step):iteratorValue(type,iterations-1,step.value[1],step)})},sliceSeq}function takeWhileFactory(iterable,predicate,context){var takeSequence=makeSequence(iterable);return takeSequence.__iterateUncached=function(fn,reverse){var this$0=this;if(reverse)return this.cacheResult().__iterate(fn,reverse);var iterations=0;return iterable.__iterate(function(v,k,c){return predicate.call(context,v,k,c)&&++iterations&&fn(v,k,this$0)}),iterations},takeSequence.__iteratorUncached=function(type,reverse){var this$0=this;if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse),iterating=!0;return new Iterator(function(){if(!iterating)return iteratorDone();var step=iterator.next();if(step.done)return step;var entry=step.value,k=entry[0],v=entry[1];return predicate.call(context,v,k,this$0)?type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step):(iterating=!1,iteratorDone())})},takeSequence}function skipWhileFactory(iterable,predicate,context,useKeys){var skipSequence=makeSequence(iterable);return skipSequence.__iterateUncached=function(fn,reverse){var this$0=this;if(reverse)return this.cacheResult().__iterate(fn,reverse);var isSkipping=!0,iterations=0;return iterable.__iterate(function(v,k,c){return isSkipping&&(isSkipping=predicate.call(context,v,k,c))?void 0:(iterations++,fn(v,useKeys?k:iterations-1,this$0))}),iterations},skipSequence.__iteratorUncached=function(type,reverse){var this$0=this;if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse),skipping=!0,iterations=0;return new Iterator(function(){var step,k,v;do{if(step=iterator.next(),step.done)return useKeys||type===ITERATE_VALUES?step:type===ITERATE_KEYS?iteratorValue(type,iterations++,void 0,step):iteratorValue(type,iterations++,step.value[1],step);var entry=step.value;k=entry[0],v=entry[1],skipping&&(skipping=predicate.call(context,v,k,this$0))}while(skipping);return type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step)})},skipSequence}function concatFactory(iterable,values){var isKeyedIterable=isKeyed(iterable),iters=[iterable].concat(values).map(function(v){return isIterable(v)?isKeyedIterable&&(v=KeyedIterable(v)):v=isKeyedIterable?keyedSeqFromValue(v):indexedSeqFromValue(Array.isArray(v)?v:[v]),v}).filter(function(v){return 0!==v.size});if(0===iters.length)return iterable;if(1===iters.length){var singleton=iters[0];if(singleton===iterable||isKeyedIterable&&isKeyed(singleton)||isIndexed(iterable)&&isIndexed(singleton))return singleton}var concatSeq=new ArraySeq(iters);return isKeyedIterable?concatSeq=concatSeq.toKeyedSeq():isIndexed(iterable)||(concatSeq=concatSeq.toSetSeq()),concatSeq=concatSeq.flatten(!0),concatSeq.size=iters.reduce(function(sum,seq){if(void 0!==sum){var size=seq.size;if(void 0!==size)return sum+size}},0),concatSeq}function flattenFactory(iterable,depth,useKeys){var flatSequence=makeSequence(iterable);return flatSequence.__iterateUncached=function(fn,reverse){function flatDeep(iter,currentDepth){var this$0=this;iter.__iterate(function(v,k){return(!depth||depth>currentDepth)&&isIterable(v)?flatDeep(v,currentDepth+1):fn(v,useKeys?k:iterations++,this$0)===!1&&(stopped=!0),!stopped},reverse)}var iterations=0,stopped=!1;return flatDeep(iterable,0),iterations},flatSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(type,reverse),stack=[],iterations=0;return new Iterator(function(){for(;iterator;){var step=iterator.next();if(step.done===!1){var v=step.value;if(type===ITERATE_ENTRIES&&(v=v[1]),depth&&!(stack.length<depth)||!isIterable(v))return useKeys?step:iteratorValue(type,iterations++,v,step);stack.push(iterator),iterator=v.__iterator(type,reverse)}else iterator=stack.pop()}return iteratorDone()})},flatSequence}function flatMapFactory(iterable,mapper,context){var coerce=iterableClass(iterable);return iterable.toSeq().map(function(v,k){return coerce(mapper.call(context,v,k,iterable))}).flatten(!0)}function interposeFactory(iterable,separator){var interposedSequence=makeSequence(iterable);return interposedSequence.size=iterable.size&&2*iterable.size-1,interposedSequence.__iterateUncached=function(fn,reverse){var this$0=this,iterations=0;return iterable.__iterate(function(v){return(!iterations||fn(separator,iterations++,this$0)!==!1)&&fn(v,iterations++,this$0)!==!1},reverse),iterations},interposedSequence.__iteratorUncached=function(type,reverse){var step,iterator=iterable.__iterator(ITERATE_VALUES,reverse),iterations=0;return new Iterator(function(){return(!step||iterations%2)&&(step=iterator.next(),step.done)?step:iterations%2?iteratorValue(type,iterations++,separator):iteratorValue(type,iterations++,step.value,step)})},interposedSequence}function sortFactory(iterable,comparator,mapper){comparator||(comparator=defaultComparator);var isKeyedIterable=isKeyed(iterable),index=0,entries=iterable.toSeq().map(function(v,k){return[k,v,index++,mapper?mapper(v,k,iterable):v]}).toArray();return entries.sort(function(a,b){return comparator(a[3],b[3])||a[2]-b[2]}).forEach(isKeyedIterable?function(v,i){entries[i].length=2}:function(v,i){entries[i]=v[1]}),isKeyedIterable?KeyedSeq(entries):isIndexed(iterable)?IndexedSeq(entries):SetSeq(entries)}function maxFactory(iterable,comparator,mapper){if(comparator||(comparator=defaultComparator),mapper){var entry=iterable.toSeq().map(function(v,k){return[v,mapper(v,k,iterable)]}).reduce(function(a,b){return maxCompare(comparator,a[1],b[1])?b:a});return entry&&entry[0]}return iterable.reduce(function(a,b){return maxCompare(comparator,a,b)?b:a})}function maxCompare(comparator,a,b){var comp=comparator(b,a);return 0===comp&&b!==a&&(void 0===b||null===b||b!==b)||comp>0}function zipWithFactory(keyIter,zipper,iters){var zipSequence=makeSequence(keyIter);return zipSequence.size=new ArraySeq(iters).map(function(i){return i.size}).min(),zipSequence.__iterate=function(fn,reverse){for(var step,iterator=this.__iterator(ITERATE_VALUES,reverse),iterations=0;!(step=iterator.next()).done&&fn(step.value,iterations++,this)!==!1;);return iterations},zipSequence.__iteratorUncached=function(type,reverse){var iterators=iters.map(function(i){return i=Iterable(i),getIterator(reverse?i.reverse():i)}),iterations=0,isDone=!1;return new Iterator(function(){var steps;return isDone||(steps=iterators.map(function(i){return i.next()}),isDone=steps.some(function(s){return s.done})),isDone?iteratorDone():iteratorValue(type,iterations++,zipper.apply(null,steps.map(function(s){return s.value})))})},zipSequence}function reify(iter,seq){return isSeq(iter)?seq:iter.constructor(seq)}function validateEntry(entry){if(entry!==Object(entry))throw new TypeError("Expected [K, V] tuple: "+entry)}function resolveSize(iter){return assertNotInfinite(iter.size),ensureSize(iter)
}function iterableClass(iterable){return isKeyed(iterable)?KeyedIterable:isIndexed(iterable)?IndexedIterable:SetIterable}function makeSequence(iterable){return Object.create((isKeyed(iterable)?KeyedSeq:isIndexed(iterable)?IndexedSeq:SetSeq).prototype)}function cacheResultThrough(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Seq.prototype.cacheResult.call(this)}function defaultComparator(a,b){return a>b?1:b>a?-1:0}function forceIterator(keyPath){var iter=getIterator(keyPath);if(!iter){if(!isArrayLike(keyPath))throw new TypeError("Expected iterable or array-like: "+keyPath);iter=getIterator(Iterable(keyPath))}return iter}function Map(value){return null===value||void 0===value?emptyMap():isMap(value)?value:emptyMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v,k){return map.set(k,v)})})}function isMap(maybeMap){return!(!maybeMap||!maybeMap[IS_MAP_SENTINEL])}function ArrayMapNode(ownerID,entries){this.ownerID=ownerID,this.entries=entries}function BitmapIndexedNode(ownerID,bitmap,nodes){this.ownerID=ownerID,this.bitmap=bitmap,this.nodes=nodes}function HashArrayMapNode(ownerID,count,nodes){this.ownerID=ownerID,this.count=count,this.nodes=nodes}function HashCollisionNode(ownerID,keyHash,entries){this.ownerID=ownerID,this.keyHash=keyHash,this.entries=entries}function ValueNode(ownerID,keyHash,entry){this.ownerID=ownerID,this.keyHash=keyHash,this.entry=entry}function MapIterator(map,type,reverse){this._type=type,this._reverse=reverse,this._stack=map._root&&mapIteratorFrame(map._root)}function mapIteratorValue(type,entry){return iteratorValue(type,entry[0],entry[1])}function mapIteratorFrame(node,prev){return{node:node,index:0,__prev:prev}}function makeMap(size,root,ownerID,hash){var map=Object.create(MapPrototype);return map.size=size,map._root=root,map.__ownerID=ownerID,map.__hash=hash,map.__altered=!1,map}function emptyMap(){return EMPTY_MAP||(EMPTY_MAP=makeMap(0))}function updateMap(map,k,v){var newRoot,newSize;if(map._root){var didChangeSize=MakeRef(CHANGE_LENGTH),didAlter=MakeRef(DID_ALTER);if(newRoot=updateNode(map._root,map.__ownerID,0,void 0,k,v,didChangeSize,didAlter),!didAlter.value)return map;newSize=map.size+(didChangeSize.value?v===NOT_SET?-1:1:0)}else{if(v===NOT_SET)return map;newSize=1,newRoot=new ArrayMapNode(map.__ownerID,[[k,v]])}return map.__ownerID?(map.size=newSize,map._root=newRoot,map.__hash=void 0,map.__altered=!0,map):newRoot?makeMap(newSize,newRoot):emptyMap()}function updateNode(node,ownerID,shift,keyHash,key,value,didChangeSize,didAlter){return node?node.update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter):value===NOT_SET?node:(SetRef(didAlter),SetRef(didChangeSize),new ValueNode(ownerID,keyHash,[key,value]))}function isLeafNode(node){return node.constructor===ValueNode||node.constructor===HashCollisionNode}function mergeIntoNode(node,ownerID,shift,keyHash,entry){if(node.keyHash===keyHash)return new HashCollisionNode(ownerID,keyHash,[node.entry,entry]);var newNode,idx1=(0===shift?node.keyHash:node.keyHash>>>shift)&MASK,idx2=(0===shift?keyHash:keyHash>>>shift)&MASK,nodes=idx1===idx2?[mergeIntoNode(node,ownerID,shift+SHIFT,keyHash,entry)]:(newNode=new ValueNode(ownerID,keyHash,entry),idx2>idx1?[node,newNode]:[newNode,node]);return new BitmapIndexedNode(ownerID,1<<idx1|1<<idx2,nodes)}function createNodes(ownerID,entries,key,value){ownerID||(ownerID=new OwnerID);for(var node=new ValueNode(ownerID,hash(key),[key,value]),ii=0;ii<entries.length;ii++){var entry=entries[ii];node=node.update(ownerID,0,void 0,entry[0],entry[1])}return node}function packNodes(ownerID,nodes,count,excluding){for(var bitmap=0,packedII=0,packedNodes=new Array(count),ii=0,bit=1,len=nodes.length;len>ii;ii++,bit<<=1){var node=nodes[ii];void 0!==node&&ii!==excluding&&(bitmap|=bit,packedNodes[packedII++]=node)}return new BitmapIndexedNode(ownerID,bitmap,packedNodes)}function expandNodes(ownerID,nodes,bitmap,including,node){for(var count=0,expandedNodes=new Array(SIZE),ii=0;0!==bitmap;ii++,bitmap>>>=1)expandedNodes[ii]=1&bitmap?nodes[count++]:void 0;return expandedNodes[including]=node,new HashArrayMapNode(ownerID,count+1,expandedNodes)}function mergeIntoMapWith(map,merger,iterables){for(var iters=[],ii=0;ii<iterables.length;ii++){var value=iterables[ii],iter=KeyedIterable(value);isIterable(value)||(iter=iter.map(function(v){return fromJS(v)})),iters.push(iter)}return mergeIntoCollectionWith(map,merger,iters)}function deepMerger(merger){return function(existing,value){return existing&&existing.mergeDeepWith&&isIterable(value)?existing.mergeDeepWith(merger,value):merger?merger(existing,value):value}}function mergeIntoCollectionWith(collection,merger,iters){return iters=iters.filter(function(x){return 0!==x.size}),0===iters.length?collection:0===collection.size&&1===iters.length?collection.constructor(iters[0]):collection.withMutations(function(collection){for(var mergeIntoMap=merger?function(value,key){collection.update(key,NOT_SET,function(existing){return existing===NOT_SET?value:merger(existing,value)})}:function(value,key){collection.set(key,value)},ii=0;ii<iters.length;ii++)iters[ii].forEach(mergeIntoMap)})}function updateInDeepMap(existing,keyPathIter,notSetValue,updater){var isNotSet=existing===NOT_SET,step=keyPathIter.next();if(step.done){var existingValue=isNotSet?notSetValue:existing,newValue=updater(existingValue);return newValue===existingValue?existing:newValue}invariant(isNotSet||existing&&existing.set,"invalid keyPath");var key=step.value,nextExisting=isNotSet?NOT_SET:existing.get(key,NOT_SET),nextUpdated=updateInDeepMap(nextExisting,keyPathIter,notSetValue,updater);return nextUpdated===nextExisting?existing:nextUpdated===NOT_SET?existing.remove(key):(isNotSet?emptyMap():existing).set(key,nextUpdated)}function popCount(x){return x-=x>>1&1431655765,x=(858993459&x)+(x>>2&858993459),x=x+(x>>4)&252645135,x+=x>>8,x+=x>>16,127&x}function setIn(array,idx,val,canEdit){var newArray=canEdit?array:arrCopy(array);return newArray[idx]=val,newArray}function spliceIn(array,idx,val,canEdit){var newLen=array.length+1;if(canEdit&&idx+1===newLen)return array[idx]=val,array;for(var newArray=new Array(newLen),after=0,ii=0;newLen>ii;ii++)ii===idx?(newArray[ii]=val,after=-1):newArray[ii]=array[ii+after];return newArray}function spliceOut(array,idx,canEdit){var newLen=array.length-1;if(canEdit&&idx===newLen)return array.pop(),array;for(var newArray=new Array(newLen),after=0,ii=0;newLen>ii;ii++)ii===idx&&(after=1),newArray[ii]=array[ii+after];return newArray}function List(value){var empty=emptyList();if(null===value||void 0===value)return empty;if(isList(value))return value;var iter=IndexedIterable(value),size=iter.size;return 0===size?empty:(assertNotInfinite(size),size>0&&SIZE>size?makeList(0,size,SHIFT,null,new VNode(iter.toArray())):empty.withMutations(function(list){list.setSize(size),iter.forEach(function(v,i){return list.set(i,v)})}))}function isList(maybeList){return!(!maybeList||!maybeList[IS_LIST_SENTINEL])}function VNode(array,ownerID){this.array=array,this.ownerID=ownerID}function iterateList(list,reverse){function iterateNodeOrLeaf(node,level,offset){return 0===level?iterateLeaf(node,offset):iterateNode(node,level,offset)}function iterateLeaf(node,offset){var array=offset===tailPos?tail&&tail.array:node&&node.array,from=offset>left?0:left-offset,to=right-offset;return to>SIZE&&(to=SIZE),function(){if(from===to)return DONE;var idx=reverse?--to:from++;return array&&array[idx]}}function iterateNode(node,level,offset){var values,array=node&&node.array,from=offset>left?0:left-offset>>level,to=(right-offset>>level)+1;return to>SIZE&&(to=SIZE),function(){for(;;){if(values){var value=values();if(value!==DONE)return value;values=null}if(from===to)return DONE;var idx=reverse?--to:from++;values=iterateNodeOrLeaf(array&&array[idx],level-SHIFT,offset+(idx<<level))}}}var left=list._origin,right=list._capacity,tailPos=getTailOffset(right),tail=list._tail;return iterateNodeOrLeaf(list._root,list._level,0)}function makeList(origin,capacity,level,root,tail,ownerID,hash){var list=Object.create(ListPrototype);return list.size=capacity-origin,list._origin=origin,list._capacity=capacity,list._level=level,list._root=root,list._tail=tail,list.__ownerID=ownerID,list.__hash=hash,list.__altered=!1,list}function emptyList(){return EMPTY_LIST||(EMPTY_LIST=makeList(0,0,SHIFT))}function updateList(list,index,value){if(index=wrapIndex(list,index),index>=list.size||0>index)return list.withMutations(function(list){0>index?setListBounds(list,index).set(0,value):setListBounds(list,0,index+1).set(index,value)});index+=list._origin;var newTail=list._tail,newRoot=list._root,didAlter=MakeRef(DID_ALTER);return index>=getTailOffset(list._capacity)?newTail=updateVNode(newTail,list.__ownerID,0,index,value,didAlter):newRoot=updateVNode(newRoot,list.__ownerID,list._level,index,value,didAlter),didAlter.value?list.__ownerID?(list._root=newRoot,list._tail=newTail,list.__hash=void 0,list.__altered=!0,list):makeList(list._origin,list._capacity,list._level,newRoot,newTail):list}function updateVNode(node,ownerID,level,index,value,didAlter){var idx=index>>>level&MASK,nodeHas=node&&idx<node.array.length;if(!nodeHas&&void 0===value)return node;var newNode;if(level>0){var lowerNode=node&&node.array[idx],newLowerNode=updateVNode(lowerNode,ownerID,level-SHIFT,index,value,didAlter);return newLowerNode===lowerNode?node:(newNode=editableVNode(node,ownerID),newNode.array[idx]=newLowerNode,newNode)}return nodeHas&&node.array[idx]===value?node:(SetRef(didAlter),newNode=editableVNode(node,ownerID),void 0===value&&idx===newNode.array.length-1?newNode.array.pop():newNode.array[idx]=value,newNode)}function editableVNode(node,ownerID){return ownerID&&node&&ownerID===node.ownerID?node:new VNode(node?node.array.slice():[],ownerID)}function listNodeFor(list,rawIndex){if(rawIndex>=getTailOffset(list._capacity))return list._tail;if(rawIndex<1<<list._level+SHIFT){for(var node=list._root,level=list._level;node&&level>0;)node=node.array[rawIndex>>>level&MASK],level-=SHIFT;return node}}function setListBounds(list,begin,end){var owner=list.__ownerID||new OwnerID,oldOrigin=list._origin,oldCapacity=list._capacity,newOrigin=oldOrigin+begin,newCapacity=void 0===end?oldCapacity:0>end?oldCapacity+end:oldOrigin+end;if(newOrigin===oldOrigin&&newCapacity===oldCapacity)return list;if(newOrigin>=newCapacity)return list.clear();for(var newLevel=list._level,newRoot=list._root,offsetShift=0;0>newOrigin+offsetShift;)newRoot=new VNode(newRoot&&newRoot.array.length?[void 0,newRoot]:[],owner),newLevel+=SHIFT,offsetShift+=1<<newLevel;offsetShift&&(newOrigin+=offsetShift,oldOrigin+=offsetShift,newCapacity+=offsetShift,oldCapacity+=offsetShift);for(var oldTailOffset=getTailOffset(oldCapacity),newTailOffset=getTailOffset(newCapacity);newTailOffset>=1<<newLevel+SHIFT;)newRoot=new VNode(newRoot&&newRoot.array.length?[newRoot]:[],owner),newLevel+=SHIFT;var oldTail=list._tail,newTail=oldTailOffset>newTailOffset?listNodeFor(list,newCapacity-1):newTailOffset>oldTailOffset?new VNode([],owner):oldTail;if(oldTail&&newTailOffset>oldTailOffset&&oldCapacity>newOrigin&&oldTail.array.length){newRoot=editableVNode(newRoot,owner);for(var node=newRoot,level=newLevel;level>SHIFT;level-=SHIFT){var idx=oldTailOffset>>>level&MASK;node=node.array[idx]=editableVNode(node.array[idx],owner)}node.array[oldTailOffset>>>SHIFT&MASK]=oldTail}if(oldCapacity>newCapacity&&(newTail=newTail&&newTail.removeAfter(owner,0,newCapacity)),newOrigin>=newTailOffset)newOrigin-=newTailOffset,newCapacity-=newTailOffset,newLevel=SHIFT,newRoot=null,newTail=newTail&&newTail.removeBefore(owner,0,newOrigin);else if(newOrigin>oldOrigin||oldTailOffset>newTailOffset){for(offsetShift=0;newRoot;){var beginIndex=newOrigin>>>newLevel&MASK;if(beginIndex!==newTailOffset>>>newLevel&MASK)break;beginIndex&&(offsetShift+=(1<<newLevel)*beginIndex),newLevel-=SHIFT,newRoot=newRoot.array[beginIndex]}newRoot&&newOrigin>oldOrigin&&(newRoot=newRoot.removeBefore(owner,newLevel,newOrigin-offsetShift)),newRoot&&oldTailOffset>newTailOffset&&(newRoot=newRoot.removeAfter(owner,newLevel,newTailOffset-offsetShift)),offsetShift&&(newOrigin-=offsetShift,newCapacity-=offsetShift)}return list.__ownerID?(list.size=newCapacity-newOrigin,list._origin=newOrigin,list._capacity=newCapacity,list._level=newLevel,list._root=newRoot,list._tail=newTail,list.__hash=void 0,list.__altered=!0,list):makeList(newOrigin,newCapacity,newLevel,newRoot,newTail)}function mergeIntoListWith(list,merger,iterables){for(var iters=[],maxSize=0,ii=0;ii<iterables.length;ii++){var value=iterables[ii],iter=IndexedIterable(value);iter.size>maxSize&&(maxSize=iter.size),isIterable(value)||(iter=iter.map(function(v){return fromJS(v)})),iters.push(iter)}return maxSize>list.size&&(list=list.setSize(maxSize)),mergeIntoCollectionWith(list,merger,iters)}function getTailOffset(size){return SIZE>size?0:size-1>>>SHIFT<<SHIFT}function OrderedMap(value){return null===value||void 0===value?emptyOrderedMap():isOrderedMap(value)?value:emptyOrderedMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v,k){return map.set(k,v)})})}function isOrderedMap(maybeOrderedMap){return isMap(maybeOrderedMap)&&isOrdered(maybeOrderedMap)}function makeOrderedMap(map,list,ownerID,hash){var omap=Object.create(OrderedMap.prototype);return omap.size=map?map.size:0,omap._map=map,omap._list=list,omap.__ownerID=ownerID,omap.__hash=hash,omap}function emptyOrderedMap(){return EMPTY_ORDERED_MAP||(EMPTY_ORDERED_MAP=makeOrderedMap(emptyMap(),emptyList()))}function updateOrderedMap(omap,k,v){var newMap,newList,map=omap._map,list=omap._list,i=map.get(k),has=void 0!==i;if(v===NOT_SET){if(!has)return omap;list.size>=SIZE&&list.size>=2*map.size?(newList=list.filter(function(entry,idx){return void 0!==entry&&i!==idx}),newMap=newList.toKeyedSeq().map(function(entry){return entry[0]}).flip().toMap(),omap.__ownerID&&(newMap.__ownerID=newList.__ownerID=omap.__ownerID)):(newMap=map.remove(k),newList=i===list.size-1?list.pop():list.set(i,void 0))}else if(has){if(v===list.get(i)[1])return omap;newMap=map,newList=list.set(i,[k,v])}else newMap=map.set(k,list.size),newList=list.set(list.size,[k,v]);return omap.__ownerID?(omap.size=newMap.size,omap._map=newMap,omap._list=newList,omap.__hash=void 0,omap):makeOrderedMap(newMap,newList)}function Stack(value){return null===value||void 0===value?emptyStack():isStack(value)?value:emptyStack().unshiftAll(value)}function isStack(maybeStack){return!(!maybeStack||!maybeStack[IS_STACK_SENTINEL])}function makeStack(size,head,ownerID,hash){var map=Object.create(StackPrototype);return map.size=size,map._head=head,map.__ownerID=ownerID,map.__hash=hash,map.__altered=!1,map}function emptyStack(){return EMPTY_STACK||(EMPTY_STACK=makeStack(0))}function Set(value){return null===value||void 0===value?emptySet():isSet(value)?value:emptySet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v){return set.add(v)})})}function isSet(maybeSet){return!(!maybeSet||!maybeSet[IS_SET_SENTINEL])}function updateSet(set,newMap){return set.__ownerID?(set.size=newMap.size,set._map=newMap,set):newMap===set._map?set:0===newMap.size?set.__empty():set.__make(newMap)}function makeSet(map,ownerID){var set=Object.create(SetPrototype);return set.size=map?map.size:0,set._map=map,set.__ownerID=ownerID,set}function emptySet(){return EMPTY_SET||(EMPTY_SET=makeSet(emptyMap()))}function OrderedSet(value){return null===value||void 0===value?emptyOrderedSet():isOrderedSet(value)?value:emptyOrderedSet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v){return set.add(v)})})}function isOrderedSet(maybeOrderedSet){return isSet(maybeOrderedSet)&&isOrdered(maybeOrderedSet)}function makeOrderedSet(map,ownerID){var set=Object.create(OrderedSetPrototype);return set.size=map?map.size:0,set._map=map,set.__ownerID=ownerID,set}function emptyOrderedSet(){return EMPTY_ORDERED_SET||(EMPTY_ORDERED_SET=makeOrderedSet(emptyOrderedMap()))}function Record(defaultValues,name){var RecordType=function(values){return this instanceof RecordType?void(this._map=Map(values)):new RecordType(values)},keys=Object.keys(defaultValues),RecordTypePrototype=RecordType.prototype=Object.create(RecordPrototype);RecordTypePrototype.constructor=RecordType,name&&(RecordTypePrototype._name=name),RecordTypePrototype._defaultValues=defaultValues,RecordTypePrototype._keys=keys,RecordTypePrototype.size=keys.length;try{keys.forEach(function(key){Object.defineProperty(RecordType.prototype,key,{get:function(){return this.get(key)},set:function(value){invariant(this.__ownerID,"Cannot set on an immutable record."),this.set(key,value)}})})}catch(error){}return RecordType}function makeRecord(likeRecord,map,ownerID){var record=Object.create(Object.getPrototypeOf(likeRecord));return record._map=map,record.__ownerID=ownerID,record}function recordName(record){return record._name||record.constructor.name}function deepEqual(a,b){if(a===b)return!0;if(!isIterable(b)||void 0!==a.size&&void 0!==b.size&&a.size!==b.size||void 0!==a.__hash&&void 0!==b.__hash&&a.__hash!==b.__hash||isKeyed(a)!==isKeyed(b)||isIndexed(a)!==isIndexed(b)||isOrdered(a)!==isOrdered(b))return!1;if(0===a.size&&0===b.size)return!0;var notAssociative=!isAssociative(a);if(isOrdered(a)){var entries=a.entries();return b.every(function(v,k){var entry=entries.next().value;return entry&&is(entry[1],v)&&(notAssociative||is(entry[0],k))})&&entries.next().done}var flipped=!1;if(void 0===a.size)if(void 0===b.size)a.cacheResult();else{flipped=!0;var _=a;a=b,b=_}var allEqual=!0,bSize=b.__iterate(function(v,k){return(notAssociative?a.has(v):flipped?is(v,a.get(k,NOT_SET)):is(a.get(k,NOT_SET),v))?void 0:(allEqual=!1,!1)});return allEqual&&a.size===bSize}function Range(start,end,step){if(!(this instanceof Range))return new Range(start,end,step);if(invariant(0!==step,"Cannot step a Range by 0"),start=start||0,void 0===end&&(end=1/0),step=void 0===step?1:Math.abs(step),start>end&&(step=-step),this._start=start,this._end=end,this._step=step,this.size=Math.max(0,Math.ceil((end-start)/step-1)+1),0===this.size){if(EMPTY_RANGE)return EMPTY_RANGE;EMPTY_RANGE=this}}function Repeat(value,times){if(!(this instanceof Repeat))return new Repeat(value,times);if(this._value=value,this.size=void 0===times?1/0:Math.max(0,times),0===this.size){if(EMPTY_REPEAT)return EMPTY_REPEAT;EMPTY_REPEAT=this}}function mixin(ctor,methods){var keyCopier=function(key){ctor.prototype[key]=methods[key]};return Object.keys(methods).forEach(keyCopier),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(methods).forEach(keyCopier),ctor}function keyMapper(v,k){return k}function entryMapper(v,k){return[k,v]}function not(predicate){return function(){return!predicate.apply(this,arguments)}}function neg(predicate){return function(){return-predicate.apply(this,arguments)}}function quoteString(value){return"string"==typeof value?JSON.stringify(value):value}function defaultZipper(){return arrCopy(arguments)}function defaultNegComparator(a,b){return b>a?1:a>b?-1:0}function hashIterable(iterable){if(1/0===iterable.size)return 0;var ordered=isOrdered(iterable),keyed=isKeyed(iterable),h=ordered?1:0,size=iterable.__iterate(keyed?ordered?function(v,k){h=31*h+hashMerge(hash(v),hash(k))|0}:function(v,k){h=h+hashMerge(hash(v),hash(k))|0}:ordered?function(v){h=31*h+hash(v)|0}:function(v){h=h+hash(v)|0});return murmurHashOfSize(size,h)}function murmurHashOfSize(size,h){return h=Math__imul(h,3432918353),h=Math__imul(h<<15|h>>>-15,461845907),h=Math__imul(h<<13|h>>>-13,5),h=(h+3864292196|0)^size,h=Math__imul(h^h>>>16,2246822507),h=Math__imul(h^h>>>13,3266489909),h=smi(h^h>>>16)}function hashMerge(a,b){return a^b+2654435769+(a<<6)+(a>>2)|0}var SLICE$0=Array.prototype.slice,DELETE="delete",SHIFT=5,SIZE=1<<SHIFT,MASK=SIZE-1,NOT_SET={},CHANGE_LENGTH={value:!1},DID_ALTER={value:!1};createClass(KeyedIterable,Iterable),createClass(IndexedIterable,Iterable),createClass(SetIterable,Iterable),Iterable.isIterable=isIterable,Iterable.isKeyed=isKeyed,Iterable.isIndexed=isIndexed,Iterable.isAssociative=isAssociative,Iterable.isOrdered=isOrdered,Iterable.Keyed=KeyedIterable,Iterable.Indexed=IndexedIterable,Iterable.Set=SetIterable;var IS_ITERABLE_SENTINEL="@@__IMMUTABLE_ITERABLE__@@",IS_KEYED_SENTINEL="@@__IMMUTABLE_KEYED__@@",IS_INDEXED_SENTINEL="@@__IMMUTABLE_INDEXED__@@",IS_ORDERED_SENTINEL="@@__IMMUTABLE_ORDERED__@@",ITERATE_KEYS=0,ITERATE_VALUES=1,ITERATE_ENTRIES=2,REAL_ITERATOR_SYMBOL="function"==typeof Symbol&&Symbol.iterator,FAUX_ITERATOR_SYMBOL="@@iterator",ITERATOR_SYMBOL=REAL_ITERATOR_SYMBOL||FAUX_ITERATOR_SYMBOL;Iterator.prototype.toString=function(){return"[Iterator]"},Iterator.KEYS=ITERATE_KEYS,Iterator.VALUES=ITERATE_VALUES,Iterator.ENTRIES=ITERATE_ENTRIES,Iterator.prototype.inspect=Iterator.prototype.toSource=function(){return this.toString()},Iterator.prototype[ITERATOR_SYMBOL]=function(){return this},createClass(Seq,Iterable),Seq.of=function(){return Seq(arguments)},Seq.prototype.toSeq=function(){return this},Seq.prototype.toString=function(){return this.__toString("Seq {","}")},Seq.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},Seq.prototype.__iterate=function(fn,reverse){return seqIterate(this,fn,reverse,!0)},Seq.prototype.__iterator=function(type,reverse){return seqIterator(this,type,reverse,!0)},createClass(KeyedSeq,Seq),KeyedSeq.of=function(){return KeyedSeq(arguments)},KeyedSeq.prototype.toKeyedSeq=function(){return this},KeyedSeq.prototype.toSeq=function(){return this},createClass(IndexedSeq,Seq),IndexedSeq.of=function(){return IndexedSeq(arguments)},IndexedSeq.prototype.toIndexedSeq=function(){return this},IndexedSeq.prototype.toString=function(){return this.__toString("Seq [","]")},IndexedSeq.prototype.__iterate=function(fn,reverse){return seqIterate(this,fn,reverse,!1)},IndexedSeq.prototype.__iterator=function(type,reverse){return seqIterator(this,type,reverse,!1)},createClass(SetSeq,Seq),SetSeq.of=function(){return SetSeq(arguments)},SetSeq.prototype.toSetSeq=function(){return this},Seq.isSeq=isSeq,Seq.Keyed=KeyedSeq,Seq.Set=SetSeq,Seq.Indexed=IndexedSeq;var IS_SEQ_SENTINEL="@@__IMMUTABLE_SEQ__@@";Seq.prototype[IS_SEQ_SENTINEL]=!0,createClass(ArraySeq,IndexedSeq),ArraySeq.prototype.get=function(index,notSetValue){return this.has(index)?this._array[wrapIndex(this,index)]:notSetValue},ArraySeq.prototype.__iterate=function(fn,reverse){for(var array=this._array,maxIndex=array.length-1,ii=0;maxIndex>=ii;ii++)if(fn(array[reverse?maxIndex-ii:ii],ii,this)===!1)return ii+1;return ii},ArraySeq.prototype.__iterator=function(type,reverse){var array=this._array,maxIndex=array.length-1,ii=0;return new Iterator(function(){return ii>maxIndex?iteratorDone():iteratorValue(type,ii,array[reverse?maxIndex-ii++:ii++])})},createClass(ObjectSeq,KeyedSeq),ObjectSeq.prototype.get=function(key,notSetValue){return void 0===notSetValue||this.has(key)?this._object[key]:notSetValue},ObjectSeq.prototype.has=function(key){return this._object.hasOwnProperty(key)},ObjectSeq.prototype.__iterate=function(fn,reverse){for(var object=this._object,keys=this._keys,maxIndex=keys.length-1,ii=0;maxIndex>=ii;ii++){var key=keys[reverse?maxIndex-ii:ii];if(fn(object[key],key,this)===!1)return ii+1}return ii},ObjectSeq.prototype.__iterator=function(type,reverse){var object=this._object,keys=this._keys,maxIndex=keys.length-1,ii=0;return new Iterator(function(){var key=keys[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,key,object[key])})},ObjectSeq.prototype[IS_ORDERED_SENTINEL]=!0,createClass(IterableSeq,IndexedSeq),IterableSeq.prototype.__iterateUncached=function(fn,reverse){if(reverse)return this.cacheResult().__iterate(fn,reverse);var iterable=this._iterable,iterator=getIterator(iterable),iterations=0;if(isIterator(iterator))for(var step;!(step=iterator.next()).done&&fn(step.value,iterations++,this)!==!1;);return iterations},IterableSeq.prototype.__iteratorUncached=function(type,reverse){if(reverse)return this.cacheResult().__iterator(type,reverse);var iterable=this._iterable,iterator=getIterator(iterable);if(!isIterator(iterator))return new Iterator(iteratorDone);var iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value)})},createClass(IteratorSeq,IndexedSeq),IteratorSeq.prototype.__iterateUncached=function(fn,reverse){if(reverse)return this.cacheResult().__iterate(fn,reverse);for(var iterator=this._iterator,cache=this._iteratorCache,iterations=0;iterations<cache.length;)if(fn(cache[iterations],iterations++,this)===!1)return iterations;for(var step;!(step=iterator.next()).done;){var val=step.value;if(cache[iterations]=val,fn(val,iterations++,this)===!1)break}return iterations},IteratorSeq.prototype.__iteratorUncached=function(type,reverse){if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=this._iterator,cache=this._iteratorCache,iterations=0;return new Iterator(function(){if(iterations>=cache.length){var step=iterator.next();if(step.done)return step;cache[iterations]=step.value}return iteratorValue(type,iterations,cache[iterations++])})};var EMPTY_SEQ;createClass(Collection,Iterable),createClass(KeyedCollection,Collection),createClass(IndexedCollection,Collection),createClass(SetCollection,Collection),Collection.Keyed=KeyedCollection,Collection.Indexed=IndexedCollection,Collection.Set=SetCollection;var Math__imul="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(a,b){a=0|a,b=0|b;var c=65535&a,d=65535&b;return c*d+((a>>>16)*d+c*(b>>>16)<<16>>>0)|0},canDefineProperty=function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),weakMap="function"==typeof WeakMap&&new WeakMap,objHashUID=0,UID_HASH_KEY="__immutablehash__";"function"==typeof Symbol&&(UID_HASH_KEY=Symbol(UID_HASH_KEY));var STRING_HASH_CACHE_MIN_STRLEN=16,STRING_HASH_CACHE_MAX_SIZE=255,STRING_HASH_CACHE_SIZE=0,stringHashCache={};createClass(ToKeyedSequence,KeyedSeq),ToKeyedSequence.prototype.get=function(key,notSetValue){return this._iter.get(key,notSetValue)},ToKeyedSequence.prototype.has=function(key){return this._iter.has(key)},ToKeyedSequence.prototype.valueSeq=function(){return this._iter.valueSeq()},ToKeyedSequence.prototype.reverse=function(){var this$0=this,reversedSequence=reverseFactory(this,!0);return this._useKeys||(reversedSequence.valueSeq=function(){return this$0._iter.toSeq().reverse()}),reversedSequence},ToKeyedSequence.prototype.map=function(mapper,context){var this$0=this,mappedSequence=mapFactory(this,mapper,context);return this._useKeys||(mappedSequence.valueSeq=function(){return this$0._iter.toSeq().map(mapper,context)}),mappedSequence},ToKeyedSequence.prototype.__iterate=function(fn,reverse){var ii,this$0=this;return this._iter.__iterate(this._useKeys?function(v,k){return fn(v,k,this$0)}:(ii=reverse?resolveSize(this):0,function(v){return fn(v,reverse?--ii:ii++,this$0)}),reverse)},ToKeyedSequence.prototype.__iterator=function(type,reverse){if(this._useKeys)return this._iter.__iterator(type,reverse);var iterator=this._iter.__iterator(ITERATE_VALUES,reverse),ii=reverse?resolveSize(this):0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,reverse?--ii:ii++,step.value,step)})},ToKeyedSequence.prototype[IS_ORDERED_SENTINEL]=!0,createClass(ToIndexedSequence,IndexedSeq),ToIndexedSequence.prototype.contains=function(value){return this._iter.contains(value)},ToIndexedSequence.prototype.__iterate=function(fn,reverse){var this$0=this,iterations=0;return this._iter.__iterate(function(v){return fn(v,iterations++,this$0)},reverse)},ToIndexedSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse),iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value,step)})},createClass(ToSetSequence,SetSeq),ToSetSequence.prototype.has=function(key){return this._iter.contains(key)},ToSetSequence.prototype.__iterate=function(fn,reverse){var this$0=this;return this._iter.__iterate(function(v){return fn(v,v,this$0)},reverse)},ToSetSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,step.value,step.value,step)})},createClass(FromEntriesSequence,KeyedSeq),FromEntriesSequence.prototype.entrySeq=function(){return this._iter.toSeq()},FromEntriesSequence.prototype.__iterate=function(fn,reverse){var this$0=this;return this._iter.__iterate(function(entry){return entry?(validateEntry(entry),fn(entry[1],entry[0],this$0)):void 0},reverse)},FromEntriesSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){for(;;){var step=iterator.next();if(step.done)return step;var entry=step.value;if(entry)return validateEntry(entry),type===ITERATE_ENTRIES?step:iteratorValue(type,entry[0],entry[1],step)}})},ToIndexedSequence.prototype.cacheResult=ToKeyedSequence.prototype.cacheResult=ToSetSequence.prototype.cacheResult=FromEntriesSequence.prototype.cacheResult=cacheResultThrough,createClass(Map,KeyedCollection),Map.prototype.toString=function(){return this.__toString("Map {","}")},Map.prototype.get=function(k,notSetValue){return this._root?this._root.get(0,void 0,k,notSetValue):notSetValue},Map.prototype.set=function(k,v){return updateMap(this,k,v)},Map.prototype.setIn=function(keyPath,v){return this.updateIn(keyPath,NOT_SET,function(){return v})},Map.prototype.remove=function(k){return updateMap(this,k,NOT_SET)},Map.prototype.deleteIn=function(keyPath){return this.updateIn(keyPath,function(){return NOT_SET})},Map.prototype.update=function(k,notSetValue,updater){return 1===arguments.length?k(this):this.updateIn([k],notSetValue,updater)},Map.prototype.updateIn=function(keyPath,notSetValue,updater){updater||(updater=notSetValue,notSetValue=void 0);var updatedValue=updateInDeepMap(this,forceIterator(keyPath),notSetValue,updater);return updatedValue===NOT_SET?void 0:updatedValue},Map.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):emptyMap()},Map.prototype.merge=function(){return mergeIntoMapWith(this,void 0,arguments)},Map.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoMapWith(this,merger,iters)},Map.prototype.mergeIn=function(keyPath){var iters=SLICE$0.call(arguments,1);return this.updateIn(keyPath,emptyMap(),function(m){return m.merge.apply(m,iters)})},Map.prototype.mergeDeep=function(){return mergeIntoMapWith(this,deepMerger(void 0),arguments)},Map.prototype.mergeDeepWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoMapWith(this,deepMerger(merger),iters)},Map.prototype.mergeDeepIn=function(keyPath){var iters=SLICE$0.call(arguments,1);return this.updateIn(keyPath,emptyMap(),function(m){return m.mergeDeep.apply(m,iters)})},Map.prototype.sort=function(comparator){return OrderedMap(sortFactory(this,comparator))},Map.prototype.sortBy=function(mapper,comparator){return OrderedMap(sortFactory(this,comparator,mapper))},Map.prototype.withMutations=function(fn){var mutable=this.asMutable();return fn(mutable),mutable.wasAltered()?mutable.__ensureOwner(this.__ownerID):this},Map.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)},Map.prototype.asImmutable=function(){return this.__ensureOwner()},Map.prototype.wasAltered=function(){return this.__altered},Map.prototype.__iterator=function(type,reverse){return new MapIterator(this,type,reverse)},Map.prototype.__iterate=function(fn,reverse){var this$0=this,iterations=0;
return this._root&&this._root.iterate(function(entry){return iterations++,fn(entry[1],entry[0],this$0)},reverse),iterations},Map.prototype.__ensureOwner=function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeMap(this.size,this._root,ownerID,this.__hash):(this.__ownerID=ownerID,this.__altered=!1,this)},Map.isMap=isMap;var IS_MAP_SENTINEL="@@__IMMUTABLE_MAP__@@",MapPrototype=Map.prototype;MapPrototype[IS_MAP_SENTINEL]=!0,MapPrototype[DELETE]=MapPrototype.remove,MapPrototype.removeIn=MapPrototype.deleteIn,ArrayMapNode.prototype.get=function(shift,keyHash,key,notSetValue){for(var entries=this.entries,ii=0,len=entries.length;len>ii;ii++)if(is(key,entries[ii][0]))return entries[ii][1];return notSetValue},ArrayMapNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){for(var removed=value===NOT_SET,entries=this.entries,idx=0,len=entries.length;len>idx&&!is(key,entries[idx][0]);idx++);var exists=len>idx;if(exists?entries[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),!removed||1!==entries.length){if(!exists&&!removed&&entries.length>=MAX_ARRAY_MAP_SIZE)return createNodes(ownerID,entries,key,value);var isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries:arrCopy(entries);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new ArrayMapNode(ownerID,newEntries)}},BitmapIndexedNode.prototype.get=function(shift,keyHash,key,notSetValue){void 0===keyHash&&(keyHash=hash(key));var bit=1<<((0===shift?keyHash:keyHash>>>shift)&MASK),bitmap=this.bitmap;return 0===(bitmap&bit)?notSetValue:this.nodes[popCount(bitmap&bit-1)].get(shift+SHIFT,keyHash,key,notSetValue)},BitmapIndexedNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));var keyHashFrag=(0===shift?keyHash:keyHash>>>shift)&MASK,bit=1<<keyHashFrag,bitmap=this.bitmap,exists=0!==(bitmap&bit);if(!exists&&value===NOT_SET)return this;var idx=popCount(bitmap&bit-1),nodes=this.nodes,node=exists?nodes[idx]:void 0,newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node)return this;if(!exists&&newNode&&nodes.length>=MAX_BITMAP_INDEXED_SIZE)return expandNodes(ownerID,nodes,bitmap,keyHashFrag,newNode);if(exists&&!newNode&&2===nodes.length&&isLeafNode(nodes[1^idx]))return nodes[1^idx];if(exists&&newNode&&1===nodes.length&&isLeafNode(newNode))return newNode;var isEditable=ownerID&&ownerID===this.ownerID,newBitmap=exists?newNode?bitmap:bitmap^bit:bitmap|bit,newNodes=exists?newNode?setIn(nodes,idx,newNode,isEditable):spliceOut(nodes,idx,isEditable):spliceIn(nodes,idx,newNode,isEditable);return isEditable?(this.bitmap=newBitmap,this.nodes=newNodes,this):new BitmapIndexedNode(ownerID,newBitmap,newNodes)},HashArrayMapNode.prototype.get=function(shift,keyHash,key,notSetValue){void 0===keyHash&&(keyHash=hash(key));var idx=(0===shift?keyHash:keyHash>>>shift)&MASK,node=this.nodes[idx];return node?node.get(shift+SHIFT,keyHash,key,notSetValue):notSetValue},HashArrayMapNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));var idx=(0===shift?keyHash:keyHash>>>shift)&MASK,removed=value===NOT_SET,nodes=this.nodes,node=nodes[idx];if(removed&&!node)return this;var newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node)return this;var newCount=this.count;if(node){if(!newNode&&(newCount--,MIN_HASH_ARRAY_MAP_SIZE>newCount))return packNodes(ownerID,nodes,newCount,idx)}else newCount++;var isEditable=ownerID&&ownerID===this.ownerID,newNodes=setIn(nodes,idx,newNode,isEditable);return isEditable?(this.count=newCount,this.nodes=newNodes,this):new HashArrayMapNode(ownerID,newCount,newNodes)},HashCollisionNode.prototype.get=function(shift,keyHash,key,notSetValue){for(var entries=this.entries,ii=0,len=entries.length;len>ii;ii++)if(is(key,entries[ii][0]))return entries[ii][1];return notSetValue},HashCollisionNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));var removed=value===NOT_SET;if(keyHash!==this.keyHash)return removed?this:(SetRef(didAlter),SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,keyHash,[key,value]));for(var entries=this.entries,idx=0,len=entries.length;len>idx&&!is(key,entries[idx][0]);idx++);var exists=len>idx;if(exists?entries[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),removed&&2===len)return new ValueNode(ownerID,this.keyHash,entries[1^idx]);var isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries:arrCopy(entries);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new HashCollisionNode(ownerID,this.keyHash,newEntries)},ValueNode.prototype.get=function(shift,keyHash,key,notSetValue){return is(key,this.entry[0])?this.entry[1]:notSetValue},ValueNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){var removed=value===NOT_SET,keyMatch=is(key,this.entry[0]);return(keyMatch?value===this.entry[1]:removed)?this:(SetRef(didAlter),removed?void SetRef(didChangeSize):keyMatch?ownerID&&ownerID===this.ownerID?(this.entry[1]=value,this):new ValueNode(ownerID,this.keyHash,[key,value]):(SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,hash(key),[key,value])))},ArrayMapNode.prototype.iterate=HashCollisionNode.prototype.iterate=function(fn,reverse){for(var entries=this.entries,ii=0,maxIndex=entries.length-1;maxIndex>=ii;ii++)if(fn(entries[reverse?maxIndex-ii:ii])===!1)return!1},BitmapIndexedNode.prototype.iterate=HashArrayMapNode.prototype.iterate=function(fn,reverse){for(var nodes=this.nodes,ii=0,maxIndex=nodes.length-1;maxIndex>=ii;ii++){var node=nodes[reverse?maxIndex-ii:ii];if(node&&node.iterate(fn,reverse)===!1)return!1}},ValueNode.prototype.iterate=function(fn){return fn(this.entry)},createClass(MapIterator,Iterator),MapIterator.prototype.next=function(){for(var type=this._type,stack=this._stack;stack;){var maxIndex,node=stack.node,index=stack.index++;if(node.entry){if(0===index)return mapIteratorValue(type,node.entry)}else if(node.entries){if(maxIndex=node.entries.length-1,maxIndex>=index)return mapIteratorValue(type,node.entries[this._reverse?maxIndex-index:index])}else if(maxIndex=node.nodes.length-1,maxIndex>=index){var subNode=node.nodes[this._reverse?maxIndex-index:index];if(subNode){if(subNode.entry)return mapIteratorValue(type,subNode.entry);stack=this._stack=mapIteratorFrame(subNode,stack)}continue}stack=this._stack=this._stack.__prev}return iteratorDone()};var EMPTY_MAP,MAX_ARRAY_MAP_SIZE=SIZE/4,MAX_BITMAP_INDEXED_SIZE=SIZE/2,MIN_HASH_ARRAY_MAP_SIZE=SIZE/4;createClass(List,IndexedCollection),List.of=function(){return this(arguments)},List.prototype.toString=function(){return this.__toString("List [","]")},List.prototype.get=function(index,notSetValue){if(index=wrapIndex(this,index),0>index||index>=this.size)return notSetValue;index+=this._origin;var node=listNodeFor(this,index);return node&&node.array[index&MASK]},List.prototype.set=function(index,value){return updateList(this,index,value)},List.prototype.remove=function(index){return this.has(index)?0===index?this.shift():index===this.size-1?this.pop():this.splice(index,1):this},List.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=SHIFT,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):emptyList()},List.prototype.push=function(){var values=arguments,oldSize=this.size;return this.withMutations(function(list){setListBounds(list,0,oldSize+values.length);for(var ii=0;ii<values.length;ii++)list.set(oldSize+ii,values[ii])})},List.prototype.pop=function(){return setListBounds(this,0,-1)},List.prototype.unshift=function(){var values=arguments;return this.withMutations(function(list){setListBounds(list,-values.length);for(var ii=0;ii<values.length;ii++)list.set(ii,values[ii])})},List.prototype.shift=function(){return setListBounds(this,1)},List.prototype.merge=function(){return mergeIntoListWith(this,void 0,arguments)},List.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoListWith(this,merger,iters)},List.prototype.mergeDeep=function(){return mergeIntoListWith(this,deepMerger(void 0),arguments)},List.prototype.mergeDeepWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoListWith(this,deepMerger(merger),iters)},List.prototype.setSize=function(size){return setListBounds(this,0,size)},List.prototype.slice=function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:setListBounds(this,resolveBegin(begin,size),resolveEnd(end,size))},List.prototype.__iterator=function(type,reverse){var index=0,values=iterateList(this,reverse);return new Iterator(function(){var value=values();return value===DONE?iteratorDone():iteratorValue(type,index++,value)})},List.prototype.__iterate=function(fn,reverse){for(var value,index=0,values=iterateList(this,reverse);(value=values())!==DONE&&fn(value,index++,this)!==!1;);return index},List.prototype.__ensureOwner=function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeList(this._origin,this._capacity,this._level,this._root,this._tail,ownerID,this.__hash):(this.__ownerID=ownerID,this)},List.isList=isList;var IS_LIST_SENTINEL="@@__IMMUTABLE_LIST__@@",ListPrototype=List.prototype;ListPrototype[IS_LIST_SENTINEL]=!0,ListPrototype[DELETE]=ListPrototype.remove,ListPrototype.setIn=MapPrototype.setIn,ListPrototype.deleteIn=ListPrototype.removeIn=MapPrototype.removeIn,ListPrototype.update=MapPrototype.update,ListPrototype.updateIn=MapPrototype.updateIn,ListPrototype.mergeIn=MapPrototype.mergeIn,ListPrototype.mergeDeepIn=MapPrototype.mergeDeepIn,ListPrototype.withMutations=MapPrototype.withMutations,ListPrototype.asMutable=MapPrototype.asMutable,ListPrototype.asImmutable=MapPrototype.asImmutable,ListPrototype.wasAltered=MapPrototype.wasAltered,VNode.prototype.removeBefore=function(ownerID,level,index){if(index===level?1<<level:0||0===this.array.length)return this;var originIndex=index>>>level&MASK;if(originIndex>=this.array.length)return new VNode([],ownerID);var newChild,removingFirst=0===originIndex;if(level>0){var oldChild=this.array[originIndex];if(newChild=oldChild&&oldChild.removeBefore(ownerID,level-SHIFT,index),newChild===oldChild&&removingFirst)return this}if(removingFirst&&!newChild)return this;var editable=editableVNode(this,ownerID);if(!removingFirst)for(var ii=0;originIndex>ii;ii++)editable.array[ii]=void 0;return newChild&&(editable.array[originIndex]=newChild),editable},VNode.prototype.removeAfter=function(ownerID,level,index){if(index===level?1<<level:0||0===this.array.length)return this;var sizeIndex=index-1>>>level&MASK;if(sizeIndex>=this.array.length)return this;var newChild,removingLast=sizeIndex===this.array.length-1;if(level>0){var oldChild=this.array[sizeIndex];if(newChild=oldChild&&oldChild.removeAfter(ownerID,level-SHIFT,index),newChild===oldChild&&removingLast)return this}if(removingLast&&!newChild)return this;var editable=editableVNode(this,ownerID);return removingLast||editable.array.pop(),newChild&&(editable.array[sizeIndex]=newChild),editable};var EMPTY_LIST,DONE={};createClass(OrderedMap,Map),OrderedMap.of=function(){return this(arguments)},OrderedMap.prototype.toString=function(){return this.__toString("OrderedMap {","}")},OrderedMap.prototype.get=function(k,notSetValue){var index=this._map.get(k);return void 0!==index?this._list.get(index)[1]:notSetValue},OrderedMap.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):emptyOrderedMap()},OrderedMap.prototype.set=function(k,v){return updateOrderedMap(this,k,v)},OrderedMap.prototype.remove=function(k){return updateOrderedMap(this,k,NOT_SET)},OrderedMap.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},OrderedMap.prototype.__iterate=function(fn,reverse){var this$0=this;return this._list.__iterate(function(entry){return entry&&fn(entry[1],entry[0],this$0)},reverse)},OrderedMap.prototype.__iterator=function(type,reverse){return this._list.fromEntrySeq().__iterator(type,reverse)},OrderedMap.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map.__ensureOwner(ownerID),newList=this._list.__ensureOwner(ownerID);return ownerID?makeOrderedMap(newMap,newList,ownerID,this.__hash):(this.__ownerID=ownerID,this._map=newMap,this._list=newList,this)},OrderedMap.isOrderedMap=isOrderedMap,OrderedMap.prototype[IS_ORDERED_SENTINEL]=!0,OrderedMap.prototype[DELETE]=OrderedMap.prototype.remove;var EMPTY_ORDERED_MAP;createClass(Stack,IndexedCollection),Stack.of=function(){return this(arguments)},Stack.prototype.toString=function(){return this.__toString("Stack [","]")},Stack.prototype.get=function(index,notSetValue){for(var head=this._head;head&&index--;)head=head.next;return head?head.value:notSetValue},Stack.prototype.peek=function(){return this._head&&this._head.value},Stack.prototype.push=function(){if(0===arguments.length)return this;for(var newSize=this.size+arguments.length,head=this._head,ii=arguments.length-1;ii>=0;ii--)head={value:arguments[ii],next:head};return this.__ownerID?(this.size=newSize,this._head=head,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head)},Stack.prototype.pushAll=function(iter){if(iter=IndexedIterable(iter),0===iter.size)return this;assertNotInfinite(iter.size);var newSize=this.size,head=this._head;return iter.reverse().forEach(function(value){newSize++,head={value:value,next:head}}),this.__ownerID?(this.size=newSize,this._head=head,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head)},Stack.prototype.pop=function(){return this.slice(1)},Stack.prototype.unshift=function(){return this.push.apply(this,arguments)},Stack.prototype.unshiftAll=function(iter){return this.pushAll(iter)},Stack.prototype.shift=function(){return this.pop.apply(this,arguments)},Stack.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):emptyStack()},Stack.prototype.slice=function(begin,end){if(wholeSlice(begin,end,this.size))return this;var resolvedBegin=resolveBegin(begin,this.size),resolvedEnd=resolveEnd(end,this.size);if(resolvedEnd!==this.size)return IndexedCollection.prototype.slice.call(this,begin,end);for(var newSize=this.size-resolvedBegin,head=this._head;resolvedBegin--;)head=head.next;return this.__ownerID?(this.size=newSize,this._head=head,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head)},Stack.prototype.__ensureOwner=function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeStack(this.size,this._head,ownerID,this.__hash):(this.__ownerID=ownerID,this.__altered=!1,this)},Stack.prototype.__iterate=function(fn,reverse){if(reverse)return this.toSeq().cacheResult.__iterate(fn,reverse);for(var iterations=0,node=this._head;node&&fn(node.value,iterations++,this)!==!1;)node=node.next;return iterations},Stack.prototype.__iterator=function(type,reverse){if(reverse)return this.toSeq().cacheResult().__iterator(type,reverse);var iterations=0,node=this._head;return new Iterator(function(){if(node){var value=node.value;return node=node.next,iteratorValue(type,iterations++,value)}return iteratorDone()})},Stack.isStack=isStack;var IS_STACK_SENTINEL="@@__IMMUTABLE_STACK__@@",StackPrototype=Stack.prototype;StackPrototype[IS_STACK_SENTINEL]=!0,StackPrototype.withMutations=MapPrototype.withMutations,StackPrototype.asMutable=MapPrototype.asMutable,StackPrototype.asImmutable=MapPrototype.asImmutable,StackPrototype.wasAltered=MapPrototype.wasAltered;var EMPTY_STACK;createClass(Set,SetCollection),Set.of=function(){return this(arguments)},Set.fromKeys=function(value){return this(KeyedIterable(value).keySeq())},Set.prototype.toString=function(){return this.__toString("Set {","}")},Set.prototype.has=function(value){return this._map.has(value)},Set.prototype.add=function(value){return updateSet(this,this._map.set(value,!0))},Set.prototype.remove=function(value){return updateSet(this,this._map.remove(value))},Set.prototype.clear=function(){return updateSet(this,this._map.clear())},Set.prototype.union=function(){var iters=SLICE$0.call(arguments,0);return iters=iters.filter(function(x){return 0!==x.size}),0===iters.length?this:0===this.size&&1===iters.length?this.constructor(iters[0]):this.withMutations(function(set){for(var ii=0;ii<iters.length;ii++)SetIterable(iters[ii]).forEach(function(value){return set.add(value)})})},Set.prototype.intersect=function(){var iters=SLICE$0.call(arguments,0);if(0===iters.length)return this;iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){iters.every(function(iter){return iter.contains(value)})||set.remove(value)})})},Set.prototype.subtract=function(){var iters=SLICE$0.call(arguments,0);if(0===iters.length)return this;iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){iters.some(function(iter){return iter.contains(value)})&&set.remove(value)})})},Set.prototype.merge=function(){return this.union.apply(this,arguments)},Set.prototype.mergeWith=function(){var iters=SLICE$0.call(arguments,1);return this.union.apply(this,iters)},Set.prototype.sort=function(comparator){return OrderedSet(sortFactory(this,comparator))},Set.prototype.sortBy=function(mapper,comparator){return OrderedSet(sortFactory(this,comparator,mapper))},Set.prototype.wasAltered=function(){return this._map.wasAltered()},Set.prototype.__iterate=function(fn,reverse){var this$0=this;return this._map.__iterate(function(_,k){return fn(k,k,this$0)},reverse)},Set.prototype.__iterator=function(type,reverse){return this._map.map(function(_,k){return k}).__iterator(type,reverse)},Set.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map.__ensureOwner(ownerID);return ownerID?this.__make(newMap,ownerID):(this.__ownerID=ownerID,this._map=newMap,this)},Set.isSet=isSet;var IS_SET_SENTINEL="@@__IMMUTABLE_SET__@@",SetPrototype=Set.prototype;SetPrototype[IS_SET_SENTINEL]=!0,SetPrototype[DELETE]=SetPrototype.remove,SetPrototype.mergeDeep=SetPrototype.merge,SetPrototype.mergeDeepWith=SetPrototype.mergeWith,SetPrototype.withMutations=MapPrototype.withMutations,SetPrototype.asMutable=MapPrototype.asMutable,SetPrototype.asImmutable=MapPrototype.asImmutable,SetPrototype.__empty=emptySet,SetPrototype.__make=makeSet;var EMPTY_SET;createClass(OrderedSet,Set),OrderedSet.of=function(){return this(arguments)},OrderedSet.fromKeys=function(value){return this(KeyedIterable(value).keySeq())},OrderedSet.prototype.toString=function(){return this.__toString("OrderedSet {","}")},OrderedSet.isOrderedSet=isOrderedSet;var OrderedSetPrototype=OrderedSet.prototype;OrderedSetPrototype[IS_ORDERED_SENTINEL]=!0,OrderedSetPrototype.__empty=emptyOrderedSet,OrderedSetPrototype.__make=makeOrderedSet;var EMPTY_ORDERED_SET;createClass(Record,KeyedCollection),Record.prototype.toString=function(){return this.__toString(recordName(this)+" {","}")},Record.prototype.has=function(k){return this._defaultValues.hasOwnProperty(k)},Record.prototype.get=function(k,notSetValue){if(!this.has(k))return notSetValue;var defaultVal=this._defaultValues[k];return this._map?this._map.get(k,defaultVal):defaultVal},Record.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var SuperRecord=Object.getPrototypeOf(this).constructor;return SuperRecord._empty||(SuperRecord._empty=makeRecord(this,emptyMap()))},Record.prototype.set=function(k,v){if(!this.has(k))throw new Error('Cannot set unknown key "'+k+'" on '+recordName(this));var newMap=this._map&&this._map.set(k,v);return this.__ownerID||newMap===this._map?this:makeRecord(this,newMap)},Record.prototype.remove=function(k){if(!this.has(k))return this;var newMap=this._map&&this._map.remove(k);return this.__ownerID||newMap===this._map?this:makeRecord(this,newMap)},Record.prototype.wasAltered=function(){return this._map.wasAltered()},Record.prototype.__iterator=function(type,reverse){var this$0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return this$0.get(k)}).__iterator(type,reverse)},Record.prototype.__iterate=function(fn,reverse){var this$0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return this$0.get(k)}).__iterate(fn,reverse)},Record.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map&&this._map.__ensureOwner(ownerID);return ownerID?makeRecord(this,newMap,ownerID):(this.__ownerID=ownerID,this._map=newMap,this)};var RecordPrototype=Record.prototype;RecordPrototype[DELETE]=RecordPrototype.remove,RecordPrototype.deleteIn=RecordPrototype.removeIn=MapPrototype.removeIn,RecordPrototype.merge=MapPrototype.merge,RecordPrototype.mergeWith=MapPrototype.mergeWith,RecordPrototype.mergeIn=MapPrototype.mergeIn,RecordPrototype.mergeDeep=MapPrototype.mergeDeep,RecordPrototype.mergeDeepWith=MapPrototype.mergeDeepWith,RecordPrototype.mergeDeepIn=MapPrototype.mergeDeepIn,RecordPrototype.setIn=MapPrototype.setIn,RecordPrototype.update=MapPrototype.update,RecordPrototype.updateIn=MapPrototype.updateIn,RecordPrototype.withMutations=MapPrototype.withMutations,RecordPrototype.asMutable=MapPrototype.asMutable,RecordPrototype.asImmutable=MapPrototype.asImmutable,createClass(Range,IndexedSeq),Range.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},Range.prototype.get=function(index,notSetValue){return this.has(index)?this._start+wrapIndex(this,index)*this._step:notSetValue},Range.prototype.contains=function(searchValue){var possibleIndex=(searchValue-this._start)/this._step;return possibleIndex>=0&&possibleIndex<this.size&&possibleIndex===Math.floor(possibleIndex)},Range.prototype.slice=function(begin,end){return wholeSlice(begin,end,this.size)?this:(begin=resolveBegin(begin,this.size),end=resolveEnd(end,this.size),begin>=end?new Range(0,0):new Range(this.get(begin,this._end),this.get(end,this._end),this._step))},Range.prototype.indexOf=function(searchValue){var offsetValue=searchValue-this._start;if(offsetValue%this._step===0){var index=offsetValue/this._step;if(index>=0&&index<this.size)return index}return-1},Range.prototype.lastIndexOf=function(searchValue){return this.indexOf(searchValue)},Range.prototype.__iterate=function(fn,reverse){for(var maxIndex=this.size-1,step=this._step,value=reverse?this._start+maxIndex*step:this._start,ii=0;maxIndex>=ii;ii++){if(fn(value,ii,this)===!1)return ii+1;value+=reverse?-step:step}return ii},Range.prototype.__iterator=function(type,reverse){var maxIndex=this.size-1,step=this._step,value=reverse?this._start+maxIndex*step:this._start,ii=0;return new Iterator(function(){var v=value;return value+=reverse?-step:step,ii>maxIndex?iteratorDone():iteratorValue(type,ii++,v)})},Range.prototype.equals=function(other){return other instanceof Range?this._start===other._start&&this._end===other._end&&this._step===other._step:deepEqual(this,other)};var EMPTY_RANGE;createClass(Repeat,IndexedSeq),Repeat.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Repeat.prototype.get=function(index,notSetValue){return this.has(index)?this._value:notSetValue},Repeat.prototype.contains=function(searchValue){return is(this._value,searchValue)},Repeat.prototype.slice=function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:new Repeat(this._value,resolveEnd(end,size)-resolveBegin(begin,size))},Repeat.prototype.reverse=function(){return this},Repeat.prototype.indexOf=function(searchValue){return is(this._value,searchValue)?0:-1},Repeat.prototype.lastIndexOf=function(searchValue){return is(this._value,searchValue)?this.size:-1},Repeat.prototype.__iterate=function(fn){for(var ii=0;ii<this.size;ii++)if(fn(this._value,ii,this)===!1)return ii+1;return ii},Repeat.prototype.__iterator=function(type){var this$0=this,ii=0;return new Iterator(function(){return ii<this$0.size?iteratorValue(type,ii++,this$0._value):iteratorDone()})},Repeat.prototype.equals=function(other){return other instanceof Repeat?is(this._value,other._value):deepEqual(other)};var EMPTY_REPEAT;Iterable.Iterator=Iterator,mixin(Iterable,{toArray:function(){assertNotInfinite(this.size);var array=new Array(this.size||0);return this.valueSeq().__iterate(function(v,i){array[i]=v}),array},toIndexedSeq:function(){return new ToIndexedSequence(this)},toJS:function(){return this.toSeq().map(function(value){return value&&"function"==typeof value.toJS?value.toJS():value}).__toJS()},toJSON:function(){return this.toSeq().map(function(value){return value&&"function"==typeof value.toJSON?value.toJSON():value}).__toJS()},toKeyedSeq:function(){return new ToKeyedSequence(this,!0)},toMap:function(){return Map(this.toKeyedSeq())},toObject:function(){assertNotInfinite(this.size);var object={};return this.__iterate(function(v,k){object[k]=v}),object},toOrderedMap:function(){return OrderedMap(this.toKeyedSeq())},toOrderedSet:function(){return OrderedSet(isKeyed(this)?this.valueSeq():this)},toSet:function(){return Set(isKeyed(this)?this.valueSeq():this)},toSetSeq:function(){return new ToSetSequence(this)},toSeq:function(){return isIndexed(this)?this.toIndexedSeq():isKeyed(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Stack(isKeyed(this)?this.valueSeq():this)},toList:function(){return List(isKeyed(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(head,tail){return 0===this.size?head+tail:head+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+tail},concat:function(){var values=SLICE$0.call(arguments,0);return reify(this,concatFactory(this,values))},contains:function(searchValue){return this.some(function(value){return is(value,searchValue)})},entries:function(){return this.__iterator(ITERATE_ENTRIES)},every:function(predicate,context){assertNotInfinite(this.size);var returnValue=!0;return this.__iterate(function(v,k,c){return predicate.call(context,v,k,c)?void 0:(returnValue=!1,!1)}),returnValue},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,!0))},find:function(predicate,context,notSetValue){var entry=this.findEntry(predicate,context);return entry?entry[1]:notSetValue},findEntry:function(predicate,context){var found;return this.__iterate(function(v,k,c){return predicate.call(context,v,k,c)?(found=[k,v],!1):void 0}),found},findLastEntry:function(predicate,context){return this.toSeq().reverse().findEntry(predicate,context)},forEach:function(sideEffect,context){return assertNotInfinite(this.size),this.__iterate(context?sideEffect.bind(context):sideEffect)},join:function(separator){assertNotInfinite(this.size),separator=void 0!==separator?""+separator:",";var joined="",isFirst=!0;return this.__iterate(function(v){isFirst?isFirst=!1:joined+=separator,joined+=null!==v&&void 0!==v?v:""}),joined},keys:function(){return this.__iterator(ITERATE_KEYS)},map:function(mapper,context){return reify(this,mapFactory(this,mapper,context))},reduce:function(reducer,initialReduction,context){assertNotInfinite(this.size);var reduction,useFirst;return arguments.length<2?useFirst=!0:reduction=initialReduction,this.__iterate(function(v,k,c){useFirst?(useFirst=!1,reduction=v):reduction=reducer.call(context,reduction,v,k,c)}),reduction},reduceRight:function(){var reversed=this.toKeyedSeq().reverse();return reversed.reduce.apply(reversed,arguments)},reverse:function(){return reify(this,reverseFactory(this,!0))},slice:function(begin,end){return reify(this,sliceFactory(this,begin,end,!0))},some:function(predicate,context){return!this.every(not(predicate),context)},sort:function(comparator){return reify(this,sortFactory(this,comparator))},values:function(){return this.__iterator(ITERATE_VALUES)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(predicate,context){return ensureSize(predicate?this.toSeq().filter(predicate,context):this)},countBy:function(grouper,context){return countByFactory(this,grouper,context)},equals:function(other){return deepEqual(this,other)},entrySeq:function(){var iterable=this;if(iterable._cache)return new ArraySeq(iterable._cache);var entriesSequence=iterable.toSeq().map(entryMapper).toIndexedSeq();return entriesSequence.fromEntrySeq=function(){return iterable.toSeq()},entriesSequence},filterNot:function(predicate,context){return this.filter(not(predicate),context)},findLast:function(predicate,context,notSetValue){return this.toKeyedSeq().reverse().find(predicate,context,notSetValue)},first:function(){return this.find(returnTrue)},flatMap:function(mapper,context){return reify(this,flatMapFactory(this,mapper,context))},flatten:function(depth){return reify(this,flattenFactory(this,depth,!0))},fromEntrySeq:function(){return new FromEntriesSequence(this)},get:function(searchKey,notSetValue){return this.find(function(_,key){return is(key,searchKey)},void 0,notSetValue)},getIn:function(searchKeyPath,notSetValue){for(var step,nested=this,iter=forceIterator(searchKeyPath);!(step=iter.next()).done;){var key=step.value;if(nested=nested&&nested.get?nested.get(key,NOT_SET):NOT_SET,nested===NOT_SET)return notSetValue}return nested},groupBy:function(grouper,context){return groupByFactory(this,grouper,context)},has:function(searchKey){return this.get(searchKey,NOT_SET)!==NOT_SET},hasIn:function(searchKeyPath){return this.getIn(searchKeyPath,NOT_SET)!==NOT_SET},isSubset:function(iter){return iter="function"==typeof iter.contains?iter:Iterable(iter),this.every(function(value){return iter.contains(value)})},isSuperset:function(iter){return iter.isSubset(this)},keySeq:function(){return this.toSeq().map(keyMapper).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(comparator){return maxFactory(this,comparator)},maxBy:function(mapper,comparator){return maxFactory(this,comparator,mapper)},min:function(comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator)},minBy:function(mapper,comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator,mapper)},rest:function(){return this.slice(1)},skip:function(amount){return this.slice(Math.max(0,amount))},skipLast:function(amount){return reify(this,this.toSeq().reverse().skip(amount).reverse())},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,!0))},skipUntil:function(predicate,context){return this.skipWhile(not(predicate),context)},sortBy:function(mapper,comparator){return reify(this,sortFactory(this,comparator,mapper))},take:function(amount){return this.slice(0,Math.max(0,amount))},takeLast:function(amount){return reify(this,this.toSeq().reverse().take(amount).reverse())},takeWhile:function(predicate,context){return reify(this,takeWhileFactory(this,predicate,context))},takeUntil:function(predicate,context){return this.takeWhile(not(predicate),context)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=hashIterable(this))}});var IterablePrototype=Iterable.prototype;IterablePrototype[IS_ITERABLE_SENTINEL]=!0,IterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.values,IterablePrototype.__toJS=IterablePrototype.toArray,IterablePrototype.__toStringMapper=quoteString,IterablePrototype.inspect=IterablePrototype.toSource=function(){return this.toString()
},IterablePrototype.chain=IterablePrototype.flatMap,function(){try{Object.defineProperty(IterablePrototype,"length",{get:function(){if(!Iterable.noLengthWarning){var stack;try{throw new Error}catch(error){stack=error.stack}if(-1===stack.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+stack),this.size}}})}catch(e){}}(),mixin(KeyedIterable,{flip:function(){return reify(this,flipFactory(this))},findKey:function(predicate,context){var entry=this.findEntry(predicate,context);return entry&&entry[0]},findLastKey:function(predicate,context){return this.toSeq().reverse().findKey(predicate,context)},keyOf:function(searchValue){return this.findKey(function(value){return is(value,searchValue)})},lastKeyOf:function(searchValue){return this.findLastKey(function(value){return is(value,searchValue)})},mapEntries:function(mapper,context){var this$0=this,iterations=0;return reify(this,this.toSeq().map(function(v,k){return mapper.call(context,[k,v],iterations++,this$0)}).fromEntrySeq())},mapKeys:function(mapper,context){var this$0=this;return reify(this,this.toSeq().flip().map(function(k,v){return mapper.call(context,k,v,this$0)}).flip())}});var KeyedIterablePrototype=KeyedIterable.prototype;KeyedIterablePrototype[IS_KEYED_SENTINEL]=!0,KeyedIterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.entries,KeyedIterablePrototype.__toJS=IterablePrototype.toObject,KeyedIterablePrototype.__toStringMapper=function(v,k){return k+": "+quoteString(v)},mixin(IndexedIterable,{toKeyedSeq:function(){return new ToKeyedSequence(this,!1)},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,!1))},findIndex:function(predicate,context){var entry=this.findEntry(predicate,context);return entry?entry[0]:-1},indexOf:function(searchValue){var key=this.toKeyedSeq().keyOf(searchValue);return void 0===key?-1:key},lastIndexOf:function(searchValue){return this.toSeq().reverse().indexOf(searchValue)},reverse:function(){return reify(this,reverseFactory(this,!1))},slice:function(begin,end){return reify(this,sliceFactory(this,begin,end,!1))},splice:function(index,removeNum){var numArgs=arguments.length;if(removeNum=Math.max(0|removeNum,0),0===numArgs||2===numArgs&&!removeNum)return this;index=resolveBegin(index,this.size);var spliced=this.slice(0,index);return reify(this,1===numArgs?spliced:spliced.concat(arrCopy(arguments,2),this.slice(index+removeNum)))},findLastIndex:function(predicate,context){var key=this.toKeyedSeq().findLastKey(predicate,context);return void 0===key?-1:key},first:function(){return this.get(0)},flatten:function(depth){return reify(this,flattenFactory(this,depth,!1))},get:function(index,notSetValue){return index=wrapIndex(this,index),0>index||1/0===this.size||void 0!==this.size&&index>this.size?notSetValue:this.find(function(_,key){return key===index},void 0,notSetValue)},has:function(index){return index=wrapIndex(this,index),index>=0&&(void 0!==this.size?1/0===this.size||index<this.size:-1!==this.indexOf(index))},interpose:function(separator){return reify(this,interposeFactory(this,separator))},interleave:function(){var iterables=[this].concat(arrCopy(arguments)),zipped=zipWithFactory(this.toSeq(),IndexedSeq.of,iterables),interleaved=zipped.flatten(!0);return zipped.size&&(interleaved.size=zipped.size*iterables.length),reify(this,interleaved)},last:function(){return this.get(-1)},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,!1))},zip:function(){var iterables=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,iterables))},zipWith:function(zipper){var iterables=arrCopy(arguments);return iterables[0]=this,reify(this,zipWithFactory(this,zipper,iterables))}}),IndexedIterable.prototype[IS_INDEXED_SENTINEL]=!0,IndexedIterable.prototype[IS_ORDERED_SENTINEL]=!0,mixin(SetIterable,{get:function(value,notSetValue){return this.has(value)?value:notSetValue},contains:function(value){return this.has(value)},keySeq:function(){return this.valueSeq()}}),SetIterable.prototype.has=IterablePrototype.contains,mixin(KeyedSeq,KeyedIterable.prototype),mixin(IndexedSeq,IndexedIterable.prototype),mixin(SetSeq,SetIterable.prototype),mixin(KeyedCollection,KeyedIterable.prototype),mixin(IndexedCollection,IndexedIterable.prototype),mixin(SetCollection,SetIterable.prototype);var Immutable={Iterable:Iterable,Seq:Seq,Collection:Collection,Map:Map,OrderedMap:OrderedMap,List:List,Stack:Stack,Set:Set,OrderedSet:OrderedSet,Record:Record,Range:Range,Repeat:Repeat,is:is,fromJS:fromJS};return Immutable})},{}],89:[function(require,module){function main(initialState,view,opts){function update(state){if(inRenderingTransaction)throw InvalidUpdateInRender({diff:state._diff,stringDiff:JSON.stringify(state._diff)});null!==currentState||redrawScheduled||(redrawScheduled=!0,raf(redraw)),currentState=state}function redraw(){if(redrawScheduled=!1,null!==currentState){inRenderingTransaction=!0;var newTree=view(currentState);if(opts.createOnly)inRenderingTransaction=!1,create(newTree,opts);else{var patches=diff(tree,newTree,opts);inRenderingTransaction=!1,target=patch(target,patches,opts)}tree=newTree,currentState=null}}opts=opts||{};var currentState=initialState,create=opts.create,diff=opts.diff,patch=opts.patch,redrawScheduled=!1,tree=opts.initialTree||view(currentState),target=opts.target||create(tree,opts),inRenderingTransaction=!1;return currentState=null,{target:target,update:update}}var raf=require("raf"),TypedError=require("error/typed"),InvalidUpdateInRender=TypedError({type:"main-loop.invalid.update.in-render",message:"main-loop: Unexpected update occurred in loop.\nWe are currently rendering a view, you can't change state right now.\nThe diff is: {stringDiff}.\nSUGGESTED FIX: find the state mutation in your view or rendering function and remove it.\nThe view should not have any side effects.\n",diff:null,stringDiff:null});module.exports=main},{"error/typed":93,raf:94}],90:[function(require,module){function walk(obj){return obj&&"object"==typeof obj?isDate(obj)||isRegex(obj)?obj:isArray(obj)?map(obj,walk):reduce(objectKeys(obj),function(acc,key){var camel=camelCase(key);return acc[camel]=walk(obj[key]),acc},{}):obj}function camelCase(str){return str.replace(/[_.-](\w|$)/g,function(_,x){return x.toUpperCase()})}function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}function reduce(xs,f,acc){if(xs.reduce)return xs.reduce(f,acc);for(var i=0;i<xs.length;i++)acc=f(acc,xs[i],i);return acc}module.exports=function(obj){return"string"==typeof obj?camelCase(obj):walk(obj)};var isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},isDate=function(obj){return"[object Date]"===Object.prototype.toString.call(obj)},isRegex=function(obj){return"[object RegExp]"===Object.prototype.toString.call(obj)},has=Object.prototype.hasOwnProperty,objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)has.call(obj,key)&&keys.push(key);return keys}},{}],91:[function(require,module){function template(string){var args;return args=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:slice.call(arguments,1),args&&args.hasOwnProperty||(args={}),string.replace(nargs,function(match,i,index){var result;return"{"===string[index-1]&&"}"===string[index+match.length]?i:(result=args.hasOwnProperty(i)?args[i]:null,null===result||void 0===result?"":result)})}var nargs=/\{([0-9a-zA-Z]+)\}/g,slice=Array.prototype.slice;module.exports=template},{}],92:[function(require,module){function extend(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}return target}module.exports=extend},{}],93:[function(require,module){function TypedError(args){function createError(opts){var result=new Error;Object.defineProperty(result,"type",{value:result.type,enumerable:!0,writable:!0,configurable:!0});var options=extend({},args,opts);return extend(result,options),result.message=template(message,options),result}if(!args)throw new Error("args is required");if(!args.type)throw new Error("args.type is required");if(!args.message)throw new Error("args.message is required");var message=args.message;if(args.type&&!args.name){var errorName=camelize(args.type)+"Error";args.name=errorName[0].toUpperCase()+errorName.substr(1)}return extend(createError,args),createError._name=args.name,createError}var camelize=require("camelize"),template=require("string-template"),extend=require("xtend/mutable");module.exports=TypedError},{camelize:90,"string-template":91,"xtend/mutable":92}],94:[function(require,module){for(var now=require("performance-now"),global="undefined"==typeof window?{}:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=global["request"+suffix],caf=global["cancel"+suffix]||global["cancelRequest"+suffix],isNative=!0,i=0;i<vendors.length&&!raf;i++)raf=global[vendors[i]+"Request"+suffix],caf=global[vendors[i]+"Cancel"+suffix]||global[vendors[i]+"CancelRequest"+suffix];if(!raf||!caf){isNative=!1;var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(callback){if(0===queue.length){var _now=now(),next=Math.max(0,frameDuration-(_now-last));last=next+_now,setTimeout(function(){var cp=queue.slice(0);queue.length=0;for(var i=0;i<cp.length;i++)if(!cp[i].cancelled)try{cp[i].callback(last)}catch(e){setTimeout(function(){throw e},0)}},Math.round(next))}return queue.push({handle:++id,callback:callback,cancelled:!1}),id},caf=function(handle){for(var i=0;i<queue.length;i++)queue[i].handle===handle&&(queue[i].cancelled=!0)}}module.exports=function(fn){return isNative?raf.call(global,function(){try{fn.apply(this,arguments)}catch(e){setTimeout(function(){throw e},0)}}):raf.call(global,fn)},module.exports.cancel=function(){caf.apply(global,arguments)}},{"performance-now":95}],95:[function(require,module){(function(process){(function(){var getNanoSeconds,hrtime,loadTime;"undefined"!=typeof performance&&null!==performance&&performance.now?module.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(module.exports=function(){return(getNanoSeconds()-loadTime)/1e6},hrtime=process.hrtime,getNanoSeconds=function(){var hr;return hr=hrtime(),1e9*hr[0]+hr[1]},loadTime=getNanoSeconds()):Date.now?(module.exports=function(){return Date.now()-loadTime},loadTime=Date.now()):(module.exports=function(){return(new Date).getTime()-loadTime},loadTime=(new Date).getTime())}).call(this)}).call(this,require("_process"))},{_process:132}],96:[function(require,module){module.exports=function(undef){var self,nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef;return self=function(str,separator,limit){if("[object RegExp]"!==Object.prototype.toString.call(separator))return nativeSplit.call(str,separator,limit);var separator2,match,lastIndex,lastLength,output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+(separator.sticky?"y":""),lastLastIndex=0,separator=new RegExp(separator.source,flags+"g");for(str+="",compliantExecNpcg||(separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags)),limit=limit===undef?-1>>>0:limit>>>0;(match=separator.exec(str))&&(lastIndex=match.index+match[0].length,!(lastIndex>lastLastIndex&&(output.push(str.slice(lastLastIndex,match.index)),!compliantExecNpcg&&match.length>1&&match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++)arguments[i]===undef&&(match[i]=undef)}),match.length>1&&match.index<str.length&&Array.prototype.push.apply(output,match.slice(1)),lastLength=match[0].length,lastLastIndex=lastIndex,output.length>=limit)));)separator.lastIndex===match.index&&separator.lastIndex++;return lastLastIndex===str.length?(lastLength||!separator.test(""))&&output.push(""):output.push(str.slice(lastLastIndex)),output.length>limit?output.slice(0,limit):output}}()},{}],97:[function(require,module){"use strict";function EvStore(elem){var hash=elem[hashKey];return hash||(hash=elem[hashKey]={}),hash}var OneVersionConstraint=require("individual/one-version"),MY_VERSION="7";OneVersionConstraint("ev-store",MY_VERSION);var hashKey="__EV_STORE_KEY@"+MY_VERSION;module.exports=EvStore},{"individual/one-version":99}],98:[function(require,module){(function(global){"use strict";function Individual(key,value){return key in root?root[key]:(root[key]=value,value)}var root="undefined"!=typeof window?window:"undefined"!=typeof global?global:{};module.exports=Individual}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],99:[function(require,module){"use strict";function OneVersion(moduleName,version,defaultValue){var key="__INDIVIDUAL_ONE_VERSION_"+moduleName,enforceKey=key+"_ENFORCE_SINGLETON",versionValue=Individual(enforceKey,version);if(versionValue!==version)throw new Error("Can only have one copy of "+moduleName+".\nYou already have version "+versionValue+" installed.\nThis means you cannot install version "+version);return Individual(key,defaultValue)}var Individual=require("./index.js");module.exports=OneVersion},{"./index.js":98}],100:[function(require,module){(function(global){var topLevel="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},minDoc=require("min-document");if("undefined"!=typeof document)module.exports=document;else{var doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"];doccy||(doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc),module.exports=doccy}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"min-document":126}],101:[function(require,module){"use strict";module.exports=function(x){return"object"==typeof x&&null!==x}},{}],102:[function(require,module){function isArray(obj){return"[object Array]"===toString.call(obj)}var nativeIsArray=Array.isArray,toString=Object.prototype.toString;module.exports=nativeIsArray||isArray},{}],103:[function(require,module){function applyProperties(node,props,previous){for(var propName in props){var propValue=props[propName];void 0===propValue?removeProperty(node,propName,propValue,previous):isHook(propValue)?(removeProperty(node,propName,propValue,previous),propValue.hook&&propValue.hook(node,propName,previous?previous[propName]:void 0)):isObject(propValue)?patchObject(node,props,previous,propName,propValue):node[propName]=propValue}}function removeProperty(node,propName,propValue,previous){if(previous){var previousValue=previous[propName];if(isHook(previousValue))previousValue.unhook&&previousValue.unhook(node,propName,propValue);else if("attributes"===propName)for(var attrName in previousValue)node.removeAttribute(attrName);else if("style"===propName)for(var i in previousValue)node.style[i]="";else node[propName]="string"==typeof previousValue?"":null}}function patchObject(node,props,previous,propName,propValue){var previousValue=previous?previous[propName]:void 0;if("attributes"!==propName){if(previousValue&&isObject(previousValue)&&getPrototype(previousValue)!==getPrototype(propValue))return void(node[propName]=propValue);isObject(node[propName])||(node[propName]={});var replacer="style"===propName?"":void 0;for(var k in propValue){var value=propValue[k];node[propName][k]=void 0===value?replacer:value}}else for(var attrName in propValue){var attrValue=propValue[attrName];void 0===attrValue?node.removeAttribute(attrName):node.setAttribute(attrName,attrValue)}}function getPrototype(value){return Object.getPrototypeOf?Object.getPrototypeOf(value):value.__proto__?value.__proto__:value.constructor?value.constructor.prototype:void 0}var isObject=require("is-object"),isHook=require("../vnode/is-vhook.js");module.exports=applyProperties},{"../vnode/is-vhook.js":115,"is-object":101}],104:[function(require,module){function createElement(vnode,opts){var doc=opts?opts.document||document:document,warn=opts?opts.warn:null;if(vnode=handleThunk(vnode).a,isWidget(vnode))return vnode.init();if(isVText(vnode))return doc.createTextNode(vnode.text);if(!isVNode(vnode))return warn&&warn("Item is not a valid virtual dom node",vnode),null;var node=null===vnode.namespace?doc.createElement(vnode.tagName):doc.createElementNS(vnode.namespace,vnode.tagName),props=vnode.properties;applyProperties(node,props);for(var children=vnode.children,i=0;i<children.length;i++){var childNode=createElement(children[i],opts);childNode&&node.appendChild(childNode)}return node}var document=require("global/document"),applyProperties=require("./apply-properties"),isVNode=require("../vnode/is-vnode.js"),isVText=require("../vnode/is-vtext.js"),isWidget=require("../vnode/is-widget.js"),handleThunk=require("../vnode/handle-thunk.js");module.exports=createElement},{"../vnode/handle-thunk.js":113,"../vnode/is-vnode.js":116,"../vnode/is-vtext.js":117,"../vnode/is-widget.js":118,"./apply-properties":103,"global/document":100}],105:[function(require,module){function domIndex(rootNode,tree,indices,nodes){return indices&&0!==indices.length?(indices.sort(ascending),recurse(rootNode,tree,indices,nodes,0)):{}}function recurse(rootNode,tree,indices,nodes,rootIndex){if(nodes=nodes||{},rootNode){indexInRange(indices,rootIndex,rootIndex)&&(nodes[rootIndex]=rootNode);var vChildren=tree.children;if(vChildren)for(var childNodes=rootNode.childNodes,i=0;i<tree.children.length;i++){rootIndex+=1;var vChild=vChildren[i]||noChild,nextIndex=rootIndex+(vChild.count||0);indexInRange(indices,rootIndex,nextIndex)&&recurse(childNodes[i],vChild,indices,nodes,rootIndex),rootIndex=nextIndex}}return nodes}function indexInRange(indices,left,right){if(0===indices.length)return!1;for(var currentIndex,currentItem,minIndex=0,maxIndex=indices.length-1;maxIndex>=minIndex;){if(currentIndex=(maxIndex+minIndex)/2>>0,currentItem=indices[currentIndex],minIndex===maxIndex)return currentItem>=left&&right>=currentItem;if(left>currentItem)minIndex=currentIndex+1;else{if(!(currentItem>right))return!0;maxIndex=currentIndex-1}}return!1}function ascending(a,b){return a>b?1:-1}var noChild={};module.exports=domIndex},{}],106:[function(require,module){function applyPatch(vpatch,domNode,renderOptions){var type=vpatch.type,vNode=vpatch.vNode,patch=vpatch.patch;switch(type){case VPatch.REMOVE:return removeNode(domNode,vNode);case VPatch.INSERT:return insertNode(domNode,patch,renderOptions);case VPatch.VTEXT:return stringPatch(domNode,vNode,patch,renderOptions);case VPatch.WIDGET:return widgetPatch(domNode,vNode,patch,renderOptions);case VPatch.VNODE:return vNodePatch(domNode,vNode,patch,renderOptions);case VPatch.ORDER:return reorderChildren(domNode,patch),domNode;case VPatch.PROPS:return applyProperties(domNode,patch,vNode.properties),domNode;case VPatch.THUNK:return replaceRoot(domNode,renderOptions.patch(domNode,patch,renderOptions));default:return domNode}}function removeNode(domNode,vNode){var parentNode=domNode.parentNode;return parentNode&&parentNode.removeChild(domNode),destroyWidget(domNode,vNode),null}function insertNode(parentNode,vNode,renderOptions){var newNode=render(vNode,renderOptions);return parentNode&&parentNode.appendChild(newNode),parentNode}function stringPatch(domNode,leftVNode,vText,renderOptions){var newNode;if(3===domNode.nodeType)domNode.replaceData(0,domNode.length,vText.text),newNode=domNode;else{var parentNode=domNode.parentNode;newNode=render(vText,renderOptions),parentNode&&parentNode.replaceChild(newNode,domNode)}return newNode}function widgetPatch(domNode,leftVNode,widget,renderOptions){var newNode,updating=updateWidget(leftVNode,widget);newNode=updating?widget.update(leftVNode,domNode)||domNode:render(widget,renderOptions);var parentNode=domNode.parentNode;return parentNode&&newNode!==domNode&&parentNode.replaceChild(newNode,domNode),updating||destroyWidget(domNode,leftVNode),newNode}function vNodePatch(domNode,leftVNode,vNode,renderOptions){var parentNode=domNode.parentNode,newNode=render(vNode,renderOptions);return parentNode&&parentNode.replaceChild(newNode,domNode),newNode}function destroyWidget(domNode,w){"function"==typeof w.destroy&&isWidget(w)&&w.destroy(domNode)}function reorderChildren(domNode,bIndex){var i,children=[],childNodes=domNode.childNodes,len=childNodes.length,reverseIndex=bIndex.reverse;for(i=0;len>i;i++)children.push(domNode.childNodes[i]);var move,node,insertNode,chainLength,insertedLength,insertOffset=0;for(i=0;len>i;){if(move=bIndex[i],chainLength=1,void 0!==move&&move!==i){for(;bIndex[i+chainLength]===move+chainLength;)chainLength++;for(reverseIndex[i]>i+chainLength&&insertOffset++,node=children[move],insertNode=childNodes[i+insertOffset]||null,insertedLength=0;node!==insertNode&&insertedLength++<chainLength;)domNode.insertBefore(node,insertNode),node=children[move+insertedLength];i>move+chainLength&&insertOffset--}i in bIndex.removes&&insertOffset++,i+=chainLength}}function replaceRoot(oldRoot,newRoot){return oldRoot&&newRoot&&oldRoot!==newRoot&&oldRoot.parentNode&&(console.log(oldRoot),oldRoot.parentNode.replaceChild(newRoot,oldRoot)),newRoot}var applyProperties=require("./apply-properties"),isWidget=require("../vnode/is-widget.js"),VPatch=require("../vnode/vpatch.js"),render=require("./create-element"),updateWidget=require("./update-widget");module.exports=applyPatch},{"../vnode/is-widget.js":118,"../vnode/vpatch.js":121,"./apply-properties":103,"./create-element":104,"./update-widget":108}],107:[function(require,module){function patch(rootNode,patches){return patchRecursive(rootNode,patches)}function patchRecursive(rootNode,patches,renderOptions){var indices=patchIndices(patches);if(0===indices.length)return rootNode;var index=domIndex(rootNode,patches.a,indices),ownerDocument=rootNode.ownerDocument;renderOptions||(renderOptions={patch:patchRecursive},ownerDocument!==document&&(renderOptions.document=ownerDocument));for(var i=0;i<indices.length;i++){var nodeIndex=indices[i];rootNode=applyPatch(rootNode,index[nodeIndex],patches[nodeIndex],renderOptions)}return rootNode}function applyPatch(rootNode,domNode,patchList,renderOptions){if(!domNode)return rootNode;var newNode;if(isArray(patchList))for(var i=0;i<patchList.length;i++)newNode=patchOp(patchList[i],domNode,renderOptions),domNode===rootNode&&(rootNode=newNode);else newNode=patchOp(patchList,domNode,renderOptions),domNode===rootNode&&(rootNode=newNode);return rootNode}function patchIndices(patches){var indices=[];for(var key in patches)"a"!==key&&indices.push(Number(key));return indices}var document=require("global/document"),isArray=require("x-is-array"),domIndex=require("./dom-index"),patchOp=require("./patch-op");module.exports=patch},{"./dom-index":105,"./patch-op":106,"global/document":100,"x-is-array":102}],108:[function(require,module){function updateWidget(a,b){return isWidget(a)&&isWidget(b)?"name"in a&&"name"in b?a.id===b.id:a.init===b.init:!1}var isWidget=require("../vnode/is-widget.js");module.exports=updateWidget},{"../vnode/is-widget.js":118}],109:[function(require,module){"use strict";function EvHook(value){return this instanceof EvHook?void(this.value=value):new EvHook(value)}var EvStore=require("ev-store");module.exports=EvHook,EvHook.prototype.hook=function(node,propertyName){var es=EvStore(node),propName=propertyName.substr(3);es[propName]=this.value},EvHook.prototype.unhook=function(node,propertyName){var es=EvStore(node),propName=propertyName.substr(3);es[propName]=void 0}},{"ev-store":97}],110:[function(require,module){"use strict";function SoftSetHook(value){return this instanceof SoftSetHook?void(this.value=value):new SoftSetHook(value)}module.exports=SoftSetHook,SoftSetHook.prototype.hook=function(node,propertyName){node[propertyName]!==this.value&&(node[propertyName]=this.value)}},{}],111:[function(require,module){"use strict";function h(tagName,properties,children){var tag,props,key,namespace,childNodes=[];return!children&&isChildren(properties)&&(children=properties,props={}),props=props||properties||{},tag=parseTag(tagName,props),props.hasOwnProperty("key")&&(key=props.key,props.key=void 0),props.hasOwnProperty("namespace")&&(namespace=props.namespace,props.namespace=void 0),"INPUT"!==tag||namespace||!props.hasOwnProperty("value")||void 0===props.value||isHook(props.value)||(props.value=softSetHook(props.value)),transformProperties(props),void 0!==children&&null!==children&&addChild(children,childNodes,tag,props),new VNode(tag,props,childNodes,key,namespace)}function addChild(c,childNodes,tag,props){if("string"==typeof c)childNodes.push(new VText(c));else if(isChild(c))childNodes.push(c);else{if(!isArray(c)){if(null===c||void 0===c)return;throw UnexpectedVirtualElement({foreignObject:c,parentVnode:{tagName:tag,properties:props}})}for(var i=0;i<c.length;i++)addChild(c[i],childNodes,tag,props)}}function transformProperties(props){for(var propName in props)if(props.hasOwnProperty(propName)){var value=props[propName];if(isHook(value))continue;"ev-"===propName.substr(0,3)&&(props[propName]=evHook(value))}}function isChild(x){return isVNode(x)||isVText(x)||isWidget(x)||isVThunk(x)}function isChildren(x){return"string"==typeof x||isArray(x)||isChild(x)}function UnexpectedVirtualElement(data){var err=new Error;return err.type="virtual-hyperscript.unexpected.virtual-element",err.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+errorString(data.foreignObject)+".\nThe parent vnode is:\n"+errorString(data.parentVnode),err.foreignObject=data.foreignObject,err.parentVnode=data.parentVnode,err}function errorString(obj){try{return JSON.stringify(obj,null,"    ")}catch(e){return String(obj)}}var isArray=require("x-is-array"),VNode=require("../vnode/vnode.js"),VText=require("../vnode/vtext.js"),isVNode=require("../vnode/is-vnode"),isVText=require("../vnode/is-vtext"),isWidget=require("../vnode/is-widget"),isHook=require("../vnode/is-vhook"),isVThunk=require("../vnode/is-thunk"),parseTag=require("./parse-tag.js"),softSetHook=require("./hooks/soft-set-hook.js"),evHook=require("./hooks/ev-hook.js");module.exports=h},{"../vnode/is-thunk":114,"../vnode/is-vhook":115,"../vnode/is-vnode":116,"../vnode/is-vtext":117,"../vnode/is-widget":118,"../vnode/vnode.js":120,"../vnode/vtext.js":122,"./hooks/ev-hook.js":109,"./hooks/soft-set-hook.js":110,"./parse-tag.js":112,"x-is-array":102}],112:[function(require,module){"use strict";function parseTag(tag,props){if(!tag)return"DIV";var noId=!props.hasOwnProperty("id"),tagParts=split(tag,classIdSplit),tagName=null;notClassId.test(tagParts[1])&&(tagName="DIV");var classes,part,type,i;for(i=0;i<tagParts.length;i++)part=tagParts[i],part&&(type=part.charAt(0),tagName?"."===type?(classes=classes||[],classes.push(part.substring(1,part.length))):"#"===type&&noId&&(props.id=part.substring(1,part.length)):tagName=part);return classes&&(props.className&&classes.push(props.className),props.className=classes.join(" ")),props.namespace?tagName:tagName.toUpperCase()}var split=require("browser-split"),classIdSplit=/([\.#]?[a-zA-Z0-9_:-]+)/,notClassId=/^\.|#/;module.exports=parseTag},{"browser-split":96}],113:[function(require,module){function handleThunk(a,b){var renderedA=a,renderedB=b;return isThunk(b)&&(renderedB=renderThunk(b,a)),isThunk(a)&&(renderedA=renderThunk(a,null)),{a:renderedA,b:renderedB}}function renderThunk(thunk,previous){var renderedThunk=thunk.vnode;if(renderedThunk||(renderedThunk=thunk.vnode=thunk.render(previous)),!(isVNode(renderedThunk)||isVText(renderedThunk)||isWidget(renderedThunk)))throw new Error("thunk did not return a valid node");return renderedThunk}var isVNode=require("./is-vnode"),isVText=require("./is-vtext"),isWidget=require("./is-widget"),isThunk=require("./is-thunk");module.exports=handleThunk},{"./is-thunk":114,"./is-vnode":116,"./is-vtext":117,"./is-widget":118}],114:[function(require,module){function isThunk(t){return t&&"Thunk"===t.type}module.exports=isThunk},{}],115:[function(require,module){function isHook(hook){return hook&&("function"==typeof hook.hook&&!hook.hasOwnProperty("hook")||"function"==typeof hook.unhook&&!hook.hasOwnProperty("unhook"))}module.exports=isHook},{}],116:[function(require,module){function isVirtualNode(x){return x&&"VirtualNode"===x.type&&x.version===version}var version=require("./version");module.exports=isVirtualNode},{"./version":119}],117:[function(require,module){function isVirtualText(x){return x&&"VirtualText"===x.type&&x.version===version}var version=require("./version");module.exports=isVirtualText},{"./version":119}],118:[function(require,module){function isWidget(w){return w&&"Widget"===w.type}module.exports=isWidget},{}],119:[function(require,module){module.exports="1"},{}],120:[function(require,module){function VirtualNode(tagName,properties,children,key,namespace){this.tagName=tagName,this.properties=properties||noProperties,this.children=children||noChildren,this.key=null!=key?String(key):void 0,this.namespace="string"==typeof namespace?namespace:null;var hooks,count=children&&children.length||0,descendants=0,hasWidgets=!1,hasThunks=!1,descendantHooks=!1;for(var propName in properties)if(properties.hasOwnProperty(propName)){var property=properties[propName];isVHook(property)&&property.unhook&&(hooks||(hooks={}),hooks[propName]=property)}for(var i=0;count>i;i++){var child=children[i];isVNode(child)?(descendants+=child.count||0,!hasWidgets&&child.hasWidgets&&(hasWidgets=!0),!hasThunks&&child.hasThunks&&(hasThunks=!0),descendantHooks||!child.hooks&&!child.descendantHooks||(descendantHooks=!0)):!hasWidgets&&isWidget(child)?"function"==typeof child.destroy&&(hasWidgets=!0):!hasThunks&&isThunk(child)&&(hasThunks=!0)}this.count=count+descendants,this.hasWidgets=hasWidgets,this.hasThunks=hasThunks,this.hooks=hooks,this.descendantHooks=descendantHooks}var version=require("./version"),isVNode=require("./is-vnode"),isWidget=require("./is-widget"),isThunk=require("./is-thunk"),isVHook=require("./is-vhook");module.exports=VirtualNode;var noProperties={},noChildren=[];VirtualNode.prototype.version=version,VirtualNode.prototype.type="VirtualNode"},{"./is-thunk":114,"./is-vhook":115,"./is-vnode":116,"./is-widget":118,"./version":119}],121:[function(require,module){function VirtualPatch(type,vNode,patch){this.type=Number(type),this.vNode=vNode,this.patch=patch}var version=require("./version");VirtualPatch.NONE=0,VirtualPatch.VTEXT=1,VirtualPatch.VNODE=2,VirtualPatch.WIDGET=3,VirtualPatch.PROPS=4,VirtualPatch.ORDER=5,VirtualPatch.INSERT=6,VirtualPatch.REMOVE=7,VirtualPatch.THUNK=8,module.exports=VirtualPatch,VirtualPatch.prototype.version=version,VirtualPatch.prototype.type="VirtualPatch"},{"./version":119}],122:[function(require,module){function VirtualText(text){this.text=String(text)}var version=require("./version");module.exports=VirtualText,VirtualText.prototype.version=version,VirtualText.prototype.type="VirtualText"},{"./version":119}],123:[function(require,module){function diffProps(a,b){var diff;for(var aKey in a){aKey in b||(diff=diff||{},diff[aKey]=void 0);var aValue=a[aKey],bValue=b[aKey];if(aValue!==bValue)if(isObject(aValue)&&isObject(bValue))if(getPrototype(bValue)!==getPrototype(aValue))diff=diff||{},diff[aKey]=bValue;else if(isHook(bValue))diff=diff||{},diff[aKey]=bValue;else{var objectDiff=diffProps(aValue,bValue);objectDiff&&(diff=diff||{},diff[aKey]=objectDiff)}else diff=diff||{},diff[aKey]=bValue}for(var bKey in b)bKey in a||(diff=diff||{},diff[bKey]=b[bKey]);return diff}function getPrototype(value){return Object.getPrototypeOf?Object.getPrototypeOf(value):value.__proto__?value.__proto__:value.constructor?value.constructor.prototype:void 0}var isObject=require("is-object"),isHook=require("../vnode/is-vhook");module.exports=diffProps},{"../vnode/is-vhook":115,"is-object":101}],124:[function(require,module){function diff(a,b){var patch={a:a};return walk(a,b,patch,0),patch}function walk(a,b,patch,index){if(a!==b){var apply=patch[index],applyClear=!1;
if(isThunk(a)||isThunk(b))thunks(a,b,patch,index);else if(null==b)isWidget(a)||(clearState(a,patch,index),apply=patch[index]),apply=appendPatch(apply,new VPatch(VPatch.REMOVE,a,b));else if(isVNode(b))if(isVNode(a))if(a.tagName===b.tagName&&a.namespace===b.namespace&&a.key===b.key){var propsPatch=diffProps(a.properties,b.properties);propsPatch&&(apply=appendPatch(apply,new VPatch(VPatch.PROPS,a,propsPatch))),apply=diffChildren(a,b,patch,apply,index)}else apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b)),applyClear=!0;else apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b)),applyClear=!0;else isVText(b)?isVText(a)?a.text!==b.text&&(apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b))):(apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b)),applyClear=!0):isWidget(b)&&(isWidget(a)||(applyClear=!0),apply=appendPatch(apply,new VPatch(VPatch.WIDGET,a,b)));apply&&(patch[index]=apply),applyClear&&clearState(a,patch,index)}}function diffChildren(a,b,patch,apply,index){for(var aChildren=a.children,bChildren=reorder(aChildren,b.children),aLen=aChildren.length,bLen=bChildren.length,len=aLen>bLen?aLen:bLen,i=0;len>i;i++){var leftNode=aChildren[i],rightNode=bChildren[i];index+=1,leftNode?walk(leftNode,rightNode,patch,index):rightNode&&(apply=appendPatch(apply,new VPatch(VPatch.INSERT,null,rightNode))),isVNode(leftNode)&&leftNode.count&&(index+=leftNode.count)}return bChildren.moves&&(apply=appendPatch(apply,new VPatch(VPatch.ORDER,a,bChildren.moves))),apply}function clearState(vNode,patch,index){unhook(vNode,patch,index),destroyWidgets(vNode,patch,index)}function destroyWidgets(vNode,patch,index){if(isWidget(vNode))"function"==typeof vNode.destroy&&(patch[index]=appendPatch(patch[index],new VPatch(VPatch.REMOVE,vNode,null)));else if(isVNode(vNode)&&(vNode.hasWidgets||vNode.hasThunks))for(var children=vNode.children,len=children.length,i=0;len>i;i++){var child=children[i];index+=1,destroyWidgets(child,patch,index),isVNode(child)&&child.count&&(index+=child.count)}else isThunk(vNode)&&thunks(vNode,null,patch,index)}function thunks(a,b,patch,index){var nodes=handleThunk(a,b),thunkPatch=diff(nodes.a,nodes.b);hasPatches(thunkPatch)&&(patch[index]=new VPatch(VPatch.THUNK,null,thunkPatch))}function hasPatches(patch){for(var index in patch)if("a"!==index)return!0;return!1}function unhook(vNode,patch,index){if(isVNode(vNode)){if(vNode.hooks&&(patch[index]=appendPatch(patch[index],new VPatch(VPatch.PROPS,vNode,undefinedKeys(vNode.hooks)))),vNode.descendantHooks||vNode.hasThunks)for(var children=vNode.children,len=children.length,i=0;len>i;i++){var child=children[i];index+=1,unhook(child,patch,index),isVNode(child)&&child.count&&(index+=child.count)}}else isThunk(vNode)&&thunks(vNode,null,patch,index)}function undefinedKeys(obj){var result={};for(var key in obj)result[key]=void 0;return result}function reorder(aChildren,bChildren){var bKeys=keyIndex(bChildren);if(!bKeys)return bChildren;var aKeys=keyIndex(aChildren);if(!aKeys)return bChildren;var bMatch={},aMatch={};for(var aKey in bKeys)bMatch[bKeys[aKey]]=aKeys[aKey];for(var bKey in aKeys)aMatch[aKeys[bKey]]=bKeys[bKey];for(var aLen=aChildren.length,bLen=bChildren.length,len=aLen>bLen?aLen:bLen,shuffle=[],freeIndex=0,i=0,moveIndex=0,moves={},removes=moves.removes={},reverse=moves.reverse={},hasMoves=!1;len>freeIndex;){var move=aMatch[i];if(void 0!==move)shuffle[i]=bChildren[move],move!==moveIndex&&(moves[move]=moveIndex,reverse[moveIndex]=move,hasMoves=!0),moveIndex++;else if(i in aMatch)shuffle[i]=void 0,removes[i]=moveIndex++,hasMoves=!0;else{for(;void 0!==bMatch[freeIndex];)freeIndex++;if(len>freeIndex){var freeChild=bChildren[freeIndex];freeChild&&(shuffle[i]=freeChild,freeIndex!==moveIndex&&(hasMoves=!0,moves[freeIndex]=moveIndex,reverse[moveIndex]=freeIndex),moveIndex++),freeIndex++}}i++}return hasMoves&&(shuffle.moves=moves),shuffle}function keyIndex(children){var i,keys;for(i=0;i<children.length;i++){var child=children[i];void 0!==child.key&&(keys=keys||{},keys[child.key]=i)}return keys}function appendPatch(apply,patch){return apply?(isArray(apply)?apply.push(patch):apply=[apply,patch],apply):patch}var isArray=require("x-is-array"),VPatch=require("../vnode/vpatch"),isVNode=require("../vnode/is-vnode"),isVText=require("../vnode/is-vtext"),isWidget=require("../vnode/is-widget"),isThunk=require("../vnode/is-thunk"),handleThunk=require("../vnode/handle-thunk"),diffProps=require("./diff-props");module.exports=diff},{"../vnode/handle-thunk":113,"../vnode/is-thunk":114,"../vnode/is-vnode":116,"../vnode/is-vtext":117,"../vnode/is-widget":118,"../vnode/vpatch":121,"./diff-props":123,"x-is-array":102}],125:[function(require,module){(function(process,global){var ee,EventEmitter=require("events").EventEmitter;ee=module.exports=null!=(ee=global.ee)?ee:new EventEmitter;var pouchdb=require("pouchdb"),stream=pouchdb(process.env.Vflow||"vflow");stream.changes({include_docs:!0,since:"now",live:!0}).on("change",function(change){var key=[change.doc.object.type,change.doc.verb].join(":");console.log(key),ee.emit(key,change.doc)}),ee.on("post",function(p){stream.post(p)})}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:132,events:131,pouchdb:41}],126:[function(){},{}],127:[function(require,module,exports){function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var length,type=typeof subject;if("number"===type)length=subject>0?subject>>>0:0;else if("string"===type)"base64"===encoding&&(subject=base64clean(subject)),length=Buffer.byteLength(subject,encoding);else{if("object"!==type||null===subject)throw new TypeError("must start with number, buffer, array or string");"Buffer"===subject.type&&isArray(subject.data)&&(subject=subject.data),length=+subject.length>0?Math.floor(+subject.length):0}if(this.length>kMaxLength)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength.toString(16)+" bytes");var buf;Buffer.TYPED_ARRAY_SUPPORT?buf=Buffer._augment(new Uint8Array(length)):(buf=this,buf.length=length,buf._isBuffer=!0);var i;if(Buffer.TYPED_ARRAY_SUPPORT&&"number"==typeof subject.byteLength)buf._set(subject);else if(isArrayish(subject))if(Buffer.isBuffer(subject))for(i=0;length>i;i++)buf[i]=subject.readUInt8(i);else for(i=0;length>i;i++)buf[i]=(subject[i]%256+256)%256;else if("string"===type)buf.write(subject,0,encoding);else if("number"===type&&!Buffer.TYPED_ARRAY_SUPPORT&&!noZero)for(i=0;length>i;i++)buf[i]=0;return buf}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var byte=parseInt(string.substr(2*i,2),16);if(isNaN(byte))throw new Error("Invalid hex string");buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length);return charsWritten}function base64Slice(buf,start,end){return base64.fromByteArray(0===start&&end===buf.length?buf:buf.slice(start,end))}function utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function binarySlice(buf,start,end){return asciiSlice(buf,start,end)}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||min>value)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){for(str=stringtrim(str).replace(INVALID_BASE64_RE,"");str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&"object"==typeof subject&&"number"==typeof subject.length}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(str){for(var byteArray=[],i=0;i<str.length;i++){var b=str.charCodeAt(i);if(127>=b)byteArray.push(b);else{var start=i;b>=55296&&57343>=b&&i++;for(var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%"),j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str){for(var c,hi,lo,byteArray=[],i=0;i<str.length;i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("is-array");exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var kMaxLength=1073741823;Buffer.TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0),arr=new Uint8Array(buf);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(e){return!1}}(),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];i++);return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,totalLength){if(!isArray(list))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if(void 0===totalLength)for(totalLength=0,i=0;i<list.length;i++)totalLength+=list[i].length;var buf=new Buffer(totalLength),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=function(str,encoding){var ret;switch(str+="",encoding||"utf8"){case"ascii":case"binary":case"raw":ret=str.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=2*str.length;break;case"hex":ret=str.length>>>1;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"base64":ret=base64ToBytes(str).length;break;default:ret=str.length}return ret},Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0,Buffer.prototype.toString=function(encoding,start,end){var loweredCase=!1;if(start>>>=0,end=void 0===end||1/0===end?this.length:end>>>0,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return 0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset))isFinite(length)||(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=length,length=swap}offset=Number(offset)||0;var remaining=this.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining,encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new TypeError("Unknown encoding: "+encoding)}return ret},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(start,end){var len=this.length;if(start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)return Buffer._augment(this.subarray(start,end));for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0,!0),i=0;sliceLen>i;i++)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(start||(start=0),end||0===end||(end=this.length),target_start||(target_start=0),end!==start&&0!==target.length&&0!==source.length){if(start>end)throw new TypeError("sourceEnd < sourceStart");if(0>target_start||target_start>=target.length)throw new TypeError("targetStart out of bounds");if(0>start||start>=source.length)throw new TypeError("sourceStart out of bounds");if(0>end||end>source.length)throw new TypeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-target_start<end-start&&(end=target.length-target_start+start);var len=end-start;if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;len>i;i++)target[i+target_start]=this[i+start];else target._set(this.subarray(start,start+len),target_start)}},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new TypeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new TypeError("start out of bounds");if(0>end||end>this.length)throw new TypeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._get=arr.get,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g},{"base64-js":128,ieee754:129,"is-array":130}],128:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS?62:code===SLASH?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],129:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?0/0:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||1/0===value?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],130:[function(require,module){var isArray=Array.isArray,str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],131:[function(require,module){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;
if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],132:[function(require,module){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canMutationObserver="undefined"!=typeof window&&window.MutationObserver,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div"),observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0,queueList.forEach(function(fn){fn()})});return observer.observe(hiddenDiv,{attributes:!0}),function(fn){queue.length||hiddenDiv.setAttribute("yes","no"),queue.push(fn)}}return canPost?(window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}):function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")}},{}]},{},[1]);