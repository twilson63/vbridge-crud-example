//var ee = require('vflow-pouchdb');
var ee = require('../../flow');

var h = require('vbridge').h;
var page = require('page');

function user(state) {
  ee.on('user:created', function(doc) {
    page.redirect('/login');
  });

  page('/signup', function(ctx) {
    state.set('ref', 'signup');
  });

  page('/users/create', function(ctx) {
    ee.emit('post', {
      verb: 'create',
      object: ctx.body,
      actor: null
    })
  });
}

function render(state) {
  return h('div', [
    h('.row', [
      h('.twelve.columns', [
        h('form', { action:'/users/create', method: 'POST'}, [
          h('input', { type: 'hidden', name: 'type', value: 'user'}),
          h('fieldset', [
            h('label', 'Username'),
            h('input.u-full-width', {type: 'text', name: 'name'})  
          ]),
          h('fieldset', [
            h('label', 'Password'),
            h('input.u-full-width', {type: 'password', name: 'password'})  
          ]),
          h('fieldset', [
            h('label', 'Email'),
            h('input.u-full-width', {type: 'text', name: 'email'})  
          ]),
          h('input.button.button-primary', { type: 'submit', value: 'Create User' } ),
          h('a.button', { href: '/'}, ['Cancel'])
        ])
      ])
    ])
  ])
}

user.render = render;
module.exports = user;