var ee = require('vflow-pouchdb');
var pouchdb = require('pouchdb');
pouchdb.plugin(require('pouchdb-authentication'));
var db = pouchdb(window.location.href + '/db');

module.exports = function() {
  ee.on('session:create', function(doc) {
    // everyone can login
    db.login(doc.object.name, doc.object.password, function(err, res) {
      if (err) { return console.log(err); }
      console.log(res);
      var e = {
        verb: 'created',
        object: doc.object
      };
      ee.emit('session:created', e);
    });
  });
};